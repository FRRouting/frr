/*BGProutingtable*Copyright(C)1998,2001KunihiroIshiguro**ThisfileispartofGNUZebr
a.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthetermsofthe
GNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversion2,or
(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwillbeusefu
l,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNES
SFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldh
avereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPY
ING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,
MA02110-1301USA*/#ifndef_QUAGGA_BGP_TABLE_H#define_QUAGGA_BGP_TABLE_H#include"mp
ls.h"#include"table.h"#include"queue.h"structbgp_table{/*afi/safiofthistable*/af
i_tafi;safi_tsafi;intlock;structroute_table*route_table;uint64_tversion;};struct
bgp_node{/**CAUTION**Thesefieldsmustbetheveryfirstfieldsinthisstructure.**@seebg
p_node_to_rnode*@seebgp_node_from_rnode*/ROUTE_NODE_FIELDSstructbgp_adj_out*adj_
out;structbgp_adj_in*adj_in;structbgp_node*prn;STAILQ_ENTRY(bgp_node)pq;mpls_lab
el_tlocal_label;uint64_tversion;uint8_tflags;#defineBGP_NODE_PROCESS_SCHEDULED(1
<<0)#defineBGP_NODE_USER_CLEAR(1<<1)#defineBGP_NODE_LABEL_CHANGED(1<<2)#defineBG
P_NODE_REGISTERED_FOR_LABEL(1<<3)};/**bgp_table_iter_t**Structurethatholdsstatef
oriteratingoverabgptable.*/typedefstructbgp_table_iter_t_{structbgp_table*table;
route_table_iter_trt_iter;}bgp_table_iter_t;externstructbgp_table*bgp_table_init
(afi_t,safi_t);externvoidbgp_table_lock(structbgp_table*);externvoidbgp_table_un
lock(structbgp_table*);externvoidbgp_table_finish(structbgp_table**);/**bgp_node
_from_rnode**Returnsthebgp_nodestructurecorrespondingtoaroute_node.*/staticinlin
estructbgp_node*bgp_node_from_rnode(structroute_node*rnode){return(structbgp_nod
e*)rnode;}/**bgp_node_to_rnode**Returnstheroute_nodestructurecorrespondingtoabgp
_node.*/staticinlinestructroute_node*bgp_node_to_rnode(structbgp_node*node){retu
rn(structroute_node*)node;}/**bgp_node_table**Returnsthebgp_tablethatthegivennod
eisin.*/staticinlinestructbgp_table*bgp_node_table(structbgp_node*node){returnbg
p_node_to_rnode(node)->table->info;}/**bgp_node_parent_nolock**Getstheparentnode
ofthegivennodewithoutlockingit.*/staticinlinestructbgp_node*bgp_node_parent_nolo
ck(structbgp_node*node){returnbgp_node_from_rnode(node->parent);}/**bgp_unlock_n
ode*/staticinlinevoidbgp_unlock_node(structbgp_node*node){route_unlock_node(bgp_
node_to_rnode(node));}/**bgp_table_top_nolock**Getsthetopnodeinthetablewithoutlo
ckingit.**@seebgp_table_top*/staticinlinestructbgp_node*bgp_table_top_nolock(con
ststructbgp_table*consttable){returnbgp_node_from_rnode(table->route_table->top)
;}/**bgp_table_top*/staticinlinestructbgp_node*bgp_table_top(conststructbgp_tabl
e*consttable){returnbgp_node_from_rnode(route_top(table->route_table));}/**bgp_r
oute_next*/staticinlinestructbgp_node*bgp_route_next(structbgp_node*node){return
bgp_node_from_rnode(route_next(bgp_node_to_rnode(node)));}/**bgp_route_next_unti
l*/staticinlinestructbgp_node*bgp_route_next_until(structbgp_node*node,structbgp
_node*limit){structroute_node*rnode;rnode=route_next_until(bgp_node_to_rnode(nod
e),bgp_node_to_rnode(limit));returnbgp_node_from_rnode(rnode);}/**bgp_node_get*/
staticinlinestructbgp_node*bgp_node_get(structbgp_table*consttable,structprefix*
p){returnbgp_node_from_rnode(route_node_get(table->route_table,p));}/**bgp_node_
lookup*/staticinlinestructbgp_node*bgp_node_lookup(conststructbgp_table*consttab
le,structprefix*p){returnbgp_node_from_rnode(route_node_lookup(table->route_tabl
e,p));}/**bgp_lock_node*/staticinlinestructbgp_node*bgp_lock_node(structbgp_node
*node){returnbgp_node_from_rnode(route_lock_node(bgp_node_to_rnode(node)));}/**b
gp_node_match*/staticinlinestructbgp_node*bgp_node_match(conststructbgp_table*ta
ble,structprefix*p){returnbgp_node_from_rnode(route_node_match(table->route_tabl
e,p));}/**bgp_node_match_ipv4*/staticinlinestructbgp_node*bgp_node_match_ipv4(co
nststructbgp_table*table,structin_addr*addr){returnbgp_node_from_rnode(route_nod
e_match_ipv4(table->route_table,addr));}/**bgp_node_match_ipv6*/staticinlinestru
ctbgp_node*bgp_node_match_ipv6(conststructbgp_table*table,structin6_addr*addr){r
eturnbgp_node_from_rnode(route_node_match_ipv6(table->route_table,addr));}static
inlineunsignedlongbgp_table_count(conststructbgp_table*consttable){returnroute_t
able_count(table->route_table);}/**bgp_table_get_next*/staticinlinestructbgp_nod
e*bgp_table_get_next(conststructbgp_table*table,structprefix*p){returnbgp_node_f
rom_rnode(route_table_get_next(table->route_table,p));}/**bgp_table_iter_init*/s
taticinlinevoidbgp_table_iter_init(bgp_table_iter_t*iter,structbgp_table*table){
bgp_table_lock(table);iter->table=table;route_table_iter_init(&iter->rt_iter,tab
le->route_table);}/**bgp_table_iter_next*/staticinlinestructbgp_node*bgp_table_i
ter_next(bgp_table_iter_t*iter){returnbgp_node_from_rnode(route_table_iter_next(
&iter->rt_iter));}/**bgp_table_iter_cleanup*/staticinlinevoidbgp_table_iter_clea
nup(bgp_table_iter_t*iter){route_table_iter_cleanup(&iter->rt_iter);bgp_table_un
lock(iter->table);iter->table=NULL;}/**bgp_table_iter_pause*/staticinlinevoidbgp
_table_iter_pause(bgp_table_iter_t*iter){route_table_iter_pause(&iter->rt_iter);
}/**bgp_table_iter_is_done*/staticinlineintbgp_table_iter_is_done(bgp_table_iter
_t*iter){returnroute_table_iter_is_done(&iter->rt_iter);}/**bgp_table_iter_start
ed*/staticinlineintbgp_table_iter_started(bgp_table_iter_t*iter){returnroute_tab
le_iter_started(&iter->rt_iter);}/*Thiswouldbenefitfromarealatomicoperation...*u
ntilthen.*/staticinlineuint64_tbgp_table_next_version(structbgp_table*table){ret
urn++table->version;}staticinlineuint64_tbgp_table_version(structbgp_table*table
){returntable->version;}#endif/*_QUAGGA_BGP_TABLE_H*/