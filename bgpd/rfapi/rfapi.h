/***Copyright2009-2016,LabNConsulting,L.L.C.***Thisprogramisfreesoftware;youcanr
edistributeitand/or*modifyitunderthetermsoftheGNUGeneralPublicLicense*aspublishe
dbytheFreeSoftwareFoundation;eitherversion2*oftheLicense,or(atyouroption)anylate
rversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,*butWITHOUTANYWAR
RANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURP
OSE.Seethe*GNUGeneralPublicLicenseformoredetails.**Youshouldhavereceivedacopyoft
heGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetoth
eFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#i
fndef_QUAGGA_BGP_RFAPI_H#define_QUAGGA_BGP_RFAPI_H#ifENABLE_BGP_VNC#include<stdi
nt.h>#include<netinet/in.h>#include"lib/zebra.h"#include"lib/vty.h"#include"lib/
prefix.h"#include"bgpd/bgpd.h"#include"bgpd/bgp_encap_types.h"/*probablyoughttoh
aveafield-specificdefineinconfig.h*/#ifndefs6_addr32/*forsolaris/bsd*/#ifdefSOLA
RIS_IPV6#defines6_addr32_S6_un._S6_u32#else#defines6_addr32__u6_addr.__u6_addr32
#endif#endif#defineRFAPI_V4_ADDR0x04#defineRFAPI_V6_ADDR0x06#defineRFAPI_SHOW_ST
R"VNCinformation\n"structrfapi_ip_addr{uint8_taddr_family;/*AF_INET|AF_INET6*/un
ion{structin_addrv4;/*innetworkorder*/structin6_addrv6;/*innetworkorder*/}addr;}
;structrfapi_ip_prefix{uint8_tlength;uint8_tcost;/*bgplocalpref=255-cost*/struct
rfapi_ip_addrprefix;};structrfapi_nexthop{structprefixaddr;uint8_tcost;};structr
fapi_next_hop_entry{structrfapi_next_hop_entry*next;structrfapi_ip_prefixprefix;
uint32_tlifetime;structrfapi_ip_addrun_address;structrfapi_ip_addrvn_address;str
uctrfapi_vn_option*vn_options;structrfapi_un_option*un_options;};#defineRFAPI_RE
MOVE_RESPONSE_LIFETIME0#defineRFAPI_INFINITE_LIFETIME0xFFFFFFFFstructrfapi_l2add
ress_option{structethaddrmacaddr;/*use0toassignlabeltoIPprefix*/uint32_tlabel;/*
20bitlabelinlowbits,noTC,S,orTTL*/uint32_tlogical_net_id;/*~=EVPNEthernetSegment
Id,mustnotbezeroformacregis.*/uint8_tlocal_nve_id;uint16_ttag_id;/*EVPNEthernetT
agID,0=none*/};typedefenum{RFAPI_UN_OPTION_TYPE_PROVISIONAL,/*internaluseonly*/R
FAPI_UN_OPTION_TYPE_TUNNELTYPE,}rfapi_un_option_type;structrfapi_tunneltype_opti
on{bgp_encap_typestype;union{structbgp_encap_type_reservedreserved;structbgp_enc
ap_type_l2tpv3_over_ipl2tpv3_ip;structbgp_encap_type_gregre;structbgp_encap_type
_transmit_tunnel_endpointtransmit_tunnel_endpoint;structbgp_encap_type_ipsec_in_
tunnel_modeipsec_tunnel;structbgp_encap_type_ip_in_ip_tunnel_with_ipsec_transpor
t_modeip_ipsec;structbgp_encap_type_mpls_in_ip_tunnel_with_ipsec_transport_modem
pls_ipsec;structbgp_encap_type_ip_in_ipip_ip;structbgp_encap_type_vxlanvxlan;str
uctbgp_encap_type_nvgrenvgre;structbgp_encap_type_mplsmpls;structbgp_encap_type_
mpls_in_grempls_gre;structbgp_encap_type_vxlan_gpevxlan_gpe;structbgp_encap_type
_mpls_in_udpmpls_udp;structbgp_encap_type_pbbpbb;}bgpinfo;};structrfapi_un_optio
n{structrfapi_un_option*next;rfapi_un_option_typetype;union{structrfapi_tunnelty
pe_optiontunnel;}v;};typedefenum{RFAPI_VN_OPTION_TYPE_L2ADDR=3,/*Layer2address,3
forlegacycompatibility*/RFAPI_VN_OPTION_TYPE_LOCAL_NEXTHOP,/*forstaticroutes*/RF
API_VN_OPTION_TYPE_INTERNAL_RD,/*internaluseonly*/}rfapi_vn_option_type;structrf
api_vn_option{structrfapi_vn_option*next;rfapi_vn_option_typetype;union{structrf
api_l2address_optionl2addr;/**Ifthisoptionispresent,thenexthopislocaltothe*clien
tNVE(i.e.,notviaatunnel).*/structrfapi_nexthoplocal_nexthop;/**Forrfapiinternalu
seonly*/structprefix_rdinternal_rd;}v;};structrfapi_l2address_option_match{struc
trfapi_l2address_optiono;uint32_tflags;#defineRFAPI_L2O_MACADDR0x00000001#define
RFAPI_L2O_LABEL0x00000002#defineRFAPI_L2O_LNI0x00000004#defineRFAPI_L2O_LHI0x000
00008};#defineVNC_CONFIG_STR"VNC/RFPrelatedconfiguration\n"typedefvoid*rfapi_han
dle;/************************************************************************RFP
Callbacks***********************************************************************
//*------------------------------------------*rfapi_response_cb_t(callbacktypede
f)**Callbacksofthistypeareusedtoprovideasynchronous*routeupdatesfromRFAPItotheRF
Pclient.**response_cb*calledtonotifytherfpclientthatanexthoplist*thathasprevious
lybeenprovidedinresponsetoan*rfapi_querycallhasbeenupdated.Deletedroutesareindic
ated*withlifetime==RFAPI_REMOVE_RESPONSE_LIFETIME.**Bydefault,theroutesanNVErece
ivesviathiscallbackinclude*itsownroutes(thatithasregistered).However,thesemaybe*
filteredoutiftheglobalBGP_VNC_CONFIG_FILTER_SELF_FROM_RSP*flagisset.**local_cb*c
alledtonotifytherfpclientthatalocalroute*hasbeenaddedordeleted.Deletedroutesarei
ndicated*withlifetime==RFAPI_REMOVE_RESPONSE_LIFETIME.**input:*next_hopsalistofp
ossiblenexthops.*Thisisalinkedlistallocatedwithinthe*rfapi.Theresponse_cbcallbac
kfunctionisresponsible*forfreeingthismemoryviarfapi_free_next_hop_list()*inorder
toavoidmemoryleaks.**userdatavalue(cookie)originallyspecifiedincallto*rfapi_open
()**------------------------------------------*/typedefvoid(rfapi_response_cb_t)
(structrfapi_next_hop_entry*next_hops,void*userdata);/*-------------------------
-----------------*rfapi_nve_close_cb_t(callbacktypedef)**Callbacksofthistypeareu
sedtoprovideasynchronous*notificationthatanrfapi_handlewasinvalidated**input:*pH
andleFirmerlyvalidrfapi_handlereturnedto*clientviarfapi_open().**reasonEIDRMhand
leadministrativelyclosed(clearnve...)*ESTALEhandleinvalidatedbyconfigurationchan
ge**------------------------------------------*/typedefvoid(rfapi_nve_close_cb_t
)(rfapi_handlepHandle,intreason);/*------------------------------------------*rf
p_cfg_write_cb_t(callbacktypedef)**Thiscallbackisusedtogenerateoutputforanyconfi
gparameters*thatmaysupportedbyRFPviaRFPdefinedvtycommandsatthebgp*level.Seelogle
velasanexample.**input:*vty--quaggavtycontext*rfp_start_val--valuereturnedbyrfp_
start**output:*tovty,rfprelatedconfiguration**returnvalue:*lineswritten---------
-----------------------------------*/typedefint(rfp_cfg_write_cb_t)(structvty*vt
y,void*rfp_start_val);/*------------------------------------------*rfp_cfg_group
_write_cb_t(callbacktypedef)**Thiscallbackisusedtogenerateoutputforanyconfigpara
meters*thatmaysupportedbyRFPviaRFPdefinedvtycommandsatthe*L2orNVElevel.Seeloglev
elasanexample.**input:*vtyquaggavtycontext*rfp_start_valvaluereturnedbyrfp_start
*typegrouptype*namegroupname*rfp_cfg_groupPointertoconfigurationstructure**outpu
t:*tovty,rfprelatedconfiguration**returnvalue:*lineswritten---------------------
-----------------------*/typedefenum{RFAPI_RFP_CFG_GROUP_DEFAULT,RFAPI_RFP_CFG_G
ROUP_NVE,RFAPI_RFP_CFG_GROUP_L2}rfapi_rfp_cfg_group_type;typedefint(rfp_cfg_grou
p_write_cb_t)(structvty*vty,void*rfp_start_val,rfapi_rfp_cfg_group_typetype,cons
tchar*name,void*rfp_cfg_group);/************************************************
************************Configurationrelateddefinesandstructures****************
*******************************************************/structrfapi_rfp_cb_metho
ds{rfp_cfg_write_cb_t*cfg_cb;/*showtoplevelconfig*/rfp_cfg_group_write_cb_t*cfg_
group_cb;/*showgrouplevelconfig*/rfapi_response_cb_t*response_cb;/*unsolicitedre
sponses*/rfapi_response_cb_t*local_cb;/*localrouteadd/delete*/rfapi_nve_close_cb
_t*close_cb;/*handleclosed*/};/**Ifaroutewithinfinitelifetimeiswithdrawn,thisis*
howlong(inseconds)towaitbeforeexpiringit(because*RFAPI_LIFETIME_MULTIPLIER_PCT*i
nfinityistoolongtowait)*/#defineRFAPI_LIFETIME_INFINITE_WITHDRAW_DELAY(60*120)/*
*thefactorthatshouldbeappliedtoaprefix's<lifetime>value*beforeusingittoexpireawi
thdrawnprefix,expressedasapercent.*Thus,avalueof100meanstousetheexactvalueof<lif
etime>,*avalueof200meanstousetwicethevalueof<lifetime>,etc.*/#defineRFAPI_RFP_CF
G_DEFAULT_HOLDDOWN_FACTOR150/**ThisisusedbyrfapitodetermineifRFPisusing/supports
*apartial(i.e.,cache)orfulltabledownloadapproachfor*mappinginformation.Whenfullt
abledownloadapproachis*usedallinformationispassedtoRFPafteraninitial*rfapi_query
.Whenpartialtabledownloadisused,only*informationmatchingaqueryispassed.*/typedef
enum{RFAPI_RFP_DOWNLOAD_PARTIAL=0,RFAPI_RFP_DOWNLOAD_FULL}rfapi_rfp_download_typ
e;#defineRFAPI_RFP_CFG_DEFAULT_FTD_ADVERTISEMENT_INTERVAL1structrfapi_rfp_cfg{/*
partialorfulltabledownload*/rfapi_rfp_download_typedownload_type;/*default=parti
al*//**Whenfull-table-downloadisenabled,thisistheminimum*numberofsecondsbetweent
imesanon-queriedprefixwill*beupdatedtoaparticularNVE.*default:RFAPI_RFP_CFG_DEFA
ULT_FTD_ADVERTISEMENT_INTERVAL*/uint32_tftd_advertisement_interval;/**percentage
ofregistrationlifetimetocontinuetouseinformation*postsoft-staterefreshtimeoutdef
ault:RFAPI_RFP_CFG_DEFAULT_HOLDDOWN_FACTOR*/uint32_tholddown_factor;/*Controlgen
erationofupdatedRFPresponses*/uint8_tuse_updated_response;/*default=0/no*//*when
use_updated_response,alsogenerateremoveresponses*/uint8_tuse_removes;/*default=0
/no*/};/************************************************************************
Processrelatedfunctions--MUSTbeprovidedbytheRFAPIuser<<===**********************
*************************************************//*----------------------------
--------------*rfp_start**ThisfunctionwillstarttheRFPcode**input:*masterquaggath
read_mastertotieintobgpdthreads**output:*cfgpPointertorfapi_rfp_cfg(null=usedefa
ults),*copiedbycaller,updatedviarfp_set_configuration*cbmpPointertorfapi_rfp_cb_
methods,maybenull*copiedbycaller,updatedviarfapi_rfp_set_cb_methods*returnvalue:
*rfp_start_valrfpreturnedvaluepassedonrfp_stopandotherrfapicalls----------------
----------------------------*/externvoid*rfp_start(structthread_master*master,st
ructrfapi_rfp_cfg**cfgp,structrfapi_rfp_cb_methods**cbmp);/*--------------------
----------------------*rfp_stop**ThisfunctioniscalledonshutdowntotriggerRFPclean
up**input:*rfp_start_val**output:*none**returnvalue:----------------------------
----------------*/externvoidrfp_stop(void*rfp_start_val);/**********************
**************************************************RFPprocessingbehaviorconfigura
tion***********************************************************************//*--
----------------------------------------*rfapi_rfp_set_configuration**Thisisused
tochangerfapi'sprocessingbehaviorbasedon*RFPrequirements.**input:*rfp_start_valv
aluereturnedbyrfp_start*rfapi_rfp_cfgPointertoconfigurationstructure**output:*no
ne**returnvalue:*0Success*ENXIOUnabledtolocateconfiguredBGP/VNC-----------------
---------------------------*/externintrfapi_rfp_set_configuration(void*rfp_start
_val,structrfapi_rfp_cfg*rfp_cfg);/*------------------------------------------*r
fapi_rfp_set_cb_methods**Changeregisteredcallbackfunctionsforasynchronousnotific
ations*fromRFAPItotheRFPclient.**input:*rfp_start_valvaluebyrfp_start*methodsPoi
ntertostructrfapi_rfp_cb_methodscontaining*pointerstocallbackmethodsasdescribeda
bove**returnvalue:*0Success*ENXIOBGPorVNCnotconfigured*-------------------------
-----------------*/externintrfapi_rfp_set_cb_methods(void*rfp_start_val,structrf
api_rfp_cb_methods*methods);/***************************************************
*********************RFPgroupspecificconfiguration******************************
*****************************************//*------------------------------------
------*rfapi_rfp_init_group_config_ptr_vty**Thisisusedtoinitorreturnapreviouslyi
nit'edgroupspecific*configurationpointer.Groupisidentifiedbyvtycontext.*NOTE:siz
eisignoredwhenapreviouslyinit'edvalueisreturned.*RFAPIfreesrfp_cfg_groupwhengrou
pisdeletedduringreconfig,*bgprestartorshutdown.**input:*rfp_start_valvaluereturn
edbyrfp_start*typegrouptype*vtyquaggavtycontext*sizenumberofbytestoallocation**o
utput:*none**returnvalue:*rfp_cfg_groupNULLorPointertoconfigurationstructure----
----------------------------------------*/externvoid*rfapi_rfp_init_group_config
_ptr_vty(void*rfp_start_val,rfapi_rfp_cfg_group_typetype,structvty*vty,uint32_ts
ize);/*------------------------------------------*rfapi_rfp_get_group_config_ptr
_vty**Thisisusedtogetgroupspecificconfigurationpointer.*Groupisidentifiedbytypea
ndvtycontext.*RFAPIfreesrfp_cfg_groupwhengroupisdeletedduringreconfig,*bgprestar
torshutdown.**input:*rfp_start_valvaluereturnedbyrfp_start*typegrouptype*vtyquag
gavtycontext**output:*none**returnvalue:*rfp_cfg_groupPointertoconfigurationstru
cture--------------------------------------------*/externvoid*rfapi_rfp_get_grou
p_config_ptr_vty(void*rfp_start_val,rfapi_rfp_cfg_group_typetype,structvty*vty);
/*------------------------------------------*rfp_group_config_search_cb_t(callba
cktypedef)**Thiscallbackisusedtocalledfromwithina*rfapi_rfp_get_group_config_ptr
tocheckiftherfp_cfg_group*matchesthesearchcriteria**input:*criteriaRFAPIcallerpr
ovidedserachcriteria*rfp_cfg_groupPointertoconfigurationstructure|NULL**output:*
*returnvalue:*0Match/Success*ENOENTNomatching-----------------------------------
---------*/typedefint(rfp_group_config_search_cb_t)(void*criteria,void*rfp_cfg_g
roup);/*------------------------------------------*rfapi_rfp_get_group_config_pt
r_name**Thisisusedtogetgroupspecificconfigurationpointer.*Groupisidentifiedbytyp
eandnamecontext.*RFAPIfreesrfp_cfg_groupwhengroupisdeletedduringreconfig,*bgpres
tartorshutdown.**input:*rfp_start_valvaluereturnedbyrfp_start*typegrouptype*name
groupname*criteriaRFAPIcallerprovidedserachcriteria*search_cboptionalrfp_group_c
onfig_search_cb_t**output:*none**returnvalue:*rfp_cfg_groupPointertoconfiguratio
nstructure--------------------------------------------*/externvoid*rfapi_rfp_get
_group_config_ptr_name(void*rfp_start_val,rfapi_rfp_cfg_group_typetype,constchar
*name,void*criteria,rfp_group_config_search_cb_t*search_cb);/*------------------
------------------------*rfapi_rfp_get_l2_group_config_ptr_lni**Thisisusedtogetg
roupspecificconfigurationpointer.*Groupisidentifiedbytypeandlogicalnetworkidenti
fier.*RFAPIfreesrfp_cfg_groupwhengroupisdeletedduringreconfig,*bgprestartorshutd
own.**input:*rfp_start_valvaluereturnedbyrfp_start*logical_net_idgrouplogicalnet
workidentifier*criteriaRFAPIcallerprovidedserachcriteria*search_cboptionalrfp_gr
oup_config_search_cb_t**output:*none**returnvalue:*rfp_cfg_groupPointertoconfigu
rationstructure--------------------------------------------*/externvoid*rfapi_rf
p_get_l2_group_config_ptr_lni(void*rfp_start_val,uint32_tlogical_net_id,void*cri
teria,rfp_group_config_search_cb_t*search_cb);/*********************************
***************************************NVESessions******************************
*****************************************//*------------------------------------
------*rfapi_open**ThisfunctioninitializesaNVErecordandassociatesitwith*thespeci
fiedVNandunderlaynetworkaddresses**input:*rfp_start_valvaluereturnedbyrfp_start*
vnNVEvirtualnetworkaddress**unNVEunderlaynetworkaddress**default_optionsDefaulto
ptionstouseonregistrations.*Fornowonlytunneltypeissupported.*Maybeoverriddenper-
prefixinrfapi_register().*Callerowns(rfapi_open()doesnotfree)**response_cbPointe
rtonexthoplistupdatecallbackfunctionor*NULLwhennocallbacksaredesired.**userdataP
assedtosubsequentresponse_cbinvocations.**output:*response_lifetimeThelengthofti
methatresponsessenttothis*NVEarevalid.**pHandlepointertolocationtostorerfapihand
le.The*handlemustbepassedonsubsequentrfapi_calls.***returnvalue:*0Success*EEXIST
NVEwiththis{vn,un}alreadyopen*ENOENTNomatchingnvegroupconfig*ENOMSGMatchednvegro
upconfigwasincomplete*ENXIOBGPorVNCnotconfigured*EAFNOSUPPORTMatchednvegroupspec
ifiesauto-assignmentofRD,*butunderlaynetworkaddressisnotIPv4*EDEADLKCalledfromwi
thinacallbackprocedure*------------------------------------------*/externintrfap
i_open(void*rfp_start_val,structrfapi_ip_addr*vn,structrfapi_ip_addr*un,structrf
api_un_option*default_options,uint32_t*response_lifetime,void*userdata,rfapi_han
dle*pHandle);/*------------------------------------------*rfapi_close**ShutdownN
VEsessionandreleaseassociateddata.Calling*fromwithinarfapicallbackprocedureisper
mitted(theclose*willbecompletedasynchronouslyafterthecallbackfinishes).**input:*
rfd:rfapidescriptorreturnedbyrfapi_open**output:**returnvalue:*0Success*EBADFinv
alidhandle*ENXIOBGPorVNCnotconfigured*------------------------------------------
*/externintrfapi_close(rfapi_handlerfd);/*--------------------------------------
----*rfapi_check**Testrfapidescriptor**input:*rfd:rfapidescriptorreturnedbyrfapi
_open**output:**returnvalue:*0Success:handleisvalidandusable*EINVALnullargument*
ESTALEformerlyvalidhandleinvalidatedbyconfig,needsclose*EBADFinvalidhandle*ENXIO
BGPorVNCnotconfigured*EAFNOSUPPORTInternaladdressingerror*----------------------
--------------------*/externintrfapi_check(rfapi_handlerfd);/*******************
*****************************************************NVERoutes******************
*****************************************************//*------------------------
------------------*rfapi_query**ThisfunctionqueriestheRIBfora*particularroute.No
tethatthiscallmayresultinsubsequent*callbackstoresponse_cb.Responsecallbackscanb
ecancelled*bycallingrfapi_query_done.Aduplicatequeryusingthesametarget*willresul
tinonlyonecallbackperchangeinnext_hops.(i.e.,*cancel/replacethepriorqueryresults
.)**input:*rfd:rfapidescriptorreturnedbyrfapi_open*target:thedestinationaddress*
l2optrtoL2Optionsstruct,NULLifnotpresentinquery**output:*ppNextHopEntrypointerto
alocationtostoreapointer*tothereturnedlistofnexthops.Itisthe*caller'sresponsibil
itytofreethislist*viarfapi_free_next_hop_list().***returnvalue:*0Success*EBADFin
validhandle*ENOENTnovalidroute*ENXIOBGPorVNCnotconfigured*ESTALEdescriptorisnolo
ngerusable;shouldbeclosed*EDEADLKCalledfromwithinacallbackprocedure-------------
-------------------------------*/externintrfapi_query(rfapi_handlerfd,structrfap
i_ip_addr*target,structrfapi_l2address_option*l2o,structrfapi_next_hop_entry**pp
NextHopEntry);/*------------------------------------------*rfapi_query_done**Not
ifiestherfapithattheuserisnolongerinterested*inthespecifiedtarget.**input:*rfd:r
fapidescriptorreturnedbyrfapi_open*target:thedestinationaddress**output:**return
value:*0Success*EBADFinvalidhandle*ENOENTnomatchfoundfortarget*ENXIOBGPorVNCnotc
onfigured*ESTALEdescriptorisnolongerusable;shouldbeclosed*EDEADLKCalledfromwithi
nacallbackprocedure--------------------------------------------*/externintrfapi_
query_done(rfapi_handlerfd,structrfapi_ip_addr*target);/*-----------------------
-------------------*rfapi_query_done_all**Notifiestherfapithattheuserisnolongeri
nterested*inanytarget.**input:*rfd:rfapidescriptorreturnedbyrfapi_open**output:*
count:numberofqueriescleared**returnvalue:*0Success*EBADFinvalidhandle*ENXIOBGPo
rVNCnotconfigured*ESTALEdescriptorisnolongerusable;shouldbeclosed*EDEADLKCalledf
romwithinacallbackprocedure--------------------------------------------*/externi
ntrfapi_query_done_all(rfapi_handlerfd,int*count);/*----------------------------
--------------*rfapi_register**Requeststhatreachabilitytotheindicatedprefixviath
isNVE*beadvertisedbyBGP.If<unregister>isnon-zero,thenthepreviously-*advertisedpr
efixshouldbewithdrawn.**(ThisfunctionshouldNOTbecallediftherfapi_open()function*
returnsNULL)**input:*rfd:rfapidescriptorreturnedbyrfapi_open*prefix:Aprefixtober
egisteredorderegistered*lifetimePrefixlifetimeinseconds,hostbyteorder*options_un
underlaynetowrkoptions,mayincludetunnel-type*Callerowns(rfapi_register()doesnotf
ree).*options_vnvirtualnetworkoptions,mayincludelayer2address*optionandlocal-nex
thopoption*Callerowns(rfapi_register()doesnotfree).**action:RFAPI_REGISTER_ADDad
dtheroute*RFAPI_REGISTER_WITHDRAWwithdrawroute*RFAPI_REGISTER_KILLwithdrawwithou
tholddown**returnvalue:*0Success*EBADFinvalidhandle*ENXIOBGPorVNCnotconfigured*E
STALEdescriptorisnolongerusable;shouldbeclosed*EDEADLKCalledfromwithinacallbackp
rocedure--------------------------------------------*/typedefenum{RFAPI_REGISTER
_ADD,RFAPI_REGISTER_WITHDRAW,RFAPI_REGISTER_KILL}rfapi_register_action;externint
rfapi_register(rfapi_handlerfd,structrfapi_ip_prefix*prefix,uint32_tlifetime,str
uctrfapi_un_option*options_un,structrfapi_vn_option*options_vn,rfapi_register_ac
tionaction);/*******************************************************************
*****Helper/Utilityfunctions****************************************************
*******************//*------------------------------------------*rfapi_get_vn_ad
dr**GetthevirtualnetworkaddressusedbyanNVEbasedonit'sRFD**input:*rfd:rfapidescri
ptorreturnedbyrfapi_openorrfapi_create_generic**output:**returnvalue:*vnNVEvirtu
alnetworkaddress*------------------------------------------*/externstructrfapi_i
p_addr*rfapi_get_vn_addr(void*);/*------------------------------------------*rfa
pi_get_un_addr**GettheunderlaynetworkaddressusedbyanNVEbasedonit'sRFD**input:*rf
d:rfapidescriptorreturnedbyrfapi_openorrfapi_create_generic**output:**returnvalu
e:*unNVEunderlaynetworkaddress*------------------------------------------*/exter
nstructrfapi_ip_addr*rfapi_get_un_addr(void*);/*--------------------------------
----------*rfapi_error_str**Returnsastringdescribingtherfapierrorcode.**input:**
codeErrorcodereturnedbyrfapifunction**returns:**constchar*String*---------------
---------------------------*/externconstchar*rfapi_error_str(intcode);/*--------
----------------------------------*rfapi_get_rfp_start_val**Returnsvaluepassedto
rfapionrfp_start**input:*void*bgpstructure**returns:*void**---------------------
---------------------*/externvoid*rfapi_get_rfp_start_val(void*bgpv);/*---------
---------------------------------*rfapi_compare_rfds**Comparetwogenericrfapidesc
riptors.**input:*rfd1:rfapidescriptorreturnedbyrfapi_openorrfapi_create_generic*
rfd2:rfapidescriptorreturnedbyrfapi_openorrfapi_create_generic**output:**returnv
alue:*0Mismatch*1Match*------------------------------------------*/externintrfap
i_compare_rfds(void*rfd1,void*rfd2);/*------------------------------------------
*rfapi_free_next_hop_list**Freesanext_hop_listreturnedbyarfapi_queryinvocation**
input:*list:apointertoaresponselist(asa*structrfapi_next_hop_entry)tofree.**outp
ut:**returnvalue:None--------------------------------------------*/externvoidrfa
pi_free_next_hop_list(structrfapi_next_hop_entry*list);/*-----------------------
-------------------*rfapi_get_response_lifetime_default**Returnsthedefaultlifeti
meforaresponse.*rfp_start_valvaluereturnedbyrfp_startor*NULL(=usedefaultinstance
)**input:*None**output:**returnvalue:Thebgpinstancedefaultlifetimeforaresponse.-
-------------------------------------------*/externintrfapi_get_response_lifetim
e_default(void*rfp_start_val);/*------------------------------------------*rfapi
_is_vnc_configured**ReturnsifVNCisconfigured**input:*rfp_start_valvaluereturnedb
yrfp_startor*NULL(=usedefaultinstance)**output:**returnvalue:IfVNCisconfiguredfo
rthebgpdinstance*0Success*ENXIOVNCnotconfigured---------------------------------
-----------*/externintrfapi_is_vnc_configured(void*rfp_start_val);/*------------
------------------------------*rfapi_bgp_lookup_by_rfp**Findbgpinstancepointerba
sedonvaluereturnedbyrfp_start**input:*rfp_start_valvaluereturnedbyrfp_startor*NU
LL(=getdefaultinstance)**output:*none**returnvalue:*bgpbgpinstancepointer*NULL=n
otfound*--------------------------------------------*/externstructbgp*rfapi_bgp_
lookup_by_rfp(void*rfp_start_val);/*------------------------------------------*r
fapi_get_rfp_start_val_by_bgp**Findbgpinstancepointerbasedonvaluereturnedbyrfp_s
tart**input:*bgpbgpinstancepointer**output:*none**returnvalue:*rfp_start_val*NUL
L=notfound*--------------------------------------------*/externvoid*rfapi_get_rf
p_start_val_by_bgp(structbgp*bgp);#endif/*ENABLE_BGP_VNC*/#endif/*_QUAGGA_BGP_RF
API_H*/