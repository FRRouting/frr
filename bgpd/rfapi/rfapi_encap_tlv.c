/**Copyright2015-2016,LabNConsulting,L.L.C.**Thisprogramisfreesoftware;youcanred
istributeitand/or*modifyitunderthetermsoftheGNUGeneralPublicLicense*aspublishedb
ytheFreeSoftwareFoundation;eitherversion2*oftheLicense,or(atyouroption)anylaterv
ersion.**Thisprogramisdistributedinthehopethatitwillbeuseful,*butWITHOUTANYWARRA
NTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOS
E.Seethe*GNUGeneralPublicLicenseformoredetails.**Youshouldhavereceivedacopyofthe
GNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheF
reeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#inc
lude"lib/zebra.h"#include"lib/memory.h"#include"lib/prefix.h"#include"lib/table.
h"#include"lib/vty.h"#include"bgpd/bgpd.h"#include"bgpd/bgp_attr.h"#include"bgpd
/bgp_encap_types.h"#include"bgpd/bgp_encap_tlv.h"#include"bgpd/rfapi/rfapi.h"#in
clude"bgpd/rfapi/rfapi_encap_tlv.h"#include"bgpd/rfapi/rfapi_private.h"#include"
bgpd/rfapi/rfapi_monitor.h"#include"bgpd/rfapi/rfapi_vty.h"#include"bgpd/rfapi/b
gp_rfapi_cfg.h"#include"bgpd/rfapi/vnc_debug.h"staticvoidrfapi_add_endpoint_addr
ess_to_subtlv(structbgp*bgp,structrfapi_ip_addr*ea,structbgp_tea_subtlv_remote_e
ndpoint*subtlv){subtlv->family=ea->addr_family;if(subtlv->family==AF_INET)subtlv
->ip_address.v4=ea->addr.v4;elsesubtlv->ip_address.v6=ea->addr.v6;subtlv->as4=ht
onl(bgp->as);}bgp_encap_typesrfapi_tunneltype_option_to_tlv(structbgp*bgp,struct
rfapi_ip_addr*ea,structrfapi_tunneltype_option*tto,structattr*attr,intalways_add
){#define_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(ttype)\if((always_add\||(bgp->rfapi_cf
g\&&!CHECK_FLAG(bgp->rfapi_cfg->flags,\BGP_VNC_CONFIG_ADV_UN_METHOD_ENCAP)))\&&e
a\&&!CHECK_SUBTLV_FLAG(&tto->bgpinfo.ttype,\BGP_TEA_SUBTLV_REMOTE_ENDPOINT)){\rf
api_add_endpoint_address_to_subtlv(\bgp,ea,&tto->bgpinfo.ttype.st_endpoint);\SET
_SUBTLV_FLAG(&tto->bgpinfo.ttype,\BGP_TEA_SUBTLV_REMOTE_ENDPOINT);\}structrfapi_
tunneltype_optiondto;if(tto==NULL){/*createdefaulttype*/tto=&dto;memset(tto,0,si
zeof(dto));tto->type=RFAPI_BGP_ENCAP_TYPE_DEFAULT;}switch(tto->type){caseBGP_ENC
AP_TYPE_L2TPV3_OVER_IP:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(l2tpv3_ip);bgp_encap_typ
e_l2tpv3overip_to_tlv(&tto->bgpinfo.l2tpv3_ip,attr);break;caseBGP_ENCAP_TYPE_GRE
:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(gre);bgp_encap_type_gre_to_tlv(&tto->bgpinfo.g
re,attr);break;caseBGP_ENCAP_TYPE_TRANSMIT_TUNNEL_ENDPOINT:_RTTO_MAYBE_ADD_ENDPO
INT_ADDRESS(transmit_tunnel_endpoint);bgp_encap_type_transmit_tunnel_endpoint(&t
to->bgpinfo.transmit_tunnel_endpoint,attr);break;caseBGP_ENCAP_TYPE_IPSEC_IN_TUN
NEL_MODE:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(ipsec_tunnel);bgp_encap_type_ipsec_in_
tunnel_mode_to_tlv(&tto->bgpinfo.ipsec_tunnel,attr);break;caseBGP_ENCAP_TYPE_IP_
IN_IP_TUNNEL_WITH_IPSEC_TRANSPORT_MODE:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(ip_ipsec
);bgp_encap_type_ip_in_ip_tunnel_with_ipsec_transport_mode_to_tlv(&tto->bgpinfo.
ip_ipsec,attr);break;caseBGP_ENCAP_TYPE_MPLS_IN_IP_TUNNEL_WITH_IPSEC_TRANSPORT_M
ODE:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(mpls_ipsec);bgp_encap_type_mpls_in_ip_tunne
l_with_ipsec_transport_mode_to_tlv(&tto->bgpinfo.mpls_ipsec,attr);break;caseBGP_
ENCAP_TYPE_IP_IN_IP:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(ip_ip);bgp_encap_type_ip_in
_ip_to_tlv(&tto->bgpinfo.ip_ip,attr);break;caseBGP_ENCAP_TYPE_VXLAN:_RTTO_MAYBE_
ADD_ENDPOINT_ADDRESS(vxlan);bgp_encap_type_vxlan_to_tlv(&tto->bgpinfo.vxlan,attr
);break;caseBGP_ENCAP_TYPE_NVGRE:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(nvgre);bgp_enc
ap_type_nvgre_to_tlv(&tto->bgpinfo.nvgre,attr);break;caseBGP_ENCAP_TYPE_MPLS:/*n
othingtodoforMPLS*/break;caseBGP_ENCAP_TYPE_MPLS_IN_GRE:_RTTO_MAYBE_ADD_ENDPOINT
_ADDRESS(mpls_gre);bgp_encap_type_mpls_in_gre_to_tlv(&tto->bgpinfo.mpls_gre,attr
);break;caseBGP_ENCAP_TYPE_VXLAN_GPE:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(vxlan_gpe)
;bgp_encap_type_vxlan_gpe_to_tlv(&tto->bgpinfo.vxlan_gpe,attr);break;caseBGP_ENC
AP_TYPE_MPLS_IN_UDP:_RTTO_MAYBE_ADD_ENDPOINT_ADDRESS(mpls_udp);bgp_encap_type_mp
ls_in_udp_to_tlv(&tto->bgpinfo.mpls_udp,attr);break;caseBGP_ENCAP_TYPE_PBB:_RTTO
_MAYBE_ADD_ENDPOINT_ADDRESS(pbb);bgp_encap_type_pbb_to_tlv(&tto->bgpinfo.pbb,att
r);break;default:assert(0);}returntto->type;}structrfapi_un_option*rfapi_encap_t
lv_to_un_option(structattr*attr){structrfapi_un_option*uo=NULL;structrfapi_tunne
ltype_option*tto;intrc;structbgp_attr_encap_subtlv*stlv;/*notunnelencapattrstore
d*/if(!attr->encap_tunneltype)returnNULL;stlv=attr->encap_subtlvs;uo=XCALLOC(MTY
PE_RFAPI_UN_OPTION,sizeof(structrfapi_un_option));assert(uo);uo->type=RFAPI_UN_O
PTION_TYPE_TUNNELTYPE;uo->v.tunnel.type=attr->encap_tunneltype;tto=&uo->v.tunnel
;switch(attr->encap_tunneltype){caseBGP_ENCAP_TYPE_L2TPV3_OVER_IP:rc=tlv_to_bgp_
encap_type_l2tpv3overip(stlv,&tto->bgpinfo.l2tpv3_ip);break;caseBGP_ENCAP_TYPE_G
RE:rc=tlv_to_bgp_encap_type_gre(stlv,&tto->bgpinfo.gre);break;caseBGP_ENCAP_TYPE
_TRANSMIT_TUNNEL_ENDPOINT:rc=tlv_to_bgp_encap_type_transmit_tunnel_endpoint(stlv
,&tto->bgpinfo.transmit_tunnel_endpoint);break;caseBGP_ENCAP_TYPE_IPSEC_IN_TUNNE
L_MODE:rc=tlv_to_bgp_encap_type_ipsec_in_tunnel_mode(stlv,&tto->bgpinfo.ipsec_tu
nnel);break;caseBGP_ENCAP_TYPE_IP_IN_IP_TUNNEL_WITH_IPSEC_TRANSPORT_MODE:rc=tlv_
to_bgp_encap_type_ip_in_ip_tunnel_with_ipsec_transport_mode(stlv,&tto->bgpinfo.i
p_ipsec);break;caseBGP_ENCAP_TYPE_MPLS_IN_IP_TUNNEL_WITH_IPSEC_TRANSPORT_MODE:rc
=tlv_to_bgp_encap_type_mpls_in_ip_tunnel_with_ipsec_transport_mode(stlv,&tto->bg
pinfo.mpls_ipsec);break;caseBGP_ENCAP_TYPE_IP_IN_IP:rc=tlv_to_bgp_encap_type_ip_
in_ip(stlv,&tto->bgpinfo.ip_ip);break;caseBGP_ENCAP_TYPE_VXLAN:rc=tlv_to_bgp_enc
ap_type_vxlan(stlv,&tto->bgpinfo.vxlan);break;caseBGP_ENCAP_TYPE_NVGRE:rc=tlv_to
_bgp_encap_type_nvgre(stlv,&tto->bgpinfo.nvgre);break;caseBGP_ENCAP_TYPE_MPLS:rc
=tlv_to_bgp_encap_type_mpls(stlv,&tto->bgpinfo.mpls);break;caseBGP_ENCAP_TYPE_MP
LS_IN_GRE:rc=tlv_to_bgp_encap_type_mpls_in_gre(stlv,&tto->bgpinfo.mpls_gre);brea
k;caseBGP_ENCAP_TYPE_VXLAN_GPE:rc=tlv_to_bgp_encap_type_vxlan_gpe(stlv,&tto->bgp
info.vxlan_gpe);break;caseBGP_ENCAP_TYPE_MPLS_IN_UDP:rc=tlv_to_bgp_encap_type_mp
ls_in_udp(stlv,&tto->bgpinfo.mpls_udp);break;caseBGP_ENCAP_TYPE_PBB:rc=tlv_to_bg
p_encap_type_pbb(stlv,&tto->bgpinfo.pbb);break;default:vnc_zlog_debug_verbose("%
s:unknowntunneltype%d",__func__,attr->encap_tunneltype);rc=-1;break;}if(rc){XFRE
E(MTYPE_RFAPI_UN_OPTION,uo);uo=NULL;}returnuo;}/********************************
****************************************SUBTLVPRINT*****************************
******************************************/staticvoidsubtlv_print_encap_l2tpv3_o
ver_ip(void*stream,intcolumn_offset,structbgp_tea_subtlv_encap_l2tpv3_over_ip*st
){int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_newline;if
(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!st)return;fp(o
ut,"%*s%s%s",column_offset,"","SubTLV:Encap(L2TPv3overIP)",vty_newline);fp(out,"
%*sSessionID:%d%s",column_offset,"",st->sessionid,vty_newline);fp(out,"%*sCookie
:(length%d)%s",column_offset,"",st->cookie_length,vty_newline);}staticvoidsubtlv
_print_encap_gre(void*stream,intcolumn_offset,structbgp_tea_subtlv_encap_gre_key
*st){int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_newline
;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!st)return;f
p(out,"%*s%s%s",column_offset,"","SubTLV:Encap(GRE)",vty_newline);fp(out,"%*sGRE
key:%d(0x%x)%s",column_offset,"",st->gre_key,st->gre_key,vty_newline);}staticvoi
dsubtlv_print_encap_pbb(void*stream,intcolumn_offset,structbgp_tea_subtlv_encap_
pbb*st){int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_newl
ine;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!st)retur
n;fp(out,"%*s%s%s",column_offset,"","SubTLV:Encap(PBB)",vty_newline);if(st->flag
_isid){fp(out,"%*sISID:%d(0x%x)%s",column_offset,"",st->isid,st->isid,vty_newlin
e);}if(st->flag_vid){fp(out,"%*sVID:%d(0x%x)%s",column_offset,"",st->vid,st->vid
,vty_newline);}fp(out,"%*sMACADDR%02x:%02x:%02x:%02x:%02x:%02x%s",column_offset,
"",st->macaddr[0],st->macaddr[1],st->macaddr[2],st->macaddr[3],st->macaddr[4],st
->macaddr[5],vty_newline);}staticvoidsubtlv_print_proto_type(void*stream,intcolu
mn_offset,structbgp_tea_subtlv_proto_type*st){int(*fp)(void*,constchar*,...);str
uctvty*vty;void*out;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&ou
t,&vty_newline)==0)return;if(!st)return;fp(out,"%*s%s%s",column_offset,"","SubTL
V:Encap(ProtoType)",vty_newline);fp(out,"%*sProto%d(0x%x)%s",column_offset,"",st
->proto,st->proto,vty_newline);}staticvoidsubtlv_print_color(void*stream,intcolu
mn_offset,structbgp_tea_subtlv_color*st){int(*fp)(void*,constchar*,...);structvt
y*vty;void*out;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vt
y_newline)==0)return;if(!st)return;fp(out,"%*s%s%s",column_offset,"","SubTLV:Col
or",vty_newline);fp(out,"%*sColor:%d(0x%x)",column_offset,"",st->color,st->color
,vty_newline);}staticvoidsubtlv_print_ipsec_ta(void*stream,intcolumn_offset,stru
ctbgp_tea_subtlv_ipsec_ta*st){int(*fp)(void*,constchar*,...);structvty*vty;void*
out;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)=
=0)return;if(!st)return;fp(out,"%*s%s%s",column_offset,"","SubTLV:IPSECTA",vty_n
ewline);fp(out,"%*sAuthenticatorType:%d(0x%x)",column_offset,"",st->authenticato
r_type,st->authenticator_type,vty_newline);fp(out,"%*sAuthenticator:(length%d)",
column_offset,"",st->authenticator_length,vty_newline);}/***********************
*************************************************TLVPRINT***********************
************************************************/staticvoidprint_encap_type_l2tp
v3overip(void*stream,intcolumn_offset,structbgp_encap_type_l2tpv3_over_ip*bet){c
onstchar*type="L2TPv3overIP";int(*fp)(void*,constchar*,...);structvty*vty;void*o
ut;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==
0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",column_offset,"",type,vty_newlin
e);subtlv_print_encap_l2tpv3_over_ip(stream,column_offset+2,&bet->st_encap);subt
lv_print_proto_type(stream,column_offset+2,&bet->st_proto);subtlv_print_color(st
ream,column_offset+2,&bet->st_color);}staticvoidprint_encap_type_gre(void*stream
,intcolumn_offset,structbgp_encap_type_gre*bet){constchar*type="GRE";int(*fp)(vo
id*,constchar*,...);structvty*vty;void*out;constchar*vty_newline;if(rfapiStream2
Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(out,"%*sTEAty
pe%s%s",column_offset,"",type,vty_newline);subtlv_print_encap_gre(stream,column_
offset+2,&bet->st_encap);subtlv_print_proto_type(stream,column_offset+2,&bet->st
_proto);subtlv_print_color(stream,column_offset+2,&bet->st_color);}staticvoidpri
nt_encap_type_ip_in_ip(void*stream,intcolumn_offset,structbgp_encap_type_ip_in_i
p*bet){constchar*type="IPinIP";int(*fp)(void*,constchar*,...);structvty*vty;void
*out;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)
==0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",column_offset,"",type,vty_newl
ine);subtlv_print_proto_type(stream,column_offset+2,&bet->st_proto);subtlv_print
_color(stream,column_offset+2,&bet->st_color);}staticvoidprint_encap_type_transm
it_tunnel_endpoint(void*stream,intcolumn_offset,structbgp_encap_type_transmit_tu
nnel_endpoint*bet){constchar*type="TransmitTunnelEndpoint";int(*fp)(void*,constc
har*,...);structvty*vty;void*out;constchar*vty_newline;if(rfapiStream2Vty(stream
,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",co
lumn_offset,"",type,vty_newline);/*nosubtlvsforthistype*/}staticvoidprint_encap_
type_ipsec_in_tunnel_mode(void*stream,intcolumn_offset,structbgp_encap_type_ipse
c_in_tunnel_mode*bet){constchar*type="IPSECinTunnelmode";int(*fp)(void*,constcha
r*,...);structvty*vty;void*out;constchar*vty_newline;if(rfapiStream2Vty(stream,&
fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",colu
mn_offset,"",type,vty_newline);subtlv_print_ipsec_ta(stream,column_offset+2,&bet
->st_ipsec_ta);}staticvoidprint_encap_type_ip_in_ip_tunnel_with_ipsec_transport_
mode(void*stream,intcolumn_offset,structbgp_encap_type_ip_in_ip_tunnel_with_ipse
c_transport_mode*bet){constchar*type="IPinIPTunnelwithIPSECtransportmode";int(*f
p)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_newline;if(rfapiSt
ream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(out,"%*s
TEAtype%s%s",column_offset,"",type,vty_newline);subtlv_print_ipsec_ta(stream,col
umn_offset+2,&bet->st_ipsec_ta);}staticvoidprint_encap_type_mpls_in_ip_tunnel_wi
th_ipsec_transport_mode(void*stream,intcolumn_offset,structbgp_encap_type_mpls_i
n_ip_tunnel_with_ipsec_transport_mode*bet){constchar*type="MPLSinIPTunnelwithIPS
ECtransportmode";int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar
*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(
!bet)return;fp(out,"%*sTEAtype%s%s",column_offset,"",type,vty_newline);subtlv_pr
int_ipsec_ta(stream,column_offset+2,&bet->st_ipsec_ta);}staticvoidprint_encap_ty
pe_pbb(void*stream,intcolumn_offset,structbgp_encap_type_pbb*bet){constchar*type
="PBB";int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_newli
ne;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)retur
n;fp(out,"%*sTEAtype%s%s",column_offset,"",type,vty_newline);subtlv_print_encap_
pbb(stream,column_offset+2,&bet->st_encap);}staticvoidprint_encap_type_vxlan(voi
d*stream,intcolumn_offset,structbgp_encap_type_vxlan*bet){constchar*type="VXLAN"
;int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_newline;if(
rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(o
ut,"%*sTEAtype%s%s",column_offset,"",type,vty_newline);/*nosubtlvsforthistype*/}
staticvoidprint_encap_type_nvgre(void*stream,intcolumn_offset,structbgp_encap_ty
pe_nvgre*bet){constchar*type="NVGRE";int(*fp)(void*,constchar*,...);structvty*vt
y;void*out;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_ne
wline)==0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",column_offset,"",type,vt
y_newline);/*nosubtlvsforthistype*/}staticvoidprint_encap_type_mpls(void*stream,
intcolumn_offset,structbgp_encap_type_mpls*bet){constchar*type="MPLS";int(*fp)(v
oid*,constchar*,...);structvty*vty;void*out;constchar*vty_newline;if(rfapiStream
2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(out,"%*sTEAt
ype%s%s",column_offset,"",type,vty_newline);/*nosubtlvsforthistype*/}staticvoidp
rint_encap_type_mpls_in_gre(void*stream,intcolumn_offset,structbgp_encap_type_mp
ls_in_gre*bet){constchar*type="MPLSinGRE";int(*fp)(void*,constchar*,...);structv
ty*vty;void*out;constchar*vty_newline;if(rfapiStream2Vty(stream,&fp,&vty,&out,&v
ty_newline)==0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",column_offset,"",ty
pe,vty_newline);/*nosubtlvsforthistype*/}staticvoidprint_encap_type_vxlan_gpe(vo
id*stream,intcolumn_offset,structbgp_encap_type_vxlan_gpe*bet){constchar*type="V
XLANGPE";int(*fp)(void*,constchar*,...);structvty*vty;void*out;constchar*vty_new
line;if(rfapiStream2Vty(stream,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)ret
urn;fp(out,"%*sTEAtype%s%s",column_offset,"",type,vty_newline);/*nosubtlvsforthi
stype*/}staticvoidprint_encap_type_mpls_in_udp(void*stream,intcolumn_offset,stru
ctbgp_encap_type_mpls_in_udp*bet){constchar*type="MPLSinUDP";int(*fp)(void*,cons
tchar*,...);structvty*vty;void*out;constchar*vty_newline;if(rfapiStream2Vty(stre
am,&fp,&vty,&out,&vty_newline)==0)return;if(!bet)return;fp(out,"%*sTEAtype%s%s",
column_offset,"",type,vty_newline);/*nosubtlvsforthistype*/}voidrfapi_print_tunn
eltype_option(void*stream,intcolumn_offset,structrfapi_tunneltype_option*tto){sw
itch(tto->type){caseBGP_ENCAP_TYPE_L2TPV3_OVER_IP:print_encap_type_l2tpv3overip(
stream,column_offset,&tto->bgpinfo.l2tpv3_ip);break;caseBGP_ENCAP_TYPE_GRE:print
_encap_type_gre(stream,column_offset,&tto->bgpinfo.gre);break;caseBGP_ENCAP_TYPE
_TRANSMIT_TUNNEL_ENDPOINT:print_encap_type_transmit_tunnel_endpoint(stream,colum
n_offset,&tto->bgpinfo.transmit_tunnel_endpoint);break;caseBGP_ENCAP_TYPE_IPSEC_
IN_TUNNEL_MODE:print_encap_type_ipsec_in_tunnel_mode(stream,column_offset,&tto->
bgpinfo.ipsec_tunnel);break;caseBGP_ENCAP_TYPE_IP_IN_IP_TUNNEL_WITH_IPSEC_TRANSP
ORT_MODE:print_encap_type_ip_in_ip_tunnel_with_ipsec_transport_mode(stream,colum
n_offset,&tto->bgpinfo.ip_ipsec);break;caseBGP_ENCAP_TYPE_MPLS_IN_IP_TUNNEL_WITH
_IPSEC_TRANSPORT_MODE:print_encap_type_mpls_in_ip_tunnel_with_ipsec_transport_mo
de(stream,column_offset,&tto->bgpinfo.mpls_ipsec);break;caseBGP_ENCAP_TYPE_IP_IN
_IP:print_encap_type_ip_in_ip(stream,column_offset,&tto->bgpinfo.ip_ip);break;ca
seBGP_ENCAP_TYPE_VXLAN:print_encap_type_vxlan(stream,column_offset,&tto->bgpinfo
.vxlan);break;caseBGP_ENCAP_TYPE_NVGRE:print_encap_type_nvgre(stream,column_offs
et,&tto->bgpinfo.nvgre);break;caseBGP_ENCAP_TYPE_MPLS:print_encap_type_mpls(stre
am,column_offset,&tto->bgpinfo.mpls);break;caseBGP_ENCAP_TYPE_MPLS_IN_GRE:print_
encap_type_mpls_in_gre(stream,column_offset,&tto->bgpinfo.mpls_gre);break;caseBG
P_ENCAP_TYPE_VXLAN_GPE:print_encap_type_vxlan_gpe(stream,column_offset,&tto->bgp
info.vxlan_gpe);break;caseBGP_ENCAP_TYPE_MPLS_IN_UDP:print_encap_type_mpls_in_ud
p(stream,column_offset,&tto->bgpinfo.mpls_udp);break;caseBGP_ENCAP_TYPE_PBB:prin
t_encap_type_pbb(stream,column_offset,&tto->bgpinfo.pbb);break;default:assert(0)
;}}