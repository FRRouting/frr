/***Copyright2016,LabNConsulting,L.L.C.**Thisprogramisfreesoftware;youcanredistr
ibuteitand/or*modifyitunderthetermsoftheGNUGeneralPublicLicense*aspublishedbythe
FreeSoftwareFoundation;eitherversion2*oftheLicense,or(atyouroption)anylaterversi
on.**Thisprogramisdistributedinthehopethatitwillbeuseful,*butWITHOUTANYWARRANTY;
withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.Se
ethe*GNUGeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGNUG
eneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeS
oftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#include
"lib/zebra.h"#include<lib/version.h>#include"lib/prefix.h"#include"lib/linklist.
h"#include"lib/stream.h"#include"lib/command.h"#include"lib/log.h"#include"bgpd/
rfapi/vnc_debug.h"/**debugstatestorage*/unsignedlongconf_vnc_debug;unsignedlongt
erm_vnc_debug;structvnc_debug{unsignedlongbit;constchar*name;};structvnc_debugvn
cdebug[]={{VNC_DEBUG_RFAPI_QUERY,"rfapi-query"},{VNC_DEBUG_IMPORT_BI_ATTACH,"imp
ort-bi-attach"},{VNC_DEBUG_IMPORT_DEL_REMOTE,"import-del-remote"},{VNC_DEBUG_EXP
ORT_BGP_GETCE,"export-bgp-getce"},{VNC_DEBUG_EXPORT_BGP_DIRECT_ADD,"export-bgp-d
irect-add"},{VNC_DEBUG_IMPORT_BGP_ADD_ROUTE,"import-bgp-add-route"},{VNC_DEBUG_V
ERBOSE,"verbose"},};#defineVNC_STR"VNCinformation\n"/***************************
*********************************************debugbgpvnc<foo>*******************
****************************************************/DEFUN(debug_bgp_vnc,debug_b
gp_vnc_cmd,"debugbgpvnc<rfapi-query|import-bi-attach|import-del-remote|verbose>"
,DEBUG_STRBGP_STRVNC_STR"rfapiqueryhandling\n""importBIatachment\n""importdelete
remoteroutes\n""verboselogging\n"){size_ti;for(i=0;i<(sizeof(vncdebug)/sizeof(st
ructvnc_debug));++i){if(strmatch(argv[3]->text,vncdebug[i].name)){if(vty->node==
CONFIG_NODE){conf_vnc_debug|=vncdebug[i].bit;term_vnc_debug|=vncdebug[i].bit;}el
se{term_vnc_debug|=vncdebug[i].bit;vty_out(vty,"BGPvnc%sdebuggingison\n",vncdebu
g[i].name);}returnCMD_SUCCESS;}}vty_out(vty,"Unknowndebugflag:%s\n",argv[3]->arg
);returnCMD_WARNING_CONFIG_FAILED;}DEFUN(no_debug_bgp_vnc,no_debug_bgp_vnc_cmd,"
<nodebug|undebug>bgpvnc<rfapi-query|import-bi-attach|import-del-remote|verbose>"
,NO_STRDEBUG_STR"Undebug\n"BGP_STRVNC_STR"rfapiqueryhandling\n""importBIatachmen
t\n""importdeleteremoteroutes\n""verboselogging\n"){size_ti;if(strmatch(argv[0]-
>text,"no"))argc--,argv++;for(i=0;i<(sizeof(vncdebug)/sizeof(structvnc_debug));+
+i){if(strmatch(argv[3]->text,vncdebug[i].name)){if(vty->node==CONFIG_NODE){conf
_vnc_debug&=~vncdebug[i].bit;term_vnc_debug&=~vncdebug[i].bit;}else{term_vnc_deb
ug&=~vncdebug[i].bit;vty_out(vty,"BGPvnc%sdebuggingisoff\n",vncdebug[i].name);}r
eturnCMD_SUCCESS;}}vty_out(vty,"Unknowndebugflag:%s\n",argv[3]->arg);returnCMD_W
ARNING_CONFIG_FAILED;}/*********************************************************
***************nodebugbgpvncall*************************************************
**********************/DEFUN(no_debug_bgp_vnc_all,no_debug_bgp_vnc_all_cmd,"<nod
ebug|undebug>allbgpvnc",NO_STRDEBUG_STR"Undebugcommand\n""DisableallVNCdebugging
\n"BGP_STRVNC_STR){term_vnc_debug=0;vty_out(vty,"AllpossibleVNCdebugginghasbeent
urnedoff\n");returnCMD_SUCCESS;}/***********************************************
*************************show/save**********************************************
*************************/DEFUN_NOSH(show_debugging_bgp_vnc,show_debugging_bgp_v
nc_cmd,"showdebuggingbgpvnc",SHOW_STRDEBUG_STRBGP_STRVNC_STR){size_ti;vty_out(vt
y,"BGPVNCdebuggingstatus:\n");for(i=0;i<(sizeof(vncdebug)/sizeof(structvnc_debug
));++i){if(term_vnc_debug&vncdebug[i].bit){vty_out(vty,"BGPVNC%sdebuggingison\n"
,vncdebug[i].name);}}vty_out(vty,"\n");returnCMD_SUCCESS;}staticintbgp_vnc_confi
g_write_debug(structvty*vty){intwrite=0;size_ti;for(i=0;i<(sizeof(vncdebug)/size
of(structvnc_debug));++i){if(conf_vnc_debug&vncdebug[i].bit){vty_out(vty,"debugb
gpvnc%s\n",vncdebug[i].name);write++;}}returnwrite;}staticstructcmd_nodedebug_no
de={DEBUG_VNC_NODE,"",1};voidvnc_debug_init(void){install_node(&debug_node,bgp_v
nc_config_write_debug);install_element(ENABLE_NODE,&show_debugging_bgp_vnc_cmd);
install_element(ENABLE_NODE,&debug_bgp_vnc_cmd);install_element(CONFIG_NODE,&deb
ug_bgp_vnc_cmd);install_element(ENABLE_NODE,&no_debug_bgp_vnc_cmd);install_eleme
nt(ENABLE_NODE,&no_debug_bgp_vnc_all_cmd);}