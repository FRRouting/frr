/***Copyright2009-2016,LabNConsulting,L.L.C.***Thisprogramisfreesoftware;youcanr
edistributeitand/or*modifyitunderthetermsoftheGNUGeneralPublicLicense*aspublishe
dbytheFreeSoftwareFoundation;eitherversion2*oftheLicense,or(atyouroption)anylate
rversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,*butWITHOUTANYWAR
RANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURP
OSE.Seethe*GNUGeneralPublicLicenseformoredetails.**Youshouldhavereceivedacopyoft
heGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetoth
eFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#i
nclude"lib/zebra.h"#include"lib/prefix.h"#include"lib/table.h"#include"lib/vty.h
"#include"lib/memory.h"#include"lib/skiplist.h"#include"bgpd/bgpd.h"#include"bgp
d/rfapi/bgp_rfapi_cfg.h"#include"bgpd/rfapi/rfapi.h"#include"bgpd/rfapi/rfapi_ba
ckend.h"#include"bgpd/rfapi/rfapi_import.h"#include"bgpd/rfapi/rfapi_private.h"#
include"bgpd/rfapi/rfapi_nve_addr.h"#include"bgpd/rfapi/rfapi_vty.h"#include"bgp
d/rfapi/vnc_debug.h"#defineDEBUG_NVE_ADDR0voidrfapiNveAddr2Str(structrfapi_nve_a
ddr*,char*,int);#ifDEBUG_NVE_ADDRstaticvoidlogdifferent(constchar*tag,structrfap
i_nve_addr*a,structrfapi_nve_addr*b){chara_str[BUFSIZ];charb_str[BUFSIZ];rfapiNv
eAddr2Str(a,a_str,BUFSIZ);rfapiNveAddr2Str(b,b_str,BUFSIZ);vnc_zlog_debug_verbos
e("%s:[%s][%s]",tag,a_str,b_str);}#endifintrfapi_nve_addr_cmp(void*k1,void*k2){s
tructrfapi_nve_addr*a=(structrfapi_nve_addr*)k1;structrfapi_nve_addr*b=(structrf
api_nve_addr*)k2;intret=0;if(!a||!b){#ifDEBUG_NVE_ADDRvnc_zlog_debug_verbose("%s
:missingaddressa=%pb=%p",__func__,a,b);#endifreturn(a-b);}if(a->un.addr_family!=
b->un.addr_family){#ifDEBUG_NVE_ADDRvnc_zlog_debug_verbose("diff:UNaddrfama->un.
af=%d,b->un.af=%d",a->un.addr_family,b->un.addr_family);#endifreturn(a->un.addr_
family-b->un.addr_family);}if(a->un.addr_family==AF_INET){ret=IPV4_ADDR_CMP(&a->
un.addr.v4,&b->un.addr.v4);if(ret!=0){#ifDEBUG_NVE_ADDRlogdifferent("diff:UNaddr
",a,b);#endifreturnret;}}elseif(a->un.addr_family==AF_INET6){ret=IPV6_ADDR_CMP(&
a->un.addr.v6,&b->un.addr.v6);if(ret==0){#ifDEBUG_NVE_ADDRlogdifferent("diff:UNa
ddr",a,b);#endifreturnret;}}else{assert(0);}if(a->vn.addr_family!=b->vn.addr_fam
ily){#ifDEBUG_NVE_ADDRvnc_zlog_debug_verbose("diff:pTaddrfama->vn.af=%d,b->vn.af
=%d",a->vn.addr_family,b->vn.addr_family);#endifreturn(a->vn.addr_family-b->vn.a
ddr_family);}if(a->vn.addr_family==AF_INET){ret=IPV4_ADDR_CMP(&a->vn.addr.v4,&b-
>vn.addr.v4);if(ret!=0){#ifDEBUG_NVE_ADDRlogdifferent("diff:VNaddr",a,b);#endifr
eturnret;}}elseif(a->vn.addr_family==AF_INET6){ret=IPV6_ADDR_CMP(&a->vn.addr.v6,
&b->vn.addr.v6);if(ret==0){#ifDEBUG_NVE_ADDRlogdifferent("diff:VNaddr",a,b);#end
ifreturnret;}}else{assert(0);}return0;}voidrfapiNveAddr2Str(structrfapi_nve_addr
*na,char*buf,intbufsize){char*p=buf;intr;#defineREMAIN(bufsize-(p-buf))#defineIN
CP{p+=(r>REMAIN)?REMAIN:r;}if(bufsize<1)return;r=snprintf(p,REMAIN,"VN=");INCP;i
f(!rfapiRfapiIpAddr2Str(&na->vn,p,REMAIN))gotodone;buf[bufsize-1]=0;p=buf+strlen
(buf);r=snprintf(p,REMAIN,",UN=");INCP;rfapiRfapiIpAddr2Str(&na->un,p,REMAIN);do
ne:buf[bufsize-1]=0;}