/*ASregularexpressionroutine*Copyright(C)1999KunihiroIshiguro**ThisfileispartofG
NUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*undertheterm
softheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversi
on2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwillb
euseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYor
FITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Yous
houldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefi
leCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,B
oston,MA02110-1301USA*/#include<zebra.h>#include"log.h"#include"command.h"#inclu
de"memory.h"#include"queue.h"#include"filter.h"#include"bgpd.h"#include"bgp_aspa
th.h"#include"bgp_regex.h"/*Character`_'hasspecialmean.Itrepresents[,{}()]andthe
beginningoftheline(^)andtheendoftheline($).(^|[,{}()]|$)*/regex_t*bgp_regcomp(co
nstchar*regstr){/*Convert_charactertogenericregularexpression.*/inti,j;intlen;in
tmagic=0;char*magic_str;charmagic_regexp[]="(^|[,{}()]|$)";intret;regex_t*regex;
len=strlen(regstr);for(i=0;i<len;i++)if(regstr[i]=='_')magic++;magic_str=XMALLOC
(MTYPE_TMP,len+(14*magic)+1);for(i=0,j=0;i<len;i++){if(regstr[i]=='_'){memcpy(ma
gic_str+j,magic_regexp,strlen(magic_regexp));j+=strlen(magic_regexp);}elsemagic_
str[j++]=regstr[i];}magic_str[j]='\0';regex=XMALLOC(MTYPE_BGP_REGEXP,sizeof(rege
x_t));ret=regcomp(regex,magic_str,REG_EXTENDED|REG_NOSUB);XFREE(MTYPE_TMP,magic_
str);if(ret!=0){XFREE(MTYPE_BGP_REGEXP,regex);returnNULL;}returnregex;}intbgp_re
gexec(regex_t*regex,structaspath*aspath){returnregexec(regex,aspath->str,0,NULL,
0);}voidbgp_regex_free(regex_t*regex){regfree(regex);XFREE(MTYPE_BGP_REGEXP,rege
x);}