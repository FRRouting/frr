/*BGPcarryingLabelinformation*Copyright(C)2013CumulusNetworks,Inc.**Thisfileispa
rtofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underth
etermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;either
version2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatit
willbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABIL
ITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.*
*YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;see
thefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFl
oor,Boston,MA02110-1301USA*/#ifndef_BGP_LABEL_H#define_BGP_LABEL_H#defineBGP_LAB
EL_BYTES3#defineBGP_LABEL_BITS24#defineBGP_WITHDRAW_LABEL0x800000structbgp_node;
structbgp_info;structpeer;externvoidbgp_reg_dereg_for_label(structbgp_node*rn,st
ructbgp_info*ri,intreg);externintbgp_parse_fec_update(void);externmpls_label_tbg
p_adv_label(structbgp_node*rn,structbgp_info*ri,structpeer*to,afi_tafi,safi_tsaf
i);externintbgp_nlri_parse_label(structpeer*peer,structattr*attr,structbgp_nlri*
packet);staticinlineintbgp_labeled_safi(safi_tsafi){/*NOTE:ThisAPIreallysaysalab
el(tag)MAYbepresent.NotallEVPN*routeswillhavealabel.*/if((safi==SAFI_LABELED_UNI
CAST)||(safi==SAFI_MPLS_VPN)||(safi==SAFI_EVPN))return1;return0;}staticinlineint
bgp_is_withdraw_label(mpls_label_t*label){uint8_t*pkt=(uint8_t*)label;/*Thecheck
onpkt[2]for0x00or0x02isincasebgp_set_valid_label()*wascalledonthewithdrawlabel*/
if((pkt[0]==0x80)&&(pkt[1]==0x00)&&((pkt[2]==0x00)||(pkt[2]==0x02)))return1;retu
rn0;}staticinlineintbgp_is_valid_label(mpls_label_t*label){uint8_t*t=(uint8_t*)l
abel;if(!t)return0;return(t[2]&0x02);}staticinlinevoidbgp_set_valid_label(mpls_l
abel_t*label){uint8_t*t=(uint8_t*)label;if(t)t[2]|=0x02;}staticinlinevoidbgp_uns
et_valid_label(mpls_label_t*label){uint8_t*t=(uint8_t*)label;if(t)t[2]&=~0x02;}s
taticinlinevoidbgp_register_for_label(structbgp_node*rn,structbgp_info*ri){bgp_r
eg_dereg_for_label(rn,ri,1);}staticinlinevoidbgp_unregister_for_label(structbgp_
node*rn){bgp_reg_dereg_for_label(rn,NULL,0);}/*Labelstreamtovalue*/staticinlineu
int32_tlabel_pton(mpls_label_t*label){uint8_t*t=(uint8_t*)label;return((((unsign
edint)t[0])<<12)|(((unsignedint)t[1])<<4)|((unsignedint)((t[2]&0xF0)>>4)));}/*En
codelabelvalues*/staticinlinevoidlabel_ntop(uint32_tl,intbos,mpls_label_t*label)
{uint8_t*t=(uint8_t*)label;t[0]=((l&0x000FF000)>>12);t[1]=((l&0x00000FF0)>>4);t[
2]=((l&0x0000000F)<<4);if(bos)t[2]|=0x01;}/*ReturnBOSvalueoflabelstream*/statici
nlineuint8_tlabel_bos(mpls_label_t*label){uint8_t*t=(uint8_t*)label;return(t[2]&
0x01);};#endif/*_BGP_LABEL_H*/