/*jhash.h:Jenkinshashsupport.**Copyright(C)1996BobJenkins(bob_jenkins@burtleburt
le.net)**http://burtleburtle.net/bob/hash/**ThesearethecreditsfromBob'ssources:*
*lookup2.c,byBobJenkins,December1996,PublicDomain.*hash(),hash2(),hash3,andmix()
areexternallyusefulfunctions.*RoutinestotestthehashareincludedifSELF_TESTisdefin
ed.*Youcanusethisfreeforanypurpose.Ithasnowarranty.**Copyright(C)2003DavidS.Mill
er(davem@redhat.com)**I'vemodifiedBob'shashtobeusefulintheLinuxkernel,and*anybug
spresentaresurelymyfault.-DaveM*/#include"zebra.h"#include"jhash.h"/*Thegoldenra
tion:anarbitraryvalue*/#defineJHASH_GOLDEN_RATIO0x9e3779b9/*NOTE:Argumentsaremod
ified.*/#define__jhash_mix(a,b,c)\{\a-=b;\a-=c;\a^=(c>>13);\b-=c;\b-=a;\b^=(a<<8
);\c-=a;\c-=b;\c^=(b>>13);\a-=b;\a-=c;\a^=(c>>12);\b-=c;\b-=a;\b^=(a<<16);\c-=a;
\c-=b;\c^=(b>>5);\a-=b;\a-=c;\a^=(c>>3);\b-=c;\b-=a;\b^=(a<<10);\c-=a;\c-=b;\c^=
(b>>15);\}/*Themostgenericversion,hashesanarbitrarysequence*ofbytes.Noalignmento
rlengthassumptionsaremadeabout*theinputkey.*/uint32_tjhash(constvoid*key,uint32_
tlength,uint32_tinitval){uint32_ta,b,c,len;constuint8_t*k=key;len=length;a=b=JHA
SH_GOLDEN_RATIO;c=initval;while(len>=12){a+=(k[0]+((uint32_t)k[1]<<8)+((uint32_t
)k[2]<<16)+((uint32_t)k[3]<<24));b+=(k[4]+((uint32_t)k[5]<<8)+((uint32_t)k[6]<<1
6)+((uint32_t)k[7]<<24));c+=(k[8]+((uint32_t)k[9]<<8)+((uint32_t)k[10]<<16)+((ui
nt32_t)k[11]<<24));__jhash_mix(a,b,c);k+=12;len-=12;}c+=length;switch(len){case1
1:c+=((uint32_t)k[10]<<24);/*fallthru*/case10:c+=((uint32_t)k[9]<<16);/*fallthru
*/case9:c+=((uint32_t)k[8]<<8);/*fallthru*/case8:b+=((uint32_t)k[7]<<24);/*fallt
hru*/case7:b+=((uint32_t)k[6]<<16);/*fallthru*/case6:b+=((uint32_t)k[5]<<8);/*fa
llthru*/case5:b+=k[4];/*fallthru*/case4:a+=((uint32_t)k[3]<<24);/*fallthru*/case
3:a+=((uint32_t)k[2]<<16);/*fallthru*/case2:a+=((uint32_t)k[1]<<8);/*fallthru*/c
ase1:a+=k[0];};__jhash_mix(a,b,c);returnc;}/*Aspecialoptimizedversionthathandles
1ormoreofuint32_ts.*Thelengthparameterhereisthenumberofuint32_tsinthekey.*/uint3
2_tjhash2(constuint32_t*k,uint32_tlength,uint32_tinitval){uint32_ta,b,c,len;a=b=
JHASH_GOLDEN_RATIO;c=initval;len=length;while(len>=3){a+=k[0];b+=k[1];c+=k[2];__
jhash_mix(a,b,c);k+=3;len-=3;}c+=length*4;switch(len){case2:b+=k[1];/*fallthru*/
case1:a+=k[0];};__jhash_mix(a,b,c);returnc;}/*Aspecialultra-optimizedversionstha
tknowstheyarehashingexactly*3,2or1word(s).**NOTE:Inpartilarthe"c+=length;__jhash
_mix(a,b,c);"normally*doneattheendisnotdonehere.*/uint32_tjhash_3words(uint32_ta
,uint32_tb,uint32_tc,uint32_tinitval){a+=JHASH_GOLDEN_RATIO;b+=JHASH_GOLDEN_RATI
O;c+=initval;__jhash_mix(a,b,c);returnc;}uint32_tjhash_2words(uint32_ta,uint32_t
b,uint32_tinitval){returnjhash_3words(a,b,0,initval);}uint32_tjhash_1word(uint32
_ta,uint32_tinitval){returnjhash_3words(a,0,0,initval);}