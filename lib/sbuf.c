/**Simplestringbuffer**Copyright(C)2017ChristianFranke**ThisfileispartofFRR.**FR
Risfreesoftware;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralP
ublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouropti
on)any*laterversion.**FRRisdistributedinthehopethatitwillbeuseful,but*WITHOUTANY
WARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARP
URPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhavereceivedacopy
oftheGNUGeneralPublicLicense*alongwithFRR;seethefileCOPYING.Ifnot,writetotheFree
*SoftwareFoundation,Inc.,59TemplePlace-Suite330,Boston,MA*02111-1307,USA.*/#incl
ude<zebra.h>#include"sbuf.h"#include"memory.h"voidsbuf_init(structsbuf*dest,char
*buf,size_tsize){dest->fixed=(size>0);if(dest->fixed){dest->buf=buf;dest->size=s
ize;}else{dest->buf=XMALLOC(MTYPE_TMP,4096);dest->size=4096;}dest->pos=0;dest->b
uf[0]='\0';}voidsbuf_reset(structsbuf*dest){dest->pos=0;dest->buf[0]='\0';}const
char*sbuf_buf(structsbuf*buf){returnbuf->buf;}voidsbuf_free(structsbuf*buf){if(!
buf->fixed)XFREE(MTYPE_TMP,buf->buf);}voidsbuf_push(structsbuf*buf,intindent,con
stchar*format,...){va_listargs;intwritten;if(!buf->fixed){chardummy;intwritten1,
written2;size_tnew_size;written1=snprintf(&dummy,0,"%*s",indent,"");va_start(arg
s,format);written2=vsnprintf(&dummy,0,format,args);va_end(args);new_size=buf->si
ze;if(written1>=0&&written2>=0){while(buf->pos+written1+written2>=new_size)new_s
ize*=2;if(new_size>buf->size){buf->buf=XREALLOC(MTYPE_TMP,buf->buf,new_size);buf
->size=new_size;}}}written=snprintf(buf->buf+buf->pos,buf->size-buf->pos,"%*s",i
ndent,"");if(written>=0)buf->pos+=written;if(buf->pos>buf->size)buf->pos=buf->si
ze;va_start(args,format);written=vsnprintf(buf->buf+buf->pos,buf->size-buf->pos,
format,args);va_end(args);if(written>=0)buf->pos+=written;if(buf->pos>buf->size)
buf->pos=buf->size;if(buf->pos==buf->size)assert(!"Bufferfilledup!");}