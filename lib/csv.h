/*CSV*Copyright(C)2013CumulusNetworks,Inc.**ThisfileispartofQuagga.**Quaggaisfre
esoftware;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicL
icenseaspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any
*laterversion.**Quaggaisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWAR
RANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURP
OSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhavereceivedacopyoft
heGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetoth
eFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#i
fndef__CSV_H__#define__CSV_H__/**CSVencodinganddecodingroutines.**Example:*Encod
ingside:**csv_t*csv;*csv_record_t*fstrec;*csv_record_t*rec;*charbuf[BUFSIZ];**cs
v=csv_init(csv,buf,BUFSIZ);*...*fstrec=csv_encode(csv,2,"hello","world");*rec=cs
v_encode(csv,2,"foo","bar");*...*fstrec=csv_encode_record(csv,fstrec,2,"HELLO","
WORLD");*...*csv_clean(csv);**Decodingside:**csv_t*csv;*csv_record_t*rec;*csv_fi
eld_t*fld;*char*rcvdbuf;**csv=csv_init(csv,rcvdbuf,BUFSIZ);*...*csv_decode(csv);
*csv_dump(csv);**for(rec=csv_record_iter(csv);rec;*rec=csv_record_iter_next(rec)
){*...*for(str=csv_field_iter(rec,&fld);str;*str=csv_field_iter_next(&fld)){*...
*}*}*...*csv_clean(csv);*/#include<stdio.h>#include<stdlib.h>#include<string.h>#
include<stdarg.h>#include<sys/queue.h>typedefstruct_csv_field_t_csv_field_t;type
defstruct_csv_record_t_csv_record_t;typedefstruct_csv_t_csv_t;/***InitializetheC
SVstructure(ifnecessary,allocatefirst).Pointto*thepassedstringbuffer.*/csv_t*csv
_init(csv_t*csv,char*buf,intbuflen);/***EncodethevariablelistofargumentsasCSVfie
lds.Thecsvstructure*shouldhavebeeninitialized(withthestringbuffer).Thefieldsget*
concatenatedintothestring.*/csv_record_t*csv_encode(csv_t*csv,intcount,...);/***
Encodethevariablelistargumentsintoanexistingrecord,essentially*overwritingtherec
ord.Nocheckingisdoneforconsistency.Thenumber*offieldsshouldbethesameaswhatwasenc
odedandthelengthofeach*fieldshouldalsobethesameaswhatwasencodedbefore.The"rec"*p
arametershouldbethesameaswhatwasreturnedfromapreviouscall*tocsv_encode().**Usefu
lformessageencoding/decodingthatgetpassedaroundbetween*processes/nodes-e.g.theme
ssageheaderrecordcanberewrittenAFTER*encodingallotherrecords,withnewinformations
uchastotallength.*/csv_record_t*csv_encode_record(csv_t*csv,csv_record_t*rec,int
count,...);/***DecodeaCSVformattedstring.Thecsvstructureshouldhavebeen*initializ
ed(withthestring).ThefunctioncreatesaLISTofrecords*(csv_record_tstructure)wheree
achrecordisinturnaLISToffields*(csv_field_tstructure).Therecordpointstothestring
containingthe*listoffields.Similarly,thefieldpointstothefieldstring.*NB:csviniti
alizedfordiscretebuf,callerwillpassinbuf*/voidcsv_decode(csv_t*csv,char*inbuf);/
***DumpallfieldsofadecodedCSVtostderr*/voidcsv_dump(csv_t*csv);/***Totallengthof
allcharactersencodedintheCSV.*/intcsvlen(csv_t*csv);voidcsv_clean(csv_t*csv);voi
dcsv_free(csv_t*csv);/***Iteratethroughtherecordsandfieldsofanencoded/decodedCSV
.*/csv_record_t*csv_record_iter(csv_t*csv);csv_record_t*csv_record_iter_next(csv
_record_t*rec);char*csv_field_iter(csv_record_t*rec,csv_field_t**fld);char*csv_f
ield_iter_next(csv_field_t**fld);/***Returnthelengthoffield*/intcsv_field_len(cs
v_field_t*fld);/***Checkstoseeifarecordbelongstoacsv*/intcsv_is_record_valid(csv
_t*csv,csv_record_t*in_rec);/***concattworecordsinacsv*Returnsthenewlyformedreco
rdwhichincludesfieldsfromrec1andrec2*rec1andrec2areremoved*/csv_record_t*csv_con
cat_record(csv_t*csv,csv_record_t*rec1,csv_record_t*rec2);/***Removearecordfromc
sv*Onlyworkswhencsvhasdiscreterecordbufs*/voidcsv_remove_record(csv_t*csv,csv_re
cord_t*rec);/***Insertarecordintocsv*Onlyworkswhencsvhasdiscreterecordbufs*/void
csv_insert_record(csv_t*csv,csv_record_t*rec);/***appendfieldstoarecord*Onlywork
swhencsvhasdiscreterecordbufs*/csv_record_t*csv_append_record(csv_t*csv,csv_reco
rd_t*rec,intcount,...);/***Serializecontentsofcsvintostring*Onlyworkswhencsvhasd
iscreterecordbufs*/intcsv_serialize(csv_t*csv,char*msgbuf,intmsglen);/***Clonear
ecord.*Onlyworkswhencsvhasdiscreterecordbufs*/voidcsv_clone_record(csv_t*csv,csv
_record_t*in_rec,csv_record_t**out_rec);/***Returnnumberofrecords*/intcsv_num_re
cords(csv_t*csv);#endif