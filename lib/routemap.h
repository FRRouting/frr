/*Routemapfunction.*Copyright(C)1998KunihiroIshiguro**ThisfileispartofGNUZebra.*
*GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthetermsoftheGNU
GeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(at
youroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwillbeuseful,b
ut*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFO
RAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhave
receivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING
;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA0
2110-1301USA*/#ifndef_ZEBRA_ROUTEMAP_H#define_ZEBRA_ROUTEMAP_H#include"prefix.h"
#include"memory.h"#include"qobj.h"#include"vty.h"DECLARE_MTYPE(ROUTE_MAP_NAME)DE
CLARE_MTYPE(ROUTE_MAP_RULE)DECLARE_MTYPE(ROUTE_MAP_COMPILED)/*Routemap'stype.*/e
numroute_map_type{RMAP_PERMIT,RMAP_DENY,RMAP_ANY};typedefenum{RMAP_MATCH,RMAP_DE
NYMATCH,RMAP_NOMATCH,RMAP_ERROR,RMAP_OKAY}route_map_result_t;typedefenum{RMAP_RI
P,RMAP_RIPNG,RMAP_OSPF,RMAP_OSPF6,RMAP_BGP,RMAP_ZEBRA,RMAP_ISIS,}route_map_objec
t_t;typedefenum{RMAP_EXIT,RMAP_GOTO,RMAP_NEXT}route_map_end_t;typedefenum{RMAP_E
VENT_SET_ADDED,RMAP_EVENT_SET_DELETED,RMAP_EVENT_SET_REPLACED,RMAP_EVENT_MATCH_A
DDED,RMAP_EVENT_MATCH_DELETED,RMAP_EVENT_MATCH_REPLACED,RMAP_EVENT_INDEX_ADDED,R
MAP_EVENT_INDEX_DELETED,RMAP_EVENT_CALL_ADDED,/*calltoanotherroutemapadded*/RMAP
_EVENT_CALL_DELETED,RMAP_EVENT_PLIST_ADDED,RMAP_EVENT_PLIST_DELETED,RMAP_EVENT_C
LIST_ADDED,RMAP_EVENT_CLIST_DELETED,RMAP_EVENT_ECLIST_ADDED,RMAP_EVENT_ECLIST_DE
LETED,RMAP_EVENT_LLIST_ADDED,RMAP_EVENT_LLIST_DELETED,RMAP_EVENT_ASLIST_ADDED,RM
AP_EVENT_ASLIST_DELETED,RMAP_EVENT_FILTER_ADDED,RMAP_EVENT_FILTER_DELETED,}route
_map_event_t;/*DepthlimitinRMAPrecursionusingRMAP_CALL.*/#defineRMAP_RECURSION_L
IMIT10/*Routemaprulestructureformatchingandsetting.*/structroute_map_rule_cmd{/*
Routemaprulename(e.g.as-path,metric)*/constchar*str;/*Functionforvaluesetormatch
.*/route_map_result_t(*func_apply)(void*,structprefix*,route_map_object_t,void*)
;/*Compileargumentandreturnresultasvoid*.*/void*(*func_compile)(constchar*);/*Fr
eeallocatedvaluebyfunc_compile().*/void(*func_free)(void*);};/*Routemapapplyerro
r.*/enum{RMAP_COMPILE_SUCCESS,/*Routemapruleismissing.*/RMAP_RULE_MISSING,/*Rout
emaprulecan'tcompile*/RMAP_COMPILE_ERROR};/*Routemaprulelist.*/structroute_map_r
ule_list{structroute_map_rule*head;structroute_map_rule*tail;};/*Routemapindexst
ructure.*/structroute_map_index{structroute_map*map;char*description;/*Preferenc
eofthisroutemaprule.*/intpref;/*Routemaptypepermitordeny.*/enumroute_map_typetyp
e;/*Dowefollowoldrules,orhopforward?*/route_map_end_texitpolicy;/*Ifwe'reusing"G
OTO",towheredowego?*/intnextpref;/*Ifwe'reusing"CALL",towhichroute-mapdoewgo?*/c
har*nextrm;/*Matchingrulelist.*/structroute_map_rule_listmatch_list;structroute_
map_rule_listset_list;/*Makelinkedlist.*/structroute_map_index*next;structroute_
map_index*prev;QOBJ_FIELDS};DECLARE_QOBJ_TYPE(route_map_index)/*Routemapliststru
cture.*/structroute_map{/*Nameofroutemap.*/char*name;/*Routemap'srule.*/structro
ute_map_index*head;structroute_map_index*tail;/*Makelinkedlist.*/structroute_map
*next;structroute_map*prev;/*Maintainupdateinfo*/intto_be_processed;/*Trueifmodi
ficationisn'tactedonyet*/intdeleted;/*If1,thenthisnodewillbedeleted*/QOBJ_FIELDS
};DECLARE_QOBJ_TYPE(route_map)/*Prototypes.*/externvoidroute_map_init(void);exte
rnvoidroute_map_finish(void);/*Addmatchstatementtoroutemap.*/externintroute_map_
add_match(structroute_map_index*index,constchar*match_name,constchar*match_arg);
/*Deletespecifiedroutematchrule.*/externintroute_map_delete_match(structroute_ma
p_index*index,constchar*match_name,constchar*match_arg);externconstchar*route_ma
p_get_match_arg(structroute_map_index*index,constchar*match_name);/*Addroute-map
setstatementtotheroutemap.*/externintroute_map_add_set(structroute_map_index*ind
ex,constchar*set_name,constchar*set_arg);/*Deleteroutemapsetrule.*/externintrout
e_map_delete_set(structroute_map_index*index,constchar*set_name,constchar*set_ar
g);/*Installrulecommandtothematchlist.*/externvoidroute_map_install_match(struct
route_map_rule_cmd*cmd);/**Installrulecommandtothesetlist.**Wheninstallingaparti
cularitem,Allowadifferenceofhandling*ofbadcliinputted(returnNULL)-vs-thisparticu
lardaemoncannotuse*thisformofthecommand(returnapointerandhandleitappropriately*i
ntheapplycommand).See'setmetric'command*asitishandledinripd/ripngdandospfd.*/ext
ernvoidroute_map_install_set(structroute_map_rule_cmd*cmd);/*Lookuproutemapbynam
e.*/externstructroute_map*route_map_lookup_by_name(constchar*name);/*Applyroutem
aptotheobject.*/externroute_map_result_troute_map_apply(structroute_map*map,stru
ctprefix*,route_map_object_tobject_type,void*object);externvoidroute_map_add_hoo
k(void(*func)(constchar*));externvoidroute_map_delete_hook(void(*func)(constchar
*));externvoidroute_map_event_hook(void(*func)(route_map_event_t,constchar*));ex
ternintroute_map_mark_updated(constchar*name,intdeleted);externintroute_map_clea
r_updated(structroute_map*rmap);externvoidroute_map_walk_update_list(int(*update
_fn)(char*name));externvoidroute_map_upd8_dependency(route_map_event_ttype,const
char*arg,constchar*rmap_name);externvoidroute_map_notify_dependencies(constchar*
affected_name,route_map_event_tevent);externintgeneric_match_add(structvty*vty,s
tructroute_map_index*index,constchar*command,constchar*arg,route_map_event_ttype
);externintgeneric_match_delete(structvty*vty,structroute_map_index*index,constc
har*command,constchar*arg,route_map_event_ttype);externintgeneric_set_add(struct
vty*vty,structroute_map_index*index,constchar*command,constchar*arg);externintge
neric_set_delete(structvty*vty,structroute_map_index*index,constchar*command,con
stchar*arg);/*matchinterface*/externvoidroute_map_match_interface_hook(int(*func
)(structvty*vty,structroute_map_index*index,constchar*command,constchar*arg,rout
e_map_event_ttype));/*nomatchinterface*/externvoidroute_map_no_match_interface_h
ook(int(*func)(structvty*vty,structroute_map_index*index,constchar*command,const
char*arg,route_map_event_ttype));/*matchipaddress*/externvoidroute_map_match_ip_
address_hook(int(*func)(structvty*vty,structroute_map_index*index,constchar*comm
and,constchar*arg,route_map_event_ttype));/*nomatchipaddress*/externvoidroute_ma
p_no_match_ip_address_hook(int(*func)(structvty*vty,structroute_map_index*index,
constchar*command,constchar*arg,route_map_event_ttype));/*matchipaddressprefixli
st*/externvoidroute_map_match_ip_address_prefix_list_hook(int(*func)(structvty*v
ty,structroute_map_index*index,constchar*command,constchar*arg,route_map_event_t
type));/*nomatchipaddressprefixlist*/externvoidroute_map_no_match_ip_address_pre
fix_list_hook(int(*func)(structvty*vty,structroute_map_index*index,constchar*com
mand,constchar*arg,route_map_event_ttype));/*matchipnexthop*/externvoidroute_map
_match_ip_next_hop_hook(int(*func)(structvty*vty,structroute_map_index*index,con
stchar*command,constchar*arg,route_map_event_ttype));/*nomatchipnexthop*/externv
oidroute_map_no_match_ip_next_hop_hook(int(*func)(structvty*vty,structroute_map_
index*index,constchar*command,constchar*arg,route_map_event_ttype));/*matchipnex
thopprefixlist*/externvoidroute_map_match_ip_next_hop_prefix_list_hook(int(*func
)(structvty*vty,structroute_map_index*index,constchar*command,constchar*arg,rout
e_map_event_ttype));/*nomatchipnexthopprefixlist*/externvoidroute_map_no_match_i
p_next_hop_prefix_list_hook(int(*func)(structvty*vty,structroute_map_index*index
,constchar*command,constchar*arg,route_map_event_ttype));/*matchipv6address*/ext
ernvoidroute_map_match_ipv6_address_hook(int(*func)(structvty*vty,structroute_ma
p_index*index,constchar*command,constchar*arg,route_map_event_ttype));/*nomatchi
pv6address*/externvoidroute_map_no_match_ipv6_address_hook(int(*func)(structvty*
vty,structroute_map_index*index,constchar*command,constchar*arg,route_map_event_
ttype));/*matchipv6addressprefixlist*/externvoidroute_map_match_ipv6_address_pre
fix_list_hook(int(*func)(structvty*vty,structroute_map_index*index,constchar*com
mand,constchar*arg,route_map_event_ttype));/*nomatchipv6addressprefixlist*/exter
nvoidroute_map_no_match_ipv6_address_prefix_list_hook(int(*func)(structvty*vty,s
tructroute_map_index*index,constchar*command,constchar*arg,route_map_event_ttype
));/*matchmetric*/externvoidroute_map_match_metric_hook(int(*func)(structvty*vty
,structroute_map_index*index,constchar*command,constchar*arg,route_map_event_tty
pe));/*nomatchmetric*/externvoidroute_map_no_match_metric_hook(int(*func)(struct
vty*vty,structroute_map_index*index,constchar*command,constchar*arg,route_map_ev
ent_ttype));/*matchtag*/externvoidroute_map_match_tag_hook(int(*func)(structvty*
vty,structroute_map_index*index,constchar*command,constchar*arg,route_map_event_
ttype));/*nomatchtag*/externvoidroute_map_no_match_tag_hook(int(*func)(structvty
*vty,structroute_map_index*index,constchar*command,constchar*arg,route_map_event
_ttype));/*setipnexthop*/externvoidroute_map_set_ip_nexthop_hook(int(*func)(stru
ctvty*vty,structroute_map_index*index,constchar*command,constchar*arg));/*noseti
pnexthop*/externvoidroute_map_no_set_ip_nexthop_hook(int(*func)(structvty*vty,st
ructroute_map_index*index,constchar*command,constchar*arg));/*setipv6nexthoploca
l*/externvoidroute_map_set_ipv6_nexthop_local_hook(int(*func)(structvty*vty,stru
ctroute_map_index*index,constchar*command,constchar*arg));/*nosetipv6nexthoploca
l*/externvoidroute_map_no_set_ipv6_nexthop_local_hook(int(*func)(structvty*vty,s
tructroute_map_index*index,constchar*command,constchar*arg));/*setmetric*/extern
voidroute_map_set_metric_hook(int(*func)(structvty*vty,structroute_map_index*ind
ex,constchar*command,constchar*arg));/*nosetmetric*/externvoidroute_map_no_set_m
etric_hook(int(*func)(structvty*vty,structroute_map_index*index,constchar*comman
d,constchar*arg));/*settag*/externvoidroute_map_set_tag_hook(int(*func)(structvt
y*vty,structroute_map_index*index,constchar*command,constchar*arg));/*nosettag*/
externvoidroute_map_no_set_tag_hook(int(*func)(structvty*vty,structroute_map_ind
ex*index,constchar*command,constchar*arg));externvoid*route_map_rule_tag_compile
(constchar*arg);externvoidroute_map_rule_tag_free(void*rule);#endif/*_ZEBRA_ROUT
EMAP_H*/