/**Nexthopstructuredefinition.*Copyright(C)1997,98,99,2001KunihiroIshiguro*Copyr
ight(C)2013CumulusNetworks,Inc.**ThisfileispartofQuagga.**Quaggaisfreesoftware;y
oucanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspub
lishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*laterversi
on.**Quaggaisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANTY;witho
uteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheG
NU*GeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGNUGenera
lPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftwa
re*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#ifndef_LIB_N
EXTHOP_H#define_LIB_NEXTHOP_H#include"prefix.h"#include"mpls.h"/*Maximumnexthops
tringlength-gateway+ifindex*/#defineNEXTHOP_STRLEN(INET6_ADDRSTRLEN+30)uniong_ad
dr{structin_addripv4;structin6_addripv6;};enumnexthop_types_t{NEXTHOP_TYPE_IFIND
EX=1,/*Directlyconnected.*/NEXTHOP_TYPE_IPV4,/*IPv4nexthop.*/NEXTHOP_TYPE_IPV4_I
FINDEX,/*IPv4nexthopwithifindex.*/NEXTHOP_TYPE_IPV6,/*IPv6nexthop.*/NEXTHOP_TYPE
_IPV6_IFINDEX,/*IPv6nexthopwithifindex.*/NEXTHOP_TYPE_BLACKHOLE,/*Null0nexthop.*
/};enumblackhole_type{BLACKHOLE_UNSPEC=0,BLACKHOLE_NULL,BLACKHOLE_REJECT,BLACKHO
LE_ADMINPROHIB,};/*IPV[46]->IPV[46]_IFINDEX*/#defineNEXTHOP_FIRSTHOPTYPE(type)\(
(type)==NEXTHOP_TYPE_IFINDEX||(type)==NEXTHOP_TYPE_BLACKHOLE)\?(type)\:((type)|1
)/*Nexthopstructure.*/structnexthop{structnexthop*next;structnexthop*prev;/**Wha
tvrfisthisnexthopassociatedwith?*/vrf_id_tvrf_id;/*Interfaceindex.*/ifindex_tifi
ndex;enumnexthop_types_ttype;uint8_tflags;#defineNEXTHOP_FLAG_ACTIVE(1<<0)/*This
nexthopisalive.*/#defineNEXTHOP_FLAG_FIB(1<<1)/*FIBnexthop.*/#defineNEXTHOP_FLAG
_RECURSIVE(1<<2)/*Recursivenexthop.*/#defineNEXTHOP_FLAG_ONLINK(1<<3)/*Nexthopsh
ouldbeinstalledonlink.*/#defineNEXTHOP_FLAG_MATCHED(1<<4)/*Alreadymatchedvsanext
hop*/#defineNEXTHOP_FLAG_FILTERED(1<<5)/*rmapfiltered,usedbystaticonly*/#defineN
EXTHOP_FLAG_DUPLICATE(1<<6)/*nexthopduplicatesanotheractiveone*/#defineNEXTHOP_F
LAG_EVPN_RVTEP(1<<7)/*EVPNremotevtepnexthop*/#defineNEXTHOP_IS_ACTIVE(flags)\(CH
ECK_FLAG(flags,NEXTHOP_FLAG_ACTIVE)\&&!CHECK_FLAG(flags,NEXTHOP_FLAG_DUPLICATE))
/*Nexthopaddress*/union{uniong_addrgate;enumblackhole_typebh_type;};uniong_addrs
rc;uniong_addrrmap_src;/*Srcissetviaroutemap*//*Nexthopsobtainedbyrecursiveresol
ution.**Ifthenexthopstructneedstoberesolvedrecursively,*NEXTHOP_FLAG_RECURSIVEwi
llbesetinflagsandthenexthops*obtainedbyrecursiveresolutionwillbeaddedto`resolved
'.*/structnexthop*resolved;/*Recursiveparent*/structnexthop*rparent;/*Typeoflabe
l(s),ifany*/enumlsp_types_tnh_label_type;/*Label(s)associatedwiththisnexthop.*/s
tructmpls_label_stack*nh_label;};structnexthop*nexthop_new(void);voidnexthop_fre
e(structnexthop*nexthop);voidnexthops_free(structnexthop*nexthop);voidnexthop_ad
d_labels(structnexthop*,enumlsp_types_t,uint8_t,mpls_label_t*);voidnexthop_del_l
abels(structnexthop*);externboolnexthop_same(conststructnexthop*nh1,conststructn
exthop*nh2);externconstchar*nexthop_type_to_str(enumnexthop_types_tnh_type);exte
rnintnexthop_same_no_recurse(conststructnexthop*next1,conststructnexthop*next2);
externintnexthop_labels_match(structnexthop*nh1,structnexthop*nh2);externintnext
hop_same_firsthop(structnexthop*next1,structnexthop*next2);externconstchar*nexth
op2str(structnexthop*nexthop,char*str,intsize);externstructnexthop*nexthop_next(
structnexthop*nexthop);externunsignedintnexthop_level(structnexthop*nexthop);#en
dif/*_LIB_NEXTHOP_H*/