/**Copyright(c)2016DavidLamparter,forNetDEF,Inc.**Permissionisherebygranted,free
ofcharge,toanypersonobtaininga*copyofthissoftwareandassociateddocumentationfiles
(the"Software"),*todealintheSoftwarewithoutrestriction,includingwithoutlimitatio
n*therightstouse,copy,modify,merge,publish,distribute,sublicense,*and/orsellcopi
esoftheSoftware,andtopermitpersonstowhomthe*Softwareisfurnishedtodoso,subjecttot
hefollowingconditions:**Theabovecopyrightnoticeandthispermissionnoticeshallbeinc
ludedin*allcopiesorsubstantialportionsoftheSoftware.**THESOFTWAREISPROVIDED"ASIS
",WITHOUTWARRANTYOFANYKIND,EXPRESSOR*IMPLIED,INCLUDINGBUTNOTLIMITEDTOTHEWARRANTI
ESOFMERCHANTABILITY,*FITNESSFORAPARTICULARPURPOSEANDNONINFRINGEMENT.INNOEVENTSHA
LL*THEAUTHORSORCOPYRIGHTHOLDERSBELIABLEFORANYCLAIM,DAMAGESOROTHER*LIABILITY,WHET
HERINANACTIONOFCONTRACT,TORTOROTHERWISE,ARISING*FROM,OUTOFORINCONNECTIONWITHTHES
OFTWAREORTHEUSEOROTHER*DEALINGSINTHESOFTWARE.*/#include"memory.h"#include"hook.h
"DEFINE_MTYPE_STATIC(LIB,HOOK_ENTRY,"Hookentry")void_hook_register(structhook*ho
ok,void*funcptr,void*arg,boolhas_arg,structfrrmod_runtime*module,constchar*funcn
ame,intpriority){structhookent*he=XCALLOC(MTYPE_HOOK_ENTRY,sizeof(*he)),**pos;he
->hookfn=funcptr;he->hookarg=arg;he->has_arg=has_arg;he->module=module;he->fnnam
e=funcname;he->priority=priority;for(pos=&hook->entries;*pos;pos=&(*pos)->next)i
f(hook->reverse?(*pos)->priority<priority:(*pos)->priority>=priority)break;he->n
ext=*pos;*pos=he;}void_hook_unregister(structhook*hook,void*funcptr,void*arg,boo
lhas_arg){structhookent*he,**prev;for(prev=&hook->entries;(he=*prev)!=NULL;prev=
&he->next)if(he->hookfn==funcptr&&he->hookarg==arg&&he->has_arg==has_arg){*prev=
he->next;XFREE(MTYPE_HOOK_ENTRY,he);break;}}