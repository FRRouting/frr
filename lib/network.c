/**Networklibrary.*Copyright(C)1997KunihiroIshiguro**ThisfileispartofGNUZebra.**
GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthetermsoftheGNUG
eneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(aty
ouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwillbeuseful,bu
t*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFOR
APARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhaver
eceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;
ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02
110-1301USA*/#include<zebra.h>#include"log.h"#include"network.h"/*Readnbytesfrom
fdandstoreintoptr.*/intreadn(intfd,uint8_t*ptr,intnbytes){intnleft;intnread;nlef
t=nbytes;while(nleft>0){nread=read(fd,ptr,nleft);if(nread<0)return(nread);elseif
(nread==0)break;nleft-=nread;ptr+=nread;}returnnbytes-nleft;}/*Writenbytesfrompt
rtofd.*/intwriten(intfd,constuint8_t*ptr,intnbytes){intnleft;intnwritten;nleft=n
bytes;while(nleft>0){nwritten=write(fd,ptr,nleft);if(nwritten<0){if(!ERRNO_IO_RE
TRY(errno))returnnwritten;}if(nwritten==0)return(nwritten);nleft-=nwritten;ptr+=
nwritten;}returnnbytes-nleft;}intset_nonblocking(intfd){intflags;/*Accordingtoth
eSingleUNIXSpec,thereturnvalueforF_GETFLshouldneverbenegative.*/if((flags=fcntl(
fd,F_GETFL))<0){zlog_warn("fcntl(F_GETFL)failedforfd%d:%s",fd,safe_strerror(errn
o));return-1;}if(fcntl(fd,F_SETFL,(flags|O_NONBLOCK))<0){zlog_warn("fcntlfaileds
ettingfd%dnon-blocking:%s",fd,safe_strerror(errno));return-1;}return0;}intset_cl
oexec(intfd){intflags;flags=fcntl(fd,F_GETFD,0);if(flags==-1)return-1;flags|=FD_
CLOEXEC;if(fcntl(fd,F_SETFD,flags)==-1)return-1;return0;}floathtonf(floathost){u
int32_tlu1,lu2;floatconvert;memcpy(&lu1,&host,sizeof(uint32_t));lu2=htonl(lu1);m
emcpy(&convert,&lu2,sizeof(uint32_t));returnconvert;}floatntohf(floatnet){return
htonf(net);}