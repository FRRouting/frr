/**Bufferingtooutputandinput.*Copyright(C)1998KunihiroIshiguro**Thisfileispartof
GNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodify*itundertheter
msoftheGNUGeneralPublicLicenseaspublished*bytheFreeSoftwareFoundation;eithervers
ion2,or(atyour*option)anylaterversion.**GNUZebraisdistributedinthehopethatitwill
beuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYo
rFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**You
shouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethef
ileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,
Boston,MA02110-1301USA*/#ifndef_ZEBRA_BUFFER_H#define_ZEBRA_BUFFER_H/*Createanew
buffer.Memorywillbeallocatedinchunksofthegivensize.Iftheargumentis0,thelibrarywi
llsupplyareasonabledefaultsizesuitableforbufferingsocketI/O.*/externstructbuffer
*buffer_new(size_t);/*Freealldatainthebuffer.*/externvoidbuffer_reset(structbuff
er*);/*Thisfunctionfirstcallsbuffer_resettoreleaseallbuffereddata.Thenitfreesthe
structbufferitself.*/externvoidbuffer_free(structbuffer*);/*Addthegivendatatothe
endofthebuffer.*/externvoidbuffer_put(structbuffer*,constvoid*,size_t);/*Addasin
glecharactertotheendofthebuffer.*/externvoidbuffer_putc(structbuffer*,uint8_t);/
*AddaNUL-terminatedstringtotheendofthebuffer.*/externvoidbuffer_putstr(structbuf
fer*,constchar*);/*Addgivendata,inline-expanding\nto\r\n*/externvoidbuffer_put_c
rlf(structbuffer*b,constvoid*p,size_tsize);/*Combineallaccumulated(andunflushed)
datainsidethebufferintoasingleNUL-terminatedstringallocatedusingXMALLOC(MTYPE_TM
P).Notethatthisfunctiondoesnotalterthestateofthebuffer,sothedataisstillinsidewai
tingtobeflushed.*/char*buffer_getstr(structbuffer*);/*Returns1ifthereisnopending
datainthebuffer.Otherwisereturns0.*/intbuffer_empty(structbuffer*);typedefenum{/
*AnI/Oerroroccurred.Thebuffershouldbedestroyedandthefiledescriptorshouldbeclosed
.*/BUFFER_ERROR=-1,/*Thedatawaswrittensuccessfully,andthebufferisnowempty(therei
snopendingdatawaitingtobeflushed).*/BUFFER_EMPTY=0,/*Thereispendingdatainthebuff
erwaitingtobeflushed.Pleasetryflushingthebufferwhenselectindicatesthatthefiledes
criptoriswriteable.*/BUFFER_PENDING=1}buffer_status_t;/*Trytowritethisdatatothef
iledescriptor.Anydatathatcannotbewrittenimmediatelyisaddedtothebufferqueue.*/ext
ernbuffer_status_tbuffer_write(structbuffer*,intfd,constvoid*,size_t);/*Thisfunc
tionattemptstoflushsome(butperhapsnotall)ofthequeueddatatothegivenfiledescriptor
.*/externbuffer_status_tbuffer_flush_available(structbuffer*,intfd);/*Thefollowi
ng2functions(buffer_flush_allandbuffer_flush_window)areforuseinlib/vty.conly.The
yshouldnotbeusedelsewhere.*//*Callbuffer_flush_availablerepeatedlyuntileitherall
datahasbeenflushed,oranI/Oerrorhasbeenencountered,ortheoperationwouldblock.*/ext
ernbuffer_status_tbuffer_flush_all(structbuffer*,intfd);/*Attempttowriteenoughda
tatothegivenfdtofillawindowofthegivenwidthandheight(andremovethedatawrittenfromt
hebuffer).If!no_more,thenamessagesaying"--More--"isappended.Iferaseistrue,thenfi
rstoverwritetheprevious"--More--"messagewithspaces.Anywriteerror(includingEAGAIN
orEINTR)willcausethisfunctiontoreturn-1(becausethelogicforhandlingtheeraseandmor
efeaturesistoocomplicatedtoretrythewritelater).*/externbuffer_status_tbuffer_flu
sh_window(structbuffer*,intfd,intwidth,intheight,interase,intno_more);#endif/*_Z
EBRA_BUFFER_H*/