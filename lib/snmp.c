/*SNMPsupport*Copyright(C)1999KunihiroIshiguro<kunihiro@zebra.org>**Thisfileispa
rtofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underth
etermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;either
version2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatit
willbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABIL
ITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.*
*YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;see
thefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFl
oor,Boston,MA02110-1301USA*/#include<zebra.h>#include<net-snmp/net-snmp-config.h
>#include<net-snmp/net-snmp-includes.h>#include"smux.h"#definemin(A,B)((A)<(B)?(
A):(B))intoid_compare(constoid*o1,into1_len,constoid*o2,into2_len){inti;for(i=0;
i<min(o1_len,o2_len);i++){if(o1[i]<o2[i])return-1;elseif(o1[i]>o2[i])return1;}if
(o1_len<o2_len)return-1;if(o1_len>o2_len)return1;return0;}void*oid_copy(void*des
t,constvoid*src,size_tsize){returnmemcpy(dest,src,size*sizeof(oid));}voidoid2in_
addr(oidoid[],intlen,structin_addr*addr){inti;uint8_t*pnt;if(len==0)return;pnt=(
uint8_t*)addr;for(i=0;i<len;i++)*pnt++=oid[i];}voidoid_copy_addr(oidoid[],struct
in_addr*addr,intlen){inti;uint8_t*pnt;if(len==0)return;pnt=(uint8_t*)addr;for(i=
0;i<len;i++)oid[i]=*pnt++;}intsmux_header_generic(structvariable*v,oid*name,size
_t*length,intexact,size_t*var_len,WriteMethod**write_method){oidfulloid[MAX_OID_
LEN];intret;oid_copy(fulloid,v->name,v->namelen);fulloid[v->namelen]=0;/*Checkag
ainstfullinstance.*/ret=oid_compare(name,*length,fulloid,v->namelen+1);/*Checksi
ngleinstance.*/if((exact&&(ret!=0))||(!exact&&(ret>=0)))returnMATCH_FAILED;/*Inc
aseofgetnext,fillinfullinstance.*/memcpy(name,fulloid,(v->namelen+1)*sizeof(oid)
);*length=v->namelen+1;*write_method=0;*var_len=sizeof(long);/*defaultto'long're
sults*/returnMATCH_SUCCEEDED;}intsmux_header_table(structvariable*v,oid*name,siz
e_t*length,intexact,size_t*var_len,WriteMethod**write_method){/*IftherequestedOI
DnameislessthanOIDprefixwehandle,adjustittoourprefix.*/if((oid_compare(name,*len
gth,v->name,v->namelen))<0){if(exact)returnMATCH_FAILED;oid_copy(name,v->name,v-
>namelen);*length=v->namelen;}*write_method=0;*var_len=sizeof(long);returnMATCH_
SUCCEEDED;}