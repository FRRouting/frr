/*Genericvectorinterfaceroutine*Copyright(C)1997KunihiroIshiguro**Thisfileispart
ofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthet
ermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherve
rsion2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwi
llbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILIT
YorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Y
oushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seeth
efileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloo
r,Boston,MA02110-1301USA*/#include<zebra.h>#include"vector.h"#include"memory.h"D
EFINE_MTYPE_STATIC(LIB,VECTOR,"Vector")DEFINE_MTYPE_STATIC(LIB,VECTOR_INDEX,"Vec
torindex")/*Initializevector:allocatememoryandreturnvector.*/vectorvector_init(u
nsignedintsize){vectorv=XCALLOC(MTYPE_VECTOR,sizeof(struct_vector));/*allocateat
leastoneslot*/if(size==0)size=1;v->alloced=size;v->active=0;v->index=XCALLOC(MTY
PE_VECTOR_INDEX,sizeof(void*)*size);returnv;}voidvector_free(vectorv){XFREE(MTYP
E_VECTOR_INDEX,v->index);XFREE(MTYPE_VECTOR,v);}vectorvector_copy(vectorv){unsig
nedintsize;vectornew=XCALLOC(MTYPE_VECTOR,sizeof(struct_vector));new->active=v->
active;new->alloced=v->alloced;size=sizeof(void*)*(v->alloced);new->index=XCALLO
C(MTYPE_VECTOR_INDEX,size);memcpy(new->index,v->index,size);returnnew;}/*Checkas
signedindex,andifitrunsshortdoubleindexpointer*/voidvector_ensure(vectorv,unsign
edintnum){if(v->alloced>num)return;v->index=XREALLOC(MTYPE_VECTOR_INDEX,v->index
,sizeof(void*)*(v->alloced*2));memset(&v->index[v->alloced],0,sizeof(void*)*v->a
lloced);v->alloced*=2;if(v->alloced<=num)vector_ensure(v,num);}/*Thisfunctiononl
yreturnsnextemptyslotindex.Itdosenotmeantheslot'sindexmemoryisassigned,pleasecal
lvector_ensure()aftercallingthisfunction.*/intvector_empty_slot(vectorv){unsigne
dinti;if(v->active==0)return0;for(i=0;i<v->active;i++)if(v->index[i]==0)returni;
returni;}/*Setvaluetothesmallestemptyslot.*/intvector_set(vectorv,void*val){unsi
gnedinti;i=vector_empty_slot(v);vector_ensure(v,i);v->index[i]=val;if(v->active<
=i)v->active=i+1;returni;}/*Setvaluetospecifiedindexslot.*/intvector_set_index(v
ectorv,unsignedinti,void*val){vector_ensure(v,i);v->index[i]=val;if(v->active<=i
)v->active=i+1;returni;}/*Lookupvector.*/void*vector_lookup(vectorv,unsignedinti
){if(i>=v->active)returnNULL;returnv->index[i];}/*Lookupvector,ensureit.*/void*v
ector_lookup_ensure(vectorv,unsignedinti){vector_ensure(v,i);returnv->index[i];}
/*Unsetvalueatspecifiedindexslot.*/voidvector_unset(vectorv,unsignedinti){if(i>=
v->alloced)return;v->index[i]=NULL;if(i+1==v->active){v->active--;while(i&&v->in
dex[--i]==NULL&&v->active--);/*Isthisugly?*/}}voidvector_unset_value(vectorv,voi
d*val){size_ti;for(i=0;i<v->active;i++)if(v->index[i]==val){v->index[i]=NULL;bre
ak;}if(i+1==v->active)dov->active--;while(i&&v->index[--i]==NULL);}/*Countthenum
berofnotempltyslot.*/unsignedintvector_count(vectorv){unsignedinti;unsignedcount
=0;for(i=0;i<v->active;i++)if(v->index[i]!=NULL)count++;returncount;}