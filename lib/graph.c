/**Graphdatastructure.**--*Copyright(C)2016CumulusNetworks,Inc.**Thisfileisparto
fGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthete
rmsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherver
sion2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwil
lbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITY
orFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Yo
ushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethe
fileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor
,Boston,MA02110-1301USA*/#include<zebra.h>#include"graph.h"#include"memory.h"DEF
INE_MTYPE_STATIC(LIB,GRAPH,"Graph")DEFINE_MTYPE_STATIC(LIB,GRAPH_NODE,"GraphNode
")structgraph*graph_new(){structgraph*graph=XCALLOC(MTYPE_GRAPH,sizeof(structgra
ph));graph->nodes=vector_init(VECTOR_MIN_SIZE);returngraph;}structgraph_node*gra
ph_new_node(structgraph*graph,void*data,void(*del)(void*)){structgraph_node*node
=XCALLOC(MTYPE_GRAPH_NODE,sizeof(structgraph_node));node->from=vector_init(VECTO
R_MIN_SIZE);node->to=vector_init(VECTOR_MIN_SIZE);node->data=data;node->del=del;
vector_set(graph->nodes,node);returnnode;}staticvoidvector_remove(vectorv,unsign
edintix){if(ix>=v->active)return;/*v->activeisguaranteed>=1becauseixcan'tbelower
than0*andv->activeis>ix.*/v->active--;/*ifix==v->active--,wesettheitemtoitself,t
hentoNULL...*stillcorrect,nocheckneccessary.*/v->index[ix]=v->index[v->active];v
->index[v->active]=NULL;}voidgraph_delete_node(structgraph*graph,structgraph_nod
e*node){if(!node)return;//anadjacentnodestructgraph_node*adj;//removealledgesfro
mothernodestousfor(unsignedinti=vector_active(node->from);i--;/**/){adj=vector_s
lot(node->from,i);graph_remove_edge(adj,node);}//removealledgesfromustoothernode
sfor(unsignedinti=vector_active(node->to);i--;/**/){adj=vector_slot(node->to,i);
graph_remove_edge(node,adj);}//ifthereisadeletioncallback,callitif(node->del&&no
de->data)(*node->del)(node->data);//freeadjacencylistsvector_free(node->to);vect
or_free(node->from);//removenodefromgraph->nodesfor(unsignedinti=vector_active(g
raph->nodes);i--;/**/)if(vector_slot(graph->nodes,i)==node){vector_remove(graph-
>nodes,i);break;}//freethenodeitselfXFREE(MTYPE_GRAPH_NODE,node);}structgraph_no
de*graph_add_edge(structgraph_node*from,structgraph_node*to){vector_set(from->to
,to);vector_set(to->from,from);returnto;}voidgraph_remove_edge(structgraph_node*
from,structgraph_node*to){//removefromfromto->fromfor(unsignedinti=vector_active
(to->from);i--;/**/)if(vector_slot(to->from,i)==from){vector_remove(to->from,i);
break;}//removetofromfrom->tofor(unsignedinti=vector_active(from->to);i--;/**/)i
f(vector_slot(from->to,i)==to){vector_remove(from->to,i);break;}}voidgraph_delet
e_graph(structgraph*graph){//deleteeachnodeinthegraphfor(unsignedinti=vector_act
ive(graph->nodes);i--;/**/)graph_delete_node(graph,vector_slot(graph->nodes,i));
vector_free(graph->nodes);XFREE(MTYPE_GRAPH,graph);}