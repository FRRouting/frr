/*Copyright2011byMatthieuBoutierandJuliuszChroboczekPermissionisherebygranted,fr
eeofcharge,toanypersonobtainingacopyofthissoftwareandassociateddocumentationfile
s(the"Software"),todealintheSoftwarewithoutrestriction,includingwithoutlimitatio
ntherightstouse,copy,modify,merge,publish,distribute,sublicense,and/orsellcopies
oftheSoftware,andtopermitpersonstowhomtheSoftwareisfurnishedtodoso,subjecttothef
ollowingconditions:Theabovecopyrightnoticeandthispermissionnoticeshallbeincluded
inallcopiesorsubstantialportionsoftheSoftware.THESOFTWAREISPROVIDED"ASIS",WITHOU
TWARRANTYOFANYKIND,EXPRESSORIMPLIED,INCLUDINGBUTNOTLIMITEDTOTHEWARRANTIESOFMERCH
ANTABILITY,FITNESSFORAPARTICULARPURPOSEANDNONINFRINGEMENT.INNOEVENTSHALLTHEAUTHO
RSORCOPYRIGHTHOLDERSBELIABLEFORANYCLAIM,DAMAGESOROTHERLIABILITY,WHETHERINANACTIO
NOFCONTRACT,TORTOROTHERWISE,ARISINGFROM,OUTOFORINCONNECTIONWITHTHESOFTWAREORTHEU
SEOROTHERDEALINGSINTHESOFTWARE.*/#ifndefBABEL_INTERFACE_H#defineBABEL_INTERFACE_
H#include<zebra.h>#include"zclient.h"#include"vty.h"#include"distribute.h"#defin
eCONFIG_DEFAULT0#defineCONFIG_NO1#defineCONFIG_YES2/*babeldinterfaceinformations
*/structbabel_interface{unsignedshortflags;/*seebelow*/unsignedshortcost;intchan
nel;structtimevalhello_timeout;structtimevalupdate_timeout;structtimevalflush_ti
meout;structtimevalupdate_flush_timeout;unsignedchar*ipv4;intbuffered;intbufsize
;/*RelativepositionoftheHellomessageinthesendbuffer,or(-1)ifthereisnone.*/intbuf
fered_hello;charhave_buffered_id;charhave_buffered_nh;charhave_buffered_prefix;u
nsignedcharbuffered_id[8];unsignedcharbuffered_nh[4];unsignedcharbuffered_prefix
[16];unsignedchar*sendbuf;structbuffered_update*buffered_updates;intnum_buffered
_updates;intupdate_bufsize;time_tbucket_time;unsignedintbucket;time_tlast_update
_time;unsignedshorthello_seqno;unsignedhello_interval;unsignedupdate_interval;/*
AhighervaluemeansweforgetoldRTTsamplesfaster.Mustbebetween1and256,inclusive.*/un
signedintrtt_decay;/*ParametersforcomputingthecostassociatedtoRTT.*/unsignedintr
tt_min;unsignedintrtt_max;unsignedintmax_rtt_penalty;/*Forfiltertypeslot.*/struc
taccess_list*list[DISTRIBUTE_MAX];/*Access-list.*/structprefix_list*prefix[DISTR
IBUTE_MAX];/*Prefix-list.*/};typedefstructbabel_interfacebabel_interface_nfo;sta
ticinlinebabel_interface_nfo*babel_get_if_nfo(structinterface*ifp){return((babel
_interface_nfo*)ifp->info);}/*babel_interface_nfoflags*/#defineBABEL_IF_IS_UP(1<
<0)#defineBABEL_IF_WIRED(1<<1)#defineBABEL_IF_SPLIT_HORIZON(1<<2)#defineBABEL_IF
_LQ(1<<3)#defineBABEL_IF_FARAWAY(1<<4)#defineBABEL_IF_TIMESTAMPS(1<<5)/*OnlyINTE
RFERINGcanappearonthewire.*/#defineBABEL_IF_CHANNEL_UNKNOWN0#defineBABEL_IF_CHAN
NEL_INTERFERING255#defineBABEL_IF_CHANNEL_NONINTERFERING-2staticinlineintif_up(s
tructinterface*ifp){return(if_is_operative(ifp)&&ifp->connected!=NULL&&(babel_ge
t_if_nfo(ifp)->flags&BABEL_IF_IS_UP));}structbuffered_update{unsignedcharid[8];u
nsignedcharprefix[16];unsignedcharplen;unsignedcharpad[3];};/*initfunction*/void
babel_if_init(void);/*Callbackfunctionsforzebraclient*/intbabel_interface_up(int
,structzclient*,zebra_size_t,vrf_id_t);intbabel_interface_down(int,structzclient
*,zebra_size_t,vrf_id_t);intbabel_interface_add(int,structzclient*,zebra_size_t,
vrf_id_t);intbabel_interface_delete(int,structzclient*,zebra_size_t,vrf_id_t);in
tbabel_interface_address_add(int,structzclient*,zebra_size_t,vrf_id_t);intbabel_
interface_address_delete(int,structzclient*,zebra_size_t,vrf_id_t);unsignedjitte
r(babel_interface_nfo*,int);unsignedupdate_jitter(babel_interface_nfo*babel_ifp,
inturgent);/*return"true"if"address"isoneofouripv6addresses*/intis_interface_ll_
address(structinterface*ifp,constunsignedchar*address);/*Sendretractiontoall,and
resetallinterfacesstatistics.*/voidbabel_interface_close_all(void);externintbabe
l_enable_if_config_write(structvty*);#endif