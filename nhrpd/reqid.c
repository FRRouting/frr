#include"zebra.h"#include"hash.h"#include"nhrpd.h"staticunsignedintnhrp_reqid_ke
y(void*data){structnhrp_reqid*r=data;returnr->request_id;}staticintnhrp_reqid_cm
p(constvoid*data,constvoid*key){conststructnhrp_reqid*a=data,*b=key;returna->req
uest_id==b->request_id;}uint32_tnhrp_reqid_alloc(structnhrp_reqid_pool*p,structn
hrp_reqid*r,void(*cb)(structnhrp_reqid*,void*)){if(!p->reqid_hash){p->reqid_hash
=hash_create(nhrp_reqid_key,nhrp_reqid_cmp,"NHRPreqidHash");p->next_request_id=1
;}if(r->cb!=cb){r->request_id=p->next_request_id;if(++p->next_request_id==0)p->n
ext_request_id=1;r->cb=cb;hash_get(p->reqid_hash,r,hash_alloc_intern);}returnr->
request_id;}voidnhrp_reqid_free(structnhrp_reqid_pool*p,structnhrp_reqid*r){if(r
->cb){hash_release(p->reqid_hash,r);r->cb=NULL;}}structnhrp_reqid*nhrp_reqid_loo
kup(structnhrp_reqid_pool*p,uint32_treqid){structnhrp_reqidkey;if(!p->reqid_hash
)return0;key.request_id=reqid;returnhash_lookup(p->reqid_hash,&key);}