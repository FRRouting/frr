/**PIMforQuagga*Copyright(C)2008EvertondaSilvaMarques**Thisprogramisfreesoftware
;youcanredistributeitand/ormodify*itunderthetermsoftheGNUGeneralPublicLicenseasp
ublishedby*theFreeSoftwareFoundation;eitherversion2oftheLicense,or*(atyouroption
)anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,but*WITHO
UTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTIC
ULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhavereceived
acopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,w
ritetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-130
1USA*/#include<zebra.h>#include"if.h"#include"linklist.h"#include"prefix.h"#incl
ude"vty.h"#include"vrf.h"#include"plist.h"#include"pimd.h"#include"pim_vty.h"#in
clude"pim_iface.h"#include"pim_cmd.h"#include"pim_str.h"#include"pim_ssmpingd.h"
#include"pim_pim.h"#include"pim_oil.h"#include"pim_static.h"#include"pim_rp.h"#i
nclude"pim_msdp.h"#include"pim_ssm.h"#include"pim_bfd.h"intpim_debug_config_writ
e(structvty*vty){intwrites=0;if(PIM_DEBUG_MSDP_EVENTS){vty_out(vty,"debugmsdpeve
nts\n");++writes;}if(PIM_DEBUG_MSDP_PACKETS){vty_out(vty,"debugmsdppackets\n");+
+writes;}if(PIM_DEBUG_MSDP_INTERNAL){vty_out(vty,"debugmsdpinternal\n");++writes
;}if(PIM_DEBUG_IGMP_EVENTS){vty_out(vty,"debugigmpevents\n");++writes;}if(PIM_DE
BUG_IGMP_PACKETS){vty_out(vty,"debugigmppackets\n");++writes;}if(PIM_DEBUG_IGMP_
TRACE){vty_out(vty,"debugigmptrace\n");++writes;}if(PIM_DEBUG_IGMP_TRACE_DETAIL)
{vty_out(vty,"debugigmptracedetail\n");++writes;}if(PIM_DEBUG_MROUTE){vty_out(vt
y,"debugmroute\n");++writes;}if(PIM_DEBUG_MTRACE){vty_out(vty,"debugmtrace\n");+
+writes;}if(PIM_DEBUG_MROUTE_DETAIL){vty_out(vty,"debugmroutedetail\n");++writes
;}if(PIM_DEBUG_PIM_EVENTS){vty_out(vty,"debugpimevents\n");++writes;}if(PIM_DEBU
G_PIM_PACKETS){vty_out(vty,"debugpimpackets\n");++writes;}if(PIM_DEBUG_PIM_PACKE
TDUMP_SEND){vty_out(vty,"debugpimpacket-dumpsend\n");++writes;}if(PIM_DEBUG_PIM_
PACKETDUMP_RECV){vty_out(vty,"debugpimpacket-dumpreceive\n");++writes;}if(PIM_DE
BUG_PIM_TRACE){vty_out(vty,"debugpimtrace\n");++writes;}if(PIM_DEBUG_PIM_TRACE_D
ETAIL){vty_out(vty,"debugpimtracedetail\n");++writes;}if(PIM_DEBUG_ZEBRA){vty_ou
t(vty,"debugpimzebra\n");++writes;}if(PIM_DEBUG_SSMPINGD){vty_out(vty,"debugssmp
ingd\n");++writes;}if(PIM_DEBUG_PIM_HELLO){vty_out(vty,"debugpimpacketshello\n")
;++writes;}if(PIM_DEBUG_PIM_J_P){vty_out(vty,"debugpimpacketsjoins\n");++writes;
}if(PIM_DEBUG_PIM_REG){vty_out(vty,"debugpimpacketsregister\n");++writes;}if(PIM
_DEBUG_STATIC){vty_out(vty,"debugpimstatic\n");++writes;}if(PIM_DEBUG_PIM_NHT){v
ty_out(vty,"debugpimnht\n");++writes;}returnwrites;}intpim_global_config_write_w
orker(structpim_instance*pim,structvty*vty){intwrites=0;structpim_ssm*ssm=pim->s
sm_info;charspaces[10];if(pim->vrf_id==VRF_DEFAULT)sprintf(spaces,"%s","");elses
printf(spaces,"%s","");writes+=pim_msdp_config_write_helper(pim,vty,spaces);if(!
pim->send_v6_secondary){vty_out(vty,"%snoippimsend-v6-secondary\n",spaces);++wri
tes;}writes+=pim_rp_config_write(pim,vty,spaces);if(qpim_register_suppress_time!
=PIM_REGISTER_SUPPRESSION_TIME_DEFAULT){vty_out(vty,"%sippimregister-suppress-ti
me%d\n",spaces,qpim_register_suppress_time);++writes;}if(qpim_t_periodic!=PIM_DE
FAULT_T_PERIODIC){vty_out(vty,"%sippimjoin-prune-interval%d\n",spaces,qpim_t_per
iodic);++writes;}if(pim->keep_alive_time!=PIM_KEEPALIVE_PERIOD){vty_out(vty,"%si
ppimkeep-alive-timer%d\n",spaces,pim->keep_alive_time);++writes;}if(pim->rp_keep
_alive_time!=(unsignedint)PIM_RP_KEEPALIVE_PERIOD){vty_out(vty,"%sippimrpkeep-al
ive-timer%d\n",spaces,pim->rp_keep_alive_time);++writes;}if(qpim_packet_process!
=PIM_DEFAULT_PACKET_PROCESS){vty_out(vty,"%sippimpackets%d\n",spaces,qpim_packet
_process);++writes;}if(ssm->plist_name){vty_out(vty,"%sippimssmprefix-list%s\n",
spaces,ssm->plist_name);++writes;}if(pim->spt.switchover==PIM_SPT_INFINITY){if(p
im->spt.plist)vty_out(vty,"%sippimspt-switchoverinfinity-and-beyondprefix-list%s
\n",spaces,pim->spt.plist);elsevty_out(vty,"%sippimspt-switchoverinfinity-and-be
yond\n",spaces);++writes;}if(qpim_ecmp_rebalance_enable){vty_out(vty,"%sippimecm
prebalance\n",spaces);++writes;}elseif(qpim_ecmp_enable){vty_out(vty,"%sippimecm
p\n",spaces);++writes;}if(pim->ssmpingd_list){structlistnode*node;structssmpingd
_sock*ss;++writes;for(ALL_LIST_ELEMENTS_RO(pim->ssmpingd_list,node,ss)){charsour
ce_str[INET_ADDRSTRLEN];pim_inet4_dump("<src?>",ss->source_addr,source_str,sizeo
f(source_str));vty_out(vty,"%sipssmpingd%s\n",spaces,source_str);++writes;}}retu
rnwrites;}intpim_interface_config_write(structvty*vty){structpim_instance*pim;st
ructinterface*ifp;structvrf*vrf;intwrites=0;RB_FOREACH(vrf,vrf_name_head,&vrfs_b
y_name){pim=vrf->info;if(!pim)continue;FOR_ALL_INTERFACES(pim->vrf,ifp){/*IFname
*/if(vrf->vrf_id==VRF_DEFAULT)vty_frame(vty,"interface%s\n",ifp->name);elsevty_f
rame(vty,"interface%svrf%s\n",ifp->name,vrf->name);++writes;if(ifp->info){struct
pim_interface*pim_ifp=ifp->info;if(PIM_IF_TEST_PIM(pim_ifp->options)){vty_out(vt
y,"ippimsm\n");++writes;}/*IFippimdrpriority*/if(pim_ifp->pim_dr_priority!=PIM_D
EFAULT_DR_PRIORITY){vty_out(vty,"ippimdrpriority%u\n",pim_ifp->pim_dr_priority);
++writes;}/*IFippimhello*/if(pim_ifp->pim_hello_period!=PIM_DEFAULT_HELLO_PERIOD
){vty_out(vty,"ippimhello%d",pim_ifp->pim_hello_period);if(pim_ifp->pim_default_
holdtime!=-1)vty_out(vty,"%d",pim_ifp->pim_default_holdtime);vty_out(vty,"\n");+
+writes;}/*updatesource*/if(PIM_INADDR_ISNOT_ANY(pim_ifp->update_source)){charsr
c_str[INET_ADDRSTRLEN];pim_inet4_dump("<src?>",pim_ifp->update_source,src_str,si
zeof(src_str));vty_out(vty,"ippimuse-source%s\n",src_str);++writes;}/*IFipigmp*/
if(PIM_IF_TEST_IGMP(pim_ifp->options)){vty_out(vty,"ipigmp\n");++writes;}/*ipigm
pversion*/if(pim_ifp->igmp_version!=IGMP_DEFAULT_VERSION){vty_out(vty,"ipigmpver
sion%d\n",pim_ifp->igmp_version);++writes;}/*IFipigmpquery-interval*/if(pim_ifp-
>igmp_default_query_interval!=IGMP_GENERAL_QUERY_INTERVAL){vty_out(vty,"ipigmpqu
ery-interval%d\n",pim_ifp->igmp_default_query_interval);++writes;}/*IFipigmpquer
y-max-response-time*/if(pim_ifp->igmp_query_max_response_time_dsec!=IGMP_QUERY_M
AX_RESPONSE_TIME_DSEC){vty_out(vty,"ipigmpquery-max-response-time%d\n",pim_ifp->
igmp_query_max_response_time_dsec);++writes;}/*IFipigmpjoin*/if(pim_ifp->igmp_jo
in_list){structlistnode*node;structigmp_join*ij;for(ALL_LIST_ELEMENTS_RO(pim_ifp
->igmp_join_list,node,ij)){chargroup_str[INET_ADDRSTRLEN];charsource_str[INET_AD
DRSTRLEN];pim_inet4_dump("<grp?>",ij->group_addr,group_str,sizeof(group_str));in
et_ntop(AF_INET,&ij->source_addr,source_str,sizeof(source_str));vty_out(vty,"ipi
gmpjoin%s%s\n",group_str,source_str);++writes;}}/*boundary*/if(pim_ifp->boundary
_oil_plist){vty_out(vty,"ipmulticastboundaryoil%s\n",pim_ifp->boundary_oil_plist
);++writes;}writes+=pim_static_write_mroute(pim,vty,ifp);pim_bfd_write_config(vt
y,ifp);}vty_endframe(vty,"!\n");++writes;}}returnwrites;}