/**PIMforQuagga*Copyright(C)2015CumulusNetworks,Inc.*DonaldSharp**Thisprogramisf
reesoftware;youcanredistributeitand/ormodify*itunderthetermsoftheGNUGeneralPubli
cLicenseaspublishedby*theFreeSoftwareFoundation;eitherversion2oftheLicense,or*(a
tyouroption)anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeusefu
l,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNES
SFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldh
avereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPY
ING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,
MA02110-1301USA*/#include<zebra.h>#include"memory.h"#include"log.h"#include"if.h
"#include"pimd.h"#include"pim_str.h"#include"pim_br.h"#include"linklist.h"struct
pim_br{structprefix_sgsg;structin_addrpmbr;};structin_addrpim_br_unknown={.s_add
r=0};staticstructlist*pim_br_list=NULL;structin_addrpim_br_get_pmbr(structprefix
_sg*sg){structlistnode*node;structpim_br*pim_br;for(ALL_LIST_ELEMENTS_RO(pim_br_
list,node,pim_br)){if(sg->src.s_addr==pim_br->sg.src.s_addr&&sg->grp.s_addr==pim
_br->sg.grp.s_addr)returnpim_br->pmbr;}returnpim_br_unknown;}voidpim_br_set_pmbr
(structprefix_sg*sg,structin_addrbr){structlistnode*node,*next;structpim_br*pim_
br;for(ALL_LIST_ELEMENTS(pim_br_list,node,next,pim_br)){if(sg->src.s_addr==pim_b
r->sg.src.s_addr&&sg->grp.s_addr==pim_br->sg.grp.s_addr)break;}if(!pim_br){pim_b
r=XCALLOC(MTYPE_PIM_BR,sizeof(*pim_br));if(!pim_br){zlog_err("PIMXCALLOC(%zu)fai
lure",sizeof(*pim_br));return;}pim_br->sg=*sg;listnode_add(pim_br_list,pim_br);}
pim_br->pmbr=br;}/**Removethe(S,G)fromthestoredvalues*/voidpim_br_clear_pmbr(str
uctprefix_sg*sg){structlistnode*node,*next;structpim_br*pim_br;for(ALL_LIST_ELEM
ENTS(pim_br_list,node,next,pim_br)){if(sg->src.s_addr==pim_br->sg.src.s_addr&&sg
->grp.s_addr==pim_br->sg.grp.s_addr)break;}if(!pim_br)return;listnode_delete(pim
_br_list,pim_br);}voidpim_br_init(void){pim_br_list=list_new();if(!pim_br_list){
zlog_err("%s:Failuretocreatepim_br_list",__PRETTY_FUNCTION__);return;}}