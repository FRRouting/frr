/**PIMforQuagga*Copyright(C)2008EvertondaSilvaMarques**Thisprogramisfreesoftware
;youcanredistributeitand/ormodify*itunderthetermsoftheGNUGeneralPublicLicenseasp
ublishedby*theFreeSoftwareFoundation;eitherversion2oftheLicense,or*(atyouroption
)anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,but*WITHO
UTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTIC
ULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhavereceived
acopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,w
ritetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-130
1USA*/#include<zebra.h>#include"log.h"#include"prefix.h"#include"if.h"#include"p
imd.h"#include"pim_str.h"#include"pim_tlv.h"#include"pim_msg.h"#include"pim_pim.
h"#include"pim_int.h"#include"pim_time.h"#include"pim_iface.h"#include"pim_hello
.h"#include"pim_macro.h"#include"pim_assert.h"#include"pim_ifchannel.h"staticint
assert_action_a3(structpim_ifchannel*ch);staticvoidassert_action_a2(structpim_if
channel*ch,structpim_assert_metricwinner_metric);staticvoidassert_action_a6(stru
ctpim_ifchannel*ch,structpim_assert_metricwinner_metric);voidpim_ifassert_winner
_set(structpim_ifchannel*ch,enumpim_ifassert_statenew_state,structin_addrwinner,
structpim_assert_metricwinner_metric){structpim_interface*pim_ifp=ch->interface-
>info;intwinner_changed=(ch->ifassert_winner.s_addr!=winner.s_addr);intmetric_ch
anged=!pim_assert_metric_match(&ch->ifassert_winner_metric,&winner_metric);if(PI
M_DEBUG_PIM_EVENTS){if(ch->ifassert_state!=new_state){zlog_debug("%s:(S,G)=%sass
ertstatechangedfrom%sto%soninterface%s",__PRETTY_FUNCTION__,ch->sg_str,pim_ifcha
nnel_ifassert_name(ch->ifassert_state),pim_ifchannel_ifassert_name(new_state),ch
->interface->name);}if(winner_changed){charwas_str[INET_ADDRSTRLEN];charwinner_s
tr[INET_ADDRSTRLEN];pim_inet4_dump("<was?>",ch->ifassert_winner,was_str,sizeof(w
as_str));pim_inet4_dump("<winner?>",winner,winner_str,sizeof(winner_str));zlog_d
ebug("%s:(S,G)=%sassertwinnerchangedfrom%sto%soninterface%s",__PRETTY_FUNCTION__
,ch->sg_str,was_str,winner_str,ch->interface->name);}}/*PIM_DEBUG_PIM_EVENTS*/ch
->ifassert_state=new_state;ch->ifassert_winner=winner;ch->ifassert_winner_metric
=winner_metric;ch->ifassert_creation=pim_time_monotonic_sec();if(winner_changed|
|metric_changed){pim_upstream_update_join_desired(pim_ifp->pim,ch->upstream);pim
_ifchannel_update_could_assert(ch);pim_ifchannel_update_assert_tracking_desired(
ch);}}staticvoidon_trace(constchar*label,structinterface*ifp,structin_addrsrc){i
f(PIM_DEBUG_PIM_TRACE){charsrc_str[INET_ADDRSTRLEN];pim_inet4_dump("<src?>",src,
src_str,sizeof(src_str));zlog_debug("%s:from%son%s",label,src_str,ifp->name);}}s
taticintpreferred_assert(conststructpim_ifchannel*ch,conststructpim_assert_metri
c*recv_metric){returnpim_assert_metric_better(recv_metric,&ch->ifassert_winner_m
etric);}staticintacceptable_assert(conststructpim_assert_metric*my_metric,consts
tructpim_assert_metric*recv_metric){returnpim_assert_metric_better(recv_metric,m
y_metric);}staticintinferior_assert(conststructpim_assert_metric*my_metric,const
structpim_assert_metric*recv_metric){returnpim_assert_metric_better(my_metric,re
cv_metric);}staticintcancel_assert(conststructpim_assert_metric*recv_metric){ret
urn(recv_metric->metric_preference==PIM_ASSERT_METRIC_PREFERENCE_MAX)&&(recv_met
ric->route_metric==PIM_ASSERT_ROUTE_METRIC_MAX);}staticvoidif_could_assert_do_a1
(constchar*caller,structpim_ifchannel*ch){if(PIM_IF_FLAG_TEST_COULD_ASSERT(ch->f
lags)){if(assert_action_a1(ch)){zlog_warn("%s:%s:(S,G)=%sassert_action_a1failure
oninterface%s",__PRETTY_FUNCTION__,caller,ch->sg_str,ch->interface->name);/*logw
arningonly*/}}}staticintdispatch_assert(structinterface*ifp,structin_addrsource_
addr,structin_addrgroup_addr,structpim_assert_metricrecv_metric){structpim_ifcha
nnel*ch;structprefix_sgsg;memset(&sg,0,sizeof(structprefix_sg));sg.src=source_ad
dr;sg.grp=group_addr;ch=pim_ifchannel_add(ifp,&sg,0,0);if(!ch){zlog_warn("%s:(S,
G)=%sfailurecreatingchanneloninterface%s",__PRETTY_FUNCTION__,pim_str_sg_dump(&s
g),ifp->name);return-1;}switch(ch->ifassert_state){casePIM_IFASSERT_NOINFO:if(re
cv_metric.rpt_bit_flag){/*RPTbitset*/if_could_assert_do_a1(__PRETTY_FUNCTION__,c
h);}else{/*RPTbitclear*/if(inferior_assert(&ch->ifassert_my_metric,&recv_metric)
){if_could_assert_do_a1(__PRETTY_FUNCTION__,ch);}elseif(acceptable_assert(&ch->i
fassert_my_metric,&recv_metric)){if(PIM_IF_FLAG_TEST_ASSERT_TRACKING_DESIRED(ch-
>flags)){assert_action_a6(ch,recv_metric);}}}break;casePIM_IFASSERT_I_AM_WINNER:
if(preferred_assert(ch,&recv_metric)){assert_action_a2(ch,recv_metric);}else{if(
inferior_assert(&ch->ifassert_my_metric,&recv_metric)){assert_action_a3(ch);}}br
eak;casePIM_IFASSERT_I_AM_LOSER:if(recv_metric.ip_address.s_addr==ch->ifassert_w
inner.s_addr){/*Assertfromcurrentwinner*/if(cancel_assert(&recv_metric)){assert_
action_a5(ch);}else{if(inferior_assert(&ch->ifassert_my_metric,&recv_metric)){as
sert_action_a5(ch);}elseif(acceptable_assert(&ch->ifassert_my_metric,&recv_metri
c)){if(!recv_metric.rpt_bit_flag){assert_action_a2(ch,recv_metric);}}}}elseif(pr
eferred_assert(ch,&recv_metric)){assert_action_a2(ch,recv_metric);}break;default
:{zlog_warn("%s:(S,G)=%sinvalidassertstate%doninterface%s",__PRETTY_FUNCTION__,c
h->sg_str,ch->ifassert_state,ifp->name);}return-2;}return0;}intpim_assert_recv(s
tructinterface*ifp,structpim_neighbor*neigh,structin_addrsrc_addr,uint8_t*buf,in
tbuf_size){structprefix_sgsg;structprefixmsg_source_addr;structpim_assert_metric
msg_metric;intoffset;uint8_t*curr;intcurr_size;structpim_interface*pim_ifp=NULL;
on_trace(__PRETTY_FUNCTION__,ifp,src_addr);curr=buf;curr_size=buf_size;/*Parseas
sertgroupaddr*/memset(&sg,0,sizeof(structprefix_sg));offset=pim_parse_addr_group
(&sg,curr,curr_size);if(offset<1){charsrc_str[INET_ADDRSTRLEN];pim_inet4_dump("<
src?>",src_addr,src_str,sizeof(src_str));zlog_warn("%s:pim_parse_addr_group()fai
lure:from%son%s",__PRETTY_FUNCTION__,src_str,ifp->name);return-1;}curr+=offset;c
urr_size-=offset;/*Parseassertsourceaddr*/offset=pim_parse_addr_ucast(&msg_sourc
e_addr,curr,curr_size);if(offset<1){charsrc_str[INET_ADDRSTRLEN];pim_inet4_dump(
"<src?>",src_addr,src_str,sizeof(src_str));zlog_warn("%s:pim_parse_addr_ucast()f
ailure:from%son%s",__PRETTY_FUNCTION__,src_str,ifp->name);return-2;}curr+=offset
;curr_size-=offset;if(curr_size!=8){charsrc_str[INET_ADDRSTRLEN];pim_inet4_dump(
"<src?>",src_addr,src_str,sizeof(src_str));zlog_warn("%s:preference/metricsizeis
not8:size=%dfrom%soninterface%s",__PRETTY_FUNCTION__,curr_size,src_str,ifp->name
);return-3;}/*Parseassertmetricpreference*/msg_metric.metric_preference=pim_read
_uint32_host(curr);msg_metric.rpt_bit_flag=msg_metric.metric_preference&0x800000
00;/*savehighestbit*/msg_metric.metric_preference&=~0x80000000;/*clearhighestbit
*/curr+=4;/*Parseassertroutemetric*/msg_metric.route_metric=pim_read_uint32_host
(curr);if(PIM_DEBUG_PIM_TRACE){charneigh_str[INET_ADDRSTRLEN];charsource_str[INE
T_ADDRSTRLEN];chargroup_str[INET_ADDRSTRLEN];pim_inet4_dump("<neigh?>",src_addr,
neigh_str,sizeof(neigh_str));pim_inet4_dump("<src?>",msg_source_addr.u.prefix4,s
ource_str,sizeof(source_str));pim_inet4_dump("<grp?>",sg.grp,group_str,sizeof(gr
oup_str));zlog_debug("%s:from%son%s:(S,G)=(%s,%s)pref=%umetric=%urpt_bit=%u",__P
RETTY_FUNCTION__,neigh_str,ifp->name,source_str,group_str,msg_metric.metric_pref
erence,msg_metric.route_metric,PIM_FORCE_BOOLEAN(msg_metric.rpt_bit_flag));}msg_
metric.ip_address=src_addr;pim_ifp=ifp->info;zassert(pim_ifp);++pim_ifp->pim_ifs
tat_assert_recv;returndispatch_assert(ifp,msg_source_addr.u.prefix4,sg.grp,msg_m
etric);}/*RFC4601:4.6.3.AssertMetricsAssertmetricsaredefinedas:Whencomparingasse
rt_metrics,therpt_bit_flag,metric_preference,androute_metricfieldarecomparedinor
der,wherethefirstlowervaluewins.Ifallfieldsareequal,theprimaryIPaddressoftherout
erthatsourcedtheAssertmessageisusedasatie-breaker,withthehighestIPaddresswinning
.*/intpim_assert_metric_better(conststructpim_assert_metric*m1,conststructpim_as
sert_metric*m2){if(m1->rpt_bit_flag<m2->rpt_bit_flag)return1;if(m1->rpt_bit_flag
>m2->rpt_bit_flag)return0;if(m1->metric_preference<m2->metric_preference)return1
;if(m1->metric_preference>m2->metric_preference)return0;if(m1->route_metric<m2->
route_metric)return1;if(m1->route_metric>m2->route_metric)return0;returnntohl(m1
->ip_address.s_addr)>ntohl(m2->ip_address.s_addr);}intpim_assert_metric_match(co
nststructpim_assert_metric*m1,conststructpim_assert_metric*m2){if(m1->rpt_bit_fl
ag!=m2->rpt_bit_flag)return0;if(m1->metric_preference!=m2->metric_preference)ret
urn0;if(m1->route_metric!=m2->route_metric)return0;returnm1->ip_address.s_addr==
m2->ip_address.s_addr;}intpim_assert_build_msg(uint8_t*pim_msg,intbuf_size,struc
tinterface*ifp,structin_addrgroup_addr,structin_addrsource_addr,uint32_tmetric_p
reference,uint32_troute_metric,uint32_trpt_bit_flag){uint8_t*buf_pastend=pim_msg
+buf_size;uint8_t*pim_msg_curr;intpim_msg_size;intremain;pim_msg_curr=pim_msg+PI
M_MSG_HEADER_LEN;/*skiproomforpimheader*//*Encodegroup*/remain=buf_pastend-pim_m
sg_curr;pim_msg_curr=pim_msg_addr_encode_ipv4_group(pim_msg_curr,group_addr);if(
!pim_msg_curr){chargroup_str[INET_ADDRSTRLEN];pim_inet4_dump("<grp?>",group_addr
,group_str,sizeof(group_str));zlog_warn("%s:failureencodinggroupaddress%s:spacel
eft=%d",__PRETTY_FUNCTION__,group_str,remain);return-1;}/*Encodesource*/remain=b
uf_pastend-pim_msg_curr;pim_msg_curr=pim_msg_addr_encode_ipv4_ucast(pim_msg_curr
,source_addr);if(!pim_msg_curr){charsource_str[INET_ADDRSTRLEN];pim_inet4_dump("
<src?>",source_addr,source_str,sizeof(source_str));zlog_warn("%s:failureencoding
sourceaddress%s:spaceleft=%d",__PRETTY_FUNCTION__,source_str,remain);return-2;}/
*Metricpreference*/pim_write_uint32(pim_msg_curr,rpt_bit_flag?metric_preference|
0x80000000:metric_preference);pim_msg_curr+=4;/*Routemetric*/pim_write_uint32(pi
m_msg_curr,route_metric);pim_msg_curr+=4;/*AddPIMheader*/pim_msg_size=pim_msg_cu
rr-pim_msg;pim_msg_build_header(pim_msg,pim_msg_size,PIM_MSG_TYPE_ASSERT);return
pim_msg_size;}staticintpim_assert_do(structpim_ifchannel*ch,structpim_assert_met
ricmetric){structinterface*ifp;structpim_interface*pim_ifp;uint8_tpim_msg[1000];
intpim_msg_size;ifp=ch->interface;if(!ifp){if(PIM_DEBUG_PIM_TRACE)zlog_debug("%s
:channel%shasnoassociatedinterface!",__PRETTY_FUNCTION__,ch->sg_str);return-1;}p
im_ifp=ifp->info;if(!pim_ifp){if(PIM_DEBUG_PIM_TRACE)zlog_debug("%s:channel%spim
notenabledoninterface:%s",__PRETTY_FUNCTION__,ch->sg_str,ifp->name);return-1;}pi
m_msg_size=pim_assert_build_msg(pim_msg,sizeof(pim_msg),ifp,ch->sg.grp,ch->sg.sr
c,metric.metric_preference,metric.route_metric,metric.rpt_bit_flag);if(pim_msg_s
ize<1){zlog_warn("%s:failurebuildingPIMassertmessage:msg_size=%d",__PRETTY_FUNCT
ION__,pim_msg_size);return-2;}/*RFC4601:4.3.1.SendingHelloMessagesThus,ifarouter
needstosendaJoin/PruneorAssertmessageonaninterfaceonwhichithasnotyetsentaHellome
ssagewiththecurrentlyconfiguredIPaddress,thenitMUSTimmediatelysendtherelevantHel
lomessagewithoutwaitingfortheHelloTimertoexpire,followedbytheJoin/PruneorAssertm
essage.*/pim_hello_require(ifp);if(PIM_DEBUG_PIM_TRACE){zlog_debug("%s:to%s:(S,G
)=%spref=%umetric=%urpt_bit=%u",__PRETTY_FUNCTION__,ifp->name,ch->sg_str,metric.
metric_preference,metric.route_metric,PIM_FORCE_BOOLEAN(metric.rpt_bit_flag));}+
+pim_ifp->pim_ifstat_assert_send;if(pim_msg_send(pim_ifp->pim_sock_fd,pim_ifp->p
rimary_address,qpim_all_pim_routers_addr,pim_msg,pim_msg_size,ifp->name)){zlog_w
arn("%s:couldnotsendPIMmessageoninterface%s",__PRETTY_FUNCTION__,ifp->name);retu
rn-3;}return0;}intpim_assert_send(structpim_ifchannel*ch){returnpim_assert_do(ch
,ch->ifassert_my_metric);}/*RFC4601:4.6.4.AssertCancelMessagesAnAssertCancel(S,G
)isaninfinitemetricassertwiththeRPTbitsetthatnamesSasthesource.*/staticintpim_as
sert_cancel(structpim_ifchannel*ch){structpim_assert_metricmetric;metric.rpt_bit
_flag=0;metric.metric_preference=PIM_ASSERT_METRIC_PREFERENCE_MAX;metric.route_m
etric=PIM_ASSERT_ROUTE_METRIC_MAX;metric.ip_address=ch->sg.src;returnpim_assert_
do(ch,metric);}staticinton_assert_timer(structthread*t){structpim_ifchannel*ch;s
tructinterface*ifp;ch=THREAD_ARG(t);ifp=ch->interface;if(PIM_DEBUG_PIM_TRACE){zl
og_debug("%s:(S,G)=%stimerexpiredoninterface%s",__PRETTY_FUNCTION__,ch->sg_str,i
fp->name);}ch->t_ifassert_timer=NULL;switch(ch->ifassert_state){casePIM_IFASSERT
_I_AM_WINNER:assert_action_a3(ch);break;casePIM_IFASSERT_I_AM_LOSER:assert_actio
n_a5(ch);break;default:{if(PIM_DEBUG_PIM_EVENTS)zlog_warn("%s:(S,G)=%sinvalidass
ertstate%doninterface%s",__PRETTY_FUNCTION__,ch->sg_str,ch->ifassert_state,ifp->
name);}}return0;}staticvoidassert_timer_off(structpim_ifchannel*ch){if(PIM_DEBUG
_PIM_TRACE){if(ch->t_ifassert_timer){zlog_debug("%s:(S,G)=%scancellingtimeronint
erface%s",__PRETTY_FUNCTION__,ch->sg_str,ch->interface->name);}}THREAD_OFF(ch->t
_ifassert_timer);}staticvoidpim_assert_timer_set(structpim_ifchannel*ch,intinter
val){assert_timer_off(ch);if(PIM_DEBUG_PIM_TRACE){zlog_debug("%s:(S,G)=%sstartin
g%usectimeroninterface%s",__PRETTY_FUNCTION__,ch->sg_str,interval,ch->interface-
>name);}thread_add_timer(master,on_assert_timer,ch,interval,&ch->t_ifassert_time
r);}staticvoidpim_assert_timer_reset(structpim_ifchannel*ch){pim_assert_timer_se
t(ch,PIM_ASSERT_TIME-PIM_ASSERT_OVERRIDE_INTERVAL);}/*RFC4601:4.6.1.(S,G)AssertM
essageStateMachine(S,G)AssertStatemachineActionsA1:SendAssert(S,G).SetAssertTime
rto(Assert_Time-Assert_Override_Interval).StoreselfasAssertWinner(S,G,I).Storesp
t_assert_metric(S,I)asAssertWinnerMetric(S,G,I).*/intassert_action_a1(structpim_
ifchannel*ch){structinterface*ifp=ch->interface;structpim_interface*pim_ifp;pim_
ifp=ifp->info;if(!pim_ifp){zlog_warn("%s:(S,G)=%smulticastnotenabledoninterface%
s",__PRETTY_FUNCTION__,ch->sg_str,ifp->name);return-1;/*mustreturnsincepim_ifpis
usedbelow*/}/*SwitchtoI_AM_WINNERbeforeperformingaction_a3below*/pim_ifassert_wi
nner_set(ch,PIM_IFASSERT_I_AM_WINNER,pim_ifp->primary_address,pim_macro_spt_asse
rt_metric(&ch->upstream->rpf,pim_ifp->primary_address));if(assert_action_a3(ch))
{zlog_warn("%s:(S,G)=%sassert_action_a3failureoninterface%s",__PRETTY_FUNCTION__
,ch->sg_str,ifp->name);/*warningonly*/}if(ch->ifassert_state!=PIM_IFASSERT_I_AM_
WINNER){if(PIM_DEBUG_PIM_EVENTS)zlog_warn("%s:channel%snotinexpectedPIM_IFASSERT
_I_AM_WINNERstate",__PRETTY_FUNCTION__,ch->sg_str);}return0;}/*RFC4601:4.6.1.(S,
G)AssertMessageStateMachine(S,G)AssertStatemachineActionsA2:Storenewassertwinner
asAssertWinner(S,G,I)andassertwinnermetricasAssertWinnerMetric(S,G,I).SetAssertT
imertoAssert_Time.*/staticvoidassert_action_a2(structpim_ifchannel*ch,structpim_
assert_metricwinner_metric){pim_ifassert_winner_set(ch,PIM_IFASSERT_I_AM_LOSER,w
inner_metric.ip_address,winner_metric);pim_assert_timer_set(ch,PIM_ASSERT_TIME);
if(ch->ifassert_state!=PIM_IFASSERT_I_AM_LOSER){if(PIM_DEBUG_PIM_EVENTS)zlog_war
n("%s:channel%snotinexpectedPIM_IFASSERT_I_AM_LOSERstate",__PRETTY_FUNCTION__,ch
->sg_str);}}/*RFC4601:4.6.1.(S,G)AssertMessageStateMachine(S,G)AssertStatemachin
eActionsA3:SendAssert(S,G).SetAssertTimerto(Assert_Time-Assert_Override_Interval
).*/staticintassert_action_a3(structpim_ifchannel*ch){if(ch->ifassert_state!=PIM
_IFASSERT_I_AM_WINNER){if(PIM_DEBUG_PIM_EVENTS)zlog_warn("%s:channel%sexpectedto
beinPIM_IFASSERT_I_AM_WINNERstate",__PRETTY_FUNCTION__,ch->sg_str);return-1;}pim
_assert_timer_reset(ch);if(pim_assert_send(ch)){zlog_warn("%s:(S,G)=%sfailuresen
dingassertoninterface%s",__PRETTY_FUNCTION__,ch->sg_str,ch->interface->name);ret
urn-1;}return0;}/*RFC4601:4.6.1.(S,G)AssertMessageStateMachine(S,G)AssertStatema
chineActionsA4:SendAssertCancel(S,G).Deleteassertinfo(AssertWinner(S,G,I)andAsse
rtWinnerMetric(S,G,I)willthenreturntheirdefaultvalues).*/voidassert_action_a4(st
ructpim_ifchannel*ch){if(pim_assert_cancel(ch)){zlog_warn("%s:failuresendingAsse
rtCancel%soninterface%s",__PRETTY_FUNCTION__,ch->sg_str,ch->interface->name);/*l
ogwarningonly*/}assert_action_a5(ch);if(ch->ifassert_state!=PIM_IFASSERT_NOINFO)
{if(PIM_DEBUG_PIM_EVENTS)zlog_warn("%s:channel%snotinPIM_IFASSERT_NOINFOstatease
xpected",__PRETTY_FUNCTION__,ch->sg_str);}}/*RFC4601:4.6.1.(S,G)AssertMessageSta
teMachine(S,G)AssertStatemachineActionsA5:Deleteassertinfo(AssertWinner(S,G,I)an
dAssertWinnerMetric(S,G,I)willthenreturntheirdefaultvalues).*/voidassert_action_
a5(structpim_ifchannel*ch){reset_ifassert_state(ch);if(ch->ifassert_state!=PIM_I
FASSERT_NOINFO){if(PIM_DEBUG_PIM_EVENTS)zlog_warn("%s:channel%snotinPIM_IFSSERT_
NOINFOstateasexpected",__PRETTY_FUNCTION__,ch->sg_str);}}/*RFC4601:4.6.1.(S,G)As
sertMessageStateMachine(S,G)AssertStatemachineActionsA6:StorenewassertwinnerasAs
sertWinner(S,G,I)andassertwinnermetricasAssertWinnerMetric(S,G,I).SetAssertTimer
toAssert_Time.If(IisRPF_interface(S))AND(UpstreamJPState(S,G)==true)setSPTbit(S,
G)toTRUE.*/staticvoidassert_action_a6(structpim_ifchannel*ch,structpim_assert_me
tricwinner_metric){assert_action_a2(ch,winner_metric);/*If(IisRPF_interface(S))A
ND(UpstreamJPState(S,G)==true)setSPTbit(S,G)toTRUE.*/if(ch->upstream->rpf.source
_nexthop.interface==ch->interface)if(ch->upstream->join_state==PIM_UPSTREAM_JOIN
ED)ch->upstream->sptbit=PIM_UPSTREAM_SPTBIT_TRUE;if(ch->ifassert_state!=PIM_IFAS
SERT_I_AM_LOSER){if(PIM_DEBUG_PIM_EVENTS)zlog_warn("%s:channel%snotinPIM_IFASSER
T_I_AM_LOSERstateasexpected",__PRETTY_FUNCTION__,ch->sg_str);}}