/**PIMforQuagga*Copyright(C)2008EvertondaSilvaMarques**Thisprogramisfreesoftware
;youcanredistributeitand/ormodify*itunderthetermsoftheGNUGeneralPublicLicenseasp
ublishedby*theFreeSoftwareFoundation;eitherversion2oftheLicense,or*(atyouroption
)anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,but*WITHO
UTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTIC
ULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhavereceived
acopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,w
ritetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-130
1USA*/#ifndefPIM_MROUTE_H#definePIM_MROUTE_H/*Formsghdr.msg_controlinSolaris10*/
#ifndef_XPG4_2#define_XPG4_2#endif#ifndef__EXTENSIONS__#define__EXTENSIONS__#end
if#include<netinet/in.h>#ifdefHAVE_NETINET_IP_MROUTE_H#include<netinet/ip_mroute
.h>#endif#definePIM_MROUTE_MIN_TTL(1)#ifdefined(HAVE_LINUX_MROUTE_H)#include<lin
ux/mroute.h>#else/*Below:from<linux/mroute.h>*/#ifndefMAXVIFS#defineMAXVIFS(256)
#endif#ifndefSIOCGETVIFCNT#defineSIOCGETVIFCNTSIOCPROTOPRIVATE/*IPprotocolprivat
es*/#defineSIOCGETSGCNT(SIOCPROTOPRIVATE+1)#defineSIOCGETRPF(SIOCPROTOPRIVATE+2)
#endif#ifndefMRT_INIT#defineMRT_BASE200#defineMRT_INIT(MRT_BASE)/*Activatetheker
nelmroutecode*/#defineMRT_DONE(MRT_BASE+1)/*Shutdownthekernelmroute*/#defineMRT_
ADD_VIF(MRT_BASE+2)/*Addavirtualinterface*/#defineMRT_DEL_VIF(MRT_BASE+3)/*Delet
eavirtualinterface*/#defineMRT_ADD_MFC(MRT_BASE+4)/*Addamulticastforwardingentry
*/#defineMRT_DEL_MFC(MRT_BASE+5)/*Deleteamulticastforwardingentry*/#defineMRT_VE
RSION(MRT_BASE+6)/*Getthekernelmulticastversion*/#defineMRT_ASSERT(MRT_BASE+7)/*
ActivatePIMassertmode*/#defineMRT_PIM(MRT_BASE+8)/*enablePIMcode*/#endif#ifndefM
RT_TABLE#defineMRT_TABLE(209)/*SpecifymroutetableID*/#endif#ifndefHAVE_VIFI_Ttyp
edefunsignedshortvifi_t;#endif#ifndefHAVE_STRUCT_VIFCTLstructvifctl{vifi_tvifc_v
ifi;/*IndexofVIF*/unsignedcharvifc_flags;/*VIFF_flags*/unsignedcharvifc_threshol
d;/*ttllimit*/unsignedintvifc_rate_limit;/*Ratelimitervalues(NI)*/structin_addrv
ifc_lcl_addr;/*Ouraddress*/structin_addrvifc_rmt_addr;/*IPIPtunneladdr*/};#endif
#ifndefHAVE_STRUCT_MFCCTLstructmfcctl{structin_addrmfcc_origin;/*Originofmcast*/
structin_addrmfcc_mcastgrp;/*Groupinquestion*/vifi_tmfcc_parent;/*Whereitarrived
*/unsignedcharmfcc_ttls[MAXVIFS];/*Whereitisgoing*/unsignedintmfcc_pkt_cnt;/*pkt
countforsrc-grp*/unsignedintmfcc_byte_cnt;unsignedintmfcc_wrong_if;intmfcc_expir
e;};#endif/**Groupcountretrievalformrouted*//*structsioc_sg_reqsgreq;memset(&sgr
eq,0,sizeof(sgreq));memcpy(&sgreq.src,&source_addr,sizeof(sgreq.src));memcpy(&sg
req.grp,&group_addr,sizeof(sgreq.grp));ioctl(mrouter_s4,SIOCGETSGCNT,&sgreq);*/#
ifndefHAVE_STRUCT_SIOC_SG_REQstructsioc_sg_req{structin_addrsrc;structin_addrgrp
;unsignedlongpktcnt;unsignedlongbytecnt;unsignedlongwrong_if;};#endif/**Togetvif
packetcounts*//*structsioc_vif_reqvreq;memset(&vreq,0,sizeof(vreq));vreq.vifi=vi
f_index;ioctl(mrouter_s4,SIOCGETVIFCNT,&vreq);*/#ifndefHAVE_STRUCT_SIOC_VIF_REQs
tructsioc_vif_req{vifi_tvifi;/*Whichiface*/unsignedlongicount;/*Inpackets*/unsig
nedlongocount;/*Outpackets*/unsignedlongibytes;/*Inbytes*/unsignedlongobytes;/*O
utbytes*/};#endif/**Pseudomessagesusedbymrouted*/#ifndefIGMPMSG_NOCACHE#defineIG
MPMSG_NOCACHE1/*Kerncachefillrequesttomrouted*/#defineIGMPMSG_WRONGVIF2/*ForPIMa
ssertprocessing(unused)*/#defineIGMPMSG_WHOLEPKT3/*ForPIMRegisterprocessing*/#en
dif#ifndefHAVE_STRUCT_IGMPMSGstructigmpmsg{uint32_tunused1,unused2;unsignedchari
m_msgtype;/*Whatisthis*/unsignedcharim_mbz;/*Mustbezero*/unsignedcharim_vif;/*In
terface(thisoughttobeavifi_t!)*/unsignedcharunused3;structin_addrim_src,im_dst;}
;#endif#endif#ifndefIGMPMSG_WRVIFWHOLE#defineIGMPMSG_WRVIFWHOLE4/*ForPIMprocessi
ng*/#endif/*Above:from<linux/mroute.h>*/intpim_mroute_socket_enable(structpim_in
stance*pim);intpim_mroute_socket_disable(structpim_instance*pim);intpim_mroute_a
dd_vif(structinterface*ifp,structin_addrifaddr,unsignedcharflags);intpim_mroute_
del_vif(structinterface*ifp);intpim_mroute_add(structchannel_oil*c_oil,constchar
*name);intpim_mroute_del(structchannel_oil*c_oil,constchar*name);voidpim_mroute_
update_counters(structchannel_oil*c_oil);#endif/*PIM_MROUTE_H*/