/**PIMforQuagga*Copyright(C)2008EvertondaSilvaMarques**Thisprogramisfreesoftware
;youcanredistributeitand/ormodify*itunderthetermsoftheGNUGeneralPublicLicenseasp
ublishedby*theFreeSoftwareFoundation;eitherversion2oftheLicense,or*(atyouroption
)anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,but*WITHO
UTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTIC
ULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhavereceived
acopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,w
ritetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-130
1USA*/#ifndefPIM_IFACE_H#definePIM_IFACE_H#include<zebra.h>#include"if.h"#includ
e"vty.h"#include"vrf.h"#include"zclient.h"#include"ferr.h"#include"pim_igmp.h"#i
nclude"pim_upstream.h"#include"bfd.h"#definePIM_IF_MASK_PIM(1<<0)#definePIM_IF_M
ASK_IGMP(1<<1)#definePIM_IF_MASK_IGMP_LISTEN_ALLROUTERS(1<<2)#definePIM_IF_MASK_
PIM_CAN_DISABLE_JOIN_SUPRESSION(1<<3)#definePIM_IF_IS_DELETED(ifp)((ifp)->ifinde
x==IFINDEX_INTERNAL)#definePIM_IF_TEST_PIM(options)(PIM_IF_MASK_PIM&(options))#d
efinePIM_IF_TEST_IGMP(options)(PIM_IF_MASK_IGMP&(options))#definePIM_IF_TEST_IGM
P_LISTEN_ALLROUTERS(options)(PIM_IF_MASK_IGMP_LISTEN_ALLROUTERS&(options))#defin
ePIM_IF_TEST_PIM_CAN_DISABLE_JOIN_SUPRESSION(options)(PIM_IF_MASK_PIM_CAN_DISABL
E_JOIN_SUPRESSION&(options))#definePIM_IF_DO_PIM(options)((options)|=PIM_IF_MASK
_PIM)#definePIM_IF_DO_IGMP(options)((options)|=PIM_IF_MASK_IGMP)#definePIM_IF_DO
_IGMP_LISTEN_ALLROUTERS(options)((options)|=PIM_IF_MASK_IGMP_LISTEN_ALLROUTERS)#
definePIM_IF_DO_PIM_CAN_DISABLE_JOIN_SUPRESSION(options)((options)|=PIM_IF_MASK_
PIM_CAN_DISABLE_JOIN_SUPRESSION)#definePIM_IF_DONT_PIM(options)((options)&=~PIM_
IF_MASK_PIM)#definePIM_IF_DONT_IGMP(options)((options)&=~PIM_IF_MASK_IGMP)#defin
ePIM_IF_DONT_IGMP_LISTEN_ALLROUTERS(options)((options)&=~PIM_IF_MASK_IGMP_LISTEN
_ALLROUTERS)#definePIM_IF_DONT_PIM_CAN_DISABLE_JOIN_SUPRESSION(options)((options
)&=~PIM_IF_MASK_PIM_CAN_DISABLE_JOIN_SUPRESSION)#definePIM_I_am_DR(pim_ifp)(pim_
ifp)->pim_dr_addr.s_addr==(pim_ifp)->primary_address.s_addrstructpim_iface_upstr
eam_switch{structin_addraddress;structlist*us;};enumpim_secondary_addr_flags{PIM
_SEC_ADDRF_NONE=0,PIM_SEC_ADDRF_STALE=(1<<0)};structpim_secondary_addr{structpre
fixaddr;enumpim_secondary_addr_flagsflags;};structpim_interface{uint32_toptions;
/*bitvector*/ifindex_tmroute_vif_index;structpim_instance*pim;structin_addrprima
ry_address;/*rememberaddrtodetectchange*/structlist*sec_addr_list;/*listofstruct
pim_secondary_addr*/structin_addrupdate_source;/*usercanstaticallysettheprimary*
addressoftheinterface*/intigmp_version;/*IGMPversion*/intigmp_default_robustness
_variable;/*IGMPv3QRV*/intigmp_default_query_interval;/*IGMPv3secsbetweengeneral
queries*/intigmp_query_max_response_time_dsec;/*IGMPv3MaxResponseTimeindsecsforg
eneralqueries*/intigmp_specific_query_max_response_time_dsec;/*IGMPv3MaxResponse
Timeindsecsforspecificqueries*/structlist*igmp_socket_list;/*listofstructigmp_so
ck*/structlist*igmp_join_list;/*listofstructigmp_join*/intpim_sock_fd;/*PIMsocke
tfiledescriptor*/structthread*t_pim_sock_read;/*threadforreadingPIMsocket*/int64
_tpim_sock_creation;/*timestampofPIMsocketcreation*/structthread*t_pim_hello_tim
er;intpim_hello_period;intpim_default_holdtime;intpim_triggered_hello_delay;uint
32_tpim_generation_id;uint16_tpim_propagation_delay_msec;/*config*/uint16_tpim_o
verride_interval_msec;/*config*/structlist*pim_neighbor_list;/*listofstructpim_n
eighbor*/structlist*upstream_switch_list;structpim_ifchannel_rbifchannel_rb;/*ne
ighborswithoutlan_delay*/intpim_number_of_nonlandelay_neighbors;uint16_tpim_neig
hbors_highest_propagation_delay_msec;uint16_tpim_neighbors_highest_override_inte
rval_msec;/*DRElection*/int64_tpim_dr_election_last;/*timestamp*/intpim_dr_elect
ion_count;intpim_dr_election_changes;structin_addrpim_dr_addr;uint32_tpim_dr_pri
ority;/*config*/intpim_dr_num_nondrpri_neighbors;/*neighborswithoutdr_pri*//*bou
ndaryprefix-list*/char*boundary_oil_plist;int64_tpim_ifstat_start;/*starttimesta
mpforstats*/uint32_tpim_ifstat_hello_sent;uint32_tpim_ifstat_hello_sendfail;uint
32_tpim_ifstat_hello_recv;uint32_tpim_ifstat_hello_recvfail;uint32_tpim_ifstat_j
oin_recv;uint32_tpim_ifstat_join_send;uint32_tpim_ifstat_prune_recv;uint32_tpim_
ifstat_prune_send;uint32_tpim_ifstat_reg_recv;uint32_tpim_ifstat_reg_send;uint32
_tpim_ifstat_reg_stop_recv;uint32_tpim_ifstat_reg_stop_send;uint32_tpim_ifstat_a
ssert_recv;uint32_tpim_ifstat_assert_send;structbfd_info*bfd_info;};/*ifdefault_
holdtimeisset(>=0),useit;otherwisedefault_holdtimeis3.5*hello_period*/#definePIM
_IF_DEFAULT_HOLDTIME(pim_ifp)\(((pim_ifp)->pim_default_holdtime<0)\?((pim_ifp)->
pim_hello_period*7/2)\:((pim_ifp)->pim_default_holdtime))voidpim_if_init(structp
im_instance*pim);voidpim_if_terminate(structpim_instance*pim);structpim_interfac
e*pim_if_new(structinterface*ifp,intigmp,intpim);voidpim_if_delete(structinterfa
ce*ifp);voidpim_if_addr_add(structconnected*ifc);voidpim_if_addr_del(structconne
cted*ifc,intforce_prim_as_any);voidpim_if_addr_add_all(structinterface*ifp);void
pim_if_addr_del_all(structinterface*ifp);voidpim_if_addr_del_all_igmp(structinte
rface*ifp);voidpim_if_addr_del_all_pim(structinterface*ifp);intpim_if_add_vif(st
ructinterface*ifp);intpim_if_del_vif(structinterface*ifp);voidpim_if_add_vif_all
(structpim_instance*pim);voidpim_if_del_vif_all(structpim_instance*pim);structin
terface*pim_if_find_by_vif_index(structpim_instance*pim,ifindex_tvif_index);intp
im_if_find_vifindex_by_ifindex(structpim_instance*pim,ifindex_tifindex);intpim_i
f_lan_delay_enabled(structinterface*ifp);uint16_tpim_if_effective_propagation_de
lay_msec(structinterface*ifp);uint16_tpim_if_effective_override_interval_msec(st
ructinterface*ifp);uint16_tpim_if_jp_override_interval_msec(structinterface*ifp)
;structpim_neighbor*pim_if_find_neighbor(structinterface*ifp,structin_addraddr);
longpim_if_t_suppressed_msec(structinterface*ifp);intpim_if_t_override_msec(stru
ctinterface*ifp);structin_addrpim_find_primary_addr(structinterface*ifp);ferr_rp
im_if_igmp_join_add(structinterface*ifp,structin_addrgroup_addr,structin_addrsou
rce_addr);intpim_if_igmp_join_del(structinterface*ifp,structin_addrgroup_addr,st
ructin_addrsource_addr);voidpim_if_update_could_assert(structinterface*ifp);void
pim_if_assert_on_neighbor_down(structinterface*ifp,structin_addrneigh_addr);void
pim_if_rpf_interface_changed(structinterface*old_rpf_ifp,structpim_upstream*up);
voidpim_if_update_join_desired(structpim_interface*pim_ifp);voidpim_if_update_as
sert_tracking_desired(structinterface*ifp);voidpim_if_create_pimreg(structpim_in
stance*pim);intpim_if_connected_to_source(structinterface*ifp,structin_addrsrc);
intpim_update_source_set(structinterface*ifp,structin_addrsource);intpim_if_is_l
oopback(structpim_instance*pim,structinterface*ifp);intpim_if_is_vrf_device(stru
ctinterface*ifp);intpim_if_ifchannel_count(structpim_interface*pim_ifp);#endif/*
PIM_IFACE_H*/