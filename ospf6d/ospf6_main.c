/**Copyright(C)1999YasuhiroOhara**ThisfileispartofGNUZebra.**GNUZebraisfreesoftw
are;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicense
aspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*later
version.**GNUZebraisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANT
Y;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.
SeetheGNU*GeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGN
UGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFre
eSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#inclu
de<zebra.h>#include<lib/version.h>#include<stdlib.h>#include"getopt.h"#include"t
hread.h"#include"log.h"#include"command.h"#include"vty.h"#include"memory.h"#incl
ude"memory_vty.h"#include"if.h"#include"filter.h"#include"prefix.h"#include"plis
t.h"#include"privs.h"#include"sigevent.h"#include"zclient.h"#include"vrf.h"#incl
ude"bfd.h"#include"libfrr.h"#include"ospf6d.h"#include"ospf6_top.h"#include"ospf
6_message.h"#include"ospf6_asbr.h"#include"ospf6_lsa.h"#include"ospf6_interface.
h"#include"ospf6_zebra.h"/*Defaultconfigurationfilenameforospf6d.*/#defineOSPF6_
DEFAULT_CONFIG"ospf6d.conf"/*Defaultportvalues.*/#defineOSPF6_VTY_PORT2606/*ospf
6dprivileges*/zebra_capabilities_t_caps_p[]={ZCAP_NET_RAW,ZCAP_BIND};structzebra
_privs_tospf6d_privs={#ifdefined(FRR_USER).user=FRR_USER,#endif#ifdefinedFRR_GRO
UP.group=FRR_GROUP,#endif#ifdefVTY_GROUP.vty_group=VTY_GROUP,#endif.caps_p=_caps
_p,.cap_num_p=2,.cap_num_i=0};/*ospf6doptions,weuseGNUgetoptlibrary.*/structopti
onlongopts[]={{0}};/*Masterofthreads.*/structthread_master*master;staticvoid__at
tribute__((noreturn))ospf6_exit(intstatus){structvrf*vrf=vrf_lookup_by_id(VRF_DE
FAULT);structinterface*ifp;frr_early_fini();if(ospf6)ospf6_delete(ospf6);bfd_gbl
_exit();FOR_ALL_INTERFACES(vrf,ifp)if(ifp->info!=NULL)ospf6_interface_delete(ifp
->info);ospf6_message_terminate();ospf6_asbr_terminate();ospf6_lsa_terminate();/
*reverseaccess_list_init*/access_list_reset();/*reverseprefix_list_init*/prefix_
list_add_hook(NULL);prefix_list_delete_hook(NULL);prefix_list_reset();vrf_termin
ate();if(zclient){zclient_stop(zclient);zclient_free(zclient);}frr_fini();exit(s
tatus);}/*SIGHUPhandler.*/staticvoidsighup(void){zlog_info("SIGHUPreceived");}/*
SIGINThandler.*/staticvoidsigint(void){zlog_notice("TerminatingonsignalSIGINT");
ospf6_exit(0);}/*SIGTERMhandler.*/staticvoidsigterm(void){zlog_notice("Terminati
ngonsignalSIGTERM");ospf6_exit(0);}/*SIGUSR1handler.*/staticvoidsigusr1(void){zl
og_info("SIGUSR1received");zlog_rotate();}structquagga_signal_tospf6_signals[]={
{.signal=SIGHUP,.handler=&sighup,},{.signal=SIGINT,.handler=&sigint,},{.signal=S
IGTERM,.handler=&sigterm,},{.signal=SIGUSR1,.handler=&sigusr1,},};FRR_DAEMON_INF
O(ospf6d,OSPF6,.vty_port=OSPF6_VTY_PORT,.proghelp="ImplementationoftheOSPFv3rout
ingprotocol.",.signals=ospf6_signals,.n_signals=array_size(ospf6_signals),.privs
=&ospf6d_privs,)/*Mainroutineofospf6d.Treatmentofargumentandstartingospffinitest
atemachineishandledhere.*/intmain(intargc,char*argv[],char*envp[]){intopt;frr_pr
einit(&ospf6d_di,argc,argv);frr_opt_add("",longopts,"");/*Commandlineargumenttre
atment.*/while(1){opt=frr_getopt(argc,argv,NULL);if(opt==EOF)break;switch(opt){c
ase0:break;default:frr_help_exit(1);break;}}if(geteuid()!=0){errno=EPERM;perror(
ospf6d_di.progname);exit(1);}/*OSPF6masterinit.*/ospf6_master_init();/*threadmas
ter*/master=frr_init();vrf_init(NULL,NULL,NULL,NULL);access_list_init();prefix_l
ist_init();/*initializeospf6*/ospf6_init();frr_config_fork();frr_run(master);/*N
otreached.*/ospf6_exit(0);}