/**Copyright(C)2003YasuhiroOhara**ThisfileispartofGNUZebra.**GNUZebraisfreesoftw
are;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicense
aspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*later
version.**GNUZebraisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANT
Y;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.
SeetheGNU*GeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGN
UGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFre
eSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#ifnde
fOSPF6_LSA_H#defineOSPF6_LSA_H/*Debugoption*/#defineOSPF6_LSA_DEBUG0x01#defineOS
PF6_LSA_DEBUG_ORIGINATE0x02#defineOSPF6_LSA_DEBUG_EXAMIN0x04#defineOSPF6_LSA_DEB
UG_FLOOD0x08#defineIS_OSPF6_DEBUG_LSA(name)\(ospf6_lstype_debug(htons(OSPF6_LSTY
PE_##name))&OSPF6_LSA_DEBUG)#defineIS_OSPF6_DEBUG_ORIGINATE(name)\(ospf6_lstype_
debug(htons(OSPF6_LSTYPE_##name))\&OSPF6_LSA_DEBUG_ORIGINATE)#defineIS_OSPF6_DEB
UG_EXAMIN(name)\(ospf6_lstype_debug(htons(OSPF6_LSTYPE_##name))\&OSPF6_LSA_DEBUG
_EXAMIN)#defineIS_OSPF6_DEBUG_LSA_TYPE(type)\(ospf6_lstype_debug(type)&OSPF6_LSA
_DEBUG)#defineIS_OSPF6_DEBUG_ORIGINATE_TYPE(type)\(ospf6_lstype_debug(type)&OSPF
6_LSA_DEBUG_ORIGINATE)#defineIS_OSPF6_DEBUG_EXAMIN_TYPE(type)\(ospf6_lstype_debu
g(type)&OSPF6_LSA_DEBUG_EXAMIN)#defineIS_OSPF6_DEBUG_FLOOD_TYPE(type)\(ospf6_lst
ype_debug(type)&OSPF6_LSA_DEBUG_FLOOD)/*LSAdefinition*/#defineOSPF6_MAX_LSASIZE4
096/*Type*/#defineOSPF6_LSTYPE_UNKNOWN0x0000#defineOSPF6_LSTYPE_ROUTER0x2001#def
ineOSPF6_LSTYPE_NETWORK0x2002#defineOSPF6_LSTYPE_INTER_PREFIX0x2003#defineOSPF6_
LSTYPE_INTER_ROUTER0x2004#defineOSPF6_LSTYPE_AS_EXTERNAL0x4005#defineOSPF6_LSTYP
E_GROUP_MEMBERSHIP0x2006#defineOSPF6_LSTYPE_TYPE_70x2007#defineOSPF6_LSTYPE_LINK
0x0008#defineOSPF6_LSTYPE_INTRA_PREFIX0x2009#defineOSPF6_LSTYPE_SIZE0x000a/*Mask
sforLSType:RFC2740A.4.2.1"LStype"*/#defineOSPF6_LSTYPE_UBIT_MASK0x8000#defineOSP
F6_LSTYPE_SCOPE_MASK0x6000#defineOSPF6_LSTYPE_FCODE_MASK0x1fff/*LSAscope*/#defin
eOSPF6_SCOPE_LINKLOCAL0x0000#defineOSPF6_SCOPE_AREA0x2000#defineOSPF6_SCOPE_AS0x
4000#defineOSPF6_SCOPE_RESERVED0x6000/*XXXU-bithandlingshouldbetreatedhere*/#def
ineOSPF6_LSA_SCOPE(type)(ntohs(type)&OSPF6_LSTYPE_SCOPE_MASK)/*LSAHeader*/#defin
eOSPF6_LSA_HEADER_SIZE20Ustructospf6_lsa_header{uint16_tage;/*LSage*/uint16_ttyp
e;/*LStype*/uint32_tid;/*LinkStateID*/uint32_tadv_router;/*AdvertisingRouter*/ui
nt32_tseqnum;/*LSsequencenumber*/uint16_tchecksum;/*LSchecksum*/uint16_tlength;/
*LSAlength*/};#defineOSPF6_LSA_HEADER_END(h)((caddr_t)(h)+sizeof(structospf6_lsa
_header))#defineOSPF6_LSA_SIZE(h)(ntohs(((structospf6_lsa_header*)(h))->length))
#defineOSPF6_LSA_END(h)\((caddr_t)(h)+ntohs(((structospf6_lsa_header*)(h))->leng
th))#defineOSPF6_LSA_IS_TYPE(t,L)\((L)->header->type==htons(OSPF6_LSTYPE_##t)?1:
0)#defineOSPF6_LSA_IS_SAME(L1,L2)\((L1)->header->adv_router==(L2)->header->adv_r
outer\&&(L1)->header->id==(L2)->header->id\&&(L1)->header->type==(L2)->header->t
ype)#defineOSPF6_LSA_IS_MATCH(t,i,a,L)\((L)->header->adv_router==(a)&&(L)->heade
r->id==(i)\&&(L)->header->type==(t))#defineOSPF6_LSA_IS_DIFFER(L1,L2)ospf6_lsa_i
s_differ(L1,L2)#defineOSPF6_LSA_IS_MAXAGE(L)(ospf6_lsa_age_current(L)==OSPF_LSA_
MAXAGE)#defineOSPF6_LSA_IS_CHANGED(L1,L2)ospf6_lsa_is_changed(L1,L2)#defineOSPF6
_LSA_IS_SEQWRAP(L)((L)->header->seqnum==htonl(OSPF_MAX_SEQUENCE_NUMBER+1))struct
ospf6_lsa{charname[64];/*dumpstring*/structroute_node*rn;unsignedcharlock;/*refe
rencecounter*/unsignedcharflag;/*specialmeaning(e.g.floodback)*/structtimevalbir
th;/*tv_secwhenLSage0*/structtimevaloriginated;/*usedbyMinLSIntervalcheck*/struc
ttimevalreceived;/*usedbyMinLSArrivalcheck*/structtimevalinstalled;structthread*
expire;structthread*refresh;/*Forself-originatedLSA*/intretrans_count;structospf
6_lsdb*lsdb;/*lsainstance*/structospf6_lsa_header*header;};#defineOSPF6_LSA_HEAD
ERONLY0x01#defineOSPF6_LSA_FLOODBACK0x02#defineOSPF6_LSA_DUPLICATE0x04#defineOSP
F6_LSA_IMPLIEDACK0x08#defineOSPF6_LSA_UNAPPROVED0x10#defineOSPF6_LSA_SEQWRAPPED0
x20structospf6_lsa_handler{conststruct{uint16_ttype;/*hostbyteorder*/constchar*n
ame;constchar*short_name;int(*show)(structvty*,structospf6_lsa*);char*(*get_pref
ix_str)(structospf6_lsa*,char*buf,intbuflen,intpos);}s;#definelh_types.type#defi
nelh_names.name#definelh_short_names.short_name#definelh_shows.show#definelh_get
_prefix_strs.get_prefix_struint8_tdebug;#definelh_debugdebug};#defineOSPF6_LSA_I
S_KNOWN(t)\(ospf6_get_lsa_handler(t)->lh_type!=OSPF6_LSTYPE_UNKNOWN?1:0)externve
ctorospf6_lsa_handler_vector;/*MacroforLSAOrigination*//*addris(structprefix*)*/
#defineCONTINUE_IF_ADDRESS_LINKLOCAL(debug,addr)\if(IN6_IS_ADDR_LINKLOCAL(&(addr
)->u.prefix6)){\charbuf[PREFIX2STR_BUFFER];\prefix2str(addr,buf,sizeof(buf));\if
(debug)\zlog_debug("FilteroutLinklocal:%s",buf);\continue;\}#defineCONTINUE_IF_A
DDRESS_UNSPECIFIED(debug,addr)\if(IN6_IS_ADDR_UNSPECIFIED(&(addr)->u.prefix6)){\
charbuf[PREFIX2STR_BUFFER];\prefix2str(addr,buf,sizeof(buf));\if(debug)\zlog_deb
ug("FilteroutUnspecified:%s",buf);\continue;\}#defineCONTINUE_IF_ADDRESS_LOOPBAC
K(debug,addr)\if(IN6_IS_ADDR_LOOPBACK(&(addr)->u.prefix6)){\charbuf[PREFIX2STR_B
UFFER];\prefix2str(addr,buf,sizeof(buf));\if(debug)\zlog_debug("FilteroutLoopbac
k:%s",buf);\continue;\}#defineCONTINUE_IF_ADDRESS_V4COMPAT(debug,addr)\if(IN6_IS
_ADDR_V4COMPAT(&(addr)->u.prefix6)){\charbuf[PREFIX2STR_BUFFER];\prefix2str(addr
,buf,sizeof(buf));\if(debug)\zlog_debug("FilteroutV4Compat:%s",buf);\continue;\}
#defineCONTINUE_IF_ADDRESS_V4MAPPED(debug,addr)\if(IN6_IS_ADDR_V4MAPPED(&(addr)-
>u.prefix6)){\charbuf[PREFIX2STR_BUFFER];\prefix2str(addr,buf,sizeof(buf));\if(d
ebug)\zlog_debug("FilteroutV4Mapped:%s",buf);\continue;\}/*FunctionPrototypes*/e
xternconstchar*ospf6_lstype_name(uint16_ttype);externconstchar*ospf6_lstype_shor
t_name(uint16_ttype);externuint8_tospf6_lstype_debug(uint16_ttype);externintospf
6_lsa_is_differ(structospf6_lsa*lsa1,structospf6_lsa*lsa2);externintospf6_lsa_is
_changed(structospf6_lsa*lsa1,structospf6_lsa*lsa2);externuint16_tospf6_lsa_age_
current(structospf6_lsa*);externvoidospf6_lsa_age_update_to_send(structospf6_lsa
*,uint32_t);externvoidospf6_lsa_premature_aging(structospf6_lsa*);externintospf6
_lsa_compare(structospf6_lsa*,structospf6_lsa*);externchar*ospf6_lsa_printbuf(st
ructospf6_lsa*lsa,char*buf,intsize);externvoidospf6_lsa_header_print_raw(structo
spf6_lsa_header*header);externvoidospf6_lsa_header_print(structospf6_lsa*lsa);ex
ternvoidospf6_lsa_show_summary_header(structvty*vty);externvoidospf6_lsa_show_su
mmary(structvty*vty,structospf6_lsa*lsa);externvoidospf6_lsa_show_dump(structvty
*vty,structospf6_lsa*lsa);externvoidospf6_lsa_show_internal(structvty*vty,struct
ospf6_lsa*lsa);externvoidospf6_lsa_show(structvty*vty,structospf6_lsa*lsa);exter
nstructospf6_lsa*ospf6_lsa_create(structospf6_lsa_header*header);externstructosp
f6_lsa*ospf6_lsa_create_headeronly(structospf6_lsa_header*header);externvoidospf
6_lsa_delete(structospf6_lsa*lsa);externstructospf6_lsa*ospf6_lsa_copy(structosp
f6_lsa*);externvoidospf6_lsa_lock(structospf6_lsa*);externvoidospf6_lsa_unlock(s
tructospf6_lsa*);externintospf6_lsa_expire(structthread*);externintospf6_lsa_ref
resh(structthread*);externunsignedshortospf6_lsa_checksum(structospf6_lsa_header
*);externintospf6_lsa_checksum_valid(structospf6_lsa_header*);externintospf6_lsa
_prohibited_duration(uint16_ttype,uint32_tid,uint32_tadv_router,void*scope);exte
rnvoidospf6_install_lsa_handler(conststructospf6_lsa_handler*handler);externcons
tstructospf6_lsa_handler*ospf6_get_lsa_handler(uint16_ttype);externvoidospf6_lsa
_init(void);externvoidospf6_lsa_terminate(void);externintconfig_write_ospf6_debu
g_lsa(structvty*vty);externvoidinstall_element_ospf6_debug_lsa(void);externvoido
spf6_lsa_age_set(structospf6_lsa*lsa);externvoidospf6_flush_self_originated_lsas
_now(void);#endif/*OSPF6_LSA_H*/