/**Copyright(C)2003YasuhiroOhara**ThisfileispartofGNUZebra.**GNUZebraisfreesoftw
are;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicense
aspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*later
version.**GNUZebraisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANT
Y;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.
SeetheGNU*GeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGN
UGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFre
eSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#ifnde
fOSPF6_SPF_H#defineOSPF6_SPF_H#include"ospf6_top.h"/*Debugoption*/externunsigned
charconf_debug_ospf6_spf;#defineOSPF6_DEBUG_SPF_PROCESS0x01#defineOSPF6_DEBUG_SP
F_TIME0x02#defineOSPF6_DEBUG_SPF_DATABASE0x04#defineOSPF6_DEBUG_SPF_ON(level)(co
nf_debug_ospf6_spf|=(level))#defineOSPF6_DEBUG_SPF_OFF(level)(conf_debug_ospf6_s
pf&=~(level))#defineIS_OSPF6_DEBUG_SPF(level)\(conf_debug_ospf6_spf&OSPF6_DEBUG_
SPF_##level)/*TransitVertex*/structospf6_vertex{/*typeofthisvertex*/uint8_ttype;
/*VertexIdentifier*/structprefixvertex_id;/*IdentifierString*/charname[128];/*As
sociatedArea*/structospf6_area*area;/*AssociatedLSA*/structospf6_lsa*lsa;/*Dista
ncefromRoot(i.e.Cost)*/uint32_tcost;/*Routerhopstothisnode*/uint8_thops;/*capabi
litybits*/uint8_tcapability;/*Optionalcapabilities*/uint8_toptions[3];/*Fortreed
isplay*/structospf6_vertex*parent;structlist*child_list;/*nexthopstothisnode*/st
ructlist*nh_list;uint32_tlink_id;};#defineOSPF6_VERTEX_TYPE_ROUTER0x01#defineOSP
F6_VERTEX_TYPE_NETWORK0x02#defineVERTEX_IS_TYPE(t,v)((v)->type==OSPF6_VERTEX_TYP
E_##t?1:0)/*WhattriggeredtheSPF?*/#defineOSPF6_SPF_FLAGS_ROUTER_LSA_ADDED(1<<0)#
defineOSPF6_SPF_FLAGS_ROUTER_LSA_REMOVED(1<<1)#defineOSPF6_SPF_FLAGS_NETWORK_LSA
_ADDED(1<<2)#defineOSPF6_SPF_FLAGS_NETWORK_LSA_REMOVED(1<<3)#defineOSPF6_SPF_FLA
GS_LINK_LSA_ADDED(1<<4)#defineOSPF6_SPF_FLAGS_LINK_LSA_REMOVED(1<<5)#defineOSPF6
_SPF_FLAGS_ROUTER_LSA_ORIGINATED(1<<6)#defineOSPF6_SPF_FLAGS_NETWORK_LSA_ORIGINA
TED(1<<7)staticinlinevoidospf6_set_spf_reason(structospf6*ospf,unsignedintreason
){ospf->spf_reason|=reason;}staticinlinevoidospf6_reset_spf_reason(structospf6*o
spf){ospf->spf_reason=0;}staticinlineunsignedintospf6_lsadd_to_spf_reason(struct
ospf6_lsa*lsa){unsignedintreason=0;switch(ntohs(lsa->header->type)){caseOSPF6_LS
TYPE_ROUTER:reason=OSPF6_SPF_FLAGS_ROUTER_LSA_ADDED;break;caseOSPF6_LSTYPE_NETWO
RK:reason=OSPF6_SPF_FLAGS_NETWORK_LSA_ADDED;break;caseOSPF6_LSTYPE_LINK:reason=O
SPF6_SPF_FLAGS_LINK_LSA_ADDED;break;default:break;}return(reason);}staticinlineu
nsignedintospf6_lsremove_to_spf_reason(structospf6_lsa*lsa){unsignedintreason=0;
switch(ntohs(lsa->header->type)){caseOSPF6_LSTYPE_ROUTER:reason=OSPF6_SPF_FLAGS_
ROUTER_LSA_REMOVED;break;caseOSPF6_LSTYPE_NETWORK:reason=OSPF6_SPF_FLAGS_NETWORK
_LSA_REMOVED;break;caseOSPF6_LSTYPE_LINK:reason=OSPF6_SPF_FLAGS_LINK_LSA_REMOVED
;break;default:break;}return(reason);}externvoidospf6_spf_table_finish(structosp
f6_route_table*result_table);externvoidospf6_spf_calculation(uint32_trouter_id,s
tructospf6_route_table*result_table,structospf6_area*oa);externvoidospf6_spf_sch
edule(structospf6*ospf,unsignedintreason);externvoidospf6_spf_display_subtree(st
ructvty*vty,constchar*prefix,intrest,structospf6_vertex*v);externvoidospf6_spf_c
onfig_write(structvty*vty);externintconfig_write_ospf6_debug_spf(structvty*vty);
externvoidinstall_element_ospf6_debug_spf(void);externvoidospf6_spf_init(void);e
xternvoidospf6_spf_reason_string(unsignedintreason,char*buf,intsize);externstruc
tospf6_lsa*ospf6_create_single_router_lsa(structospf6_area*area,structospf6_lsdb
*lsdb,uint32_tadv_router);externvoidospf6_remove_temp_router_lsa(structospf6_are
a*area);#endif/*OSPF6_SPF_H*/