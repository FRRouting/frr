/**Copyright(C)2003YasuhiroOhara**ThisfileispartofGNUZebra.**GNUZebraisfreesoftw
are;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicense
aspublishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*later
version.**GNUZebraisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANT
Y;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.
SeetheGNU*GeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGN
UGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFre
eSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#ifnde
fOSPF6_ROUTE_H#defineOSPF6_ROUTE_H#include"command.h"#include"zclient.h"#defineO
SPF6_MULTI_PATH_LIMIT4/*Debugoption*/externunsignedcharconf_debug_ospf6_route;#d
efineOSPF6_DEBUG_ROUTE_TABLE0x01#defineOSPF6_DEBUG_ROUTE_INTRA0x02#defineOSPF6_D
EBUG_ROUTE_INTER0x04#defineOSPF6_DEBUG_ROUTE_MEMORY0x80#defineOSPF6_DEBUG_ROUTE_
ON(level)(conf_debug_ospf6_route|=(level))#defineOSPF6_DEBUG_ROUTE_OFF(level)(co
nf_debug_ospf6_route&=~(level))#defineIS_OSPF6_DEBUG_ROUTE(e)(conf_debug_ospf6_r
oute&OSPF6_DEBUG_ROUTE_##e)/*Nexthop*/structospf6_nexthop{/*Interfaceindex*/ifin
dex_tifindex;/*IPaddress,ifany*/structin6_addraddress;};#defineospf6_nexthop_is_
set(x)\((x)->ifindex||!IN6_IS_ADDR_UNSPECIFIED(&(x)->address))#defineospf6_nexth
op_is_same(a,b)\((a)->ifindex==(b)->ifindex\&&IN6_ARE_ADDR_EQUAL(&(a)->address,&
(b)->address))#defineospf6_nexthop_clear(x)\do{\(x)->ifindex=0;\memset(&(x)->add
ress,0,sizeof(structin6_addr));\}while(0)#defineospf6_nexthop_copy(a,b)\do{\(a)-
>ifindex=(b)->ifindex;\memcpy(&(a)->address,&(b)->address,sizeof(structin6_addr)
);\}while(0)/*Path*/structospf6_ls_origin{uint16_ttype;uint32_tid;uint32_tadv_ro
uter;};structospf6_path{/*LinkStateOrigin*/structospf6_ls_originorigin;/*Routerb
its*/uint8_trouter_bits;/*OptionalCapabilities*/uint8_toptions[3];/*PrefixOption
s*/uint8_tprefix_options;/*AssociatedArea*/uint32_tarea_id;/*Path-type*/uint8_tt
ype;uint8_tsubtype;/*onlyusedforredistributei.eZEBRA_ROUTE_XXX*//*Cost*/uint8_tm
etric_type;uint32_tcost;union{uint32_tcost_e2;uint32_tcost_config;}u;uint32_ttag
;/*nhlistforthispath*/structlist*nh_list;};#defineOSPF6_PATH_TYPE_NONE0#defineOS
PF6_PATH_TYPE_INTRA1#defineOSPF6_PATH_TYPE_INTER2#defineOSPF6_PATH_TYPE_EXTERNAL
13#defineOSPF6_PATH_TYPE_EXTERNAL24#defineOSPF6_PATH_TYPE_REDISTRIBUTE5#defineOS
PF6_PATH_TYPE_MAX6#defineOSPF6_PATH_SUBTYPE_DEFAULT_RT1#defineOSPF6_PATH_COST_IS
_CONFIGURED(path)(path.u.cost_config!=OSPF_AREA_RANGE_COST_UNSPEC)#include"prefi
x.h"#include"table.h"#include"bitfield.h"structospf6_route{structroute_node*rnod
e;structospf6_route_table*table;structospf6_route*prev;structospf6_route*next;un
signedintlock;/*DestinationType*/uint8_ttype;/*XXX:Itwouldlikelybebettertousesep
aratestructin_addr's*fortheadvertisingrouter-IDandprefixIDs,insteadofstuffing*th
em*intoone.SeealsoXXXbelow.*//*DestinationID*/structprefixprefix;/*Time*/structt
imevalinstalled;structtimevalchanged;/*flag*/uint8_tflag;/*routeoption*/void*rou
te_option;/*linkstateidforadvertising*/uint32_tlinkstate_id;/*path*/structospf6_
pathpath;/*ListofPaths.*/structlist*paths;/*nexthop*/structlist*nh_list;};#defin
eOSPF6_DEST_TYPE_NONE0#defineOSPF6_DEST_TYPE_ROUTER1#defineOSPF6_DEST_TYPE_NETWO
RK2#defineOSPF6_DEST_TYPE_DISCARD3#defineOSPF6_DEST_TYPE_LINKSTATE4#defineOSPF6_
DEST_TYPE_RANGE5#defineOSPF6_DEST_TYPE_MAX6#defineOSPF6_ROUTE_CHANGE0x01#defineO
SPF6_ROUTE_ADD0x02#defineOSPF6_ROUTE_REMOVE0x04#defineOSPF6_ROUTE_BEST0x08#defin
eOSPF6_ROUTE_ACTIVE_SUMMARY0x10#defineOSPF6_ROUTE_DO_NOT_ADVERTISE0x20#defineOSP
F6_ROUTE_WAS_REMOVED0x40#defineOSPF6_ROUTE_BLACKHOLE_ADDED0x80structospf6_route_
table{intscope_type;inttable_type;void*scope;/*patriciatree*/structroute_table*t
able;uint32_tcount;bitfield_tidspace;/*hooks*/void(*hook_add)(structospf6_route*
);void(*hook_change)(structospf6_route*);void(*hook_remove)(structospf6_route*);
};#defineOSPF6_SCOPE_TYPE_NONE0#defineOSPF6_SCOPE_TYPE_GLOBAL1#defineOSPF6_SCOPE
_TYPE_AREA2#defineOSPF6_SCOPE_TYPE_INTERFACE3#defineOSPF6_TABLE_TYPE_NONE0#defin
eOSPF6_TABLE_TYPE_ROUTES1#defineOSPF6_TABLE_TYPE_BORDER_ROUTERS2#defineOSPF6_TAB
LE_TYPE_CONNECTED_ROUTES3#defineOSPF6_TABLE_TYPE_EXTERNAL_ROUTES4#defineOSPF6_TA
BLE_TYPE_SPF_RESULTS5#defineOSPF6_TABLE_TYPE_PREFIX_RANGES6#defineOSPF6_TABLE_TY
PE_SUMMARY_PREFIXES7#defineOSPF6_TABLE_TYPE_SUMMARY_ROUTERS8#defineOSPF6_ROUTE_T
ABLE_CREATE(s,t)\ospf6_route_table_create(OSPF6_SCOPE_TYPE_##s,OSPF6_TABLE_TYPE_
##t)externconstchar*ospf6_dest_type_str[OSPF6_DEST_TYPE_MAX];externconstchar*osp
f6_dest_type_substr[OSPF6_DEST_TYPE_MAX];#defineOSPF6_DEST_TYPE_NAME(x)\(0<(x)&&
(x)<OSPF6_DEST_TYPE_MAX?ospf6_dest_type_str[(x)]\:ospf6_dest_type_str[0])#define
OSPF6_DEST_TYPE_SUBSTR(x)\(0<(x)&&(x)<OSPF6_DEST_TYPE_MAX?ospf6_dest_type_substr
[(x)]\:ospf6_dest_type_substr[0])externconstchar*ospf6_path_type_str[OSPF6_PATH_
TYPE_MAX];externconstchar*ospf6_path_type_substr[OSPF6_PATH_TYPE_MAX];#defineOSP
F6_PATH_TYPE_NAME(x)\(0<(x)&&(x)<OSPF6_PATH_TYPE_MAX?ospf6_path_type_str[(x)]\:o
spf6_path_type_str[0])#defineOSPF6_PATH_TYPE_SUBSTR(x)\(0<(x)&&(x)<OSPF6_PATH_TY
PE_MAX?ospf6_path_type_substr[(x)]\:ospf6_path_type_substr[0])#defineOSPF6_ROUTE
_ADDRESS_STR"Displaytheroutebestmatchestheaddress\n"#defineOSPF6_ROUTE_PREFIX_ST
R"Displaytheroute\n"#defineOSPF6_ROUTE_MATCH_STR"Displaytheroutematchestheprefix
\n"#defineospf6_route_is_prefix(p,r)\(memcmp(p,&(r)->prefix,sizeof(structprefix)
)==0)#defineospf6_route_is_same(ra,rb)(prefix_same(&(ra)->prefix,&(rb)->prefix))
#defineospf6_route_is_same_origin(ra,rb)\((ra)->path.area_id==(rb)->path.area_id
\&&memcmp(&(ra)->path.origin,&(rb)->path.origin,\sizeof(structospf6_ls_origin))\
==0)#defineospf6_route_is_identical(ra,rb)\((ra)->type==(rb)->type\&&memcmp(&(ra
)->prefix,&(rb)->prefix,sizeof(structprefix))==0\&&memcmp(&(ra)->path,&(rb)->pat
h,sizeof(structospf6_path))==0\&&ospf6_route_cmp_nexthops(ra,rb)==0)#defineospf6
_route_is_best(r)(CHECK_FLAG((r)->flag,OSPF6_ROUTE_BEST))#defineospf6_linkstate_
prefix_adv_router(x)((x)->u.lp.id.s_addr)#defineospf6_linkstate_prefix_id(x)((x)
->u.lp.adv_router.s_addr)#defineADV_ROUTER_IN_PREFIX(x)((x)->u.lp.id.s_addr)/*Fu
nctionprototype*/externvoidospf6_linkstate_prefix(uint32_tadv_router,uint32_tid,
structprefix*prefix);externvoidospf6_linkstate_prefix2str(structprefix*prefix,ch
ar*buf,intsize);externstructospf6_nexthop*ospf6_nexthop_create(void);externintos
pf6_nexthop_cmp(structospf6_nexthop*a,structospf6_nexthop*b);externvoidospf6_nex
thop_delete(structospf6_nexthop*nh);externvoidospf6_clear_nexthops(structlist*nh
_list);externintospf6_num_nexthops(structlist*nh_list);externvoidospf6_copy_next
hops(structlist*dst,structlist*src);externvoidospf6_merge_nexthops(structlist*ds
t,structlist*src);externvoidospf6_add_nexthop(structlist*nh_list,intifindex,stru
ctin6_addr*addr);externintospf6_num_nexthops(structlist*nh_list);externintospf6_
route_cmp_nexthops(structospf6_route*a,structospf6_route*b);externvoidospf6_rout
e_zebra_copy_nexthops(structospf6_route*route,structzapi_nexthopnexthops[],inten
tries);externintospf6_route_get_first_nh_index(structospf6_route*route);/*Hideab
stractionofnexthopimplementationinroutefromoutsiders*/#defineospf6_route_copy_ne
xthops(dst,src)ospf6_copy_nexthops(dst->nh_list,src->nh_list)#defineospf6_route_
merge_nexthops(dst,src)ospf6_merge_nexthops(dst->nh_list,src->nh_list)#defineosp
f6_route_num_nexthops(route)ospf6_num_nexthops(route->nh_list)#defineospf6_route
_add_nexthop(route,ifindex,addr)\ospf6_add_nexthop(route->nh_list,ifindex,addr)e
xternstructospf6_route*ospf6_route_create(void);externvoidospf6_route_delete(str
uctospf6_route*);externstructospf6_route*ospf6_route_copy(structospf6_route*rout
e);externintospf6_route_cmp(structospf6_route*ra,structospf6_route*rb);externvoi
dospf6_route_lock(structospf6_route*route);externvoidospf6_route_unlock(structos
pf6_route*route);externstructospf6_route*ospf6_route_lookup(structprefix*prefix,
structospf6_route_table*table);externstructospf6_route*ospf6_route_lookup_identi
cal(structospf6_route*route,structospf6_route_table*table);externstructospf6_rou
te*ospf6_route_lookup_bestmatch(structprefix*prefix,structospf6_route_table*tabl
e);externstructospf6_route*ospf6_route_add(structospf6_route*route,structospf6_r
oute_table*table);externvoidospf6_route_remove(structospf6_route*route,structosp
f6_route_table*table);externstructospf6_route*ospf6_route_head(structospf6_route
_table*table);externstructospf6_route*ospf6_route_next(structospf6_route*route);
externstructospf6_route*ospf6_route_best_next(structospf6_route*route);externstr
uctospf6_route*ospf6_route_match_head(structprefix*prefix,structospf6_route_tabl
e*table);externstructospf6_route*ospf6_route_match_next(structprefix*prefix,stru
ctospf6_route*route);externvoidospf6_route_remove_all(structospf6_route_table*);
externstructospf6_route_table*ospf6_route_table_create(ints,intt);externvoidospf
6_route_table_delete(structospf6_route_table*);externvoidospf6_route_dump(struct
ospf6_route_table*table);externvoidospf6_route_show(structvty*vty,structospf6_ro
ute*route);externvoidospf6_route_show_detail(structvty*vty,structospf6_route*rou
te);externintospf6_route_table_show(structvty*,int,int,structcmd_token**,structo
spf6_route_table*);externintospf6_linkstate_table_show(structvty*vty,intidx_ipv4
,intargc,structcmd_token**argv,structospf6_route_table*table);externvoidospf6_br
outer_show_header(structvty*vty);externvoidospf6_brouter_show(structvty*vty,stru
ctospf6_route*route);externintconfig_write_ospf6_debug_route(structvty*vty);exte
rnvoidinstall_element_ospf6_debug_route(void);externvoidospf6_route_init(void);e
xternvoidospf6_clean(void);externvoidospf6_path_free(structospf6_path*op);extern
structospf6_path*ospf6_path_dup(structospf6_path*path);#endif/*OSPF6_ROUTE_H*/