/**IS-ISRout(e)ingprotocol-isis_circuit.h**Copyright(C)2001,2002SampoSaaristo*Ta
mpereUniversityofTechnology*InstituteofCommunicationsEngineering**Thisprogramisf
reesoftware;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPubli
cLicenseaspublishedbytheFree*SoftwareFoundation;eitherversion2oftheLicense,or(at
youroption)*anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeusefu
l,butWITHOUT*ANYWARRANTY;withouteventheimpliedwarrantyofMERCHANTABILITYor*FITNES
SFORAPARTICULARPURPOSE.SeetheGNUGeneralPublicLicensefor*moredetails.**Youshouldh
avereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPY
ING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,
MA02110-1301USA*/#ifndefISIS_CIRCUIT_H#defineISIS_CIRCUIT_H#include"vty.h"#inclu
de"if.h"#include"qobj.h"#include"prefix.h"#include"ferr.h"#include"isis_constant
s.h"#include"isis_common.h"structisis_lsp;structpassword{structpassword*next;int
len;uint8_t*pass;};structmetric{uint8_tmetric_default;uint8_tmetric_error;uint8_
tmetric_expense;uint8_tmetric_delay;};structisis_bcast_info{uint8_tsnpa[ETH_ALEN
];/*SNPAofthiscircuit*/charrun_dr_elect[2];/*Shouldwerundrelection?*/structthrea
d*t_run_dr[2];/*DRelectionthread*/structthread*t_send_lan_hello[2];/*sendLANIIHs
inthisthread*/structlist*adjdb[2];/*adjacencydbs*/structlist*lan_neighs[2];/*lis
toflxneighsnpa*/charis_dr[2];/*ArewelevelxDR?*/uint8_tl1_desig_is[ISIS_SYS_ID_LE
N+1];/*level-1DR*/uint8_tl2_desig_is[ISIS_SYS_ID_LEN+1];/*level-2DR*/structthrea
d*t_refresh_pseudo_lsp[2];/*refreshpseudo-nodeLSPs*/};structisis_p2p_info{struct
isis_adjacency*neighbor;structthread*t_send_p2p_hello;/*sendP2PIIHsinthisthread*
/};structisis_circuit{intstate;uint8_tcircuit_id;/*l1/l2bcastCircuitID*/structis
is_area*area;/*backpointertothearea*/structinterface*interface;/*interfaceinfofr
omz*/intfd;/*IS-ISl1/2socket*/intsap_length;/*SAPlengthforDLPI*/structnlpidsnlpi
ds;/**Threads*/structthread*t_read;structthread*t_send_csnp[2];structthread*t_se
nd_psnp[2];structthread*t_send_lsp;structlist*lsp_queue;/*LSPstobetxed(bothlevel
s)*/structisis_lsp_hash*lsp_hash;/*Hashtablesynchronizedwithlsp_queue*/time_tlsp
_queue_last_push[2];/*timestampusedtoenforcetransmit*interval;*forscalability,us
eonetimestampper*circuit,insteadofoneperlspper*circuit*//*thereisnorealpointintw
ostreams,justforprogrammingkicker*/int(*rx)(structisis_circuit*circuit,uint8_t*s
snpa);structstream*rcv_stream;/*Streamforreceiving*/int(*tx)(structisis_circuit*
circuit,intlevel);structstream*snd_stream;/*Streamforsending*/intidx;/*idxinS[RM
|SN]flags*/#defineCIRCUIT_T_UNKNOWN0#defineCIRCUIT_T_BROADCAST1#defineCIRCUIT_T_
P2P2#defineCIRCUIT_T_LOOPBACK3intcirc_type;/*typeofthephysicalinterface*/intcirc
_type_config;/*configtypeofthephysicalinterface*/union{structisis_bcast_infobc;s
tructisis_p2p_infop2p;}u;uint8_tpriority[2];/*l1/2ISconfiguredpriority*/intpad_h
ellos;/*addpaddingtoHelloPDUs?*/charext_domain;/*externalDomain(boolean)*/intlsp
_regenerate_pending[ISIS_LEVELS];/**Configurables*/structisis_passwdpasswd;/*Cir
cuitrx/txpassword*/intis_type;/*circuitistype==levelofcircuit*differentiatedfrom
circuittype(media)*/uint32_thello_interval[2];/*l1HelloIntervalinmsecs*/uint16_t
hello_multiplier[2];/*l1HelloMultiplier*/uint16_tcsnp_interval[2];/*level-1csnp-
intervalinseconds*/uint16_tpsnp_interval[2];/*level-1psnp-intervalinseconds*/uin
t8_tmetric[2];uint32_tte_metric[2];structmpls_te_circuit*mtc;/*SupportforMPLS-TE
parameters-seeisis_te.[c,h]*/intip_router;/*RouteIP?*/intis_passive;/*IsPassive?
*/structlist*mt_settings;/*IS-ISMTSettings*/structlist*ip_addrs;/*ourIPaddresses
*/intipv6_router;/*RouteIPv6?*/structlist*ipv6_link;/*ourlinklocalIPv6addresses*
/structlist*ipv6_non_link;/*ournon-linklocalIPv6addresses*/uint16_tupadjcount[2]
;#defineISIS_CIRCUIT_FLAPPED_AFTER_SPF0x01uint8_tflags;booldisable_threeway_adj;
/**Countersasin10589--11.2.5.9*/uint32_tadj_state_changes;/*changesInAdjacencySt
ate*/uint32_tinit_failures;/*intialisationFailures*/uint32_tctrl_pdus_rxed;/*con
trolPDUsReceived*/uint32_tctrl_pdus_txed;/*controlPDUsSent*/uint32_tdesig_change
s[2];/*lanLxDesignatedIntermediateSystemChanges*/uint32_trej_adjacencies;/*rejec
tedAdjacencies*/QOBJ_FIELDS};DECLARE_QOBJ_TYPE(isis_circuit)voidisis_circuit_ini
t(void);structisis_circuit*isis_circuit_new(void);voidisis_circuit_del(structisi
s_circuit*circuit);structisis_circuit*circuit_lookup_by_ifp(structinterface*ifp,
structlist*list);structisis_circuit*circuit_scan_by_ifp(structinterface*ifp);voi
disis_circuit_configure(structisis_circuit*circuit,structisis_area*area);voidisi
s_circuit_deconfigure(structisis_circuit*circuit,structisis_area*area);voidisis_
circuit_if_add(structisis_circuit*circuit,structinterface*ifp);voidisis_circuit_
if_del(structisis_circuit*circuit,structinterface*ifp);voidisis_circuit_if_bind(
structisis_circuit*circuit,structinterface*ifp);voidisis_circuit_if_unbind(struc
tisis_circuit*circuit,structinterface*ifp);voidisis_circuit_add_addr(structisis_
circuit*circuit,structconnected*conn);voidisis_circuit_del_addr(structisis_circu
it*circuit,structconnected*conn);voidisis_circuit_prepare(structisis_circuit*cir
cuit);intisis_circuit_up(structisis_circuit*circuit);voidisis_circuit_down(struc
tisis_circuit*);voidcircuit_update_nlpids(structisis_circuit*circuit);voidisis_c
ircuit_print_vty(structisis_circuit*circuit,structvty*vty,chardetail);size_tisis
_circuit_pdu_size(structisis_circuit*circuit);voidisis_circuit_stream(structisis
_circuit*circuit,structstream**stream);structisis_circuit*isis_circuit_create(st
ructisis_area*area,structinterface*ifp);voidisis_circuit_af_set(structisis_circu
it*circuit,boolip_router,boolipv6_router);ferr_risis_circuit_passive_set(structi
sis_circuit*circuit,boolpassive);voidisis_circuit_is_type_set(structisis_circuit
*circuit,intis_type);ferr_risis_circuit_circ_type_set(structisis_circuit*circuit
,intcirc_type);ferr_risis_circuit_metric_set(structisis_circuit*circuit,intlevel
,intmetric);ferr_risis_circuit_passwd_unset(structisis_circuit*circuit);ferr_ris
is_circuit_passwd_cleartext_set(structisis_circuit*circuit,constchar*passwd);fer
r_risis_circuit_passwd_hmac_md5_set(structisis_circuit*circuit,constchar*passwd)
;intisis_circuit_mt_enabled_set(structisis_circuit*circuit,uint16_tmtid,boolenab
led);voidisis_circuit_schedule_lsp_send(structisis_circuit*circuit);voidisis_cir
cuit_queue_lsp(structisis_circuit*circuit,structisis_lsp*lsp);voidisis_circuit_l
sp_queue_clean(structisis_circuit*circuit);voidisis_circuit_cancel_queued_lsp(st
ructisis_circuit*circuit,structisis_lsp*lsp);structisis_lsp*isis_circuit_lsp_que
ue_pop(structisis_circuit*circuit);#endif/*_ZEBRA_ISIS_CIRCUIT_H*/