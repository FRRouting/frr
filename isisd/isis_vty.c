/**IS-ISRout(e)ingprotocol-isis_circuit.h**Copyright(C)2001,2002SampoSaaristo*Ta
mpereUniversityofTechnology*InstituteofCommunicationsEngineering*Copyright(C)201
6DavidLamparter,forNetDEF,Inc.**Thisprogramisfreesoftware;youcanredistributeitan
d/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspublishedbytheFree*Softw
areFoundation;eitherversion2oftheLicense,or(atyouroption)*anylaterversion.**This
programisdistributedinthehopethatitwillbeuseful,butWITHOUT*ANYWARRANTY;withoutev
entheimpliedwarrantyofMERCHANTABILITYor*FITNESSFORAPARTICULARPURPOSE.SeetheGNUGe
neralPublicLicensefor*moredetails.**YoushouldhavereceivedacopyoftheGNUGeneralPub
licLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftware*F
oundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#include<zebra.h>
#include"command.h"#include"spf_backoff.h"#include"isis_circuit.h"#include"isis_
csm.h"#include"isis_misc.h"#include"isis_mt.h"#include"isisd.h"staticstructisis_
circuit*isis_circuit_lookup(structvty*vty){structinterface*ifp=VTY_GET_CONTEXT(i
nterface);structisis_circuit*circuit;if(!ifp){vty_out(vty,"Invalidinterface\n");
returnNULL;}circuit=circuit_scan_by_ifp(ifp);if(!circuit){vty_out(vty,"ISISisnot
enabledoncircuit%s\n",ifp->name);returnNULL;}returncircuit;}DEFUN(ip_router_isis
,ip_router_isis_cmd,"iprouterisisWORD","InterfaceInternetProtocolconfigcommands\
n""IProuterinterfacecommands\n""IS-ISRoutingforIP\n""Routingprocesstag\n"){intid
x_afi=0;intidx_word=3;VTY_DECLVAR_CONTEXT(interface,ifp);structisis_circuit*circ
uit;structisis_area*area;constchar*af=argv[idx_afi]->arg;constchar*area_tag=argv
[idx_word]->arg;/*Preventmorethanoneareapercircuit*/circuit=circuit_scan_by_ifp(
ifp);if(circuit&&circuit->area){if(strcmp(circuit->area->area_tag,area_tag)){vty
_out(vty,"ISIScircuitisalreadydefinedon%s\n",circuit->area->area_tag);returnCMD_
ERR_NOTHING_TODO;}}area=isis_area_lookup(area_tag);if(!area)area=isis_area_creat
e(area_tag);if(!circuit||!circuit->area){circuit=isis_circuit_create(area,ifp);i
f(circuit->state!=C_STATE_CONF&&circuit->state!=C_STATE_UP){vty_out(vty,"Couldn'
tbringupinterface,pleasechecklog.\n");returnCMD_WARNING_CONFIG_FAILED;}}boolip=c
ircuit->ip_router,ipv6=circuit->ipv6_router;if(af[2]!='\0')ipv6=true;elseip=true
;isis_circuit_af_set(circuit,ip,ipv6);returnCMD_SUCCESS;}DEFUN(ip6_router_isis,i
p6_router_isis_cmd,"ipv6routerisisWORD","InterfaceInternetProtocolconfigcommands
\n""IProuterinterfacecommands\n""IS-ISRoutingforIP\n""Routingprocesstag\n"){retu
rnip_router_isis(self,vty,argc,argv);}DEFUN(no_ip_router_isis,no_ip_router_isis_
cmd,"no<ip|ipv6>routerisisWORD",NO_STR"InterfaceInternetProtocolconfigcommands\n
""IProuterinterfacecommands\n""IProuterinterfacecommands\n""IS-ISRoutingforIP\n"
"Routingprocesstag\n"){intidx_afi=1;intidx_word=4;VTY_DECLVAR_CONTEXT(interface,
ifp);structisis_area*area;structisis_circuit*circuit;constchar*af=argv[idx_afi]-
>arg;constchar*area_tag=argv[idx_word]->arg;area=isis_area_lookup(area_tag);if(!
area){vty_out(vty,"Can'tfindISISinstance%s\n",argv[idx_afi]->arg);returnCMD_ERR_
NO_MATCH;}circuit=circuit_lookup_by_ifp(ifp,area->circuit_list);if(!circuit){vty
_out(vty,"ISISisnotenabledoncircuit%s\n",ifp->name);returnCMD_ERR_NO_MATCH;}bool
ip=circuit->ip_router,ipv6=circuit->ipv6_router;if(af[2]!='\0')ipv6=false;elseip
=false;isis_circuit_af_set(circuit,ip,ipv6);returnCMD_SUCCESS;}DEFUN(isis_passiv
e,isis_passive_cmd,"isispassive","IS-IScommands\n""Configurethepassivemodeforint
erface\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)retur
nCMD_ERR_NO_MATCH;CMD_FERR_RETURN(isis_circuit_passive_set(circuit,1),"Cannotset
passive:$ERR");returnCMD_SUCCESS;}DEFUN(no_isis_passive,no_isis_passive_cmd,"noi
sispassive",NO_STR"IS-IScommands\n""Configurethepassivemodeforinterface\n"){stru
ctisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MAT
CH;CMD_FERR_RETURN(isis_circuit_passive_set(circuit,0),"Cannotsetnopassive:$ERR"
);returnCMD_SUCCESS;}DEFUN(isis_circuit_type,isis_circuit_type_cmd,"isiscircuit-
type<level-1|level-1-2|level-2-only>","IS-IScommands\n""Configurecircuittypefori
nterface\n""Level-1onlyadjacenciesareformed\n""Level-1-2adjacenciesareformed\n""
Level-2onlyadjacenciesareformed\n"){intidx_level=2;intis_type;structisis_circuit
*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;is_type=str
ing2circuit_t(argv[idx_level]->arg);if(!is_type){vty_out(vty,"Unknowncircuit-typ
e\n");returnCMD_WARNING_CONFIG_FAILED;}if(circuit->state==C_STATE_UP&&circuit->a
rea->is_type!=IS_LEVEL_1_AND_2&&circuit->area->is_type!=is_type){vty_out(vty,"In
validcircuitlevelforarea%s.\n",circuit->area->area_tag);returnCMD_WARNING_CONFIG
_FAILED;}isis_circuit_is_type_set(circuit,is_type);returnCMD_SUCCESS;}DEFUN(no_i
sis_circuit_type,no_isis_circuit_type_cmd,"noisiscircuit-type<level-1|level-1-2|
level-2-only>",NO_STR"IS-IScommands\n""Configurecircuittypeforinterface\n""Level
-1onlyadjacenciesareformed\n""Level-1-2adjacenciesareformed\n""Level-2onlyadjace
nciesareformed\n"){intis_type;structisis_circuit*circuit=isis_circuit_lookup(vty
);if(!circuit)returnCMD_ERR_NO_MATCH;/**Setthecircuitsleveltoitsdefaultvalue*/if
(circuit->state==C_STATE_UP)is_type=circuit->area->is_type;elseis_type=IS_LEVEL_
1_AND_2;isis_circuit_is_type_set(circuit,is_type);returnCMD_SUCCESS;}DEFUN(isis_
network,isis_network_cmd,"isisnetworkpoint-to-point","IS-IScommands\n""Setnetwor
ktype\n""point-to-pointnetworktype\n"){structisis_circuit*circuit=isis_circuit_l
ookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;if(isis_circuit_circ_type_set(circ
uit,CIRCUIT_T_P2P)){vty_out(vty,"isisnetworkpoint-to-pointisvalidonlyonbroadcast
interfaces\n");returnCMD_WARNING_CONFIG_FAILED;}returnCMD_SUCCESS;}DEFUN(no_isis
_network,no_isis_network_cmd,"noisisnetworkpoint-to-point",NO_STR"IS-IScommands\
n""Setnetworktypeforcircuit\n""point-to-pointnetworktype\n"){structisis_circuit*
circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;if(isis_circ
uit_circ_type_set(circuit,CIRCUIT_T_BROADCAST)){vty_out(vty,"isisnetworkpoint-to
-pointisvalidonlyonbroadcastinterfaces\n");returnCMD_WARNING_CONFIG_FAILED;}retu
rnCMD_SUCCESS;}DEFUN(isis_passwd,isis_passwd_cmd,"isispassword<md5|clear>WORD","
IS-IScommands\n""Configuretheauthenticationpasswordforacircuit\n""HMAC-MD5authen
tication\n""Cleartextpassword\n""Circuitpassword\n"){intidx_encryption=2;intidx_
word=3;structisis_circuit*circuit=isis_circuit_lookup(vty);ferr_rrv;if(!circuit)
returnCMD_ERR_NO_MATCH;if(argv[idx_encryption]->arg[0]=='m')rv=isis_circuit_pass
wd_hmac_md5_set(circuit,argv[idx_word]->arg);elserv=isis_circuit_passwd_cleartex
t_set(circuit,argv[idx_word]->arg);CMD_FERR_RETURN(rv,"Failedtosetcircuitpasswor
d:$ERR");returnCMD_SUCCESS;}DEFUN(no_isis_passwd,no_isis_passwd_cmd,"noisispassw
ord[<md5|clear>WORD]",NO_STR"IS-IScommands\n""Configuretheauthenticationpassword
foracircuit\n""HMAC-MD5authentication\n""Cleartextpassword\n""Circuitpassword\n"
){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_
NO_MATCH;CMD_FERR_RETURN(isis_circuit_passwd_unset(circuit),"Failedtounsetcircui
tpassword:$ERR");returnCMD_SUCCESS;}DEFUN(isis_priority,isis_priority_cmd,"isisp
riority(0-127)","IS-IScommands\n""SetpriorityforDesignatedRouterelection\n""Prio
rityvalue\n"){intidx_number=2;intprio;structisis_circuit*circuit=isis_circuit_lo
okup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;prio=atoi(argv[idx_number]->arg);if
(prio<MIN_PRIORITY||prio>MAX_PRIORITY){vty_out(vty,"Invalidpriority%d-shouldbe<0
-127>\n",prio);returnCMD_WARNING_CONFIG_FAILED;}circuit->priority[0]=prio;circui
t->priority[1]=prio;returnCMD_SUCCESS;}DEFUN(no_isis_priority,no_isis_priority_c
md,"noisispriority[(0-127)]",NO_STR"IS-IScommands\n""SetpriorityforDesignatedRou
terelection\n""Priorityvalue\n"){structisis_circuit*circuit=isis_circuit_lookup(
vty);if(!circuit)returnCMD_ERR_NO_MATCH;circuit->priority[0]=DEFAULT_PRIORITY;ci
rcuit->priority[1]=DEFAULT_PRIORITY;returnCMD_SUCCESS;}DEFUN(isis_priority_l1,is
is_priority_l1_cmd,"isispriority(0-127)level-1","IS-IScommands\n""Setpriorityfor
DesignatedRouterelection\n""Priorityvalue\n""Specifypriorityforlevel-1routing\n"
){intidx_number=2;intprio;structisis_circuit*circuit=isis_circuit_lookup(vty);if
(!circuit)returnCMD_ERR_NO_MATCH;prio=atoi(argv[idx_number]->arg);if(prio<MIN_PR
IORITY||prio>MAX_PRIORITY){vty_out(vty,"Invalidpriority%d-shouldbe<0-127>\n",pri
o);returnCMD_WARNING_CONFIG_FAILED;}circuit->priority[0]=prio;returnCMD_SUCCESS;
}DEFUN(no_isis_priority_l1,no_isis_priority_l1_cmd,"noisispriority[(0-127)]level
-1",NO_STR"IS-IScommands\n""SetpriorityforDesignatedRouterelection\n""Priorityva
lue\n""Specifypriorityforlevel-1routing\n"){structisis_circuit*circuit=isis_circ
uit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;circuit->priority[0]=DEFAULT_
PRIORITY;returnCMD_SUCCESS;}DEFUN(isis_priority_l2,isis_priority_l2_cmd,"isispri
ority(0-127)level-2","IS-IScommands\n""SetpriorityforDesignatedRouterelection\n"
"Priorityvalue\n""Specifypriorityforlevel-2routing\n"){intidx_number=2;intprio;s
tructisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_
MATCH;prio=atoi(argv[idx_number]->arg);if(prio<MIN_PRIORITY||prio>MAX_PRIORITY){
vty_out(vty,"Invalidpriority%d-shouldbe<0-127>\n",prio);returnCMD_WARNING_CONFIG
_FAILED;}circuit->priority[1]=prio;returnCMD_SUCCESS;}DEFUN(no_isis_priority_l2,
no_isis_priority_l2_cmd,"noisispriority[(0-127)]level-2",NO_STR"IS-IScommands\n"
"SetpriorityforDesignatedRouterelection\n""Priorityvalue\n""Specifypriorityforle
vel-2routing\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit
)returnCMD_ERR_NO_MATCH;circuit->priority[1]=DEFAULT_PRIORITY;returnCMD_SUCCESS;
}/*Metriccommand*/DEFUN(isis_metric,isis_metric_cmd,"isismetric(0-16777215)","IS
-IScommands\n""Setdefaultmetricforcircuit\n""Defaultmetricvalue\n"){intidx_numbe
r=2;intmet;structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)retur
nCMD_ERR_NO_MATCH;met=atoi(argv[idx_number]->arg);/*RFC3787section5.1*/if(circui
t->area&&circuit->area->oldmetric==1&&met>MAX_NARROW_LINK_METRIC){vty_out(vty,"I
nvalidmetric%d-shouldbe<0-63>""whennarrowmetrictypeenabled\n",met);returnCMD_WAR
NING_CONFIG_FAILED;}/*RFC4444*/if(circuit->area&&circuit->area->newmetric==1&&me
t>MAX_WIDE_LINK_METRIC){vty_out(vty,"Invalidmetric%d-shouldbe<0-16777215>""whenw
idemetrictypeenabled\n",met);returnCMD_WARNING_CONFIG_FAILED;}CMD_FERR_RETURN(is
is_circuit_metric_set(circuit,IS_LEVEL_1,met),"FailedtosetL1metric:$ERR");CMD_FE
RR_RETURN(isis_circuit_metric_set(circuit,IS_LEVEL_2,met),"FailedtosetL2metric:$
ERR");returnCMD_SUCCESS;}DEFUN(no_isis_metric,no_isis_metric_cmd,"noisismetric[(
0-16777215)]",NO_STR"IS-IScommands\n""Setdefaultmetricforcircuit\n""Defaultmetri
cvalue\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)retur
nCMD_ERR_NO_MATCH;CMD_FERR_RETURN(isis_circuit_metric_set(circuit,IS_LEVEL_1,DEF
AULT_CIRCUIT_METRIC),"FailedtosetL1metric:$ERR");CMD_FERR_RETURN(isis_circuit_me
tric_set(circuit,IS_LEVEL_2,DEFAULT_CIRCUIT_METRIC),"FailedtosetL2metric:$ERR");
returnCMD_SUCCESS;}DEFUN(isis_metric_l1,isis_metric_l1_cmd,"isismetric(0-1677721
5)level-1","IS-IScommands\n""Setdefaultmetricforcircuit\n""Defaultmetricvalue\n"
"Specifymetricforlevel-1routing\n"){intidx_number=2;intmet;structisis_circuit*ci
rcuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;met=atoi(argv[
idx_number]->arg);CMD_FERR_RETURN(isis_circuit_metric_set(circuit,IS_LEVEL_1,met
),"FailedtosetL1metric:$ERR");returnCMD_SUCCESS;}DEFUN(no_isis_metric_l1,no_isis
_metric_l1_cmd,"noisismetric[(0-16777215)]level-1",NO_STR"IS-IScommands\n""Setde
faultmetricforcircuit\n""Defaultmetricvalue\n""Specifymetricforlevel-1routing\n"
){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_
NO_MATCH;CMD_FERR_RETURN(isis_circuit_metric_set(circuit,IS_LEVEL_1,DEFAULT_CIRC
UIT_METRIC),"FailedtosetL1metric:$ERR");returnCMD_SUCCESS;}DEFUN(isis_metric_l2,
isis_metric_l2_cmd,"isismetric(0-16777215)level-2","IS-IScommands\n""Setdefaultm
etricforcircuit\n""Defaultmetricvalue\n""Specifymetricforlevel-2routing\n"){inti
dx_number=2;intmet;structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circu
it)returnCMD_ERR_NO_MATCH;met=atoi(argv[idx_number]->arg);CMD_FERR_RETURN(isis_c
ircuit_metric_set(circuit,IS_LEVEL_2,met),"FailedtosetL2metric:$ERR");returnCMD_
SUCCESS;}DEFUN(no_isis_metric_l2,no_isis_metric_l2_cmd,"noisismetric[(0-16777215
)]level-2",NO_STR"IS-IScommands\n""Setdefaultmetricforcircuit\n""Defaultmetricva
lue\n""Specifymetricforlevel-2routing\n"){structisis_circuit*circuit=isis_circui
t_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;CMD_FERR_RETURN(isis_circuit_me
tric_set(circuit,IS_LEVEL_2,DEFAULT_CIRCUIT_METRIC),"FailedtosetL2metric:$ERR");
returnCMD_SUCCESS;}/*endofmetrics*/DEFUN(isis_hello_interval,isis_hello_interval
_cmd,"isishello-interval(1-600)","IS-IScommands\n""SetHellointerval\n""Holdtime1
seconds,intervaldependsonmultiplier\n"){intidx_number=2;intinterval;structisis_c
ircuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;inter
val=atoi(argv[idx_number]->arg);if(interval<MIN_HELLO_INTERVAL||interval>MAX_HEL
LO_INTERVAL){vty_out(vty,"Invalidhello-interval%d-shouldbe<1-600>\n",interval);r
eturnCMD_WARNING_CONFIG_FAILED;}circuit->hello_interval[0]=(uint16_t)interval;ci
rcuit->hello_interval[1]=(uint16_t)interval;returnCMD_SUCCESS;}DEFUN(no_isis_hel
lo_interval,no_isis_hello_interval_cmd,"noisishello-interval[(1-600)]",NO_STR"IS
-IScommands\n""SetHellointerval\n""Holdtime1second,intervaldependsonmultiplier\n
"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR
_NO_MATCH;circuit->hello_interval[0]=DEFAULT_HELLO_INTERVAL;circuit->hello_inter
val[1]=DEFAULT_HELLO_INTERVAL;returnCMD_SUCCESS;}DEFUN(isis_hello_interval_l1,is
is_hello_interval_l1_cmd,"isishello-interval(1-600)level-1","IS-IScommands\n""Se
tHellointerval\n""Holdtime1second,intervaldependsonmultiplier\n""Specifyhello-in
tervalforlevel-1IIHs\n"){intidx_number=2;longinterval;structisis_circuit*circuit
=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;interval=atoi(argv[
idx_number]->arg);if(interval<MIN_HELLO_INTERVAL||interval>MAX_HELLO_INTERVAL){v
ty_out(vty,"Invalidhello-interval%ld-shouldbe<1-600>\n",interval);returnCMD_WARN
ING_CONFIG_FAILED;}circuit->hello_interval[0]=(uint16_t)interval;returnCMD_SUCCE
SS;}DEFUN(no_isis_hello_interval_l1,no_isis_hello_interval_l1_cmd,"noisishello-i
nterval[(1-600)]level-1",NO_STR"IS-IScommands\n""SetHellointerval\n""Holdtime1se
cond,intervaldependsonmultiplier\n""Specifyhello-intervalforlevel-1IIHs\n"){stru
ctisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MAT
CH;circuit->hello_interval[0]=DEFAULT_HELLO_INTERVAL;returnCMD_SUCCESS;}DEFUN(is
is_hello_interval_l2,isis_hello_interval_l2_cmd,"isishello-interval(1-600)level-
2","IS-IScommands\n""SetHellointerval\n""Holdtime1second,intervaldependsonmultip
lier\n""Specifyhello-intervalforlevel-2IIHs\n"){intidx_number=2;longinterval;str
uctisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MA
TCH;interval=atoi(argv[idx_number]->arg);if(interval<MIN_HELLO_INTERVAL||interva
l>MAX_HELLO_INTERVAL){vty_out(vty,"Invalidhello-interval%ld-shouldbe<1-600>\n",i
nterval);returnCMD_WARNING_CONFIG_FAILED;}circuit->hello_interval[1]=(uint16_t)i
nterval;returnCMD_SUCCESS;}DEFUN(no_isis_hello_interval_l2,no_isis_hello_interva
l_l2_cmd,"noisishello-interval[(1-600)]level-2",NO_STR"IS-IScommands\n""SetHello
interval\n""Holdtime1second,intervaldependsonmultiplier\n""Specifyhello-interval
forlevel-2IIHs\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circu
it)returnCMD_ERR_NO_MATCH;circuit->hello_interval[1]=DEFAULT_HELLO_INTERVAL;retu
rnCMD_SUCCESS;}DEFUN(isis_hello_multiplier,isis_hello_multiplier_cmd,"isishello-
multiplier(2-100)","IS-IScommands\n""SetmultiplierforHelloholdingtime\n""Hellomu
ltipliervalue\n"){intidx_number=2;intmult;structisis_circuit*circuit=isis_circui
t_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;mult=atoi(argv[idx_number]->arg
);if(mult<MIN_HELLO_MULTIPLIER||mult>MAX_HELLO_MULTIPLIER){vty_out(vty,"Invalidh
ello-multiplier%d-shouldbe<2-100>\n",mult);returnCMD_WARNING_CONFIG_FAILED;}circ
uit->hello_multiplier[0]=(uint16_t)mult;circuit->hello_multiplier[1]=(uint16_t)m
ult;returnCMD_SUCCESS;}DEFUN(no_isis_hello_multiplier,no_isis_hello_multiplier_c
md,"noisishello-multiplier[(2-100)]",NO_STR"IS-IScommands\n""SetmultiplierforHel
loholdingtime\n""Hellomultipliervalue\n"){structisis_circuit*circuit=isis_circui
t_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;circuit->hello_multiplier[0]=DE
FAULT_HELLO_MULTIPLIER;circuit->hello_multiplier[1]=DEFAULT_HELLO_MULTIPLIER;ret
urnCMD_SUCCESS;}DEFUN(isis_hello_multiplier_l1,isis_hello_multiplier_l1_cmd,"isi
shello-multiplier(2-100)level-1","IS-IScommands\n""SetmultiplierforHelloholdingt
ime\n""Hellomultipliervalue\n""Specifyhellomultiplierforlevel-1IIHs\n"){intidx_n
umber=2;intmult;structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)
returnCMD_ERR_NO_MATCH;mult=atoi(argv[idx_number]->arg);if(mult<MIN_HELLO_MULTIP
LIER||mult>MAX_HELLO_MULTIPLIER){vty_out(vty,"Invalidhello-multiplier%d-shouldbe
<2-100>\n",mult);returnCMD_WARNING_CONFIG_FAILED;}circuit->hello_multiplier[0]=(
uint16_t)mult;returnCMD_SUCCESS;}DEFUN(no_isis_hello_multiplier_l1,no_isis_hello
_multiplier_l1_cmd,"noisishello-multiplier[(2-100)]level-1",NO_STR"IS-IScommands
\n""SetmultiplierforHelloholdingtime\n""Hellomultipliervalue\n""Specifyhellomult
iplierforlevel-1IIHs\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(
!circuit)returnCMD_ERR_NO_MATCH;circuit->hello_multiplier[0]=DEFAULT_HELLO_MULTI
PLIER;returnCMD_SUCCESS;}DEFUN(isis_hello_multiplier_l2,isis_hello_multiplier_l2
_cmd,"isishello-multiplier(2-100)level-2","IS-IScommands\n""SetmultiplierforHell
oholdingtime\n""Hellomultipliervalue\n""Specifyhellomultiplierforlevel-2IIHs\n")
{intidx_number=2;intmult;structisis_circuit*circuit=isis_circuit_lookup(vty);if(
!circuit)returnCMD_ERR_NO_MATCH;mult=atoi(argv[idx_number]->arg);if(mult<MIN_HEL
LO_MULTIPLIER||mult>MAX_HELLO_MULTIPLIER){vty_out(vty,"Invalidhello-multiplier%d
-shouldbe<2-100>\n",mult);returnCMD_WARNING_CONFIG_FAILED;}circuit->hello_multip
lier[1]=(uint16_t)mult;returnCMD_SUCCESS;}DEFUN(no_isis_hello_multiplier_l2,no_i
sis_hello_multiplier_l2_cmd,"noisishello-multiplier[(2-100)]level-2",NO_STR"IS-I
Scommands\n""SetmultiplierforHelloholdingtime\n""Hellomultipliervalue\n""Specify
hellomultiplierforlevel-2IIHs\n"){structisis_circuit*circuit=isis_circuit_lookup
(vty);if(!circuit)returnCMD_ERR_NO_MATCH;circuit->hello_multiplier[1]=DEFAULT_HE
LLO_MULTIPLIER;returnCMD_SUCCESS;}DEFUN(isis_hello_padding,isis_hello_padding_cm
d,"isishellopadding","IS-IScommands\n""AddpaddingtoIS-IShellopackets\n""Padhello
packets\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)retu
rnCMD_ERR_NO_MATCH;circuit->pad_hellos=1;returnCMD_SUCCESS;}DEFUN(no_isis_hello_
padding,no_isis_hello_padding_cmd,"noisishellopadding",NO_STR"IS-IScommands\n""A
ddpaddingtoIS-IShellopackets\n""Padhellopackets\n"){structisis_circuit*circuit=i
sis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;circuit->pad_hellos=0
;returnCMD_SUCCESS;}DEFUN(isis_threeway_adj,isis_threeway_adj_cmd,"[no]isisthree
-way-handshake",NO_STR"IS-IScommands\n""Enable/Disablethree-wayhandshake\n"){str
uctisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MA
TCH;circuit->disable_threeway_adj=!strcmp(argv[0]->text,"no");returnCMD_SUCCESS;
}DEFUN(csnp_interval,csnp_interval_cmd,"isiscsnp-interval(1-600)","IS-IScommands
\n""SetCSNPintervalinseconds\n""CSNPintervalvalue\n"){intidx_number=2;unsignedlo
nginterval;structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)retur
nCMD_ERR_NO_MATCH;interval=atol(argv[idx_number]->arg);if(interval<MIN_CSNP_INTE
RVAL||interval>MAX_CSNP_INTERVAL){vty_out(vty,"Invalidcsnp-interval%lu-shouldbe<
1-600>\n",interval);returnCMD_WARNING_CONFIG_FAILED;}circuit->csnp_interval[0]=(
uint16_t)interval;circuit->csnp_interval[1]=(uint16_t)interval;returnCMD_SUCCESS
;}DEFUN(no_csnp_interval,no_csnp_interval_cmd,"noisiscsnp-interval[(1-600)]",NO_
STR"IS-IScommands\n""SetCSNPintervalinseconds\n""CSNPintervalvalue\n"){structisi
s_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;ci
rcuit->csnp_interval[0]=DEFAULT_CSNP_INTERVAL;circuit->csnp_interval[1]=DEFAULT_
CSNP_INTERVAL;returnCMD_SUCCESS;}DEFUN(csnp_interval_l1,csnp_interval_l1_cmd,"is
iscsnp-interval(1-600)level-1","IS-IScommands\n""SetCSNPintervalinseconds\n""CSN
Pintervalvalue\n""Specifyintervalforlevel-1CSNPs\n"){intidx_number=2;unsignedlon
ginterval;structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)return
CMD_ERR_NO_MATCH;interval=atol(argv[idx_number]->arg);if(interval<MIN_CSNP_INTER
VAL||interval>MAX_CSNP_INTERVAL){vty_out(vty,"Invalidcsnp-interval%lu-shouldbe<1
-600>\n",interval);returnCMD_WARNING_CONFIG_FAILED;}circuit->csnp_interval[0]=(u
int16_t)interval;returnCMD_SUCCESS;}DEFUN(no_csnp_interval_l1,no_csnp_interval_l
1_cmd,"noisiscsnp-interval[(1-600)]level-1",NO_STR"IS-IScommands\n""SetCSNPinter
valinseconds\n""CSNPintervalvalue\n""Specifyintervalforlevel-1CSNPs\n"){structis
is_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;c
ircuit->csnp_interval[0]=DEFAULT_CSNP_INTERVAL;returnCMD_SUCCESS;}DEFUN(csnp_int
erval_l2,csnp_interval_l2_cmd,"isiscsnp-interval(1-600)level-2","IS-IScommands\n
""SetCSNPintervalinseconds\n""CSNPintervalvalue\n""Specifyintervalforlevel-2CSNP
s\n"){intidx_number=2;unsignedlonginterval;structisis_circuit*circuit=isis_circu
it_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;interval=atol(argv[idx_number]
->arg);if(interval<MIN_CSNP_INTERVAL||interval>MAX_CSNP_INTERVAL){vty_out(vty,"I
nvalidcsnp-interval%lu-shouldbe<1-600>\n",interval);returnCMD_WARNING_CONFIG_FAI
LED;}circuit->csnp_interval[1]=(uint16_t)interval;returnCMD_SUCCESS;}DEFUN(no_cs
np_interval_l2,no_csnp_interval_l2_cmd,"noisiscsnp-interval[(1-600)]level-2",NO_
STR"IS-IScommands\n""SetCSNPintervalinseconds\n""CSNPintervalvalue\n""Specifyint
ervalforlevel-2CSNPs\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(
!circuit)returnCMD_ERR_NO_MATCH;circuit->csnp_interval[1]=DEFAULT_CSNP_INTERVAL;
returnCMD_SUCCESS;}DEFUN(psnp_interval,psnp_interval_cmd,"isispsnp-interval(1-12
0)","IS-IScommands\n""SetPSNPintervalinseconds\n""PSNPintervalvalue\n"){intidx_n
umber=2;unsignedlonginterval;structisis_circuit*circuit=isis_circuit_lookup(vty)
;if(!circuit)returnCMD_ERR_NO_MATCH;interval=atol(argv[idx_number]->arg);if(inte
rval<MIN_PSNP_INTERVAL||interval>MAX_PSNP_INTERVAL){vty_out(vty,"Invalidpsnp-int
erval%lu-shouldbe<1-120>\n",interval);returnCMD_WARNING_CONFIG_FAILED;}circuit->
psnp_interval[0]=(uint16_t)interval;circuit->psnp_interval[1]=(uint16_t)interval
;returnCMD_SUCCESS;}DEFUN(no_psnp_interval,no_psnp_interval_cmd,"noisispsnp-inte
rval[(1-120)]",NO_STR"IS-IScommands\n""SetPSNPintervalinseconds\n""PSNPintervalv
alue\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnC
MD_ERR_NO_MATCH;circuit->psnp_interval[0]=DEFAULT_PSNP_INTERVAL;circuit->psnp_in
terval[1]=DEFAULT_PSNP_INTERVAL;returnCMD_SUCCESS;}DEFUN(psnp_interval_l1,psnp_i
nterval_l1_cmd,"isispsnp-interval(1-120)level-1","IS-IScommands\n""SetPSNPinterv
alinseconds\n""PSNPintervalvalue\n""Specifyintervalforlevel-1PSNPs\n"){intidx_nu
mber=2;unsignedlonginterval;structisis_circuit*circuit=isis_circuit_lookup(vty);
if(!circuit)returnCMD_ERR_NO_MATCH;interval=atol(argv[idx_number]->arg);if(inter
val<MIN_PSNP_INTERVAL||interval>MAX_PSNP_INTERVAL){vty_out(vty,"Invalidpsnp-inte
rval%lu-shouldbe<1-120>\n",interval);returnCMD_WARNING_CONFIG_FAILED;}circuit->p
snp_interval[0]=(uint16_t)interval;returnCMD_SUCCESS;}DEFUN(no_psnp_interval_l1,
no_psnp_interval_l1_cmd,"noisispsnp-interval[(1-120)]level-1",NO_STR"IS-IScomman
ds\n""SetPSNPintervalinseconds\n""PSNPintervalvalue\n""Specifyintervalforlevel-1
PSNPs\n"){structisis_circuit*circuit=isis_circuit_lookup(vty);if(!circuit)return
CMD_ERR_NO_MATCH;circuit->psnp_interval[0]=DEFAULT_PSNP_INTERVAL;returnCMD_SUCCE
SS;}DEFUN(psnp_interval_l2,psnp_interval_l2_cmd,"isispsnp-interval(1-120)level-2
","IS-IScommands\n""SetPSNPintervalinseconds\n""PSNPintervalvalue\n""Specifyinte
rvalforlevel-2PSNPs\n"){intidx_number=2;unsignedlonginterval;structisis_circuit*
circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;interval=ato
l(argv[idx_number]->arg);if(interval<MIN_PSNP_INTERVAL||interval>MAX_PSNP_INTERV
AL){vty_out(vty,"Invalidpsnp-interval%lu-shouldbe<1-120>\n",interval);returnCMD_
WARNING_CONFIG_FAILED;}circuit->psnp_interval[1]=(uint16_t)interval;returnCMD_SU
CCESS;}DEFUN(no_psnp_interval_l2,no_psnp_interval_l2_cmd,"noisispsnp-interval[(1
-120)]level-2",NO_STR"IS-IScommands\n""SetPSNPintervalinseconds\n""PSNPintervalv
alue\n""Specifyintervalforlevel-2PSNPs\n"){structisis_circuit*circuit=isis_circu
it_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;circuit->psnp_interval[1]=DEFA
ULT_PSNP_INTERVAL;returnCMD_SUCCESS;}DEFUN(circuit_topology,circuit_topology_cmd
,"isistopology"ISIS_MT_NAMES,"IS-IScommands\n""ConfigureinterfaceIS-IStopologies
\n"ISIS_MT_DESCRIPTIONS){structisis_circuit*circuit=isis_circuit_lookup(vty);if(
!circuit)returnCMD_ERR_NO_MATCH;constchar*arg=argv[2]->arg;uint16_tmtid=isis_str
2mtid(arg);if(circuit->area&&circuit->area->oldmetric){vty_out(vty,"Multitopolog
yIS-IScanonlybeusedwithwidemetrics\n");returnCMD_WARNING_CONFIG_FAILED;}if(mtid=
=(uint16_t)-1){vty_out(vty,"Don'tknowtopology'%s'\n",arg);returnCMD_WARNING_CONF
IG_FAILED;}returnisis_circuit_mt_enabled_set(circuit,mtid,true);}DEFUN(no_circui
t_topology,no_circuit_topology_cmd,"noisistopology"ISIS_MT_NAMES,NO_STR"IS-IScom
mands\n""ConfigureinterfaceIS-IStopologies\n"ISIS_MT_DESCRIPTIONS){structisis_ci
rcuit*circuit=isis_circuit_lookup(vty);if(!circuit)returnCMD_ERR_NO_MATCH;constc
har*arg=argv[3]->arg;uint16_tmtid=isis_str2mtid(arg);if(circuit->area&&circuit->
area->oldmetric){vty_out(vty,"MultitopologyIS-IScanonlybeusedwithwidemetrics\n")
;returnCMD_WARNING_CONFIG_FAILED;}if(mtid==(uint16_t)-1){vty_out(vty,"Don'tknowt
opology'%s'\n",arg);returnCMD_WARNING_CONFIG_FAILED;}returnisis_circuit_mt_enabl
ed_set(circuit,mtid,false);}staticintvalidate_metric_style_narrow(structvty*vty,
structisis_area*area){structisis_circuit*circuit;structlistnode*node;if(!vty)ret
urnCMD_WARNING_CONFIG_FAILED;if(!area){vty_out(vty,"ISISareaisinvalid\n");return
CMD_WARNING_CONFIG_FAILED;}for(ALL_LIST_ELEMENTS_RO(area->circuit_list,node,circ
uit)){if((area->is_type&IS_LEVEL_1)&&(circuit->is_type&IS_LEVEL_1)&&(circuit->te
_metric[0]>MAX_NARROW_LINK_METRIC)){vty_out(vty,"ISIScircuit%smetricisinvalid\n"
,circuit->interface->name);returnCMD_WARNING_CONFIG_FAILED;}if((area->is_type&IS
_LEVEL_2)&&(circuit->is_type&IS_LEVEL_2)&&(circuit->te_metric[1]>MAX_NARROW_LINK
_METRIC)){vty_out(vty,"ISIScircuit%smetricisinvalid\n",circuit->interface->name)
;returnCMD_WARNING_CONFIG_FAILED;}}returnCMD_SUCCESS;}DEFUN(metric_style,metric_
style_cmd,"metric-style<narrow|transition|wide>","Useold-style(ISO10589)ornew-st
ylepacketformats\n""UseoldstyleofTLVswithnarrowmetric\n""Sendandacceptbothstyles
ofTLVsduringtransition\n""UsenewstyleofTLVstocarrywidermetric\n"){intidx_metric_
style=1;VTY_DECLVAR_CONTEXT(isis_area,area);intret;if(strncmp(argv[idx_metric_st
yle]->arg,"w",1)==0){isis_area_metricstyle_set(area,false,true);returnCMD_SUCCES
S;}if(area_is_mt(area)){vty_out(vty,"Narrowmetricscannotbeusedwhilemultitopology
IS-ISisactive\n");returnCMD_WARNING_CONFIG_FAILED;}ret=validate_metric_style_nar
row(vty,area);if(ret!=CMD_SUCCESS)returnret;if(strncmp(argv[idx_metric_style]->a
rg,"t",1)==0)isis_area_metricstyle_set(area,true,true);elseif(strncmp(argv[idx_m
etric_style]->arg,"n",1)==0)isis_area_metricstyle_set(area,true,false);returnCMD
_SUCCESS;returnCMD_SUCCESS;}DEFUN(no_metric_style,no_metric_style_cmd,"nometric-
style",NO_STR"Useold-style(ISO10589)ornew-stylepacketformats\n"){VTY_DECLVAR_CON
TEXT(isis_area,area);intret;if(area_is_mt(area)){vty_out(vty,"Narrowmetricscanno
tbeusedwhilemultitopologyIS-ISisactive\n");returnCMD_WARNING_CONFIG_FAILED;}ret=
validate_metric_style_narrow(vty,area);if(ret!=CMD_SUCCESS)returnret;isis_area_m
etricstyle_set(area,true,false);returnCMD_SUCCESS;}DEFUN(set_overload_bit,set_ov
erload_bit_cmd,"set-overload-bit","Setoverloadbittoavoidanytransittraffic\n"){VT
Y_DECLVAR_CONTEXT(isis_area,area);isis_area_overload_bit_set(area,true);returnCM
D_SUCCESS;}DEFUN(no_set_overload_bit,no_set_overload_bit_cmd,"noset-overload-bit
","Resetoverloadbittoaccepttransittraffic\n""Resetoverloadbit\n"){VTY_DECLVAR_CO
NTEXT(isis_area,area);isis_area_overload_bit_set(area,false);returnCMD_SUCCESS;}
DEFUN(set_attached_bit,set_attached_bit_cmd,"set-attached-bit","Setattachedbitto
identifyasL1/L2routerforinter-areatraffic\n"){VTY_DECLVAR_CONTEXT(isis_area,area
);isis_area_attached_bit_set(area,true);returnCMD_SUCCESS;}DEFUN(no_set_attached
_bit,no_set_attached_bit_cmd,"noset-attached-bit",NO_STR"Resetattachedbit\n"){VT
Y_DECLVAR_CONTEXT(isis_area,area);isis_area_attached_bit_set(area,false);returnC
MD_SUCCESS;}DEFUN(dynamic_hostname,dynamic_hostname_cmd,"hostnamedynamic","Dynam
ichostnameforIS-IS\n""Dynamichostname\n"){VTY_DECLVAR_CONTEXT(isis_area,area);is
is_area_dynhostname_set(area,true);returnCMD_SUCCESS;}DEFUN(no_dynamic_hostname,
no_dynamic_hostname_cmd,"nohostnamedynamic",NO_STR"DynamichostnameforIS-IS\n""Dy
namichostname\n"){VTY_DECLVAR_CONTEXT(isis_area,area);isis_area_dynhostname_set(
area,false);returnCMD_SUCCESS;}staticintarea_lsp_mtu_set(structvty*vty,unsignedi
ntlsp_mtu){VTY_DECLVAR_CONTEXT(isis_area,area);structlistnode*node;structisis_ci
rcuit*circuit;for(ALL_LIST_ELEMENTS_RO(area->circuit_list,node,circuit)){if(circ
uit->state!=C_STATE_INIT&&circuit->state!=C_STATE_UP)continue;if(lsp_mtu>isis_ci
rcuit_pdu_size(circuit)){vty_out(vty,"ISISareacontainscircuit%s,whichhasamaximum
PDUsizeof%zu.\n",circuit->interface->name,isis_circuit_pdu_size(circuit));return
CMD_WARNING_CONFIG_FAILED;}}isis_area_lsp_mtu_set(area,lsp_mtu);returnCMD_SUCCES
S;}DEFUN(area_lsp_mtu,area_lsp_mtu_cmd,"lsp-mtu(128-4352)","Configurethemaximums
izeofgeneratedLSPs\n""MaximumsizeofgeneratedLSPs\n"){intidx_number=1;unsignedint
lsp_mtu;lsp_mtu=strtoul(argv[idx_number]->arg,NULL,10);returnarea_lsp_mtu_set(vt
y,lsp_mtu);}DEFUN(no_area_lsp_mtu,no_area_lsp_mtu_cmd,"nolsp-mtu[(128-4352)]",NO
_STR"ConfigurethemaximumsizeofgeneratedLSPs\n""MaximumsizeofgeneratedLSPs\n"){re
turnarea_lsp_mtu_set(vty,DEFAULT_LSP_MTU);}DEFUN(is_type,is_type_cmd,"is-type<le
vel-1|level-1-2|level-2-only>","ISLevelforthisroutingprocess(OSIonly)\n""Actasas
tationrouteronly\n""Actasbothastationrouterandanarearouter\n""Actasanarearoutero
nly\n"){intidx_level=1;VTY_DECLVAR_CONTEXT(isis_area,area);inttype;type=string2c
ircuit_t(argv[idx_level]->arg);if(!type){vty_out(vty,"UnknownISlevel\n");returnC
MD_SUCCESS;}isis_area_is_type_set(area,type);returnCMD_SUCCESS;}DEFUN(no_is_type
,no_is_type_cmd,"nois-type<level-1|level-1-2|level-2-only>",NO_STR"ISLevelforthi
sroutingprocess(OSIonly)\n""Actasastationrouteronly\n""Actasbothastationrouteran
danarearouter\n""Actasanarearouteronly\n"){VTY_DECLVAR_CONTEXT(isis_area,area);i
nttype;/**Puttheis-typebacktodefaults:*-level-1-2onfirstarea*-level-1fortherest*
/if(listgetdata(listhead(isis->area_list))==area)type=IS_LEVEL_1_AND_2;elsetype=
IS_LEVEL_1;isis_area_is_type_set(area,type);returnCMD_SUCCESS;}staticintset_lsp_
gen_interval(structvty*vty,structisis_area*area,uint16_tinterval,intlevel){intlv
l;for(lvl=IS_LEVEL_1;lvl<=IS_LEVEL_2;++lvl){if(!(lvl&level))continue;if(interval
>=area->lsp_refresh[lvl-1]){vty_out(vty,"LSPgeninterval%usmustbelessthan""theLSP
refreshinterval%us\n",interval,area->lsp_refresh[lvl-1]);returnCMD_WARNING_CONFI
G_FAILED;}}for(lvl=IS_LEVEL_1;lvl<=IS_LEVEL_2;++lvl){if(!(lvl&level))continue;ar
ea->lsp_gen_interval[lvl-1]=interval;}returnCMD_SUCCESS;}DEFUN(lsp_gen_interval,
lsp_gen_interval_cmd,"lsp-gen-interval[<level-1|level-2>](1-120)","Minimuminterv
albetweenregeneratingsameLSP\n""Setintervalforlevel1only\n""Setintervalforlevel2
only\n""Minimumintervalinseconds\n"){intidx=0;VTY_DECLVAR_CONTEXT(isis_area,area
);uint16_tinterval;intlevel;level=0;level|=argv_find(argv,argc,"level-1",&idx)?I
S_LEVEL_1:0;level|=argv_find(argv,argc,"level-2",&idx)?IS_LEVEL_2:0;if(!level)le
vel=IS_LEVEL_1|IS_LEVEL_2;argv_find(argv,argc,"(1-120)",&idx);interval=atoi(argv
[idx]->arg);returnset_lsp_gen_interval(vty,area,interval,level);}DEFUN(no_lsp_ge
n_interval,no_lsp_gen_interval_cmd,"nolsp-gen-interval[<level-1|level-2>][(1-120
)]",NO_STR"MinimumintervalbetweenregeneratingsameLSP\n""Setintervalforlevel1only
\n""Setintervalforlevel2only\n""Minimumintervalinseconds\n"){intidx=0;VTY_DECLVA
R_CONTEXT(isis_area,area);uint16_tinterval;intlevel;level=0;level|=argv_find(arg
v,argc,"level-1",&idx)?IS_LEVEL_1:0;level|=argv_find(argv,argc,"level-2",&idx)?I
S_LEVEL_2:0;if(!level)level=IS_LEVEL_1|IS_LEVEL_2;interval=DEFAULT_MIN_LSP_GEN_I
NTERVAL;returnset_lsp_gen_interval(vty,area,interval,level);}DEFUN(spf_interval,
spf_interval_cmd,"spf-interval(1-120)","MinimumintervalbetweenSPFcalculations\n"
"MinimumintervalbetweenconsecutiveSPFsinseconds\n"){intidx_number=1;VTY_DECLVAR_
CONTEXT(isis_area,area);uint16_tinterval;interval=atoi(argv[idx_number]->arg);ar
ea->min_spf_interval[0]=interval;area->min_spf_interval[1]=interval;returnCMD_SU
CCESS;}DEFUN(no_spf_interval,no_spf_interval_cmd,"nospf-interval[[<level-1|level
-2>](1-120)]",NO_STR"MinimumintervalbetweenSPFcalculations\n""Setintervalforleve
l1only\n""Setintervalforlevel2only\n""MinimumintervalbetweenconsecutiveSPFsinsec
onds\n"){VTY_DECLVAR_CONTEXT(isis_area,area);area->min_spf_interval[0]=MINIMUM_S
PF_INTERVAL;area->min_spf_interval[1]=MINIMUM_SPF_INTERVAL;returnCMD_SUCCESS;}DE
FUN(spf_interval_l1,spf_interval_l1_cmd,"spf-intervallevel-1(1-120)","Minimumint
ervalbetweenSPFcalculations\n""Setintervalforlevel1only\n""Minimumintervalbetwee
nconsecutiveSPFsinseconds\n"){intidx_number=2;VTY_DECLVAR_CONTEXT(isis_area,area
);uint16_tinterval;interval=atoi(argv[idx_number]->arg);area->min_spf_interval[0
]=interval;returnCMD_SUCCESS;}DEFUN(no_spf_interval_l1,no_spf_interval_l1_cmd,"n
ospf-intervallevel-1",NO_STR"MinimumintervalbetweenSPFcalculations\n""Setinterva
lforlevel1only\n"){VTY_DECLVAR_CONTEXT(isis_area,area);area->min_spf_interval[0]
=MINIMUM_SPF_INTERVAL;returnCMD_SUCCESS;}DEFUN(spf_interval_l2,spf_interval_l2_c
md,"spf-intervallevel-2(1-120)","MinimumintervalbetweenSPFcalculations\n""Setint
ervalforlevel2only\n""MinimumintervalbetweenconsecutiveSPFsinseconds\n"){intidx_
number=2;VTY_DECLVAR_CONTEXT(isis_area,area);uint16_tinterval;interval=atoi(argv
[idx_number]->arg);area->min_spf_interval[1]=interval;returnCMD_SUCCESS;}DEFUN(n
o_spf_interval_l2,no_spf_interval_l2_cmd,"nospf-intervallevel-2",NO_STR"Minimumi
ntervalbetweenSPFcalculations\n""Setintervalforlevel2only\n"){VTY_DECLVAR_CONTEX
T(isis_area,area);area->min_spf_interval[1]=MINIMUM_SPF_INTERVAL;returnCMD_SUCCE
SS;}DEFUN(no_spf_delay_ietf,no_spf_delay_ietf_cmd,"nospf-delay-ietf",NO_STR"IETF
SPFdelayalgorithm\n"){VTY_DECLVAR_CONTEXT(isis_area,area);spf_backoff_free(area-
>spf_delay_ietf[0]);spf_backoff_free(area->spf_delay_ietf[1]);area->spf_delay_ie
tf[0]=NULL;area->spf_delay_ietf[1]=NULL;returnCMD_SUCCESS;}DEFUN(spf_delay_ietf,
spf_delay_ietf_cmd,"spf-delay-ietfinit-delay(0-60000)short-delay(0-60000)long-de
lay(0-60000)holddown(0-60000)time-to-learn(0-60000)","IETFSPFdelayalgorithm\n""D
elayusedwhileinQUIETstate\n""DelayusedwhileinQUIETstateinmilliseconds\n""Delayus
edwhileinSHORT_WAITstate\n""DelayusedwhileinSHORT_WAITstateinmilliseconds\n""Del
ayusedwhileinLONG_WAIT\n""DelayusedwhileinLONG_WAITstateinmilliseconds\n""Timewi
thnoreceivedIGPeventsbeforeconsideringIGPstable\n""TimewithnoreceivedIGPeventsbe
foreconsideringIGPstable(inmilliseconds)\n""Maximumdurationneededtolearnalltheev
entsrelatedtoasinglefailure\n""Maximumdurationneededtolearnalltheeventsrelatedto
asinglefailure(inmilliseconds)\n"){VTY_DECLVAR_CONTEXT(isis_area,area);longinit_
delay=atol(argv[2]->arg);longshort_delay=atol(argv[4]->arg);longlong_delay=atol(
argv[6]->arg);longholddown=atol(argv[8]->arg);longtimetolearn=atol(argv[10]->arg
);size_tbufsiz=strlen(area->area_tag)+sizeof("IS-ISLx");char*buf=XCALLOC(MTYPE_T
MP,bufsiz);snprintf(buf,bufsiz,"IS-IS%sL1",area->area_tag);spf_backoff_free(area
->spf_delay_ietf[0]);area->spf_delay_ietf[0]=spf_backoff_new(master,buf,init_del
ay,short_delay,long_delay,holddown,timetolearn);snprintf(buf,bufsiz,"IS-IS%sL2",
area->area_tag);spf_backoff_free(area->spf_delay_ietf[1]);area->spf_delay_ietf[1
]=spf_backoff_new(master,buf,init_delay,short_delay,long_delay,holddown,timetole
arn);XFREE(MTYPE_TMP,buf);returnCMD_SUCCESS;}staticintarea_max_lsp_lifetime_set(
structvty*vty,intlevel,uint16_tinterval){VTY_DECLVAR_CONTEXT(isis_area,area);int
lvl;uint16_trefresh_interval=interval-300;intset_refresh_interval[ISIS_LEVELS]={
0,0};for(lvl=IS_LEVEL_1;lvl<=IS_LEVEL_2;lvl++){if(!(lvl&level))continue;if(refre
sh_interval<area->lsp_refresh[lvl-1]){vty_out(vty,"Level%dMaxLSPlifetime%usmustb
e300sgreaterthan""theconfiguredLSPrefreshinterval%us\n",lvl,interval,area->lsp_r
efresh[lvl-1]);vty_out(vty,"Automaticallyreducinglevel%dLSPrefreshinterval""to%u
s\n",lvl,refresh_interval);set_refresh_interval[lvl-1]=1;if(refresh_interval<=ar
ea->lsp_gen_interval[lvl-1]){vty_out(vty,"LSPrefreshinterval%usmustbegreaterthan
""theconfiguredLSPgeninterval%us\n",refresh_interval,area->lsp_gen_interval[lvl-
1]);returnCMD_WARNING_CONFIG_FAILED;}}}for(lvl=IS_LEVEL_1;lvl<=IS_LEVEL_2;lvl++)
{if(!(lvl&level))continue;isis_area_max_lsp_lifetime_set(area,lvl,interval);if(s
et_refresh_interval[lvl-1])isis_area_lsp_refresh_set(area,lvl,refresh_interval);
}returnCMD_SUCCESS;}DEFUN(max_lsp_lifetime,max_lsp_lifetime_cmd,"max-lsp-lifetim
e[<level-1|level-2>](350-65535)","MaximumLSPlifetime\n""MaximumLSPlifetimeforLev
el1only\n""MaximumLSPlifetimeforLevel2only\n""LSPlifetimeinseconds\n"){intidx=0;
unsignedintlevel=IS_LEVEL_1_AND_2;if(argv_find(argv,argc,"level-1",&idx))level=I
S_LEVEL_1;elseif(argv_find(argv,argc,"level-2",&idx))level=IS_LEVEL_2;argv_find(
argv,argc,"(350-65535)",&idx);intlifetime=atoi(argv[idx]->arg);returnarea_max_ls
p_lifetime_set(vty,level,lifetime);}DEFUN(no_max_lsp_lifetime,no_max_lsp_lifetim
e_cmd,"nomax-lsp-lifetime[<level-1|level-2>][(350-65535)]",NO_STR"MaximumLSPlife
time\n""MaximumLSPlifetimeforLevel1only\n""MaximumLSPlifetimeforLevel2only\n""LS
Plifetimeinseconds\n"){intidx=0;unsignedintlevel=IS_LEVEL_1_AND_2;if(argv_find(a
rgv,argc,"level-1",&idx))level=IS_LEVEL_1;elseif(argv_find(argv,argc,"level-2",&
idx))level=IS_LEVEL_2;returnarea_max_lsp_lifetime_set(vty,level,DEFAULT_LSP_LIFE
TIME);}staticintarea_lsp_refresh_interval_set(structvty*vty,intlevel,uint16_tint
erval){VTY_DECLVAR_CONTEXT(isis_area,area);intlvl;for(lvl=IS_LEVEL_1;lvl<=IS_LEV
EL_2;++lvl){if(!(lvl&level))continue;if(interval<=area->lsp_gen_interval[lvl-1])
{vty_out(vty,"LSPrefreshinterval%usmustbegreaterthan""theconfiguredLSPgeninterva
l%us\n",interval,area->lsp_gen_interval[lvl-1]);returnCMD_WARNING_CONFIG_FAILED;
}if(interval>(area->max_lsp_lifetime[lvl-1]-300)){vty_out(vty,"LSPrefreshinterva
l%usmustbelessthan""theconfiguredLSPlifetime%usless300\n",interval,area->max_lsp
_lifetime[lvl-1]);returnCMD_WARNING_CONFIG_FAILED;}}for(lvl=IS_LEVEL_1;lvl<=IS_L
EVEL_2;++lvl){if(!(lvl&level))continue;isis_area_lsp_refresh_set(area,lvl,interv
al);}returnCMD_SUCCESS;}DEFUN(lsp_refresh_interval,lsp_refresh_interval_cmd,"lsp
-refresh-interval[<level-1|level-2>](1-65235)","LSPrefreshinterval\n""LSPrefresh
intervalforLevel1only\n""LSPrefreshintervalforLevel2only\n""LSPrefreshintervalin
seconds\n"){intidx=0;unsignedintlevel=IS_LEVEL_1_AND_2;unsignedintinterval=0;if(
argv_find(argv,argc,"level-1",&idx))level=IS_LEVEL_1;elseif(argv_find(argv,argc,
"level-2",&idx))level=IS_LEVEL_2;interval=atoi(argv[argc-1]->arg);returnarea_lsp
_refresh_interval_set(vty,level,interval);}DEFUN(no_lsp_refresh_interval,no_lsp_
refresh_interval_cmd,"nolsp-refresh-interval[<level-1|level-2>][(1-65235)]",NO_S
TR"LSPrefreshinterval\n""LSPrefreshintervalforLevel1only\n""LSPrefreshintervalfo
rLevel2only\n""LSPrefreshintervalinseconds\n"){intidx=0;unsignedintlevel=IS_LEVE
L_1_AND_2;if(argv_find(argv,argc,"level-1",&idx))level=IS_LEVEL_1;elseif(argv_fi
nd(argv,argc,"level-2",&idx))level=IS_LEVEL_2;returnarea_lsp_refresh_interval_se
t(vty,level,DEFAULT_MAX_LSP_GEN_INTERVAL);}staticintarea_passwd_set(structvty*vt
y,intlevel,int(*type_set)(structisis_area*area,intlevel,constchar*passwd,uint8_t
snp_auth),constchar*passwd,uint8_tsnp_auth){VTY_DECLVAR_CONTEXT(isis_area,area);
if(passwd&&strlen(passwd)>254){vty_out(vty,"Toolongareapassword(>254)\n");return
CMD_WARNING_CONFIG_FAILED;}type_set(area,level,passwd,snp_auth);returnCMD_SUCCES
S;}DEFUN(area_passwd_md5,area_passwd_md5_cmd,"area-passwordmd5WORD[authenticates
np<send-only|validate>]","Configuretheauthenticationpasswordforanarea\n""Authent
icationtype\n""Level-widepassword\n""Authentication\n""SNPPDUs\n""Sendbutdonotch
eckPDUsonreceiving\n""SendandcheckPDUsonreceiving\n"){intidx_password=0;intidx_w
ord=2;intidx_type=5;uint8_tsnp_auth=0;intlevel=strmatch(argv[idx_password]->text
,"domain-password")?IS_LEVEL_2:IS_LEVEL_1;if(argc>3){snp_auth=SNP_AUTH_SEND;if(s
trmatch(argv[idx_type]->text,"validate"))snp_auth|=SNP_AUTH_RECV;}returnarea_pas
swd_set(vty,level,isis_area_passwd_hmac_md5_set,argv[idx_word]->arg,snp_auth);}D
EFUN(domain_passwd_md5,domain_passwd_md5_cmd,"domain-passwordmd5WORD[authenticat
esnp<send-only|validate>]","Settheauthenticationpasswordforaroutingdomain\n""Aut
henticationtype\n""Level-widepassword\n""Authentication\n""SNPPDUs\n""Sendbutdon
otcheckPDUsonreceiving\n""SendandcheckPDUsonreceiving\n"){returnarea_passwd_md5(
self,vty,argc,argv);}DEFUN(area_passwd_clear,area_passwd_clear_cmd,"area-passwor
dclearWORD[authenticatesnp<send-only|validate>]","Configuretheauthenticationpass
wordforanarea\n""Authenticationtype\n""Areapassword\n""Authentication\n""SNPPDUs
\n""SendbutdonotcheckPDUsonreceiving\n""SendandcheckPDUsonreceiving\n"){intidx_p
assword=0;intidx_word=2;intidx_type=5;uint8_tsnp_auth=0;intlevel=strmatch(argv[i
dx_password]->text,"domain-password")?IS_LEVEL_2:IS_LEVEL_1;if(argc>3){snp_auth=
SNP_AUTH_SEND;if(strmatch(argv[idx_type]->text,"validate"))snp_auth|=SNP_AUTH_RE
CV;}returnarea_passwd_set(vty,level,isis_area_passwd_cleartext_set,argv[idx_word
]->arg,snp_auth);}DEFUN(domain_passwd_clear,domain_passwd_clear_cmd,"domain-pass
wordclearWORD[authenticatesnp<send-only|validate>]","Settheauthenticationpasswor
dforaroutingdomain\n""Authenticationtype\n""Areapassword\n""Authentication\n""SN
PPDUs\n""SendbutdonotcheckPDUsonreceiving\n""SendandcheckPDUsonreceiving\n"){ret
urnarea_passwd_clear(self,vty,argc,argv);}DEFUN(no_area_passwd,no_area_passwd_cm
d,"no<area-password|domain-password>",NO_STR"Configuretheauthenticationpasswordf
oranarea\n""Settheauthenticationpasswordforaroutingdomain\n"){intidx_password=1;
intlevel=strmatch(argv[idx_password]->text,"domain-password")?IS_LEVEL_2:IS_LEVE
L_1;VTY_DECLVAR_CONTEXT(isis_area,area);returnisis_area_passwd_unset(area,level)
;}voidisis_vty_init(void){install_element(INTERFACE_NODE,&ip_router_isis_cmd);in
stall_element(INTERFACE_NODE,&ip6_router_isis_cmd);install_element(INTERFACE_NOD
E,&no_ip_router_isis_cmd);install_element(INTERFACE_NODE,&isis_passive_cmd);inst
all_element(INTERFACE_NODE,&no_isis_passive_cmd);install_element(INTERFACE_NODE,
&isis_circuit_type_cmd);install_element(INTERFACE_NODE,&no_isis_circuit_type_cmd
);install_element(INTERFACE_NODE,&isis_network_cmd);install_element(INTERFACE_NO
DE,&no_isis_network_cmd);install_element(INTERFACE_NODE,&isis_passwd_cmd);instal
l_element(INTERFACE_NODE,&no_isis_passwd_cmd);install_element(INTERFACE_NODE,&is
is_priority_cmd);install_element(INTERFACE_NODE,&no_isis_priority_cmd);install_e
lement(INTERFACE_NODE,&isis_priority_l1_cmd);install_element(INTERFACE_NODE,&no_
isis_priority_l1_cmd);install_element(INTERFACE_NODE,&isis_priority_l2_cmd);inst
all_element(INTERFACE_NODE,&no_isis_priority_l2_cmd);install_element(INTERFACE_N
ODE,&isis_metric_cmd);install_element(INTERFACE_NODE,&no_isis_metric_cmd);instal
l_element(INTERFACE_NODE,&isis_metric_l1_cmd);install_element(INTERFACE_NODE,&no
_isis_metric_l1_cmd);install_element(INTERFACE_NODE,&isis_metric_l2_cmd);install
_element(INTERFACE_NODE,&no_isis_metric_l2_cmd);install_element(INTERFACE_NODE,&
isis_hello_interval_cmd);install_element(INTERFACE_NODE,&no_isis_hello_interval_
cmd);install_element(INTERFACE_NODE,&isis_hello_interval_l1_cmd);install_element
(INTERFACE_NODE,&no_isis_hello_interval_l1_cmd);install_element(INTERFACE_NODE,&
isis_hello_interval_l2_cmd);install_element(INTERFACE_NODE,&no_isis_hello_interv
al_l2_cmd);install_element(INTERFACE_NODE,&isis_hello_multiplier_cmd);install_el
ement(INTERFACE_NODE,&no_isis_hello_multiplier_cmd);install_element(INTERFACE_NO
DE,&isis_hello_multiplier_l1_cmd);install_element(INTERFACE_NODE,&no_isis_hello_
multiplier_l1_cmd);install_element(INTERFACE_NODE,&isis_hello_multiplier_l2_cmd)
;install_element(INTERFACE_NODE,&no_isis_hello_multiplier_l2_cmd);install_elemen
t(INTERFACE_NODE,&isis_hello_padding_cmd);install_element(INTERFACE_NODE,&no_isi
s_hello_padding_cmd);install_element(INTERFACE_NODE,&isis_threeway_adj_cmd);inst
all_element(INTERFACE_NODE,&csnp_interval_cmd);install_element(INTERFACE_NODE,&n
o_csnp_interval_cmd);install_element(INTERFACE_NODE,&csnp_interval_l1_cmd);insta
ll_element(INTERFACE_NODE,&no_csnp_interval_l1_cmd);install_element(INTERFACE_NO
DE,&csnp_interval_l2_cmd);install_element(INTERFACE_NODE,&no_csnp_interval_l2_cm
d);install_element(INTERFACE_NODE,&psnp_interval_cmd);install_element(INTERFACE_
NODE,&no_psnp_interval_cmd);install_element(INTERFACE_NODE,&psnp_interval_l1_cmd
);install_element(INTERFACE_NODE,&no_psnp_interval_l1_cmd);install_element(INTER
FACE_NODE,&psnp_interval_l2_cmd);install_element(INTERFACE_NODE,&no_psnp_interva
l_l2_cmd);install_element(INTERFACE_NODE,&circuit_topology_cmd);install_element(
INTERFACE_NODE,&no_circuit_topology_cmd);install_element(ISIS_NODE,&metric_style
_cmd);install_element(ISIS_NODE,&no_metric_style_cmd);install_element(ISIS_NODE,
&set_overload_bit_cmd);install_element(ISIS_NODE,&no_set_overload_bit_cmd);insta
ll_element(ISIS_NODE,&set_attached_bit_cmd);install_element(ISIS_NODE,&no_set_at
tached_bit_cmd);install_element(ISIS_NODE,&dynamic_hostname_cmd);install_element
(ISIS_NODE,&no_dynamic_hostname_cmd);install_element(ISIS_NODE,&area_lsp_mtu_cmd
);install_element(ISIS_NODE,&no_area_lsp_mtu_cmd);install_element(ISIS_NODE,&is_
type_cmd);install_element(ISIS_NODE,&no_is_type_cmd);install_element(ISIS_NODE,&
lsp_gen_interval_cmd);install_element(ISIS_NODE,&no_lsp_gen_interval_cmd);instal
l_element(ISIS_NODE,&spf_interval_cmd);install_element(ISIS_NODE,&no_spf_interva
l_cmd);install_element(ISIS_NODE,&spf_interval_l1_cmd);install_element(ISIS_NODE
,&no_spf_interval_l1_cmd);install_element(ISIS_NODE,&spf_interval_l2_cmd);instal
l_element(ISIS_NODE,&no_spf_interval_l2_cmd);install_element(ISIS_NODE,&max_lsp_
lifetime_cmd);install_element(ISIS_NODE,&no_max_lsp_lifetime_cmd);install_elemen
t(ISIS_NODE,&lsp_refresh_interval_cmd);install_element(ISIS_NODE,&no_lsp_refresh
_interval_cmd);install_element(ISIS_NODE,&area_passwd_md5_cmd);install_element(I
SIS_NODE,&area_passwd_clear_cmd);install_element(ISIS_NODE,&domain_passwd_md5_cm
d);install_element(ISIS_NODE,&domain_passwd_clear_cmd);install_element(ISIS_NODE
,&no_area_passwd_cmd);install_element(ISIS_NODE,&spf_delay_ietf_cmd);install_ele
ment(ISIS_NODE,&no_spf_delay_ietf_cmd);}