/**Zebradebugrelatedfunction*Copyright(C)1999KunihiroIshiguro**ThisfileispartofG
NUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*undertheterm
softheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversi
on2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwillb
euseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYor
FITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Yous
houldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefi
leCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,B
oston,MA02110-1301USA*/#include<zebra.h>#include"command.h"#include"debug.h"/*Fo
rdebugstatement.*/unsignedlongzebra_debug_event;unsignedlongzebra_debug_packet;u
nsignedlongzebra_debug_kernel;unsignedlongzebra_debug_rib;unsignedlongzebra_debu
g_fpm;unsignedlongzebra_debug_nht;unsignedlongzebra_debug_mpls;unsignedlongzebra
_debug_vxlan;unsignedlongzebra_debug_pw;DEFUN_NOSH(show_debugging_zebra,show_deb
ugging_zebra_cmd,"showdebugging[zebra]",SHOW_STR"Debugginginformation\n""Zebraco
nfiguration\n"){vty_out(vty,"Zebradebuggingstatus:\n");if(IS_ZEBRA_DEBUG_EVENT)v
ty_out(vty,"Zebraeventdebuggingison\n");if(IS_ZEBRA_DEBUG_PACKET){if(IS_ZEBRA_DE
BUG_SEND&&IS_ZEBRA_DEBUG_RECV){vty_out(vty,"Zebrapacket%sdebuggingison\n",IS_ZEB
RA_DEBUG_DETAIL?"detail":"");}else{if(IS_ZEBRA_DEBUG_SEND)vty_out(vty,"Zebrapack
etsend%sdebuggingison\n",IS_ZEBRA_DEBUG_DETAIL?"detail":"");elsevty_out(vty,"Zeb
rapacketreceive%sdebuggingison\n",IS_ZEBRA_DEBUG_DETAIL?"detail":"");}}if(IS_ZEB
RA_DEBUG_KERNEL)vty_out(vty,"Zebrakerneldebuggingison\n");if(IS_ZEBRA_DEBUG_KERN
EL_MSGDUMP_SEND)vty_out(vty,"Zebrakernelnetlinkmessagedumps(send)areon\n");if(IS
_ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV)vty_out(vty,"Zebrakernelnetlinkmessagedumps(rec
v)areon\n");/*Checkhereusingflagsasthe'macro'doesanOR*/if(CHECK_FLAG(zebra_debug
_rib,ZEBRA_DEBUG_RIB_DETAILED))vty_out(vty,"ZebraRIBdetaileddebuggingison\n");el
seif(CHECK_FLAG(zebra_debug_rib,ZEBRA_DEBUG_RIB))vty_out(vty,"ZebraRIBdebuggingi
son\n");if(IS_ZEBRA_DEBUG_FPM)vty_out(vty,"ZebraFPMdebuggingison\n");if(IS_ZEBRA
_DEBUG_NHT)vty_out(vty,"Zebranext-hoptrackingdebuggingison\n");if(IS_ZEBRA_DEBUG
_MPLS)vty_out(vty,"ZebraMPLSdebuggingison\n");if(IS_ZEBRA_DEBUG_VXLAN)vty_out(vt
y,"ZebraVXLANdebuggingison\n");if(IS_ZEBRA_DEBUG_PW)vty_out(vty,"Zebrapseudowire
debuggingison\n");returnCMD_SUCCESS;}DEFUN(debug_zebra_events,debug_zebra_events
_cmd,"debugzebraevents",DEBUG_STR"Zebraconfiguration\n""Debugoptionsetforzebraev
ents\n"){zebra_debug_event=ZEBRA_DEBUG_EVENT;returnCMD_SUCCESS;}DEFUN(debug_zebr
a_nht,debug_zebra_nht_cmd,"debugzebranht",DEBUG_STR"Zebraconfiguration\n""Debugo
ptionsetforzebranexthoptracking\n"){zebra_debug_nht=ZEBRA_DEBUG_NHT;returnCMD_SU
CCESS;}DEFUN(debug_zebra_mpls,debug_zebra_mpls_cmd,"debugzebrampls",DEBUG_STR"Ze
braconfiguration\n""DebugoptionsetforzebraMPLSLSPs\n"){zebra_debug_mpls=ZEBRA_DE
BUG_MPLS;returnCMD_SUCCESS;}DEFUN(debug_zebra_vxlan,debug_zebra_vxlan_cmd,"debug
zebravxlan",DEBUG_STR"Zebraconfiguration\n""DebugoptionsetforzebraVxLAN(EVPN)\n"
){zebra_debug_vxlan=ZEBRA_DEBUG_VXLAN;returnCMD_SUCCESS;}DEFUN(debug_zebra_pw,de
bug_zebra_pw_cmd,"[no]debugzebrapseudowires",NO_STRDEBUG_STR"Zebraconfiguration\
n""Debugoptionsetforzebrapseudowires\n"){if(strmatch(argv[0]->text,"no"))UNSET_F
LAG(zebra_debug_pw,ZEBRA_DEBUG_PW);elseSET_FLAG(zebra_debug_pw,ZEBRA_DEBUG_PW);r
eturnCMD_SUCCESS;}DEFUN(debug_zebra_packet,debug_zebra_packet_cmd,"debugzebrapac
ket[<recv|send>][detail]",DEBUG_STR"Zebraconfiguration\n""Debugoptionsetforzebra
packet\n""Debugoptionsetforreceivepacket\n""Debugoptionsetforsendpacket\n""Debug
optionsetfordetailedinfo\n"){intidx=0;zebra_debug_packet=ZEBRA_DEBUG_PACKET;if(a
rgv_find(argv,argc,"send",&idx))SET_FLAG(zebra_debug_packet,ZEBRA_DEBUG_SEND);el
seif(argv_find(argv,argc,"recv",&idx))SET_FLAG(zebra_debug_packet,ZEBRA_DEBUG_RE
CV);else{SET_FLAG(zebra_debug_packet,ZEBRA_DEBUG_SEND);SET_FLAG(zebra_debug_pack
et,ZEBRA_DEBUG_RECV);}if(argv_find(argv,argc,"detail",&idx))SET_FLAG(zebra_debug
_packet,ZEBRA_DEBUG_DETAIL);returnCMD_SUCCESS;}DEFUN(debug_zebra_kernel,debug_ze
bra_kernel_cmd,"debugzebrakernel",DEBUG_STR"Zebraconfiguration\n""Debugoptionset
forzebrabetweenkernelinterface\n"){SET_FLAG(zebra_debug_kernel,ZEBRA_DEBUG_KERNE
L);if(IS_ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV)UNSET_FLAG(zebra_debug_kernel,ZEBRA_DEB
UG_KERNEL_MSGDUMP_RECV);if(IS_ZEBRA_DEBUG_KERNEL_MSGDUMP_SEND)UNSET_FLAG(zebra_d
ebug_kernel,ZEBRA_DEBUG_KERNEL_MSGDUMP_SEND);returnCMD_SUCCESS;}DEFUN(debug_zebr
a_kernel_msgdump,debug_zebra_kernel_msgdump_cmd,"debugzebrakernelmsgdump[<recv|s
end>]",DEBUG_STR"Zebraconfiguration\n""Debugoptionsetforzebrabetweenkernelinterf
ace\n""Dumprawnetlinkmessages,sentandreceived\n""Dumprawnetlinkmessagesreceived\
n""Dumprawnetlinkmessagessent\n"){intidx=0;if(argv_find(argv,argc,"recv",&idx)){
SET_FLAG(zebra_debug_kernel,ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV);if(IS_ZEBRA_DEBUG_K
ERNEL_MSGDUMP_SEND)UNSET_FLAG(zebra_debug_kernel,ZEBRA_DEBUG_KERNEL_MSGDUMP_SEND
);}elseif(argv_find(argv,argc,"send",&idx)){SET_FLAG(zebra_debug_kernel,ZEBRA_DE
BUG_KERNEL_MSGDUMP_SEND);if(IS_ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV)UNSET_FLAG(zebra_
debug_kernel,ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV);}else{SET_FLAG(zebra_debug_kernel,
ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV);SET_FLAG(zebra_debug_kernel,ZEBRA_DEBUG_KERNEL_
MSGDUMP_SEND);}returnCMD_SUCCESS;}DEFUN(debug_zebra_rib,debug_zebra_rib_cmd,"deb
ugzebrarib[detailed]",DEBUG_STR"Zebraconfiguration\n""DebugRIBevents\n""Detailed
debugs\n"){intidx=0;SET_FLAG(zebra_debug_rib,ZEBRA_DEBUG_RIB);if(argv_find(argv,
argc,"detailed",&idx))SET_FLAG(zebra_debug_rib,ZEBRA_DEBUG_RIB_DETAILED);returnC
MD_SUCCESS;}DEFUN(debug_zebra_fpm,debug_zebra_fpm_cmd,"debugzebrafpm",DEBUG_STR"
Zebraconfiguration\n""DebugzebraFPMevents\n"){SET_FLAG(zebra_debug_fpm,ZEBRA_DEB
UG_FPM);returnCMD_SUCCESS;}DEFUN(no_debug_zebra_events,no_debug_zebra_events_cmd
,"nodebugzebraevents",NO_STRDEBUG_STR"Zebraconfiguration\n""Debugoptionsetforzeb
raevents\n"){zebra_debug_event=0;returnCMD_SUCCESS;}DEFUN(no_debug_zebra_nht,no_
debug_zebra_nht_cmd,"nodebugzebranht",NO_STRDEBUG_STR"Zebraconfiguration\n""Debu
goptionsetforzebranexthoptracking\n"){zebra_debug_nht=0;returnCMD_SUCCESS;}DEFUN
(no_debug_zebra_mpls,no_debug_zebra_mpls_cmd,"nodebugzebrampls",NO_STRDEBUG_STR"
Zebraconfiguration\n""DebugoptionsetforzebraMPLSLSPs\n"){zebra_debug_mpls=0;retu
rnCMD_SUCCESS;}DEFUN(no_debug_zebra_vxlan,no_debug_zebra_vxlan_cmd,"nodebugzebra
vxlan",NO_STRDEBUG_STR"Zebraconfiguration\n""DebugoptionsetforzebraVxLAN(EVPN)\n
"){zebra_debug_vxlan=0;returnCMD_SUCCESS;}DEFUN(no_debug_zebra_packet,no_debug_z
ebra_packet_cmd,"nodebugzebrapacket[<recv|send>][detail]",NO_STRDEBUG_STR"Zebrac
onfiguration\n""Debugoptionsetforzebrapacket\n""Debugoptionsetforreceivepacket\n
""Debugoptionsetforsendpacket\n""Debugoptionsetfordetailedinfo\n"){zebra_debug_p
acket=0;returnCMD_SUCCESS;}DEFUN(no_debug_zebra_kernel,no_debug_zebra_kernel_cmd
,"nodebugzebrakernel",NO_STRDEBUG_STR"Zebraconfiguration\n""Debugoptionsetforzeb
rabetweenkernelinterface\n"){zebra_debug_kernel=0;returnCMD_SUCCESS;}DEFUN(no_de
bug_zebra_kernel_msgdump,no_debug_zebra_kernel_msgdump_cmd,"nodebugzebrakernelms
gdump[<recv|send>]",NO_STRDEBUG_STR"Zebraconfiguration\n""Debugoptionsetforzebra
betweenkernelinterface\n""Dumprawnetlinkmessages,sentandreceived\n""Dumprawnetli
nkmessagesreceived\n""Dumprawnetlinkmessagessent\n"){zebra_debug_kernel=0;return
CMD_SUCCESS;}DEFUN(no_debug_zebra_rib,no_debug_zebra_rib_cmd,"nodebugzebrarib[de
tailed]",NO_STRDEBUG_STR"Zebraconfiguration\n""DebugzebraRIB\n""Detaileddebugs\n
"){zebra_debug_rib=0;returnCMD_SUCCESS;}DEFUN(no_debug_zebra_fpm,no_debug_zebra_
fpm_cmd,"nodebugzebrafpm",NO_STRDEBUG_STR"Zebraconfiguration\n""DebugzebraFPMeve
nts\n"){zebra_debug_fpm=0;returnCMD_SUCCESS;}/*Debugnode.*/structcmd_nodedebug_n
ode={DEBUG_NODE,"",/*Debugnodehasnointerface.*/1};staticintconfig_write_debug(st
ructvty*vty){intwrite=0;if(IS_ZEBRA_DEBUG_EVENT){vty_out(vty,"debugzebraevents\n
");write++;}if(IS_ZEBRA_DEBUG_PACKET){if(IS_ZEBRA_DEBUG_SEND&&IS_ZEBRA_DEBUG_REC
V){vty_out(vty,"debugzebrapacket%s\n",IS_ZEBRA_DEBUG_DETAIL?"detail":"");write++
;}else{if(IS_ZEBRA_DEBUG_SEND)vty_out(vty,"debugzebrapacketsend%s\n",IS_ZEBRA_DE
BUG_DETAIL?"detail":"");elsevty_out(vty,"debugzebrapacketrecv%s\n",IS_ZEBRA_DEBU
G_DETAIL?"detail":"");write++;}}if(IS_ZEBRA_DEBUG_KERNEL){if(IS_ZEBRA_DEBUG_KERN
EL_MSGDUMP_SEND&&IS_ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV){vty_out(vty,"debugzebrakern
elmsgdump\n");write++;}elseif(IS_ZEBRA_DEBUG_KERNEL_MSGDUMP_RECV){vty_out(vty,"d
ebugzebrakernelmsgdumprecv\n");write++;}elseif(IS_ZEBRA_DEBUG_KERNEL_MSGDUMP_SEN
D){vty_out(vty,"debugzebrakernelmsgdumpsend\n");write++;}else{vty_out(vty,"debug
zebrakernel\n");write++;}}if(CHECK_FLAG(zebra_debug_rib,ZEBRA_DEBUG_RIB_DETAILED
)){vty_out(vty,"debugzebraribdetailed\n");write++;}elseif(CHECK_FLAG(zebra_debug
_rib,ZEBRA_DEBUG_RIB)){vty_out(vty,"debugzebrarib\n");write++;}if(IS_ZEBRA_DEBUG
_FPM){vty_out(vty,"debugzebrafpm\n");write++;}if(IS_ZEBRA_DEBUG_NHT){vty_out(vty
,"debugzebranht\n");write++;}if(IS_ZEBRA_DEBUG_MPLS){vty_out(vty,"debugzebrampls
\n");write++;}if(IS_ZEBRA_DEBUG_VXLAN){vty_out(vty,"debugzebravxlan\n");write++;
}if(IS_ZEBRA_DEBUG_PW){vty_out(vty,"debugzebrapseudowires\n");write++;}returnwri
te;}voidzebra_debug_init(void){zebra_debug_event=0;zebra_debug_packet=0;zebra_de
bug_kernel=0;zebra_debug_rib=0;zebra_debug_fpm=0;zebra_debug_mpls=0;zebra_debug_
vxlan=0;zebra_debug_pw=0;install_node(&debug_node,config_write_debug);install_el
ement(VIEW_NODE,&show_debugging_zebra_cmd);install_element(ENABLE_NODE,&debug_ze
bra_events_cmd);install_element(ENABLE_NODE,&debug_zebra_nht_cmd);install_elemen
t(ENABLE_NODE,&debug_zebra_mpls_cmd);install_element(ENABLE_NODE,&debug_zebra_vx
lan_cmd);install_element(ENABLE_NODE,&debug_zebra_pw_cmd);install_element(ENABLE
_NODE,&debug_zebra_packet_cmd);install_element(ENABLE_NODE,&debug_zebra_kernel_c
md);install_element(ENABLE_NODE,&debug_zebra_kernel_msgdump_cmd);install_element
(ENABLE_NODE,&debug_zebra_rib_cmd);install_element(ENABLE_NODE,&debug_zebra_fpm_
cmd);install_element(ENABLE_NODE,&no_debug_zebra_events_cmd);install_element(ENA
BLE_NODE,&no_debug_zebra_nht_cmd);install_element(ENABLE_NODE,&no_debug_zebra_mp
ls_cmd);install_element(ENABLE_NODE,&no_debug_zebra_vxlan_cmd);install_element(E
NABLE_NODE,&no_debug_zebra_packet_cmd);install_element(ENABLE_NODE,&no_debug_zeb
ra_kernel_cmd);install_element(ENABLE_NODE,&no_debug_zebra_kernel_msgdump_cmd);i
nstall_element(ENABLE_NODE,&no_debug_zebra_rib_cmd);install_element(ENABLE_NODE,
&no_debug_zebra_fpm_cmd);install_element(CONFIG_NODE,&debug_zebra_events_cmd);in
stall_element(CONFIG_NODE,&debug_zebra_nht_cmd);install_element(CONFIG_NODE,&deb
ug_zebra_mpls_cmd);install_element(CONFIG_NODE,&debug_zebra_vxlan_cmd);install_e
lement(CONFIG_NODE,&debug_zebra_pw_cmd);install_element(CONFIG_NODE,&debug_zebra
_packet_cmd);install_element(CONFIG_NODE,&debug_zebra_kernel_cmd);install_elemen
t(CONFIG_NODE,&debug_zebra_kernel_msgdump_cmd);install_element(CONFIG_NODE,&debu
g_zebra_rib_cmd);install_element(CONFIG_NODE,&debug_zebra_fpm_cmd);install_eleme
nt(CONFIG_NODE,&no_debug_zebra_events_cmd);install_element(CONFIG_NODE,&no_debug
_zebra_nht_cmd);install_element(CONFIG_NODE,&no_debug_zebra_mpls_cmd);install_el
ement(CONFIG_NODE,&no_debug_zebra_vxlan_cmd);install_element(CONFIG_NODE,&no_deb
ug_zebra_packet_cmd);install_element(CONFIG_NODE,&no_debug_zebra_kernel_cmd);ins
tall_element(CONFIG_NODE,&no_debug_zebra_kernel_msgdump_cmd);install_element(CON
FIG_NODE,&no_debug_zebra_rib_cmd);install_element(CONFIG_NODE,&no_debug_zebra_fp
m_cmd);}