/**ZebraPolicyBasedRouting(PBR)Datastructuresanddefinitions*Thesearepublicdefini
tionsreferencedbymultiplefiles.*Copyright(C)2018CumulusNetworks,Inc.**Thisfileis
partofFRR.**FRRisfreesoftware;youcanredistributeitand/ormodifyit*underthetermsof
theGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversion2
,or(atyouroption)any*laterversion.**FRRisdistributedinthehopethatitwillbeuseful,
but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNESSF
ORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshouldhav
ereceivedacopyoftheGNUGeneralPublicLicense*alongwithFRR;seethefileCOPYING.Ifnot,
writetotheFree*SoftwareFoundation,Inc.,59TemplePlace-Suite330,Boston,MA*02111-13
07,USA.*/#ifndef_ZEBRA_PBR_H#define_ZEBRA_PBR_H#include<zebra.h>#include"prefix.
h"#include"if.h"#include"rt.h"/**APBRfilter**ThefilterormatchcriteriainaPBRrule.
*Forsimplicity,allsupportedfiltersaregroupedintoastructurerather*thandelineating
further.Abitmaskdenoteswhichfiltersareactually*specified.*/structzebra_pbr_filte
r{uint32_tfilter_bm;#definePBR_FILTER_SRC_IP(1<<0)#definePBR_FILTER_DST_IP(1<<1)
#definePBR_FILTER_SRC_PORT(1<<2)#definePBR_FILTER_DST_PORT(1<<3)/*SourceandDesti
nationIPaddresswithmasks.*/structprefixsrc_ip;structprefixdst_ip;/*SourceandDest
inationhigher-layer(TCP/UDP)portnumbers.*/uint16_tsrc_port;uint16_tdst_port;};#d
efineIS_RULE_FILTERING_ON_SRC_IP(r)\(r->filter.filter_bm&PBR_FILTER_SRC_IP)#defi
neIS_RULE_FILTERING_ON_DST_IP(r)\(r->filter.filter_bm&PBR_FILTER_DST_IP)#defineI
S_RULE_FILTERING_ON_SRC_PORT(r)\(r->filter.filter_bm&PBR_FILTER_SRC_PORT)#define
IS_RULE_FILTERING_ON_DST_PORT(r)\(r->filter.filter_bm&PBR_FILTER_DST_PORT)/**APB
Raction**TheactioncorrespondingtoaPBRrule.*Whiletheuserspecifiestheactioninapart
icularway,theforwarding*planeimplementation(Linuxonly)requiresthattobeencodedint
oa*routetableandtherulethenpointtothatroutetable;insomecases,*theusercriteriamay
directlypointtoatabletoo.*/structzebra_pbr_action{uint32_ttable;};/**APBRrule**T
hisisacombinationofthefiltercriteriaandcorrespondingaction.*Rulesalsohaveauser-d
efinedsequencenumberwhichdefinestherelative*orderamongstrules.*/structzebra_pbr_
rule{/**Originatingzclientsockfd,sowecanknowwhotosend*backto.*/intsock;uint32_ts
eq;uint32_tpriority;structinterface*ifp;uint32_tunique;structzebra_pbr_filterfil
ter;structzebra_pbr_actionaction;};voidzebra_pbr_add_rule(structzebra_ns*zns,str
uctzebra_pbr_rule*rule);voidzebra_pbr_del_rule(structzebra_ns*zns,structzebra_pb
r_rule*rule);/**Installspecifiedruleforaspecificinterface.*Itispossiblethattheus
er-definedsequencenumberandtheoneinthe*forwardingplanemaynotcoincide,hencetheAPI
requiresaseparate*rulepriority-mapstopreference/FRA_PRIORITYonLinux.*/externvoid
kernel_add_pbr_rule(structzebra_pbr_rule*rule);/**Uninstallspecifiedruleforaspec
ificinterface.*/externvoidkernel_del_pbr_rule(structzebra_pbr_rule*rule);/**Gett
oknowexistingPBRrulesinthekernel-typicallycalledatstartup.*/externvoidkernel_rea
d_pbr_rules(structzebra_ns*zns);enumsouthbound_results;/**Handlesuccessorfailure
ofrule(un)installinthekernel.*/externvoidkernel_pbr_rule_add_del_status(structze
bra_pbr_rule*rule,enumsouthbound_resultsres);/**Handleruledeletenotificationfrom
kernel.*/externintkernel_pbr_rule_del(structzebra_pbr_rule*rule);externvoidzebra
_pbr_client_close_cleanup(intsock);externvoidzebra_pbr_rules_free(void*arg);exte
rnuint32_tzebra_pbr_rules_hash_key(void*arg);externintzebra_pbr_rules_hash_equal
(constvoid*arg1,constvoid*arg2);#endif/*_ZEBRA_PBR_H*/