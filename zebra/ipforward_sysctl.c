/*IPforwardcontrolbysysctlfunction.*Copyright(C)1997,1999KunihiroIshiguro**Thisf
ileispartofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*
underthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation
;eitherversion2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehop
ethatitwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCH
ANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformorede
tails.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprog
ram;seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,
FifthFloor,Boston,MA02110-1301USA*/#include<zebra.h>#if!defined(GNU_LINUX)&&!def
ined(SUNOS_5)#include"privs.h"#include"zebra/ipforward.h"#include"log.h"#defineM
IB_SIZ4externstructzebra_privs_tzserv_privs;/*IPv4forwardingcontrolMIB.*/intmib[
MIB_SIZ]={CTL_NET,PF_INET,IPPROTO_IP,IPCTL_FORWARDING};intipforward(void){size_t
len;intipforwarding=0;len=sizeofipforwarding;if(sysctl(mib,MIB_SIZ,&ipforwarding
,&len,0,0)<0){zlog_warn("Can'tgetipforwardingvalue");return-1;}returnipforwardin
g;}intipforward_on(void){size_tlen;intipforwarding=1;len=sizeofipforwarding;if(z
serv_privs.change(ZPRIVS_RAISE))zlog_err("Can'traiseprivileges");if(sysctl(mib,M
IB_SIZ,NULL,NULL,&ipforwarding,len)<0){if(zserv_privs.change(ZPRIVS_LOWER))zlog_
err("Can'tlowerprivileges");zlog_warn("Can'tsetipforwardingon");return-1;}if(zse
rv_privs.change(ZPRIVS_LOWER))zlog_err("Can'tlowerprivileges");returnipforwardin
g;}intipforward_off(void){size_tlen;intipforwarding=0;len=sizeofipforwarding;if(
zserv_privs.change(ZPRIVS_RAISE))zlog_err("Can'traiseprivileges");if(sysctl(mib,
MIB_SIZ,NULL,NULL,&ipforwarding,len)<0){if(zserv_privs.change(ZPRIVS_LOWER))zlog
_err("Can'tlowerprivileges");zlog_warn("Can'tsetipforwardingon");return-1;}if(zs
erv_privs.change(ZPRIVS_LOWER))zlog_err("Can'tlowerprivileges");returnipforwardi
ng;}/*IPv6forwardingcontrolMIB.*/intmib_ipv6[MIB_SIZ]={CTL_NET,PF_INET6,#ifdefin
ed(BSD_V6_SYSCTL)IPPROTO_IPV6,IPV6CTL_FORWARDING#else/*NOTBSD_V6_SYSCTL*/IPPROTO
_IP,IP6CTL_FORWARDING#endif/*BSD_V6_SYSCTL*/};intipforward_ipv6(void){size_tlen;
intip6forwarding=0;len=sizeofip6forwarding;if(zserv_privs.change(ZPRIVS_RAISE))z
log_err("Can'traiseprivileges");if(sysctl(mib_ipv6,MIB_SIZ,&ip6forwarding,&len,0
,0)<0){if(zserv_privs.change(ZPRIVS_LOWER))zlog_err("Can'tlowerprivileges");zlog
_warn("can'tgetip6forwardingvalue");return-1;}if(zserv_privs.change(ZPRIVS_LOWER
))zlog_err("Can'tlowerprivileges");returnip6forwarding;}intipforward_ipv6_on(voi
d){size_tlen;intip6forwarding=1;len=sizeofip6forwarding;if(zserv_privs.change(ZP
RIVS_RAISE))zlog_err("Can'traiseprivileges");if(sysctl(mib_ipv6,MIB_SIZ,NULL,NUL
L,&ip6forwarding,len)<0){if(zserv_privs.change(ZPRIVS_LOWER))zlog_err("Can'tlowe
rprivileges");zlog_warn("can'tgetip6forwardingvalue");return-1;}if(zserv_privs.c
hange(ZPRIVS_LOWER))zlog_err("Can'tlowerprivileges");returnip6forwarding;}intipf
orward_ipv6_off(void){size_tlen;intip6forwarding=0;len=sizeofip6forwarding;if(zs
erv_privs.change(ZPRIVS_RAISE))zlog_err("Can'traiseprivileges");if(sysctl(mib_ip
v6,MIB_SIZ,NULL,NULL,&ip6forwarding,len)<0){if(zserv_privs.change(ZPRIVS_LOWER))
zlog_err("Can'tlowerprivileges");zlog_warn("can'tgetip6forwardingvalue");return-
1;}if(zserv_privs.change(ZPRIVS_LOWER))zlog_err("Can'tlowerprivileges");returnip
6forwarding;}#endif/*!defined(GNU_LINUX)&&!defined(SUNOS_5)*/