/*Interfacefunctionheader.*Copyright(C)1999KunihiroIshiguro**ThisfileispartofGNU
Zebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthetermso
ftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherversion
2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitwillbeu
seful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFI
TNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Yousho
uldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefile
COPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Bos
ton,MA02110-1301USA*/#ifndef_ZEBRA_INTERFACE_H#define_ZEBRA_INTERFACE_H#include"
redistribute.h"#include"vrf.h"#include"hook.h"#include"zebra/zebra_l2.h"/*Forint
erfacemulticastconfiguration.*/#defineIF_ZEBRA_MULTICAST_UNSPEC0#defineIF_ZEBRA_
MULTICAST_ON1#defineIF_ZEBRA_MULTICAST_OFF2/*Forinterfaceshutdownconfiguration.*
/#defineIF_ZEBRA_SHUTDOWN_OFF0#defineIF_ZEBRA_SHUTDOWN_ON1#ifdefined(HAVE_RTADV)
/*Routeradvertisementparameter.FromRFC4861,RFC6275andRFC4191.*/structrtadvconf{/
*AflagindicatingwhetherornottheroutersendsperiodicRouterAdvertisementsandrespond
stoRouterSolicitations.Default:FALSE*/intAdvSendAdvertisements;/*Themaximumtimea
llowedbetweensendingunsolicitedmulticastRouterAdvertisementsfromtheinterface,inm
illiseconds.MUSTbenolessthan70ms[RFC62757.5]andnogreaterthan1800000ms[RFC48616.2
.1].Default:600000milliseconds*/intMaxRtrAdvInterval;#defineRTADV_MAX_RTR_ADV_IN
TERVAL600000/*TheminimumtimeallowedbetweensendingunsolicitedmulticastRouterAdver
tisementsfromtheinterface,inmilliseconds.MUSTbenolessthan30ms[RFC62757.5].MUSTbe
nogreaterthan.75*MaxRtrAdvInterval.Default:0.33*MaxRtrAdvInterval*/intMinRtrAdvI
nterval;/*Thisfieldiscurrentlyunused.*/#defineRTADV_MIN_RTR_ADV_INTERVAL(0.33*RT
ADV_MAX_RTR_ADV_INTERVAL)/*UnsolicitedRouterAdvertisements'intervaltimer.*/intAd
vIntervalTimer;/*TheTRUE/FALSEvaluetobeplacedinthe"Managedaddressconfiguration"f
lagfieldintheRouterAdvertisement.See[ADDRCONF].Default:FALSE*/intAdvManagedFlag;
/*TheTRUE/FALSEvaluetobeplacedinthe"Otherstatefulconfiguration"flagfieldintheRou
terAdvertisement.See[ADDRCONF].Default:FALSE*/intAdvOtherConfigFlag;/*Thevalueto
beplacedinMTUoptionssentbytherouter.AvalueofzeroindicatesthatnoMTUoptionsaresent
.Default:0*/intAdvLinkMTU;/*ThevaluetobeplacedintheReachableTimefieldintheRouter
Advertisementmessagessentbytherouter.Thevaluezeromeansunspecified(bythisrouter).
MUSTbenogreaterthan3,600,000milliseconds(1hour).Default:0*/uint32_tAdvReachableT
ime;#defineRTADV_MAX_REACHABLE_TIME3600000/*ThevaluetobeplacedintheRetransTimerf
ieldintheRouterAdvertisementmessagessentbytherouter.Thevaluezeromeansunspecified
(bythisrouter).Default:0*/intAdvRetransTimer;/*ThedefaultvaluetobeplacedintheCur
HopLimitfieldintheRouterAdvertisementmessagessentbytherouter.Thevalueshouldbeset
tothatcurrentdiameteroftheInternet.Thevaluezeromeansunspecified(bythisrouter).De
fault:Thevaluespecifiedinthe"AssignedNumbers"RFC[ASSIGNED]thatwasineffectattheti
meofimplementation.*/intAdvCurHopLimit;/*ThevaluetobeplacedintheRouterLifetimefi
eldofRouterAdvertisementssentfromtheinterface,inseconds.MUSTbeeitherzeroorbetwee
nMaxRtrAdvIntervaland9000seconds.Avalueofzeroindicatesthattherouterisnottobeused
asadefaultrouter.Default:3*MaxRtrAdvInterval*/intAdvDefaultLifetime;#defineRTADV
_MAX_RTRLIFETIME9000/*2.5hours*//*AlistofprefixestobeplacedinPrefixInformationop
tionsinRouterAdvertisementmessagessentfromtheinterface.Default:allprefixesthatth
erouteradvertisesviaroutingprotocolsasbeingon-linkfortheinterfacefromwhichtheadv
ertisementissent.Thelink-localprefixSHOULDNOTbeincludedinthelistofadvertisedpref
ixes.*/structlist*AdvPrefixList;/*TheTRUE/FALSEvaluetobeplacedinthe"Homeagent"fl
agfieldintheRouterAdvertisement.See[RFC62757.1].Default:FALSE*/intAdvHomeAgentFl
ag;#ifndefND_RA_FLAG_HOME_AGENT#defineND_RA_FLAG_HOME_AGENT0x20#endif/*Thevaluet
obeplacedinHomeAgentInformationoptionifHomeFlagisset.Default:0*/intHomeAgentPref
erence;/*ThevaluetobeplacedinHomeAgentInformationoptionifHomeFlagisset.Lifetime(
seconds)MUSTnotbegreaterthan18.2hours.Thevalue0hasspecialmeaning:useofAdvDefault
Lifetimevalue.Default:0*/intHomeAgentLifetime;#defineRTADV_MAX_HALIFETIME65520/*
18.2hours*//*TheTRUE/FALSEvaluetoinsertornotanAdvertisementIntervaloption.See[RF
C62757.3]Default:FALSE*/intAdvIntervalOption;/*ThevaluetobeplacedintheDefaultRou
terPreferencefieldofarouteradvertisement.See[RFC41912.1&2.2]Default:0(medium)*/i
ntDefaultPreference;#defineRTADV_PREF_MEDIUM0x0/*PerRFC4191.*/uint8_tinFastRexmi
t;/*Trueifwe'rerexmitsfasterthanusual*//*TrackifRAwasconfiguredbyBGPorbytheOpera
tororboth*/uint8_tra_configured;/*WasRAconfigured?*/#defineBGP_RA_CONFIGURED(1<<
0)/*BGPconfiguredRA?*/#defineVTY_RA_CONFIGURED(1<<1)/*OperatorconfiguredRA?*/#de
fineVTY_RA_INTERVAL_CONFIGURED(1<<2)/*OperatorconfiguredRAinterval*/intNumFastRe
XmitsRemain;/*Loadedfirstwithnumberoffastrexmitstodo*/#defineRTADV_FAST_REXMIT_P
ERIOD1/*1sec*/#defineRTADV_NUM_FAST_REXMITS4/*FastRexmitRA4timesoncertainevents*
/};#endif/*HAVE_RTADV*//*Zebrainterfacetype-onesofinterest.*/typedefenum{ZEBRA_I
F_OTHER=0,/*Anythingelse*/ZEBRA_IF_VXLAN,/*VxLANinterface*/ZEBRA_IF_VRF,/*VRFdev
ice*/ZEBRA_IF_BRIDGE,/*bridgedevice*/ZEBRA_IF_VLAN,/*VLANsub-interface*/ZEBRA_IF
_MACVLAN,/*MACVLANinterface*/}zebra_iftype_t;/*Zebra"slave"interfacetype*/typede
fenum{ZEBRA_IF_SLAVE_NONE,/*Notaslave*/ZEBRA_IF_SLAVE_VRF,/*MemberofaVRF*/ZEBRA_
IF_SLAVE_BRIDGE,/*Memberofabridge*/ZEBRA_IF_SLAVE_OTHER,/*Somethingelse-e.g.,bon
dslave*/}zebra_slave_iftype_t;structirdp_interface;/*`zebra'daemonlocalinterface
structure.*/structzebra_if{/*Shutdownconfiguration.*/uint8_tshutdown;/*Multicast
configuration.*/uint8_tmulticast;/*Routeradvertiseconfiguration.*/uint8_trtadv_e
nable;/*Installedaddresseschainstree.*/structroute_table*ipv4_subnets;/*Informat
ionaboutup/downchanges*/unsignedintup_count;charup_last[QUAGGA_TIMESTAMP_LEN];un
signedintdown_count;chardown_last[QUAGGA_TIMESTAMP_LEN];#ifdefined(HAVE_RTADV)st
ructrtadvconfrtadv;unsignedintra_sent,ra_rcvd;#endif/*HAVE_RTADV*/structirdp_int
erface*irdp;#ifdefHAVE_STRUCT_SOCKADDR_DLunion{/*notethatsdl_storageisneveracces
sed,itonlyexiststo*makespace.*allactualusesrefertosdl-butusesizeof(sdl_storage)!
*thisfits*bestwithCaliasingrules.*/structsockaddr_dlsdl;structsockaddr_storagesd
l_storage;};#endif#ifdefSUNOS_5/*therealIFF_UPstateoftheprimaryinterface.*needth
istodifferentiatebetweenallinterfacesbeing*down(butprimarystillplumbed)andprimar
yhavinggone*~IFF_UP,andalladdressesgone.*/uint8_tprimary_state;#endif/*SUNOS_5*/
/*ptmenableconfiguration*/uint8_tptm_enable;/*Zebrainterfaceand"slave"interfacet
ype*/zebra_iftype_tzif_type;zebra_slave_iftype_tzif_slave_type;/*AdditionalL2inf
o,dependsonzif_type*/unionzebra_l2if_infol2info;/*Formembersofabridge,linktobrid
ge.*//*Note:Ifadditionalfieldsbecomenecessary,thiscanbemodifiedto*beapointertoad
ynamicallyallocdstruct.*/structzebra_l2info_brslavebrslave_info;/*Linkfields-for
sub-interfaces.*/ifindex_tlink_ifindex;structinterface*link;structthread*speed_u
pdate;};DECLARE_HOOK(zebra_if_extra_info,(structvty*vty,structinterface*ifp),(vt
y,ifp))DECLARE_HOOK(zebra_if_config_wr,(structvty*vty,structinterface*ifp),(vty,
ifp))staticinlinevoidzebra_if_set_ziftype(structinterface*ifp,zebra_iftype_tzif_
type,zebra_slave_iftype_tzif_slave_type){structzebra_if*zif;zif=(structzebra_if*
)ifp->info;zif->zif_type=zif_type;zif->zif_slave_type=zif_slave_type;}#defineIS_
ZEBRA_IF_VRF(ifp)\(((structzebra_if*)(ifp->info))->zif_type==ZEBRA_IF_VRF)#defin
eIS_ZEBRA_IF_BRIDGE(ifp)\(((structzebra_if*)(ifp->info))->zif_type==ZEBRA_IF_BRI
DGE)#defineIS_ZEBRA_IF_VLAN(ifp)\(((structzebra_if*)(ifp->info))->zif_type==ZEBR
A_IF_VLAN)#defineIS_ZEBRA_IF_VXLAN(ifp)\(((structzebra_if*)(ifp->info))->zif_typ
e==ZEBRA_IF_VXLAN)#defineIS_ZEBRA_IF_MACVLAN(ifp)\(((structzebra_if*)(ifp->info)
)->zif_type==ZEBRA_IF_MACVLAN)#defineIS_ZEBRA_IF_BRIDGE_SLAVE(ifp)\(((structzebr
a_if*)(ifp->info))->zif_slave_type\==ZEBRA_IF_SLAVE_BRIDGE)#defineIS_ZEBRA_IF_VR
F_SLAVE(ifp)\(((structzebra_if*)(ifp->info))->zif_slave_type==ZEBRA_IF_SLAVE_VRF
)externvoidzebra_if_init(void);externstructinterface*if_lookup_by_index_per_ns(s
tructzebra_ns*,uint32_t);externstructinterface*if_lookup_by_name_per_ns(structze
bra_ns*,constchar*);externstructinterface*if_link_per_ns(structzebra_ns*,structi
nterface*);externconstchar*ifindex2ifname_per_ns(structzebra_ns*,unsignedint);ex
ternvoidif_unlink_per_ns(structinterface*);externvoidif_nbr_ipv6ll_to_ipv4ll_nei
gh_update(structinterface*ifp,structin6_addr*address,intadd);externvoidif_nbr_ip
v6ll_to_ipv4ll_neigh_del_all(structinterface*ifp);externvoidif_delete_update(str
uctinterface*ifp);externvoidif_add_update(structinterface*ifp);externvoidif_up(s
tructinterface*);externvoidif_down(structinterface*);externvoidif_refresh(struct
interface*);externvoidif_flags_update(structinterface*,uint64_t);externintif_sub
net_add(structinterface*,structconnected*);externintif_subnet_delete(structinter
face*,structconnected*);externintipv6_address_configured(structinterface*ifp);ex
ternvoidif_handle_vrf_change(structinterface*ifp,vrf_id_tvrf_id);externvoidzebra
_if_update_link(structinterface*ifp,ifindex_tlink_ifindex);externvoidvrf_add_upd
ate(structvrf*vrfp);#ifdefHAVE_PROC_NET_DEVexternvoidifstat_update_proc(void);#e
ndif/*HAVE_PROC_NET_DEV*/#ifdefHAVE_NET_RT_IFLISTexternvoidifstat_update_sysctl(
void);#endif/*HAVE_NET_RT_IFLIST*/#ifdefHAVE_PROC_NET_DEVexternintinterface_list
_proc(void);#endif/*HAVE_PROC_NET_DEV*/#ifdefHAVE_PROC_NET_IF_INET6externintifad
dr_proc_ipv6(void);#endif/*HAVE_PROC_NET_IF_INET6*/#endif/*_ZEBRA_INTERFACE_H*/