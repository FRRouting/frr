/**qpb.h**@copyrightCopyright(C)2016SprouteNetworks,Inc.**@authorAvneeshSachdev<
avneesh@sproute.com>**ThisfileispartofQuagga.**Quaggaisfreesoftware;youcanredist
ributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspublishedbythe
*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*laterversion.**Quagga
isdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheim
pliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralP
ublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLice
nsealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundati
on,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*//**Mainpublicheaderfilef
orthequaggaprotobuflibrary.*/#ifndef_QPB_H#define_QPB_H#include"prefix.h"#includ
e"qpb/qpb.pb-c.h"#include"qpb/qpb_allocator.h"/**qpb__address_family__set*/#defi
neqpb_address_family_setqpb__address_family__setstaticinlineintqpb__address_fami
ly__set(Qpb__AddressFamily*pb_family,uint8_tfamily){switch(family){caseAF_INET:*
pb_family=QPB__ADDRESS_FAMILY__IPV4;return1;caseAF_INET6:*pb_family=QPB__ADDRESS
_FAMILY__IPV6;return1;default:*pb_family=QPB__ADDRESS_FAMILY__UNKNOWN_AF;}return
0;}/**qpb__address_family__get*/#defineqpb_address_family_getqpb__address_family
__getstaticinlineintqpb__address_family__get(Qpb__AddressFamilypb_family,uint8_t
*family){switch(pb_family){caseQPB__ADDRESS_FAMILY__IPV4:*family=AF_INET;return1
;caseQPB__ADDRESS_FAMILY__IPV6:*family=AF_INET6;return1;caseQPB__ADDRESS_FAMILY_
_UNKNOWN_AF:return0;default:/*protobuf"magicvalue"_QPB__ADDRESS_FAMILY_IS_INT_SI
ZE*/return0;}return0;}/**qpb__l3_prefix__create*/#defineqpb_l3_prefix_createqpb_
_l3_prefix__createstaticinlineQpb__L3Prefix*qpb__l3_prefix__create(qpb_allocator
_t*allocator,structprefix*p){Qpb__L3Prefix*prefix;prefix=QPB_ALLOC(allocator,typ
eof(*prefix));if(!prefix){returnNULL;}qpb__l3_prefix__init(prefix);prefix->lengt
h=p->prefixlen;prefix->bytes.len=(p->prefixlen+7)/8;prefix->bytes.data=qpb_alloc
(allocator,prefix->bytes.len);if(!prefix->bytes.data){returnNULL;}memcpy(prefix-
>bytes.data,&p->u.prefix,prefix->bytes.len);returnprefix;}/**qpb__l3_prefix__get
*/#defineqpb_l3_prefix_getqpb__l3_prefix__getstaticinlineintqpb__l3_prefix__get(
constQpb__L3Prefix*pb_prefix,uint8_tfamily,structprefix*prefix){switch(family){c
aseAF_INET:memset(prefix,0,sizeof(structprefix_ipv4));break;caseAF_INET6:memset(
prefix,0,sizeof(structprefix_ipv6));break;default:memset(prefix,0,sizeof(*prefix
));}prefix->prefixlen=pb_prefix->length;prefix->family=family;memcpy(&prefix->u.
prefix,pb_prefix->bytes.data,pb_prefix->bytes.len);return1;}/**qpb__protocol__se
t**Translateaquaggaroutetypetoaprotobufprotocol.*/#defineqpb_protocol_setqpb__pr
otocol__setstaticinlineintqpb__protocol__set(Qpb__Protocol*pb_proto,introute_typ
e){switch(route_type){caseZEBRA_ROUTE_KERNEL:*pb_proto=QPB__PROTOCOL__KERNEL;bre
ak;caseZEBRA_ROUTE_CONNECT:*pb_proto=QPB__PROTOCOL__CONNECTED;break;caseZEBRA_RO
UTE_STATIC:*pb_proto=QPB__PROTOCOL__STATIC;break;caseZEBRA_ROUTE_RIP:*pb_proto=Q
PB__PROTOCOL__RIP;break;caseZEBRA_ROUTE_RIPNG:*pb_proto=QPB__PROTOCOL__RIPNG;bre
ak;caseZEBRA_ROUTE_OSPF:caseZEBRA_ROUTE_OSPF6:*pb_proto=QPB__PROTOCOL__OSPF;brea
k;caseZEBRA_ROUTE_ISIS:*pb_proto=QPB__PROTOCOL__ISIS;break;caseZEBRA_ROUTE_BGP:*
pb_proto=QPB__PROTOCOL__BGP;break;caseZEBRA_ROUTE_HSLS:caseZEBRA_ROUTE_OLSR:case
ZEBRA_ROUTE_MAX:caseZEBRA_ROUTE_SYSTEM:default:*pb_proto=QPB__PROTOCOL__OTHER;}r
eturn1;}/**qpb__ipv4_address__create*/staticinlineQpb__Ipv4Address*qpb__ipv4_add
ress__create(qpb_allocator_t*allocator,structin_addr*addr){Qpb__Ipv4Address*v4;v
4=QPB_ALLOC(allocator,typeof(*v4));if(!v4){returnNULL;}qpb__ipv4_address__init(v
4);v4->value=ntohl(addr->s_addr);returnv4;}/**qpb__ipv4_address__get*/staticinli
neintqpb__ipv4_address__get(constQpb__Ipv4Address*v4,structin_addr*addr){addr->s
_addr=htonl(v4->value);return1;}/**qpb__ipv6_address__create*/staticinlineQpb__I
pv6Address*qpb__ipv6_address__create(qpb_allocator_t*allocator,structin6_addr*ad
dr){Qpb__Ipv6Address*v6;v6=QPB_ALLOC(allocator,typeof(*v6));if(!v6)returnNULL;qp
b__ipv6_address__init(v6);v6->bytes.len=16;v6->bytes.data=qpb_alloc(allocator,16
);if(!v6->bytes.data)returnNULL;memcpy(v6->bytes.data,addr->s6_addr,v6->bytes.le
n);returnv6;}/**qpb__ipv6_address__get**Readoutinformationfromaprotobufipv6addre
ssstructure.*/staticinlineintqpb__ipv6_address__get(constQpb__Ipv6Address*v6,str
uctin6_addr*addr){if(v6->bytes.len!=16)return0;memcpy(addr->s6_addr,v6->bytes.da
ta,v6->bytes.len);return1;}/**qpb__l3_address__create*/#defineqpb_l3_address_cre
ateqpb__l3_address__createstaticinlineQpb__L3Address*qpb__l3_address__create(qpb
_allocator_t*allocator,uniong_addr*addr,uint8_tfamily){Qpb__L3Address*l3_addr;l3
_addr=QPB_ALLOC(allocator,typeof(*l3_addr));if(!l3_addr)returnNULL;qpb__l3_addre
ss__init(l3_addr);switch(family){caseAF_INET:l3_addr->v4=qpb__ipv4_address__crea
te(allocator,&addr->ipv4);if(!l3_addr->v4)returnNULL;break;caseAF_INET6:l3_addr-
>v6=qpb__ipv6_address__create(allocator,&addr->ipv6);if(!l3_addr->v6)returnNULL;
break;}returnl3_addr;}/**qpb__l3_address__get**Readoutagatewayaddressfromaprotob
ufl3address.*/#defineqpb_l3_address_getqpb__l3_address__getstaticinlineintqpb__l
3_address__get(constQpb__L3Address*l3_addr,uint8_t*family,uniong_addr*addr){if(l
3_addr->v4){qpb__ipv4_address__get(l3_addr->v4,&addr->ipv4);*family=AF_INET;retu
rn1;}if(l3_addr->v6){qpb__ipv6_address__get(l3_addr->v6,&addr->ipv6);*family=AF_
INET6;return1;}return0;}/**qpb__if_identifier__create*/#defineqpb_if_identifier_
createqpb__if_identifier__createstaticinlineQpb__IfIdentifier*qpb__if_identifier
__create(qpb_allocator_t*allocator,uintif_index){Qpb__IfIdentifier*if_id;if_id=Q
PB_ALLOC(allocator,typeof(*if_id));if(!if_id){returnNULL;}qpb__if_identifier__in
it(if_id);if_id->has_index=1;if_id->index=if_index;returnif_id;}/**qpb__if_ident
ifier__get**Getinterfacenameand/orif_indexfromanifidentifier.*/#defineqpb_if_ide
ntifier_getqpb__if_identifier__getstaticinlineintqpb__if_identifier__get(Qpb__If
Identifier*if_id,uint*if_index,char**name){char*str;uintix;if(!if_index)if_index
=&ix;if(!name)name=&str;if(if_id->has_index)*if_index=if_id->index;else*if_index
=0;*name=if_id->name;return1;}#endif