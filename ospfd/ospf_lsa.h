/**OSPFLinkStateAdvertisement*Copyright(C)1999,2000ToshiakiTakada**Thisfileispar
tofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underthe
termsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eitherv
ersion2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatitw
illbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILI
TYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**
YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seet
hefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFlo
or,Boston,MA02110-1301USA*/#ifndef_ZEBRA_OSPF_LSA_H#define_ZEBRA_OSPF_LSA_H#incl
ude"stream.h"/*OSPFLSARangedefinition.*/#defineOSPF_MIN_LSA1/*beginrangehere*/#d
efineOSPF_MAX_LSA12/*OSPFLSATypedefinition.*/#defineOSPF_UNKNOWN_LSA0#defineOSPF
_ROUTER_LSA1#defineOSPF_NETWORK_LSA2#defineOSPF_SUMMARY_LSA3#defineOSPF_ASBR_SUM
MARY_LSA4#defineOSPF_AS_EXTERNAL_LSA5#defineOSPF_GROUP_MEMBER_LSA6/*Notsupported
.*/#defineOSPF_AS_NSSA_LSA7#defineOSPF_EXTERNAL_ATTRIBUTES_LSA8/*Notsupported.*/
#defineOSPF_OPAQUE_LINK_LSA9#defineOSPF_OPAQUE_AREA_LSA10#defineOSPF_OPAQUE_AS_L
SA11#defineOSPF_LSA_HEADER_SIZE20U#defineOSPF_ROUTER_LSA_LINK_SIZE12U#defineOSPF
_ROUTER_LSA_TOS_SIZE4U#defineOSPF_MAX_LSA_SIZE1500U/*AS-external-LSArefreshmetho
d.*/#defineLSA_REFRESH_IF_CHANGED0#defineLSA_REFRESH_FORCE1/*OSPFLSAheader.*/str
uctlsa_header{uint16_tls_age;uint8_toptions;uint8_ttype;structin_addrid;structin
_addradv_router;uint32_tls_seqnum;uint16_tchecksum;uint16_tlength;};/*OSPFLSA.*/
structospf_lsa{/*LSAoriginationflag.*/uint8_tflags;#defineOSPF_LSA_SELF0x01#defi
neOSPF_LSA_SELF_CHECKED0x02#defineOSPF_LSA_RECEIVED0x04#defineOSPF_LSA_APPROVED0
x08#defineOSPF_LSA_DISCARD0x10#defineOSPF_LSA_LOCAL_XLT0x20#defineOSPF_LSA_PREMA
TURE_AGE0x40#defineOSPF_LSA_IN_MAXAGE0x80/*LSAdata.*/structlsa_header*data;/*Rec
eivedtimestamp.*/structtimevaltv_recv;/*Lasttimeitwasoriginated*/structtimevaltv
_orig;/*Allofreferencecount,alsolocktoremove.*/intlock;/*FlagsfortheSPFcalculati
on.*/intstat;#defineLSA_SPF_NOT_EXPLORED-1#defineLSA_SPF_IN_SPFTREE-2/*Ifstat>=0
,statisLSApositionincandidatesheap.*//*ReferencestothisLSAinneighborretransmissi
onlists*/intretransmit_counter;/*AreatheLSAbelongsto,maybeNULLifAS-external-LSA.
*/structospf_area*area;/*ParentLSDB.*/structospf_lsdb*lsdb;/*RelatedRoute.*/void
*route;/*RefreshementListorQueue*/intrefresh_list;/*ForType-9Opaque-LSAs*/struct
ospf_interface*oi;/*VRFId*/vrf_id_tvrf_id;};/*OSPFLSALinkType.*/#defineLSA_LINK_
TYPE_POINTOPOINT1#defineLSA_LINK_TYPE_TRANSIT2#defineLSA_LINK_TYPE_STUB3#defineL
SA_LINK_TYPE_VIRTUALLINK4/*OSPFRouterLSAFlag.*/#defineROUTER_LSA_BORDER0x01/*The
routerisanABR*/#defineROUTER_LSA_EXTERNAL0x02/*TherouterisanASBR*/#defineROUTER_
LSA_VIRTUAL0x04/*TherouterhasaVLinthisarea*/#defineROUTER_LSA_NT0x10/*Therouters
alwaystranslatesType-7*/#defineROUTER_LSA_SHORTCUT0x20/*Shortcut-ABRspecificflag
*/#defineIS_ROUTER_LSA_VIRTUAL(x)((x)->flags&ROUTER_LSA_VIRTUAL)#defineIS_ROUTER
_LSA_EXTERNAL(x)((x)->flags&ROUTER_LSA_EXTERNAL)#defineIS_ROUTER_LSA_BORDER(x)((
x)->flags&ROUTER_LSA_BORDER)#defineIS_ROUTER_LSA_SHORTCUT(x)((x)->flags&ROUTER_L
SA_SHORTCUT)#defineIS_ROUTER_LSA_NT(x)((x)->flags&ROUTER_LSA_NT)/*OSPFRouter-LSA
Linkinformation.*/structrouter_lsa_link{structin_addrlink_id;structin_addrlink_d
ata;struct{uint8_ttype;uint8_ttos_count;uint16_tmetric;}m[1];};/*OSPFRouter-LSAs
structure.*/#defineOSPF_ROUTER_LSA_MIN_SIZE4U/*w/0linkdescriptors*//*Thereisaned
gecase,whennumberoflinksinaRouter-LSAmaybe0withoutbreakingthespecification.Arout
er,whichhasnootherlinkstobackboneareabesidesonevirtuallink,willnotputanyVLdescri
ptorblocksintotheRouter-LSAgeneratedforarea0untilafulladjacencyovertheVLisreache
d(RFC232812.4.1.3).InthiscasetheRouter-LSAinitiallyreceivedbytheotherendoftheVLw
illhave0linkdescriptorblocks,butsoonwillbereplacedwiththenextrevisionhaving1desc
riptorblock.*/structrouter_lsa{structlsa_headerheader;uint8_tflags;uint8_tzero;u
int16_tlinks;struct{structin_addrlink_id;structin_addrlink_data;uint8_ttype;uint
8_ttos;uint16_tmetric;}link[1];};/*OSPFNetwork-LSAsstructure.*/#defineOSPF_NETWO
RK_LSA_MIN_SIZE8U/*w/1router-ID*/structnetwork_lsa{structlsa_headerheader;struct
in_addrmask;structin_addrrouters[1];};/*OSPFSummary-LSAsstructure.*/#defineOSPF_
SUMMARY_LSA_MIN_SIZE8U/*w/1TOSmetricblock*/structsummary_lsa{structlsa_headerhea
der;structin_addrmask;uint8_ttos;uint8_tmetric[3];};/*OSPFAS-external-LSAsstruct
ure.*/#defineOSPF_AS_EXTERNAL_LSA_MIN_SIZE16U/*w/1TOSforwardingblock*/structas_e
xternal_lsa{structlsa_headerheader;structin_addrmask;struct{uint8_ttos;uint8_tme
tric[3];structin_addrfwd_addr;uint32_troute_tag;}e[1];};#include"ospfd/ospf_opaq
ue.h"/*Macros.*/#defineGET_METRIC(x)get_metric(x)#defineIS_EXTERNAL_METRIC(x)((x
)&0x80)#defineGET_AGE(x)(ntohs((x)->data->ls_age)+time(NULL)-(x)->tv_recv)#defin
eLS_AGE(x)(OSPF_LSA_MAXAGE<get_age(x)?OSPF_LSA_MAXAGE:get_age(x))#defineIS_LSA_S
ELF(L)(CHECK_FLAG((L)->flags,OSPF_LSA_SELF))#defineIS_LSA_MAXAGE(L)(LS_AGE((L))=
=OSPF_LSA_MAXAGE)#defineOSPF_LSA_UPDATE_DELAY2#defineOSPF_LSA_UPDATE_TIMER_ON(T,
F)\if(!(T))\(T)=thread_add_timer(master,(F),0,2)/*Prototypes.*//*XXX:Eek,timefun
ctions,similarareinlib/thread.c*/externstructtimevalint2tv(int);externstructtime
valmsec2tv(int);externintget_age(structospf_lsa*);externuint16_tospf_lsa_checksu
m(structlsa_header*);externintospf_lsa_checksum_valid(structlsa_header*);externi
ntospf_lsa_refresh_delay(structospf_lsa*);externconstchar*dump_lsa_key(structosp
f_lsa*);externuint32_tlsa_seqnum_increment(structospf_lsa*);externvoidlsa_header
_set(structstream*,uint8_t,uint8_t,structin_addr,structin_addr);externstructospf
_neighbor*ospf_nbr_lookup_ptop(structospf_interface*);externintospf_check_nbr_st
atus(structospf*);/*PrototypeforLSAprimitive.*/externstructospf_lsa*ospf_lsa_new
(void);externstructospf_lsa*ospf_lsa_dup(structospf_lsa*);externvoidospf_lsa_fre
e(structospf_lsa*);externstructospf_lsa*ospf_lsa_lock(structospf_lsa*);externvoi
dospf_lsa_unlock(structospf_lsa**);externvoidospf_lsa_discard(structospf_lsa*);e
xternintospf_lsa_flush_schedule(structospf*,structospf_lsa*);externstructlsa_hea
der*ospf_lsa_data_new(size_t);externstructlsa_header*ospf_lsa_data_dup(structlsa
_header*);externvoidospf_lsa_data_free(structlsa_header*);/*PrototypeforvariousL
SAs*/externintospf_router_lsa_update(structospf*);externintospf_router_lsa_updat
e_area(structospf_area*);externvoidospf_network_lsa_update(structospf_interface*
);externstructospf_lsa*ospf_summary_lsa_originate(structprefix_ipv4*,uint32_t,st
ructospf_area*);externstructospf_lsa*ospf_summary_asbr_lsa_originate(structprefi
x_ipv4*,uint32_t,structospf_area*);externstructospf_lsa*ospf_lsa_install(structo
spf*,structospf_interface*,structospf_lsa*);externvoidospf_nssa_lsa_flush(struct
ospf*ospf,structprefix_ipv4*p);externvoidospf_external_lsa_flush(structospf*,uin
t8_t,structprefix_ipv4*,ifindex_t/*,structin_addrnexthop*/);externstructin_addro
spf_get_ip_from_ifp(structospf_interface*);externstructospf_lsa*ospf_external_ls
a_originate(structospf*,structexternal_info*);externintospf_external_lsa_origina
te_timer(structthread*);externintospf_default_originate_timer(structthread*);ext
ernstructospf_lsa*ospf_lsa_lookup(structospf*ospf,structospf_area*,uint32_t,stru
ctin_addr,structin_addr);externstructospf_lsa*ospf_lsa_lookup_by_id(structospf_a
rea*,uint32_t,structin_addr);externstructospf_lsa*ospf_lsa_lookup_by_header(stru
ctospf_area*,structlsa_header*);externintospf_lsa_more_recent(structospf_lsa*,st
ructospf_lsa*);externintospf_lsa_different(structospf_lsa*,structospf_lsa*);exte
rnvoidospf_flush_self_originated_lsas_now(structospf*);externintospf_lsa_is_self
_originated(structospf*,structospf_lsa*);externstructospf_lsa*ospf_lsa_lookup_by
_prefix(structospf_lsdb*,uint8_t,structprefix_ipv4*,structin_addr);externvoidosp
f_lsa_maxage(structospf*,structospf_lsa*);externuint32_tget_metric(uint8_t*);ext
ernintospf_lsa_maxage_walker(structthread*);externstructospf_lsa*ospf_lsa_refres
h(structospf*,structospf_lsa*);externvoidospf_external_lsa_refresh_default(struc
tospf*);externvoidospf_external_lsa_refresh_type(structospf*,uint8_t,unsignedsho
rt,int);externstructospf_lsa*ospf_external_lsa_refresh(structospf*,structospf_ls
a*,structexternal_info*,int);externstructin_addrospf_lsa_unique_id(structospf*,s
tructospf_lsdb*,uint8_t,structprefix_ipv4*);externvoidospf_schedule_lsa_flood_ar
ea(structospf_area*,structospf_lsa*);externvoidospf_schedule_lsa_flush_area(stru
ctospf_area*,structospf_lsa*);externvoidospf_refresher_register_lsa(structospf*,
structospf_lsa*);externvoidospf_refresher_unregister_lsa(structospf*,structospf_
lsa*);externintospf_lsa_refresh_walker(structthread*);externvoidospf_lsa_maxage_
delete(structospf*,structospf_lsa*);externvoidospf_discard_from_db(structospf*,s
tructospf_lsdb*,structospf_lsa*);externintis_prefix_default(structprefix_ipv4*);
externintmetric_type(structospf*,uint8_t,unsignedshort);externintmetric_value(st
ructospf*,uint8_t,unsignedshort);externstructin_addrospf_get_nssa_ip(structospf_
area*);externintospf_translated_nssa_compare(structospf_lsa*,structospf_lsa*);ex
ternstructospf_lsa*ospf_translated_nssa_refresh(structospf*,structospf_lsa*,stru
ctospf_lsa*);externstructospf_lsa*ospf_translated_nssa_originate(structospf*,str
uctospf_lsa*);#endif/*_ZEBRA_OSPF_LSA_H*/