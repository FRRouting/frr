/**OSPFSendingandReceivingOSPFPackets.*Copyright(C)1999ToshiakiTakada**Thisfilei
spartofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*unde
rthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;eit
herversion2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopetha
titwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTA
BILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetail
s.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;
seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,Fift
hFloor,Boston,MA02110-1301USA*/#ifndef_ZEBRA_OSPF_PACKET_H#define_ZEBRA_OSPF_PAC
KET_H#defineOSPF_HEADER_SIZE24U#defineOSPF_AUTH_SIMPLE_SIZE8U#defineOSPF_AUTH_MD
5_SIZE16U#defineOSPF_MAX_PACKET_SIZE65535U/*includesIPHeadersize.*/#defineOSPF_H
ELLO_MIN_SIZE20U/*notincludingneighbors*/#defineOSPF_DB_DESC_MIN_SIZE8U#defineOS
PF_LS_REQ_MIN_SIZE0U#defineOSPF_LS_UPD_MIN_SIZE4U#defineOSPF_LS_ACK_MIN_SIZE0U#d
efineOSPF_MSG_HELLO1/*OSPFHelloMessage.*/#defineOSPF_MSG_DB_DESC2/*OSPFDatabaseD
escriptoinMessage.*/#defineOSPF_MSG_LS_REQ3/*OSPFLinkStateRequestMessage.*/#defi
neOSPF_MSG_LS_UPD4/*OSPFLinkStateUpdateMessage.*/#defineOSPF_MSG_LS_ACK5/*OSPFLi
nkStateAcknoledgementMessage.*/#defineOSPF_SEND_PACKET_DIRECT1#defineOSPF_SEND_P
ACKET_INDIRECT2#defineOSPF_SEND_PACKET_LOOP3#defineOSPF_HELLO_REPLY_DELAY1/*Retu
rnvaluesoffunctionsinvolvedinpacketverification,seeospf6d.*/#defineMSG_OK0#defin
eMSG_NG1structospf_packet{structospf_packet*next;/*Pointertodatastream.*/structs
tream*s;/*IPdestinationaddress.*/structin_addrdst;/*OSPFpacketlength.*/uint16_tl
ength;};/*OSPFpacketqueuestructure.*/structospf_fifo{unsignedlongcount;structosp
f_packet*head;structospf_packet*tail;};/*OSPFpacketheaderstructure.*/structospf_
header{uint8_tversion;/*OSPFVersion.*/uint8_ttype;/*PacketType.*/uint16_tlength;
/*PacketLength.*/structin_addrrouter_id;/*RouterID.*/structin_addrarea_id;/*Area
ID.*/uint16_tchecksum;/*CheckSum.*/uint16_tauth_type;/*AuthenticationType.*//*Au
thenticationData.*/union{/*SimpleAuthentication.*/uint8_tauth_data[OSPF_AUTH_SIM
PLE_SIZE];/*CryptographicAuthentication.*/struct{uint16_tzero;/*Shouldbe0.*/uint
8_tkey_id;/*KeyID.*/uint8_tauth_data_len;/*AuthDataLength.*/uint32_tcrypt_seqnum
;/*CryptographicSequenceNumber.*/}crypt;}u;};/*OSPFHellobodyformat.*/structospf_
hello{structin_addrnetwork_mask;uint16_thello_interval;uint8_toptions;uint8_tpri
ority;uint32_tdead_interval;structin_addrd_router;structin_addrbd_router;structi
n_addrneighbors[1];};/*OSPFDatabaseDescriptionbodyformat.*/structospf_db_desc{ui
nt16_tmtu;uint8_toptions;uint8_tflags;uint32_tdd_seqnum;};structospf_ls_update{u
int32_tnum_lsas;};/*Macros.*//*XXXPerhapsobsolete;functioninospf_packet.c*/#defi
neOSPF_PACKET_MAX(oi)ospf_packet_max(oi)#defineOSPF_OUTPUT_PNT(S)((S)->data+(S)-
>putp)#defineOSPF_OUTPUT_LENGTH(S)((S)->endp)#defineIS_SET_DD_MS(X)((X)&OSPF_DD_
FLAG_MS)#defineIS_SET_DD_M(X)((X)&OSPF_DD_FLAG_M)#defineIS_SET_DD_I(X)((X)&OSPF_
DD_FLAG_I)#defineIS_SET_DD_ALL(X)((X)&OSPF_DD_FLAG_ALL)/*Prototypes.*/externvoid
ospf_output_forward(structstream*,int);externstructospf_packet*ospf_packet_new(s
ize_t);externvoidospf_packet_free(structospf_packet*);externstructospf_fifo*ospf
_fifo_new(void);externvoidospf_fifo_push(structospf_fifo*,structospf_packet*);ex
ternstructospf_packet*ospf_fifo_pop(structospf_fifo*);externstructospf_packet*os
pf_fifo_head(structospf_fifo*);externvoidospf_fifo_flush(structospf_fifo*);exter
nvoidospf_fifo_free(structospf_fifo*);externvoidospf_packet_add(structospf_inter
face*,structospf_packet*);externvoidospf_packet_delete(structospf_interface*);ex
ternstructstream*ospf_stream_dup(structstream*);externstructospf_packet*ospf_pac
ket_dup(structospf_packet*);externintospf_read(structthread*);externvoidospf_hel
lo_send(structospf_interface*);externvoidospf_db_desc_send(structospf_neighbor*)
;externvoidospf_db_desc_resend(structospf_neighbor*);externvoidospf_ls_req_send(
structospf_neighbor*);externvoidospf_ls_upd_send_lsa(structospf_neighbor*,struct
ospf_lsa*,int);externvoidospf_ls_upd_send(structospf_neighbor*,structlist*,int,i
nt);externvoidospf_ls_ack_send(structospf_neighbor*,structospf_lsa*);externvoido
spf_ls_ack_send_delayed(structospf_interface*);externvoidospf_ls_retransmit(stru
ctospf_interface*,structospf_lsa*);externvoidospf_ls_req_event(structospf_neighb
or*);externintospf_ls_upd_timer(structthread*);externintospf_ls_ack_timer(struct
thread*);externintospf_poll_timer(structthread*);externintospf_hello_reply_timer
(structthread*);externconststructmessageospf_packet_type_str[];externconstsize_t
ospf_packet_type_str_max;externvoidospf_proactively_arp(structospf_neighbor*);#e
ndif/*_ZEBRA_OSPF_PACKET_H*/