/**ThisisanimplementationofRFC7684OSPFv2Prefix/LinkAttribute*Advertisement**Modu
lename:ExtendedPrefix/LinkOpaqueLSAheaderdefinition**Author:OlivierDugeon<olivie
r.dugeon@orange.com>*Author:AnselmeSawadogo<anselmesawadogo@gmail.com>**Copyrigh
t(C)2016-2018OrangeLabshttp://www.orange.com**Thisprogramisfreesoftware;youcanre
distributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspublishedb
ytheFree*SoftwareFoundation;eitherversion2oftheLicense,or(atyouroption)*anylater
version.**Thisprogramisdistributedinthehopethatitwillbeuseful,butWITHOUT*ANYWARR
ANTY;withouteventheimpliedwarrantyofMERCHANTABILITYor*FITNESSFORAPARTICULARPURPO
SE.SeetheGNUGeneralPublicLicensefor*moredetails.**Youshouldhavereceivedacopyofth
eGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetothe
FreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#if
ndef_FRR_OSPF_EXT_PREF_H_#define_FRR_OSPF_EXT_PREF_H_/**OpaqueLSA'slinkstateIDfo
rExtendedPrefix/Linkis*structuredasfollows.**241680*+--------+--------+--------+
--------+*|7/8|........|........|........|*+--------+--------+--------+--------+
*|<-Type->|<-------Instance------->|***Type:IANAhasassigned'7'forExtendedPrefixO
paqueLSA*and'8'forExtendedLinkOpaqueLSA*Instance:Usermayselectarbitrary24-bitval
uestoidentify*differentinstancesofExtendedPrefix/LinkOpaqueLSA**//**241680*+----
----+--------+--------+--------+---*|LSage|Options|10,11|A*+--------+--------+--
------+--------+|Standard(Opaque)LSAheader;*|7/8|Instance||*+--------+--------+-
-------+--------+|Type10or11areusedforExtended*|Advertisingrouter||PrefixOpaqueL
SA*+--------+--------+--------+--------+|*|LSsequencenumber||Type10onlyisusedfor
Extended*+--------+--------+--------+--------+|LinkOpaqueLSA*|LSchecksum|Length|
V*+--------+--------+--------+--------+---*|Type|Length|A*+--------+--------+---
-----+--------+|TLVpartforExtendedPrefix/Link*|||OpaqueLSA;*~Values...~|Valuesmi
ghtbestructuredasaset*||Vofsub-TLVs.*+--------+--------+--------+--------+---*//
*Globaluseconstantnumbers*/#defineMAX_LEGAL_EXT_INSTANCE_NUM(0xffff)#defineLEGAL
_EXT_INSTANCE_RANGE(i)(0<=(i)&&(i)<=0xffff)/*FlagstomanageExtendedLink/PrefixOpa
queLSA*/#defineEXT_LPFLG_LSA_INACTIVE0x00#defineEXT_LPFLG_LSA_ACTIVE0x01#defineE
XT_LPFLG_LSA_ENGAGED0x02#defineEXT_LPFLG_LSA_LOOKUP_DONE0x04#defineEXT_LPFLG_LSA
_FORCED_REFRESH0x08#defineEXT_LPFLG_FIB_ENTRY_SET0x10/**FollowingsectiondefinesT
LV(tag,length,value)structures,*usedinExtendedPrefix/LinkOpaqueLSA.*//*ExtendedP
refixTLVRouteTypes*/#defineEXT_TLV_PREF_ROUTE_UNSPEC0#defineEXT_TLV_PREF_ROUTE_I
NTRA_AREA1#defineEXT_TLV_PREF_ROUTE_INTER_AREA3#defineEXT_TLV_PREF_ROUTE_AS_EXT5
#defineEXT_TLV_PREF_ROUTE_NSSA_EXT7/**ExtendedPrefixandExtendedPrefixRangeTLVs'*
AddressfamilyflagforIPv4*/#defineEXT_TLV_PREF_AF_IPV40/*ExtendedPrefixTLVFlags*/
#defineEXT_TLV_PREF_AFLG0x80#defineEXT_TLV_PREF_NFLG0x40/*ExtendedPrefixRangeTLV
Flags*/#defineEXT_TLV_PREF_RANGE_IAFLG0x80/*EROsubtlvsFlags*/#defineEXT_SUBTLV_E
RO_LFLG0x80/*ExtendedPrefixTLVseeRFC7684section2.1*/#defineEXT_TLV_PREFIX1#defin
eEXT_TLV_PREFIX_SIZE8structext_tlv_prefix{structtlv_headerheader;uint8_troute_ty
pe;uint8_tpref_length;uint8_taf;uint8_tflags;structin_addraddress;};/*ExtendedLi
nkTLVseeRFC7684section3.1*/#defineEXT_TLV_LINK1#defineEXT_TLV_LINK_SIZE12structe
xt_tlv_link{structtlv_headerheader;uint8_tlink_type;uint8_treserved[3];structin_
addrlink_id;structin_addrlink_data;};/*RemoteInterfaceAddressSub-TLV,Ciscoexperi
mentaluseSub-TLV*/#defineEXT_SUBTLV_RMT_ITF_ADDR32768#defineEXT_SUBTLV_RMT_ITF_A
DDR_SIZE4structext_subtlv_rmt_itf_addr{structtlv_headerheader;structin_addrvalue
;};/*InternalstructuretomanageExtendedLink/PrefixOpaqueLSA*/structospf_ext_lp{bo
olenabled;/*FlagstomanagethisExtendedPrefix/LinkOpaqueLSA*/uint32_tflags;/**Scop
eisareaOpaqueType10orASOpaqueLSAType11for*ExtendedPrefixandareaOpaqueType10forEx
tendedLink*/uint8_tscope;/*areapointeriffloodingisType10NulliffloodingisASscope*
/structospf_area*area;structin_addrarea_id;/*ListofinterfacewithSegmentRoutingen
able*/structlist*iflist;};/*StructuretoaggregateinterfacesinformationforExtended
Prefix/Link*/structext_itf{/*24-bitOpaque-IDfieldvalueaccordingtoRFC7684specific
ation*/uint32_tinstance;uint8_ttype;/*ExtendedPrefix(7)orLink(8)*//*Referencepoi
ntertoaZebra-interface.*/structinterface*ifp;/*AreainfoinwhichthisSRlinkbelongst
o.*/structospf_area*area;/*Flagstomanagethislinkparameters.*/uint32_tflags;/*SID
type:Node,AdjacencyorLANAdjacency*/enumsid_typestype;/*extendedlink/prefixTLVinf
ormation*/structext_tlv_prefixprefix;structext_subtlv_prefix_sidnode_sid;structe
xt_tlv_linklink;structext_subtlv_adj_sidadj_sid[2];structext_subtlv_lan_adj_sidl
an_sid[2];/*ciscoexperimentalsubtlv*/structext_subtlv_rmt_itf_addrrmt_itf_addr;}
;/*Prototypes.*/externintospf_ext_init(void);externvoidospf_ext_term(void);exter
nvoidospf_ext_finish(void);externvoidospf_ext_update_sr(boolenable);externuint32
_tospf_ext_schedule_prefix_index(structinterface*ifp,uint32_tindex,structprefix_
ipv4*p,uint8_tflags);#endif/*_FRR_OSPF_EXT_PREF_H_*/