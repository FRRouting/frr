/**ThisisanimplementationofSegmentRouting*asperdraftdraft-ietf-ospf-segment-rout
ing-extensions-24**Modulename:SegmentRoutingheaderdefinitions**Author:OlivierDug
eon<olivier.dugeon@orange.com>*Author:AnselmeSawadogo<anselmesawadogo@gmail.com>
**Copyright(C)2016-2018OrangeLabshttp://www.orange.com**Thisprogramisfreesoftwar
e;youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseas
publishedbytheFree*SoftwareFoundation;eitherversion2oftheLicense,or(atyouroption
)*anylaterversion.**Thisprogramisdistributedinthehopethatitwillbeuseful,butWITHO
UT*ANYWARRANTY;withouteventheimpliedwarrantyofMERCHANTABILITYor*FITNESSFORAPARTI
CULARPURPOSE.SeetheGNUGeneralPublicLicensefor*moredetails.**Youshouldhavereceive
dacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,
writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-13
01USA*/#ifndef_FRR_OSPF_SR_H#define_FRR_OSPF_SR_H/*DefaultRoutepriorityforOSPFSe
gmentRouting*/#defineOSPF_SR_PRIORITY_DEFAULT10/*macrosandconstantsforsegmentrou
ting*/#defineSET_RANGE_SIZE_MASK0xffffff00#defineGET_RANGE_SIZE_MASK0x00ffffff#d
efineSET_LABEL_MASK0xffffff00#defineGET_LABEL_MASK0x00ffffff#defineSET_RANGE_SIZ
E(range_size)((range_size<<8)&SET_RANGE_SIZE_MASK)#defineGET_RANGE_SIZE(range_si
ze)((range_size>>8)&GET_RANGE_SIZE_MASK)#defineSET_LABEL(label)((label<<8)&SET_L
ABEL_MASK)#defineGET_LABEL(label)((label>>8)&GET_LABEL_MASK)/*LabelrangeforAdj-S
IDattributionpurpose.StartjustrightafterSRGB*/#defineADJ_SID_MINMPLS_DEFAULT_MAX
_SRGB_LABEL#defineADJ_SID_MAX(MPLS_DEFAULT_MAX_SRGB_LABEL+1000)#defineOSPF_SR_DE
FAULT_METRIC1/*SegmentRoutingTLVsasperdraft-ietf-ospf-segment-routing-extensions
-19*//*SegmentIDcouldbeaLabel(3bytes)oranIndex(4bytes)*/#defineSID_LABEL3#define
SID_LABEL_SIZE(U)(U-1)#defineSID_INDEX4#defineSID_INDEX_SIZE(U)(U)/*SID/LabelSub
TLV-section2.1*/#defineSUBTLV_SID_LABEL1#defineSUBTLV_SID_LABEL_SIZE8structsubtl
v_sid_label{/*Lengthis3(20rightmostbitsMPLSlabel)or4(32bitsSID)*/structtlv_heade
rheader;uint32_tvalue;};/**FollowingsectiondefinesSegmentRoutingTLV(tag,length,v
alue)*structures,usedinRouterInformationOpaqueLSA.*//*RISR-AlgorithmTLV-section3
.1*/#defineRI_SR_TLV_SR_ALGORITHM8structri_sr_tlv_sr_algorithm{structtlv_headerh
eader;#defineSR_ALGORITHM_SPF0#defineSR_ALGORITHM_STRICT_SPF1#defineSR_ALGORITHM
_UNSET255#defineALGORITHM_COUNT4/*Only4algorithmssupportedinthiscode*/uint8_tval
ue[ALGORITHM_COUNT];};/*RISID/LabelRangeTLV-section3.2*/#defineRI_SR_TLV_SID_LAB
EL_RANGE9structri_sr_tlv_sid_label_range{structtlv_headerheader;/*Only24uppermos
tbitsaresignificant*/#defineSID_RANGE_LABEL_LENGTH3uint32_tsize;/*ASID/Labelsub-
TLVwillfollow.*/structsubtlv_sid_labellower;};/*RINode/MSDTLVasperdraft-ietf-osp
f-segment-routing-msd-05*/#defineRI_SR_TLV_NODE_MSD12structri_sr_tlv_node_msd{st
ructtlv_headerheader;uint8_tsubtype;/*always=1*/uint8_tvalue;uint16_tpadding;};/
**FollowingsectiondefinesSegmentRoutingTLV(tag,length,value)*structures,usedinEx
tendedPrefix/LinkOpaqueLSA.*//*Adj-SIDandLAN-Ajd-SIDsubtlvs'flags*/#defineEXT_SU
BTLV_LINK_ADJ_SID_BFLG0x80#defineEXT_SUBTLV_LINK_ADJ_SID_VFLG0x40#defineEXT_SUBT
LV_LINK_ADJ_SID_LFLG0x20#defineEXT_SUBTLV_LINK_ADJ_SID_SFLG0x10/*PrefixSIDsubtlv
Flags*/#defineEXT_SUBTLV_PREFIX_SID_NPFLG0x40#defineEXT_SUBTLV_PREFIX_SID_MFLG0x
20#defineEXT_SUBTLV_PREFIX_SID_EFLG0x10#defineEXT_SUBTLV_PREFIX_SID_VFLG0x08#def
ineEXT_SUBTLV_PREFIX_SID_LFLG0x04/*SID/LabelBindingsubtlvFlags*/#defineEXT_SUBTL
V_SID_BINDING_MFLG0x80/*ExtendedPrefixRangeTLV-section4*/#defineEXT_TLV_PREF_RAN
GE2#defineEXT_SUBTLV_PREFIX_RANGE_SIZE12structext_tlv_prefix_range{structtlv_hea
derheader;uint8_tpref_length;uint8_taf;uint16_trange_size;uint8_tflags;uint8_tre
served[3];structin_addraddress;};/*PrefixSIDSub-TLV-section5*/#defineEXT_SUBTLV_
PREFIX_SID2#defineEXT_SUBTLV_PREFIX_SID_SIZE8structext_subtlv_prefix_sid{structt
lv_headerheader;uint8_tflags;uint8_treserved;uint8_tmtid;uint8_talgorithm;uint32
_tvalue;};/*Adj-SIDSub-TLV-section6.1*/#defineEXT_SUBTLV_ADJ_SID2#defineEXT_SUBT
LV_ADJ_SID_SIZE8structext_subtlv_adj_sid{structtlv_headerheader;uint8_tflags;uin
t8_treserved;uint8_tmtid;uint8_tweight;uint32_tvalue;};/*LANAdj-SIDSub-TLV-secti
on6.2*/#defineEXT_SUBTLV_LAN_ADJ_SID3#defineEXT_SUBTLV_LAN_ADJ_SID_SIZE12structe
xt_subtlv_lan_adj_sid{structtlv_headerheader;uint8_tflags;uint8_treserved;uint8_
tmtid;uint8_tweight;structin_addrneighbor_id;uint32_tvalue;};/**Followingsection
definestructureusedtomanageSegmentRouting*informationandTLVs/SubTLVs*//*Structur
eaggregatingSRGBinforetrievedfromanlsa*/structsr_srgb{uint32_trange_size;uint32_
tlower_bound;};/*SIDtypetomakedifferencebetweenloopbackinterfacesandothers*/enum
sid_type{PREF_SID,ADJ_SID,LAN_ADJ_SID};/*StructureaggregatingallOSPFSegmentRouti
nginformationforthenode*/structospf_sr_db{/*StatusofSegmentRouting:enableordisab
le*/boolenabled;/*OngoingUpdatefollowinganOSPFSPF*/boolupdate;/*FloodingScope:Ar
ea=10orAS=11*/uint8_tscope;/*FRRSRnode*/structsr_node*self;/*ListofneighbourSRno
des*/structhash*neighbors;/*ListofSRprefix*/structroute_table*prefix;/*LocalSRin
foannouncedinRouterInfoLSA*//*Algorithmssupportedbythenode*/uint8_talgo[ALGORITH
M_COUNT];/**SegmentRoutingGlobalBlocki.e.labelrange*Onlyonerangesupportedinthisc
ode*/structsr_srgbsrgb;/*MaximumSIDDepthsupportedbythenode*/uint8_tmsd;};/*Struc
tureaggregatingallreceivedSRinfofromLSAsbynode*/structsr_node{structin_addradv_r
outer;/*usedtoidentifysenderofLSA*//*24-bitOpaque-IDfieldvalueaccordingtoRFC7684
specification*/uint32_tinstance;uint8_talgo[ALGORITHM_COUNT];/*Algorithmssupport
edbythenode*//*SegmentRoutingGlobalBlocki.e.labelrange*/structsr_srgbsrgb;uint8_
tmsd;/*MaximumSIDDepth*//*ListofPrefix&Linkadvertisebythisnode*/structlist*ext_p
refix;/*ForNodeSID*/structlist*ext_link;/*ForAdjandLANSID*//*PointertoFRRSR-Node
orNULLifitisnotaneighbor*/structsr_node*neighbor;};/*SegmentRouting-NHLFEinfo:su
pportIPv4Only*/structsr_nhlfe{structprefix_ipv4prefv4;structin_addrnexthop;ifind
ex_tifindex;mpls_label_tlabel_in;mpls_label_tlabel_out;};/*Structureaggregatinga
llSegmentRoutingLinkinformation*//*Linkaregenerallyadvertisedbypair:primary+back
up*/structsr_link{structin_addradv_router;/*usedtoidentifysenderofLSA*//*24-bitO
paque-IDfieldvalueaccordingtoRFC7684specification*/uint32_tinstance;/*Flagstoman
agethislinkparameters.*/uint8_tflags[2];/*SegmentRoutingID*/uint32_tsid[2];enums
id_typetype;/*SRNHLFEforthislink*/structsr_nhlfenhlfe[2];/*BackpointertoSRNodewh
ichadvertisethisLink*/structsr_node*srn;};/*StructureaggregatingallSegmentRoutin
gPrefixinformation*/structsr_prefix{structin_addradv_router;/*usedtoidentifysend
erofLSA*//*24-bitOpaque-IDfieldvalueaccordingtoRFC7684specification*/uint32_tins
tance;/*Flagstomanagethisprefixparameters.*/uint8_tflags;/*SegmentRoutingID*/uin
t32_tsid;enumsid_typetype;/*SRNHLFEforthisprefix*/structsr_nhlfenhlfe;/*Backpoin
tertoSRNodewhichadvertisethisPrefix*/structsr_node*srn;/**PointertoSRNodewhichis
thenexthopforthisPrefix*orNULLifnexthopisthedestinationoftheprefix*/structsr_nod
e*nexthop;};/*Prototypesdefinition*//*SegmentRoutinginitialisationfunctions*/ext
ernintospf_sr_init(void);externvoidospf_sr_term(void);externvoidospf_sr_finish(v
oid);/*SegmentRoutingLSAupdate&deletefunctions*/externvoidospf_sr_ri_lsa_update(
structospf_lsa*lsa);externvoidospf_sr_ri_lsa_delete(structospf_lsa*lsa);externvo
idospf_sr_ext_link_lsa_update(structospf_lsa*lsa);externvoidospf_sr_ext_link_lsa
_delete(structospf_lsa*lsa);externvoidospf_sr_ext_prefix_lsa_update(structospf_l
sa*lsa);externvoidospf_sr_ext_prefix_lsa_delete(structospf_lsa*lsa);/*SegmentRou
tingconfigurationfunctions*/externuint32_tget_ext_link_label_value(void);externv
oidospf_sr_config_write_router(structvty*vty);externvoidospf_sr_update_prefix(st
ructinterface*ifp,structprefix*p);/*SegmentRoutingre-routingfunction*/externvoid
ospf_sr_update_timer_add(structospf*ospf);#endif/*_FRR_OSPF_SR_H*/