/**ThisisanimplementationofRFC3630,RFC5392&RFC6827*Copyright(C)2001KDDR&DLaborat
ories,Inc.*http://www.kddlabs.co.jp/**Copyright(C)2012OrangeLabs*http://www.oran
ge.com**ThisfileispartofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitan
d/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftw
areFoundation;eitherversion2,or(atyouroption)any*laterversion.**GNUZebraisdistri
butedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwar
rantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLic
enseformoredetails.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong
*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,
51FranklinSt,FifthFloor,Boston,MA02110-1301USA*//*AddsupportofRFC7471*//*Addsupp
ortofRFC5392*//*AddsupportofRFC6827(partial)*/#ifndef_ZEBRA_OSPF_MPLS_TE_H#defin
e_ZEBRA_OSPF_MPLS_TE_H/**OpaqueLSA'slinkstateIDforTrafficEngineeringis*structure
dasfollows.**241680*+--------+--------+--------+--------+*|1|MBZ|........|......
..|*+--------+--------+--------+--------+*|<-Type->|<Resv'd>|<--Instance--->|***
Type:IANAhasassigned'1'forTrafficEngineering.*MBZ:Reserved,mustbesettozero.*Inst
ance:Usermayselectanarbitrary16-bitvalue.**/#defineMAX_LEGAL_TE_INSTANCE_NUM(0xf
fff)#defineLEGAL_TE_INSTANCE_RANGE(i)(0<=(i)&&(i)<=0xffff)/**241680*+--------+--
------+--------+--------+---*|LSage|Options|10|A*+--------+--------+--------+---
-----+|*|1|0|Instance||*+--------+--------+--------+--------+|*|Advertisingroute
r||Standard(Opaque)LSAheader;*+--------+--------+--------+--------+|Onlytype-10i
sused.*|LSsequencenumber||*+--------+--------+--------+--------+|*|LSchecksum|Le
ngth|V*+--------+--------+--------+--------+---*|Type|Length|A*+--------+-------
-+--------+--------+|TLVpartforTE;Valuesmightbe*|Values...|Vstructuredasasetofsu
b-TLVs.*+--------+--------+--------+--------+---*//*FollowingdefinethetypeofTEli
nkregardingthevariousRFC*/#defineSTD_TE0x01#defineGMPLS0x02#defineINTER_AS0x04#d
efinePSEUDO_TE0x08#defineFLOOD_AREA0x10#defineFLOOD_AS0x20#defineEMULATED0x80#de
fineIS_STD_TE(x)(x&STD_TE)#defineIS_PSEUDO_TE(x)(x&PSEUDO_TE)#defineIS_INTER_AS(
x)(x&INTER_AS)#defineIS_EMULATED(x)(x&EMULATED)#defineIS_FLOOD_AREA(x)(x&FLOOD_A
REA)#defineIS_FLOOD_AS(x)(x&FLOOD_AS)#defineIS_INTER_AS_EMU(x)(x&INTER_AS&EMULAT
ED)#defineIS_INTER_AS_AS(x)(x&INTER_AS&FLOOD_AS)/*FlagstomanageTELinkLSA*/#defin
eLPFLG_LSA_INACTIVE0x0#defineLPFLG_LSA_ACTIVE0x1#defineLPFLG_LSA_ENGAGED0x2#defi
neLPFLG_LOOKUP_DONE0x4#defineLPFLG_LSA_FORCED_REFRESH0x8/**Followingsectiondefin
esTLVbodyparts.*//*RouterAddressTLV*//*Mandatory*/#defineTE_TLV_ROUTER_ADDR1stru
ctte_tlv_router_addr{structtlv_headerheader;/*Valuelengthis4octets.*/structin_ad
drvalue;};/*LinkTLV*/#defineTE_TLV_LINK2structte_tlv_link{structtlv_headerheader
;/*Asetoflink-sub-TLVswillfollow.*/};/*DefaultTETLVsize*/#defineTE_LINK_SUBTLV_D
EF_SIZE4/*LinkTypeSub-TLV*//*Mandatory*/#defineTE_LINK_SUBTLV_LINK_TYPE1#defineT
E_LINK_SUBTLV_TYPE_SIZE1structte_link_subtlv_link_type{structtlv_headerheader;/*
Valuelengthis1octet.*/struct{#defineLINK_TYPE_SUBTLV_VALUE_PTP1#defineLINK_TYPE_
SUBTLV_VALUE_MA2uint8_tvalue;uint8_tpadding[3];}link_type;};/*LinkSub-TLV:LinkID
*//*Mandatory*/#defineTE_LINK_SUBTLV_LINK_ID2structte_link_subtlv_link_id{struct
tlv_headerheader;/*Valuelengthis4octets.*/structin_addrvalue;/*Sameasrouter-lsa'
slink-id.*/};/*LinkSub-TLV:LocalInterfaceIPAddress*//*Optional*/#defineTE_LINK_S
UBTLV_LCLIF_IPADDR3structte_link_subtlv_lclif_ipaddr{structtlv_headerheader;/*Va
luelengthis4xNoctets.*/structin_addrvalue[1];/*LocalIPaddress(es).*/};/*LinkSub-
TLV:RemoteInterfaceIPAddress*//*Optional*/#defineTE_LINK_SUBTLV_RMTIF_IPADDR4str
uctte_link_subtlv_rmtif_ipaddr{structtlv_headerheader;/*Valuelengthis4xNoctets.*
/structin_addrvalue[1];/*Neighbor'sIPaddress(es).*/};/*LinkSub-TLV:TrafficEngine
eringMetric*//*Optional*/#defineTE_LINK_SUBTLV_TE_METRIC5structte_link_subtlv_te
_metric{structtlv_headerheader;/*Valuelengthis4octets.*/uint32_tvalue;/*Linkmetr
icforTEpurpose.*/};/*LinkSub-TLV:MaximumBandwidth*//*Optional*/#defineTE_LINK_SU
BTLV_MAX_BW6structte_link_subtlv_max_bw{structtlv_headerheader;/*Valuelengthis4o
ctets.*/floatvalue;/*bytes/sec*/};/*LinkSub-TLV:MaximumReservableBandwidth*//*Op
tional*/#defineTE_LINK_SUBTLV_MAX_RSV_BW7structte_link_subtlv_max_rsv_bw{structt
lv_headerheader;/*Valuelengthis4octets.*/floatvalue;/*bytes/sec*/};/*LinkSub-TLV
:UnreservedBandwidth*//*Optional*/#defineTE_LINK_SUBTLV_UNRSV_BW8#defineTE_LINK_
SUBTLV_UNRSV_SIZE32structte_link_subtlv_unrsv_bw{structtlv_headerheader;/*Valuel
engthis32octets.*/floatvalue[MAX_CLASS_TYPE];/*Oneforeachprioritylevel.*/};/*Lin
kSub-TLV:ResourceClass/Color*//*Optional*/#defineTE_LINK_SUBTLV_RSC_CLSCLR9struc
tte_link_subtlv_rsc_clsclr{structtlv_headerheader;/*Valuelengthis4octets.*/uint3
2_tvalue;/*Admin.groupmembership.*/};/*ForRFC6827*//*LocalandRemoteTERouterID*/#
defineTE_LINK_SUBTLV_LRRID10#defineTE_LINK_SUBTLV_LRRID_SIZE8structte_link_subtl
v_lrrid{structtlv_headerheader;/*Valuelengthis8octets.*/structin_addrlocal;/*Loc
alTERouterIdentifier*/structin_addrremote;/*RemoteTERouterIdentifier*/};/*RFC420
3:LinkLocal/RemoteIdentifiers*/#defineTE_LINK_SUBTLV_LLRI11#defineTE_LINK_SUBTLV
_LLRI_SIZE8structte_link_subtlv_llri{structtlv_headerheader;/*Valuelengthis8octe
ts.*/uint32_tlocal;/*LinkLocalIdentifier*/uint32_tremote;/*LinkRemoteIdentifier*
/};/*Inter-RAExportUpwardsub-TLV(12)andInter-RAExportDownwardsub-TLV(13)*(RFC682
7bis)arenotyetsupported*//*SUBTLV14-16(RFC4203)arenotyetsupported*//*BandwidthCo
nstraintssub-TLV(17)(RFC4124)isnotyetsupported*//*SUBLV18-20areforOSPFv3TE(RFC53
29).seeospf6d*//*ForRFC5392*//*RemoteASNumbersub-TLV*/#defineTE_LINK_SUBTLV_RAS2
1structte_link_subtlv_ras{structtlv_headerheader;/*Valuelengthis4octets.*/uint32
_tvalue;/*RemoteASnumber*/};/*IPv4RemoteASBRIDSub-TLV*/#defineTE_LINK_SUBTLV_RIP
22structte_link_subtlv_rip{structtlv_headerheader;/*Valuelengthis4octets.*/struc
tin_addrvalue;/*RemoteASBRIPaddress*/};/*SUBTLV24isIPv6RemoteASBRID(RFC5392).see
ospf6d*//*SUBTLV23(RFC5330)and25(RFC6001)arenotyetsupported*//*SUBTLV26(RFC7308)
isnotyetsupported*//*RFC7471*//*LinkSub-TLV:AverageLinkDelay*//*Optional*/#defin
eTE_LINK_SUBTLV_AV_DELAY27structte_link_subtlv_av_delay{structtlv_headerheader;/
*Valuelengthis4bytes.*//**delayinmicro-secondsonly24bits=>0...16777215*withAnoma
lousBitasUppermostbit*/uint32_tvalue;};/*LinkSub-TLV:Low/HighLinkDelay*/#defineT
E_LINK_SUBTLV_MM_DELAY28#defineTE_LINK_SUBTLV_MM_DELAY_SIZE8structte_link_subtlv
_mm_delay{structtlv_headerheader;/*Valuelengthis8bytes.*//**lowdelayinmicro-seco
ndsonly24bits=>0...16777215*withAnomalousBit(A)asUppermostbit*/uint32_tlow;/*hig
hdelayinmicro-secondsonly24bits=>0...16777215*/uint32_thigh;};/*LinkSub-TLV:Link
DelayVariationi.e.Jitter*/#defineTE_LINK_SUBTLV_DELAY_VAR29structte_link_subtlv_
delay_var{structtlv_headerheader;/*Valuelengthis4bytes.*//*intervalinmicro-secon
dsonly24bits=>0...16777215*/uint32_tvalue;};/*LinkSub-TLV:RoutineUnidirectionalL
inkPacketLoss*/#defineTE_LINK_SUBTLV_PKT_LOSS30structte_link_subtlv_pkt_loss{str
ucttlv_headerheader;/*Valuelengthis4bytes.*//**inpercentageoftotaltrafficonly24b
its(2^24-2)*withAnomalousBitasUppermostbit*/uint32_tvalue;};/*LinkSub-TLV:Unidir
ectionalResidualBandwidth*//*Optional*/#defineTE_LINK_SUBTLV_RES_BW31structte_li
nk_subtlv_res_bw{structtlv_headerheader;/*Valuelengthis4bytes.*//*bandwidthinIEE
Efloatingpointformatwithunitsinbytes/second*/floatvalue;};/*LinkSub-TLV:Unidirec
tionalAvailableBandwidth*//*Optional*/#defineTE_LINK_SUBTLV_AVA_BW32structte_lin
k_subtlv_ava_bw{structtlv_headerheader;/*Valuelengthis4octets.*//*bandwidthinIEE
Efloatingpointformatwithunitsinbytes/second*/floatvalue;};/*LinkSub-TLV:Unidirec
tionalUtilizedBandwidth*//*Optional*/#defineTE_LINK_SUBTLV_USE_BW33structte_link
_subtlv_use_bw{structtlv_headerheader;/*Valuelengthis4octets.*//*bandwidthinIEEE
floatingpointformatwithunitsinbytes/second*/floatvalue;};#defineTE_LINK_SUBTLV_M
AX34/*LastSUBTLV+1*//*Hereare"non-official"architecturalconstants.*/#defineMPLS_
TE_MINIMUM_BANDWIDTH1.0/*Reasonable?*//*XXX*//*ModeforInter-ASOpaque-LSA*/enumin
ter_as_mode{Off,AS,Area};structte_link_subtlv{structtlv_headerheader;union{uint3
2_tlink_type;structin_addrlink_id;structin_addrlclif;structin_addrrmtif;uint32_t
te_metric;floatmax_bw;floatmax_rsv_bw;floatunrsv[8];uint32_trsc_clsclr;uint32_tl
lri[2];uint32_tras;structin_addrrip;structin_addrlrrid[2];uint32_tav_delay;uint3
2_tmm_delay;uint32_tdelay_var;uint32_tpkt_loss;floatres_bw;floatava_bw;floatuse_
bw;}value;};/*Followingstructureareinternaluseonly.*/structospf_mpls_te{/*Status
ofMPLS-TE:enableordisbale*/boolenabled;/*RFC5392*/enuminter_as_modeinter_as;stru
ctin_addrinteras_areaid;/*Listelementsarezebra-interfaces(ifp),notospf-interface
s(oi).*/structlist*iflist;/*StoreRouter-TLVinnetworkbyteorder.*/structte_tlv_rou
ter_addrrouter_addr;};structmpls_te_link{/**AccordingtoMPLS-TE(draft)specificati
on,24-bitOpaque-IDfield*issubdividedinto8-bit"unused"fieldand16-bit"instance"fie
ld.*Inthisimplementation,eachLink-TLVhasitsowninstance.*/uint32_tinstance;/*Refe
rencepointertoaZebra-interface.*/structinterface*ifp;/*AreainfoinwhichthisMPLS-T
Elinkbelongsto.*/structospf_area*area;/*Flagstomanagethislinkparameters.*/uint32
_tflags;/*TypeofMPLS-TElink:RFC3630,RFC5392,RFC5392emulated,RFC6827*/uint8_ttype
;/*StoreLink-TLVinnetworkbyteorder.*//*RFC3630&RFC6827/RFC6827*/structte_tlv_lin
klink_header;structte_link_subtlv_link_typelink_type;structte_link_subtlv_link_i
dlink_id;structte_link_subtlv_lclif_ipaddrlclif_ipaddr;structte_link_subtlv_rmti
f_ipaddrrmtif_ipaddr;structte_link_subtlv_te_metricte_metric;structte_link_subtl
v_max_bwmax_bw;structte_link_subtlv_max_rsv_bwmax_rsv_bw;structte_link_subtlv_un
rsv_bwunrsv_bw;structte_link_subtlv_rsc_clsclrrsc_clsclr;/*RFC4203*/structte_lin
k_subtlv_llrillri;/*RFC5392*/structte_link_subtlv_rasras;structte_link_subtlv_ri
prip;/*RFC6827*/structte_link_subtlv_lrridlrrid;/*RFC7471*/structte_link_subtlv_
av_delayav_delay;structte_link_subtlv_mm_delaymm_delay;structte_link_subtlv_dela
y_vardelay_var;structte_link_subtlv_pkt_losspkt_loss;structte_link_subtlv_res_bw
res_bw;structte_link_subtlv_ava_bwava_bw;structte_link_subtlv_use_bwuse_bw;struc
tin_addradv_router;structin_addrid;};/*Prototypes.*/externintospf_mpls_te_init(v
oid);externvoidospf_mpls_te_term(void);externvoidospf_mpls_te_finish(void);exter
nstructospf_mpls_te*get_ospf_mpls_te(void);externvoidospf_mpls_te_update_if(stru
ctinterface*);externvoidospf_mpls_te_lsa_schedule(structmpls_te_link*,enumlsa_op
code);externvoidset_linkparams_llri(structmpls_te_link*,uint32_t,uint32_t);exter
nvoidset_linkparams_lrrid(structmpls_te_link*,structin_addr,structin_addr);#endi
f/*_ZEBRA_OSPF_MPLS_TE_H*/