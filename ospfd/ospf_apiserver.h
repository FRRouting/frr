/**ServersideofOSPFAPI.*Copyright(C)2001,2002RalphKeller**ThisfileispartofGNUZeb
ra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodify*itunderthetermsofth
eGNUGeneralPublicLicenseaspublished*bytheFreeSoftwareFoundation;eitherversion2,o
r(atyour*option)anylaterversion.**GNUZebraisdistributedinthehopethatitwillbeusef
ul,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABILITYorFITNE
SSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.**Youshould
havereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;seethefileCOP
YING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFloor,Boston
,MA02110-1301USA*/#ifndef_OSPF_APISERVER_H#define_OSPF_APISERVER_H/*MTYPEdefinit
ionisnotreflectedto"memory.h".*/#defineMTYPE_OSPF_APISERVERMTYPE_TMP#defineMTYPE
_OSPF_APISERVER_MSGFILTERMTYPE_TMP/*Listofopaquetypesthatapplicationregistered*/
structregistered_opaque_type{uint8_tlsa_type;uint8_topaque_type;};/*Serverinstan
ceforeachacceptedclientconnection.*/structospf_apiserver{/*Socketconnectionsfors
ynchronouscommandsandasynchronousnotifications*/intfd_sync;/*synchronousrequests
*/structsockaddr_inpeer_sync;intfd_async;/*asynchronousnotifications*/structsock
addr_inpeer_async;/*Listofallopaquetypesthatapplicationregisterstouse.Usingasing
leconnectionwiththeOSPFdaemon,multiple<lsa,opaque_type>pairscanberegistered.Howe
ver,eachcombinationcanonlyberegisteredoncebyallapplications.*/structlist*opaque_
types;/*oftyperegistered_opaque_type*//*TemporarystorageforLSAinstancestoberefre
shed.*/structospf_lsdbreserve;/*filterforLSAupdate/deletenotifies*/structlsa_fil
ter_type*filter;/*Fifobuffersforoutgoingmessages*/structmsg_fifo*out_sync_fifo;s
tructmsg_fifo*out_async_fifo;/*Readandwritethreads*/structthread*t_sync_read;#if
defUSE_ASYNC_READstructthread*t_async_read;#endif/*USE_ASYNC_READ*/structthread*
t_sync_write;structthread*t_async_write;};enumevent{OSPF_APISERVER_ACCEPT,OSPF_A
PISERVER_SYNC_READ,#ifdefUSE_ASYNC_READOSPF_APISERVER_ASYNC_READ,#endif/*USE_ASY
NC_READ*/OSPF_APISERVER_SYNC_WRITE,OSPF_APISERVER_ASYNC_WRITE};/*---------------
--------------------------------------------*Followingsarefunctionstomanageclien
tconnections.*-----------------------------------------------------------*/exter
nunsignedshortospf_apiserver_getport(void);externintospf_apiserver_init(void);ex
ternvoidospf_apiserver_term(void);externstructospf_apiserver*ospf_apiserver_new(
intfd_sync,intfd_async);externvoidospf_apiserver_free(structospf_apiserver*apise
rv);externvoidospf_apiserver_event(enumeventevent,intfd,structospf_apiserver*api
serv);externintospf_apiserver_serv_sock_family(unsignedshortport,intfamily);exte
rnintospf_apiserver_accept(structthread*thread);externintospf_apiserver_read(str
uctthread*thread);externintospf_apiserver_sync_write(structthread*thread);extern
intospf_apiserver_async_write(structthread*thread);externintospf_apiserver_send_
reply(structospf_apiserver*apiserv,uint32_tseqnr,uint8_trc);/*------------------
-----------------------------------------*Followingsaremessagehandlerfunctions*-
----------------------------------------------------------*/externintospf_apiser
ver_lsa9_originator(void*arg);externintospf_apiserver_lsa10_originator(void*arg)
;externintospf_apiserver_lsa11_originator(void*arg);externvoidospf_apiserver_cli
ents_notify_all(structmsg*msg);externvoidospf_apiserver_clients_notify_ready_typ
e9(structospf_interface*oi);externvoidospf_apiserver_clients_notify_ready_type10
(structospf_area*area);externvoidospf_apiserver_clients_notify_ready_type11(stru
ctospf*top);externvoidospf_apiserver_clients_notify_new_if(structospf_interface*
oi);externvoidospf_apiserver_clients_notify_del_if(structospf_interface*oi);exte
rnvoidospf_apiserver_clients_notify_ism_change(structospf_interface*oi);externvo
idospf_apiserver_clients_notify_nsm_change(structospf_neighbor*nbr);externintosp
f_apiserver_is_ready_type9(structospf_interface*oi);externintospf_apiserver_is_r
eady_type10(structospf_area*area);externintospf_apiserver_is_ready_type11(struct
ospf*ospf);externvoidospf_apiserver_notify_ready_type9(structospf_apiserver*apis
erv);externvoidospf_apiserver_notify_ready_type10(structospf_apiserver*apiserv);
externvoidospf_apiserver_notify_ready_type11(structospf_apiserver*apiserv);exter
nintospf_apiserver_handle_msg(structospf_apiserver*apiserv,structmsg*msg);extern
intospf_apiserver_handle_register_opaque_type(structospf_apiserver*apiserv,struc
tmsg*msg);externintospf_apiserver_handle_unregister_opaque_type(structospf_apise
rver*apiserv,structmsg*msg);externintospf_apiserver_handle_register_event(struct
ospf_apiserver*apiserv,structmsg*msg);externintospf_apiserver_handle_originate_r
equest(structospf_apiserver*apiserv,structmsg*msg);externintospf_apiserver_handl
e_delete_request(structospf_apiserver*apiserv,structmsg*msg);externintospf_apise
rver_handle_sync_lsdb(structospf_apiserver*apiserv,structmsg*msg);/*------------
-----------------------------------------------*FollowingsarefunctionsforLSAorig
ination/deletion*-----------------------------------------------------------*/ex
ternintospf_apiserver_register_opaque_type(structospf_apiserver*apiserver,uint8_
tlsa_type,uint8_topaque_type);externintospf_apiserver_unregister_opaque_type(str
uctospf_apiserver*apiserver,uint8_tlsa_type,uint8_topaque_type);externstructospf
_lsa*ospf_apiserver_opaque_lsa_new(structospf_area*area,structospf_interface*oi,
structlsa_header*protolsa);externstructospf_interface*ospf_apiserver_if_lookup_b
y_addr(structin_addraddress);externstructospf_interface*ospf_apiserver_if_lookup
_by_ifp(structinterface*ifp);externintospf_apiserver_originate1(structospf_lsa*l
sa);externvoidospf_apiserver_flood_opaque_lsa(structospf_lsa*lsa);/*------------
-----------------------------------------------*Followingsarecallbackfunctionsto
handleopaquetypes*-----------------------------------------------------------*/e
xternintospf_apiserver_new_if(structinterface*ifp);externintospf_apiserver_del_i
f(structinterface*ifp);externvoidospf_apiserver_ism_change(structospf_interface*
oi,intold_status);externvoidospf_apiserver_nsm_change(structospf_neighbor*nbr,in
told_status);externvoidospf_apiserver_config_write_router(structvty*vty);externv
oidospf_apiserver_config_write_if(structvty*vty,structinterface*ifp);externvoido
spf_apiserver_show_info(structvty*vty,structospf_lsa*lsa);externintospf_ospf_api
server_lsa_originator(void*arg);externstructospf_lsa*ospf_apiserver_lsa_refreshe
r(structospf_lsa*lsa);externvoidospf_apiserver_flush_opaque_lsa(structospf_apise
rver*apiserv,uint8_tlsa_type,uint8_topaque_type);/*-----------------------------
------------------------------*FollowingsarehookswhenLSAsareupdatedordeleted*---
--------------------------------------------------------*//*Hooksthatareinvokedf
romospfopaquemodule*/externintospf_apiserver_lsa_update(structospf_lsa*lsa);exte
rnintospf_apiserver_lsa_delete(structospf_lsa*lsa);externvoidospf_apiserver_clie
nts_lsa_change_notify(uint8_tmsgtype,structospf_lsa*lsa);#endif/*_OSPF_APISERVER
_H*/