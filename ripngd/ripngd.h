/**RIPngrelatedvalueandstructure.*Copyright(C)1998KunihiroIshiguro**Thisfileispa
rtofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit*underth
etermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;either
version2,or(atyouroption)any*laterversion.**GNUZebraisdistributedinthehopethatit
willbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTABIL
ITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetails.*
*YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;see
thefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,FifthFl
oor,Boston,MA02110-1301USA*/#ifndef_ZEBRA_RIPNG_RIPNGD_H#define_ZEBRA_RIPNG_RIPN
GD_H#include<zclient.h>#include<vty.h>#include"ripng_memory.h"/*RIPngversionandp
ortnumber.*/#defineRIPNG_V11#defineRIPNG_PORT_DEFAULT521#defineRIPNG_VTY_PORT260
3#defineRIPNG_MAX_PACKET_SIZE1500#defineRIPNG_PRIORITY_DEFAULT0/*RIPngcommands.*
/#defineRIPNG_REQUEST1#defineRIPNG_RESPONSE2/*RIPngmetricandmulticastgroupaddres
s.*/#defineRIPNG_METRIC_INFINITY16#defineRIPNG_METRIC_NEXTHOP0xff#defineRIPNG_GR
OUP"ff02::9"/*RIPngtimers.*/#defineRIPNG_UPDATE_TIMER_DEFAULT30#defineRIPNG_TIME
OUT_TIMER_DEFAULT180#defineRIPNG_GARBAGE_TIMER_DEFAULT120/*RIPngpeertimeoutvalue
.*/#defineRIPNG_PEER_TIMER_DEFAULT180/*Defaultconfigfilename.*/#defineRIPNG_DEFA
ULT_CONFIG"ripngd.conf"/*RIPngroutetypes.*/#defineRIPNG_ROUTE_RTE0#defineRIPNG_R
OUTE_STATIC1#defineRIPNG_ROUTE_DEFAULT2#defineRIPNG_ROUTE_REDISTRIBUTE3#defineRI
PNG_ROUTE_INTERFACE4#defineRIPNG_ROUTE_AGGREGATE5/*Interfacesend/receiveconfigur
ation.*/#defineRIPNG_SEND_UNSPEC0#defineRIPNG_SEND_OFF1#defineRIPNG_RECEIVE_UNSP
EC0#defineRIPNG_RECEIVE_OFF1/*RIPdefaultroute'saccept/announcemethods.*/#defineR
IPNG_DEFAULT_ADVERTISE_UNSPEC0#defineRIPNG_DEFAULT_ADVERTISE_NONE1#defineRIPNG_D
EFAULT_ADVERTISE2#defineRIPNG_DEFAULT_ACCEPT_UNSPEC0#defineRIPNG_DEFAULT_ACCEPT_
NONE1#defineRIPNG_DEFAULT_ACCEPT2/*Defaultvaluefor"default-metric"command.*/#def
ineRIPNG_DEFAULT_METRIC_DEFAULT1/*FormaxRTEcalculation.*/#ifndefIPV6_HDRLEN#defi
neIPV6_HDRLEN40#endif/*IPV6_HDRLEN*/#ifndefIFMINMTU#defineIFMINMTU576#endif/*IFM
INMTU*//*RIPngstructure.*/structripng{/*RIPngsocket.*/intsock;/*RIPngParameters.
*/uint8_tcommand;uint8_tversion;unsignedlongupdate_time;unsignedlongtimeout_time
;unsignedlonggarbage_time;intmax_mtu;intdefault_metric;intdefault_information;/*
Input/outputbufferofRIPng.*/structstream*ibuf;structstream*obuf;/*RIPngroutingin
formationbase.*/structroute_table*table;/*RIPngonlystaticrouteinformation.*/stru
ctroute_table*route;/*RIPngaggregaterouteinformation.*/structroute_table*aggrega
te;/*RIPngthreads.*/structthread*t_read;structthread*t_write;structthread*t_upda
te;structthread*t_garbage;structthread*t_zebra;/*Triggeredupdatehack.*/inttrigge
r;structthread*t_triggered_update;structthread*t_triggered_interval;/*RIPngECMPf
lag*/unsignedintecmp;/*Forredistributeroutemap.*/struct{char*name;structroute_ma
p*map;intmetric_config;uint32_tmetric;}route_map[ZEBRA_ROUTE_MAX];};/*Routingtab
leentry.*/structrte{structin6_addraddr;/*RIPngdestinationprefix*/uint16_ttag;/*R
IPngtag*/uint8_tprefixlen;/*LengthoftheRIPngprefix*/uint8_tmetric;/*MetricoftheR
IPngroute*//*Thenexthopisstoredbythestructure*ripng_nexthopwithinripngd.c*/};/*R
IPNGsendpacket.*/structripng_packet{uint8_tcommand;uint8_tversion;uint16_tzero;s
tructrterte[1];};/*Eachroute'sinformation.*/structripng_info{/*Thisroute'stype.S
tatic,ripngoraggregate.*/uint8_ttype;/*Subtypeforstaticroute.*/uint8_tsub_type;/
*RIPngspecificinformation*/structin6_addrnexthop;structin6_addrfrom;/*Whichinter
facedoesthisroutecomefrom.*/ifindex_tifindex;/*Metricofthisroute.*/uint8_tmetric
;/*TagfieldofRIPngpacket.*/uint16_ttag;/*Foraggregation.*/unsignedintsuppress;/*
FlagsofRIPngroute.*/#defineRIPNG_RTF_FIB1#defineRIPNG_RTF_CHANGED2uint8_tflags;/
*Garbagecollecttimer.*/structthread*t_timeout;structthread*t_garbage_collect;/*R
oute-mapfeatures-thisvariablescanbechanged.*/structin6_addrnexthop_out;uint8_tme
tric_set;uint8_tmetric_out;uint16_ttag_out;structroute_node*rp;};#ifdefnotyet#if
0/*RIPngtagstructure.*/structripng_tag{/*Tagvalue.*/uint16_ttag;/*Port.*/uint16_
tport;/*Multicastgroup.*/structin6_addrmaddr;/*Tablenumber.*/inttable;/*Distance
.*/intdistance;/*Splithorizon.*/uint8_tsplit_horizon;/*Poisonreverse.*/uint8_tpo
ison_reverse;};#endif/*0*/#endif/*notyet*/typedefenum{RIPNG_NO_SPLIT_HORIZON=0,R
IPNG_SPLIT_HORIZON,RIPNG_SPLIT_HORIZON_POISONED_REVERSE}split_horizon_policy_t;/
*RIPngspecificinterfaceconfiguration.*/structripng_interface{/*RIPngisenabledont
hisinterface.*/intenable_network;intenable_interface;/*RIPngisrunningonthisinter
face.*/intrunning;/*Splithorizonflag.*/split_horizon_policy_tsplit_horizon;split
_horizon_policy_tsplit_horizon_default;/*Forfiltertypeslot.*/#defineRIPNG_FILTER
_IN0#defineRIPNG_FILTER_OUT1#defineRIPNG_FILTER_MAX2/*Access-list.*/structaccess
_list*list[RIPNG_FILTER_MAX];/*Prefix-list.*/structprefix_list*prefix[RIPNG_FILT
ER_MAX];/*Route-map.*/structroute_map*routemap[RIPNG_FILTER_MAX];#ifdefnotyet#if
0/*RIPngtagconfiguration.*/structripng_tag*rtag;#endif/*0*/#endif/*notyet*//*Def
aultinformationoriginate.*/uint8_tdefault_originate;/*Defaultinformationonly.*/u
int8_tdefault_only;/*Wakeupthread.*/structthread*t_wakeup;/*Passiveinterface.*/i
ntpassive;};/*RIPngpeerinformation.*/structripng_peer{/*Peeraddress.*/structin6_
addraddr;/*PeerRIPngtagvalue.*/intdomain;/*Lastupdatetime.*/time_tuptime;/*PeerR
IPversion.*/uint8_tversion;/*Statistics.*/intrecv_badpackets;intrecv_badroutes;/
*Timeoutthread.*/structthread*t_timeout;};/*AllRIPngevents.*/enumripng_event{RIP
NG_READ,RIPNG_ZEBRA,RIPNG_REQUEST_EVENT,RIPNG_UPDATE_EVENT,RIPNG_TRIGGERED_UPDAT
E,};/*RIPngtimeron/offmacro.*/#defineRIPNG_TIMER_ON(T,F,V)thread_add_timer(maste
r,(F),rinfo,(V),&(T))#defineRIPNG_TIMER_OFF(T)\do{\if(T){\thread_cancel(T);\(T)=
NULL;\}\}while(0)/*Externvariables.*/externstructripng*ripng;externstructzebra_p
rivs_tripngd_privs;externstructthread_master*master;/*Prototypes.*/externvoidrip
ng_init(void);externvoidripng_reset(void);externvoidripng_clean(void);externvoid
ripng_clean_network(void);externvoidripng_interface_clean(void);externvoidripng_
interface_reset(void);externvoidripng_passive_interface_clean(void);externvoidri
png_if_init(void);externvoidripng_route_map_init(void);externvoidripng_route_map
_reset(void);externvoidripng_terminate(void);/*zclient_init()isdonebyripng_zebra
.c:zebra_init()*/externvoidzebra_init(structthread_master*);externvoidripng_zebr
a_stop(void);externvoidripng_zclient_reset(void);externvoidripng_offset_init(voi
d);externintconfig_write_ripng_offset_list(structvty*);externvoidripng_peer_init
(void);externvoidripng_peer_update(structsockaddr_in6*,uint8_t);externvoidripng_
peer_bad_route(structsockaddr_in6*);externvoidripng_peer_bad_packet(structsockad
dr_in6*);externvoidripng_peer_display(structvty*);externstructripng_peer*ripng_p
eer_lookup(structin6_addr*);externstructripng_peer*ripng_peer_lookup_next(struct
in6_addr*);externintripng_offset_list_apply_in(structprefix_ipv6*,structinterfac
e*,uint8_t*);externintripng_offset_list_apply_out(structprefix_ipv6*,structinter
face*,uint8_t*);externvoidripng_offset_clean(void);externstructripng_info*ripng_
info_new(void);externvoidripng_info_free(structripng_info*rinfo);externvoidripng
_event(enumripng_event,int);externintripng_request(structinterface*ifp);externvo
idripng_redistribute_add(int,int,structprefix_ipv6*,ifindex_t,structin6_addr*,ro
ute_tag_t);externvoidripng_redistribute_delete(int,int,structprefix_ipv6*,ifinde
x_t);externvoidripng_redistribute_withdraw(inttype);externvoidripng_distribute_u
pdate_interface(structinterface*);externvoidripng_if_rmap_update_interface(struc
tinterface*);externvoidripng_zebra_ipv6_add(structroute_node*);externvoidripng_z
ebra_ipv6_delete(structroute_node*);externvoidripng_redistribute_clean(void);ext
ernintripng_redistribute_check(int);externvoidripng_redistribute_write(structvty
*,int);externintripng_write_rte(intnum,structstream*s,structprefix_ipv6*p,struct
in6_addr*nexthop,uint16_ttag,uint8_tmetric);externintripng_send_packet(caddr_tbu
f,intbufsize,structsockaddr_in6*to,structinterface*ifp);externvoidripng_packet_d
ump(structripng_packet*packet,intsize,constchar*sndrcv);externintripng_interface
_up(intcommand,structzclient*,zebra_size_t,vrf_id_t);externintripng_interface_do
wn(intcommand,structzclient*,zebra_size_t,vrf_id_t);externintripng_interface_add
(intcommand,structzclient*,zebra_size_t,vrf_id_t);externintripng_interface_delet
e(intcommand,structzclient*,zebra_size_t,vrf_id_t);externintripng_interface_addr
ess_add(intcommand,structzclient*,zebra_size_t,vrf_id_t);externintripng_interfac
e_address_delete(intcommand,structzclient*,zebra_size_t,vrf_id_t);externintripng
_network_write(structvty*,int);externstructripng_info*ripng_ecmp_add(structripng
_info*);externstructripng_info*ripng_ecmp_replace(structripng_info*);externstruc
tripng_info*ripng_ecmp_delete(structripng_info*);#endif/*_ZEBRA_RIPNG_RIPNGD_H*/
