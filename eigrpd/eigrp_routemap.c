/**EIGRPFilterFunctions.*Copyright(C)2013-2015*Authors:*DonnieSavage*JanJanovic*
MatejPerina*PeterOrsag*PeterPaluch*FrantisekGazo*TomasHvorkovy*MartinKontsek*Luk
asKoribsky**Note:Thisfilecontainsskeletonforallpossiblematchesandsets,*buttheyar
ehiddenincommentblockandnotproperlyimplemented.*Atthistime,theonlyfunctionwecons
iderusefulforouruse*indistributecommandinEIGRPismatchingdestinationIP(withboth*a
ccessandprefixlist).***ThisfileispartofGNUZebra.**GNUZebraisfreesoftware;youcanr
edistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspublished
bythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*laterversion.**G
NUZebraisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANTY;withoutev
entheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*G
eneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGNUGeneralPub
licLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftware*F
oundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#include<zebra.h>
#include"memory.h"#include"prefix.h"#include"if_rmap.h"#include"routemap.h"#incl
ude"command.h"#include"filter.h"#include"log.h"#include"sockunion.h"/*forinet_at
on()*/#include"plist.h"#include"eigrpd/eigrpd.h"#include"eigrpd/eigrp_structs.h"
#include"eigrpd/eigrp_const.h"#include"eigrpd/eigrp_macros.h"#include"eigrpd/eig
rp_routemap.h"voideigrp_if_rmap_update(structif_rmap*if_rmap){structinterface*if
p;structeigrp_interface*ei,*ei2;structlistnode*node,*nnode;structroute_map*rmap;
structeigrp*e;ifp=if_lookup_by_name(if_rmap->ifname);if(ifp==NULL)return;ei=NULL
;e=eigrp_lookup();for(ALL_LIST_ELEMENTS(e->eiflist,node,nnode,ei2)){if(strcmp(ei
2->ifp->name,ifp->name)==0){ei=ei2;break;}}if(if_rmap->routemap[IF_RMAP_IN]){rma
p=route_map_lookup_by_name(if_rmap->routemap[IF_RMAP_IN]);if(rmap)ei->routemap[I
F_RMAP_IN]=rmap;elseei->routemap[IF_RMAP_IN]=NULL;}elseei->routemap[EIGRP_FILTER
_IN]=NULL;if(if_rmap->routemap[IF_RMAP_OUT]){rmap=route_map_lookup_by_name(if_rm
ap->routemap[IF_RMAP_OUT]);if(rmap)ei->routemap[IF_RMAP_OUT]=rmap;elseei->routem
ap[IF_RMAP_OUT]=NULL;}elseei->routemap[EIGRP_FILTER_OUT]=NULL;}voideigrp_if_rmap
_update_interface(structinterface*ifp){structif_rmap*if_rmap;if_rmap=if_rmap_loo
kup(ifp->name);if(if_rmap)eigrp_if_rmap_update(if_rmap);}voideigrp_routemap_upda
te_redistribute(void){inti;structeigrp*e;e=eigrp_lookup();if(e){for(i=0;i<ZEBRA_
ROUTE_MAX;i++){if(e->route_map[i].name)e->route_map[i].map=route_map_lookup_by_n
ame(e->route_map[i].name);}}}/*ARGSUSED*/voideigrp_rmap_update(constchar*notused
){structinterface*ifp;structlistnode*node,*nnode;for(ALL_LIST_ELEMENTS(iflist,no
de,nnode,ifp))eigrp_if_rmap_update_interface(ifp);eigrp_routemap_update_redistri
bute();}/*Addeigrproutemaprule.*/staticinteigrp_route_match_add(structvty*vty,st
ructroute_map_index*index,constchar*command,constchar*arg){intret;ret=route_map_
add_match(index,command,arg);switch(ret){caseRMAP_RULE_MISSING:vty_out(vty,"%%Ca
n'tfindrule.\n");returnCMD_WARNING_CONFIG_FAILED;break;caseRMAP_COMPILE_ERROR:vt
y_out(vty,"%%Argumentismalformed.\n");returnCMD_WARNING_CONFIG_FAILED;break;case
RMAP_COMPILE_SUCCESS:break;}returnCMD_SUCCESS;}/*Deleteriproutemaprule.*/statici
nteigrp_route_match_delete(structvty*vty,structroute_map_index*index,constchar*c
ommand,constchar*arg){intret;ret=route_map_delete_match(index,command,arg);switc
h(ret){caseRMAP_RULE_MISSING:vty_out(vty,"%%Can'tfindrule.\n");returnCMD_WARNING
_CONFIG_FAILED;break;caseRMAP_COMPILE_ERROR:vty_out(vty,"%%Argumentismalformed.\
n");returnCMD_WARNING_CONFIG_FAILED;break;caseRMAP_COMPILE_SUCCESS:break;}return
CMD_SUCCESS;}/*Addeigrproutemaprule.*/staticinteigrp_route_set_add(structvty*vty
,structroute_map_index*index,constchar*command,constchar*arg){intret;ret=route_m
ap_add_set(index,command,arg);switch(ret){caseRMAP_RULE_MISSING:vty_out(vty,"%%C
an'tfindrule.\n");returnCMD_WARNING_CONFIG_FAILED;break;caseRMAP_COMPILE_ERROR:/
**rip,ripngandotherprotocolssharethesetmetriccommand*butonlyvaluesfrom0to16areva
lidforripandripng*ifmetricisoutofrangeforripandripng,itis*notforotherprotocols.D
onotreturnanerror*/if(strcmp(command,"metric")){vty_out(vty,"%%Argumentismalform
ed.\n");returnCMD_WARNING_CONFIG_FAILED;}break;caseRMAP_COMPILE_SUCCESS:break;}r
eturnCMD_SUCCESS;}/*Deleteeigrproutemaprule.*/staticinteigrp_route_set_delete(st
ructvty*vty,structroute_map_index*index,constchar*command,constchar*arg){intret;
ret=route_map_delete_set(index,command,arg);switch(ret){caseRMAP_RULE_MISSING:vt
y_out(vty,"%%Can'tfindrule.\n");returnCMD_WARNING_CONFIG_FAILED;break;caseRMAP_C
OMPILE_ERROR:vty_out(vty,"%%Argumentismalformed.\n");returnCMD_WARNING_CONFIG_FA
ILED;break;caseRMAP_COMPILE_SUCCESS:break;}returnCMD_SUCCESS;}/*Hookfunctionforu
pdatingroute_mapassignment.*//*ARGSUSED*/voideigrp_route_map_update(constchar*no
tused){inti;structeigrp*e;e=eigrp_lookup();if(e){for(i=0;i<ZEBRA_ROUTE_MAX;i++){
if(e->route_map[i].name)e->route_map[i].map=route_map_lookup_by_name(e->route_ma
p[i].name);}}}/*`matchmetricMETRIC'*//*Matchfunctionreturn1ifmatchissuccesselser
eturnzero.*/staticroute_map_result_troute_match_metric(void*rule,structprefix*pr
efix,route_map_object_ttype,void*object){//uint32_t*metric;//uint32_tcheck;//str
uctrip_info*rinfo;//structeigrp_nexthop_entry*te;//structeigrp_prefix_entry*pe;/
/structlistnode*node,*node2,*nnode,*nnode2;//structeigrp*e;////e=eigrp_lookup();
////if(type==RMAP_EIGRP)//{//metric=rule;//rinfo=object;/////*Ifexternalmetricis
available,theroute-mapshould//workonthisone(forredistributepurpose)*////*check=(
rinfo->external_metric)?rinfo->external_metric://rinfo->metric;*/////if(check==*
metric)//returnRMAP_MATCH;//else//returnRMAP_NOMATCH;//}returnRMAP_NOMATCH;}/*Ro
utemap`matchmetric'matchstatement.`arg'isMETRICvalue*/staticvoid*route_match_met
ric_compile(constchar*arg){//uint32_t*metric;////metric=XMALLOC(MTYPE_ROUTE_MAP_
COMPILED,sizeof(uint32_t));//*metric=atoi(arg);////if(*metric>0)//returnmetric;/
///XFREE(MTYPE_ROUTE_MAP_COMPILED,metric);returnNULL;}/*Freeroutemap'scompiled`m
atchmetric'value.*/staticvoidroute_match_metric_free(void*rule){XFREE(MTYPE_ROUT
E_MAP_COMPILED,rule);}/*Routemapcommandsformetricmatching.*/structroute_map_rule
_cmdroute_match_metric_cmd={"metric",route_match_metric,route_match_metric_compi
le,route_match_metric_free};/*`matchinterfaceIFNAME'*//*Matchfunctionreturn1ifma
tchissuccesselsereturnzero.*/staticroute_map_result_troute_match_interface(void*
rule,structprefix*prefix,route_map_object_ttype,void*object){//structrip_info*ri
nfo;//structinterface*ifp;//char*ifname;////if(type==RMAP_EIGRP)//{//ifname=rule
;//ifp=if_lookup_by_name(ifname);////if(!ifp)//returnRMAP_NOMATCH;////rinfo=obje
ct;/////*if(rinfo->ifindex_out==ifp->ifindex||rinfo->ifindex==//ifp->ifindex)//r
eturnRMAP_MATCH;//else//returnRMAP_NOMATCH;*///}returnRMAP_NOMATCH;}/*Routemap`m
atchinterface'matchstatement.`arg'isIFNAMEvalue*//*XXXIdon`tknowifIneedtocheckdo
esinterfaceexist?*/staticvoid*route_match_interface_compile(constchar*arg){retur
nXSTRDUP(MTYPE_ROUTE_MAP_COMPILED,arg);}/*Freeroutemap'scompiled`matchinterface'
value.*/staticvoidroute_match_interface_free(void*rule){XFREE(MTYPE_ROUTE_MAP_CO
MPILED,rule);}/*Routemapcommandsforinterfacematching.*/structroute_map_rule_cmdr
oute_match_interface_cmd={"interface",route_match_interface,route_match_interfac
e_compile,route_match_interface_free};/*`matchipnext-hopIP_ACCESS_LIST'*//*Match
functionreturn1ifmatchissuccesselsereturnzero.*/staticroute_map_result_troute_ma
tch_ip_next_hop(void*rule,structprefix*prefix,route_map_object_ttype,void*object
){//structaccess_list*alist;//structrip_info*rinfo;//structprefix_ipv4p;////if(t
ype==RMAP_EIGRP)//{//rinfo=object;//p.family=AF_INET;///*p.prefix=(rinfo->nextho
p.s_addr)?rinfo->nexthop://rinfo->from;*///p.prefixlen=IPV4_MAX_BITLEN;////alist
=access_list_lookup(AFI_IP,(char*)rule);//if(alist==NULL)//returnRMAP_NOMATCH;//
//return(access_list_apply(alist,&p)==FILTER_DENY?//RMAP_NOMATCH:RMAP_MATCH);//}
returnRMAP_NOMATCH;}/*Routemap`ipnext-hop'matchstatement.`arg'shouldbeaccess-lis
tname.*/staticvoid*route_match_ip_next_hop_compile(constchar*arg){returnXSTRDUP(
MTYPE_ROUTE_MAP_COMPILED,arg);}/*Freeroutemap'scompiled`.*/staticvoidroute_match
_ip_next_hop_free(void*rule){XFREE(MTYPE_ROUTE_MAP_COMPILED,rule);}/*Routemapcom
mandsforipnext-hopmatching.*/staticstructroute_map_rule_cmdroute_match_ip_next_h
op_cmd={"ipnext-hop",route_match_ip_next_hop,route_match_ip_next_hop_compile,rou
te_match_ip_next_hop_free};/*`matchipnext-hopprefix-listPREFIX_LIST'*/staticrout
e_map_result_troute_match_ip_next_hop_prefix_list(void*rule,structprefix*prefix,
route_map_object_ttype,void*object){//structprefix_list*plist;//structrip_info*r
info;//structprefix_ipv4p;////if(type==RMAP_EIGRP)//{//rinfo=object;//p.family=A
F_INET;///*p.prefix=(rinfo->nexthop.s_addr)?rinfo->nexthop://rinfo->from;*///p.p
refixlen=IPV4_MAX_BITLEN;////plist=prefix_list_lookup(AFI_IP,(char*)rule);//if(p
list==NULL)//returnRMAP_NOMATCH;////return(prefix_list_apply(plist,&p)==PREFIX_D
ENY?//RMAP_NOMATCH:RMAP_MATCH);//}returnRMAP_NOMATCH;}staticvoid*route_match_ip_
next_hop_prefix_list_compile(constchar*arg){returnXSTRDUP(MTYPE_ROUTE_MAP_COMPIL
ED,arg);}staticvoidroute_match_ip_next_hop_prefix_list_free(void*rule){XFREE(MTY
PE_ROUTE_MAP_COMPILED,rule);}staticstructroute_map_rule_cmdroute_match_ip_next_h
op_prefix_list_cmd={"ipnext-hopprefix-list",route_match_ip_next_hop_prefix_list,
route_match_ip_next_hop_prefix_list_compile,route_match_ip_next_hop_prefix_list_
free};/*`matchipaddressIP_ACCESS_LIST'*//*Matchfunctionshouldreturn1ifmatchissuc
cesselsereturnzero.*/staticroute_map_result_troute_match_ip_address(void*rule,st
ructprefix*prefix,route_map_object_ttype,void*object){structaccess_list*alist;if
(type==RMAP_EIGRP){alist=access_list_lookup(AFI_IP,(char*)rule);if(alist==NULL)r
eturnRMAP_NOMATCH;return(access_list_apply(alist,prefix)==FILTER_DENY?RMAP_NOMAT
CH:RMAP_MATCH);}returnRMAP_NOMATCH;}/*Routemap`ipaddress'matchstatement.`arg'sho
uldbeaccess-listname.*/staticvoid*route_match_ip_address_compile(constchar*arg){
returnXSTRDUP(MTYPE_ROUTE_MAP_COMPILED,arg);}/*Freeroutemap'scompiled`ipaddress'
value.*/staticvoidroute_match_ip_address_free(void*rule){XFREE(MTYPE_ROUTE_MAP_C
OMPILED,rule);}/*Routemapcommandsforipaddressmatching.*/staticstructroute_map_ru
le_cmdroute_match_ip_address_cmd={"ipaddress",route_match_ip_address,route_match
_ip_address_compile,route_match_ip_address_free};/*`matchipaddressprefix-listPRE
FIX_LIST'*/staticroute_map_result_troute_match_ip_address_prefix_list(void*rule,
structprefix*prefix,route_map_object_ttype,void*object){structprefix_list*plist;
if(type==RMAP_EIGRP){plist=prefix_list_lookup(AFI_IP,(char*)rule);if(plist==NULL
)returnRMAP_NOMATCH;return(prefix_list_apply(plist,prefix)==PREFIX_DENY?RMAP_NOM
ATCH:RMAP_MATCH);}returnRMAP_NOMATCH;}staticvoid*route_match_ip_address_prefix_l
ist_compile(constchar*arg){returnXSTRDUP(MTYPE_ROUTE_MAP_COMPILED,arg);}staticvo
idroute_match_ip_address_prefix_list_free(void*rule){XFREE(MTYPE_ROUTE_MAP_COMPI
LED,rule);}staticstructroute_map_rule_cmdroute_match_ip_address_prefix_list_cmd=
{"ipaddressprefix-list",route_match_ip_address_prefix_list,route_match_ip_addres
s_prefix_list_compile,route_match_ip_address_prefix_list_free};/*`matchtagTAG'*/
/*Matchfunctionreturn1ifmatchissuccesselsereturnzero.*/staticroute_map_result_tr
oute_match_tag(void*rule,structprefix*prefix,route_map_object_ttype,void*object)
{//unsignedshort*tag;//structrip_info*rinfo;////if(type==RMAP_EIGRP)//{//tag=rul
e;//rinfo=object;/////*Theinformationstoredbyrinfoishostordered.*////*if(rinfo->
tag==*tag)//returnRMAP_MATCH;//else//returnRMAP_NOMATCH;*///}returnRMAP_NOMATCH;
}/*Routemap`matchtag'matchstatement.`arg'isTAGvalue*/staticvoid*route_match_tag_
compile(constchar*arg){//unsignedshort*tag;////tag=XMALLOC(MTYPE_ROUTE_MAP_COMPI
LED,sizeof(unsignedshort));//*tag=atoi(arg);////returntag;}/*Freeroutemap'scompi
led`matchtag'value.*/staticvoidroute_match_tag_free(void*rule){XFREE(MTYPE_ROUTE
_MAP_COMPILED,rule);}/*Routemapcommandsfortagmatching.*/structroute_map_rule_cmd
route_match_tag_cmd={"tag",route_match_tag,route_match_tag_compile,route_match_t
ag_free};/*Setmetrictoattribute.*/staticroute_map_result_troute_set_metric(void*
rule,structprefix*prefix,route_map_object_ttype,void*object){//if(type==RMAP_RIP
)//{//structrip_metric_modifier*mod;//structrip_info*rinfo;////mod=rule;//rinfo=
object;/////*if(mod->type==metric_increment)//rinfo->metric_out+=mod->metric;//e
lseif(mod->type==metric_decrement)//rinfo->metric_out-=mod->metric;//elseif(mod-
>type==metric_absolute)//rinfo->metric_out=mod->metric;////if((signedint)rinfo->
metric_out<1)//rinfo->metric_out=1;//if(rinfo->metric_out>RIP_METRIC_INFINITY)//
rinfo->metric_out=RIP_METRIC_INFINITY;*/////rinfo->metric_set=1;//}returnRMAP_OK
AY;}/*setmetriccompilation.*/staticvoid*route_set_metric_compile(constchar*arg){
//intlen;//constchar*pnt;//inttype;//longmetric;//char*endptr=NULL;//structrip_m
etric_modifier*mod;////len=strlen(arg);//pnt=arg;////if(len==0)//returnNULL;////
/*Examinefirstcharacter.*///if(arg[0]=='+')//{////type=metric_increment;//pnt++;
//}//elseif(arg[0]=='-')//{////type=metric_decrement;//pnt++;//}///*else//type=m
etric_absolute;*//////*Checkbeginningwithdigitstring.*///if(*pnt<'0'||*pnt>'9')/
/returnNULL;/////*Convertstringtointeger.*///metric=strtol(pnt,&endptr,10);////i
f(metric==LONG_MAX||*endptr!='\0')//returnNULL;///*if(metric<0||metric>RIP_METRI
C_INFINITY)//returnNULL;*/////mod=XMALLOC(MTYPE_ROUTE_MAP_COMPILED,//sizeof(stru
ctrip_metric_modifier));//mod->type=type;//mod->metric=metric;//returnmod;}/*Fre
eroutemap'scompiled`setmetric'value.*/staticvoidroute_set_metric_free(void*rule)
{XFREE(MTYPE_ROUTE_MAP_COMPILED,rule);}/*Setmetricrulestructure.*/staticstructro
ute_map_rule_cmdroute_set_metric_cmd={"metric",route_set_metric,route_set_metric
_compile,route_set_metric_free,};/*`setipnext-hopIP_ADDRESS'*//*Setnexthoptoobje
ct.ojbectmustbepointertostructattr.*/staticroute_map_result_troute_set_ip_nextho
p(void*rule,structprefix*prefix,route_map_object_ttype,void*object){//structin_a
ddr*address;//structrip_info*rinfo;////if(type==RMAP_RIP)//{///*Fetchroutemap'sr
uleinformation.*///address=rule;//rinfo=object;/////*Setnexthopvalue.*///rinfo->
nexthop_out=*address;//}returnRMAP_OKAY;}/*Routemap`ipnexthop'compilefunction.Gi
venstringisconvertedtostructin_addrstructure.*/staticvoid*route_set_ip_nexthop_c
ompile(constchar*arg){//intret;//structin_addr*address;////address=XMALLOC(MTYPE
_ROUTE_MAP_COMPILED,sizeof(struct//in_addr));////ret=inet_aton(arg,address);////
if(ret==0)//{//XFREE(MTYPE_ROUTE_MAP_COMPILED,address);//returnNULL;//}////retur
naddress;}/*Freeroutemap'scompiled`ipnexthop'value.*/staticvoidroute_set_ip_next
hop_free(void*rule){XFREE(MTYPE_ROUTE_MAP_COMPILED,rule);}/*Routemapcommandsfori
pnexthopset.*/staticstructroute_map_rule_cmdroute_set_ip_nexthop_cmd={"ipnext-ho
p",route_set_ip_nexthop,route_set_ip_nexthop_compile,route_set_ip_nexthop_free};
/*`settagTAG'*//*Settagtoobject.ojbectmustbepointertostructattr.*/staticroute_ma
p_result_troute_set_tag(void*rule,structprefix*prefix,route_map_object_ttype,voi
d*object){//unsignedshort*tag;//structrip_info*rinfo;////if(type==RMAP_RIP)//{//
/*Fetchroutemap'sruleinformation.*///tag=rule;//rinfo=object;/////*Setnexthopval
ue.*///rinfo->tag_out=*tag;//}returnRMAP_OKAY;}/*Routemap`tag'compilefunction.Gi
venstringisconvertedtounsignedshort.*/staticvoid*route_set_tag_compile(constchar
*arg){//unsignedshort*tag;////tag=XMALLOC(MTYPE_ROUTE_MAP_COMPILED,sizeof(unsign
edshort));//*tag=atoi(arg);////returntag;}/*Freeroutemap'scompiled`ipnexthop'val
ue.*/staticvoidroute_set_tag_free(void*rule){XFREE(MTYPE_ROUTE_MAP_COMPILED,rule
);}/*Routemapcommandsfortagset.*/staticstructroute_map_rule_cmdroute_set_tag_cmd
={"tag",route_set_tag,route_set_tag_compile,route_set_tag_free};#defineMATCH_STR
"Matchvaluesfromroutingtable\n"#defineSET_STR"Setvaluesindestinationroutingproto
col\n"DEFUN(match_metric,match_metric_cmd,"matchmetric<0-4294967295>",MATCH_STR"
Matchmetricofroute\n""Metricvalue\n"){returneigrp_route_match_add(vty,vty->index
,"metric",argv[0]);}DEFUN(no_match_metric,no_match_metric_cmd,"nomatchmetric",NO
_STRMATCH_STR"Matchmetricofroute\n"){if(argc==0)returneigrp_route_match_delete(v
ty,vty->index,"metric",NULL);returneigrp_route_match_delete(vty,vty->index,"metr
ic",argv[0]);}ALIAS(no_match_metric,no_match_metric_val_cmd,"nomatchmetric<0-429
4967295>",NO_STRMATCH_STR"Matchmetricofroute\n""Metricvalue\n")DEFUN(match_inter
face,match_interface_cmd,"matchinterfaceWORD",MATCH_STR"Matchfirsthopinterfaceof
route\n""Interfacename\n"){returneigrp_route_match_add(vty,vty->index,"interface
",argv[0]);}DEFUN(no_match_interface,no_match_interface_cmd,"nomatchinterface",N
O_STRMATCH_STR"Matchfirsthopinterfaceofroute\n"){if(argc==0)returneigrp_route_ma
tch_delete(vty,vty->index,"interface",NULL);returneigrp_route_match_delete(vty,v
ty->index,"interface",argv[0]);}ALIAS(no_match_interface,no_match_interface_val_
cmd,"nomatchinterfaceWORD",NO_STRMATCH_STR"Matchfirsthopinterfaceofroute\n""Inte
rfacename\n")DEFUN(match_ip_next_hop,match_ip_next_hop_cmd,"matchipnext-hop(<1-1
99>|<1300-2699>|WORD)",MATCH_STRIP_STR"Matchnext-hopaddressofroute\n""IPaccess-l
istnumber\n""IPaccess-listnumber(expandedrange)\n""IPAccess-listname\n"){returne
igrp_route_match_add(vty,vty->index,"ipnext-hop",argv[0]);}DEFUN(no_match_ip_nex
t_hop,no_match_ip_next_hop_cmd,"nomatchipnext-hop",NO_STRMATCH_STRIP_STR"Matchne
xt-hopaddressofroute\n"){if(argc==0)returneigrp_route_match_delete(vty,vty->inde
x,"ipnext-hop",NULL);returneigrp_route_match_delete(vty,vty->index,"ipnext-hop",
argv[0]);}ALIAS(no_match_ip_next_hop,no_match_ip_next_hop_val_cmd,"nomatchipnext
-hop(<1-199>|<1300-2699>|WORD)",NO_STRMATCH_STRIP_STR"Matchnext-hopaddressofrout
e\n""IPaccess-listnumber\n""IPaccess-listnumber(expandedrange)\n""IPAccess-listn
ame\n")DEFUN(match_ip_next_hop_prefix_list,match_ip_next_hop_prefix_list_cmd,"ma
tchipnext-hopprefix-listWORD",MATCH_STRIP_STR"Matchnext-hopaddressofroute\n""Mat
chentriesofprefix-lists\n""IPprefix-listname\n"){returneigrp_route_match_add(vty
,vty->index,"ipnext-hopprefix-list",argv[0]);}DEFUN(no_match_ip_next_hop_prefix_
list,no_match_ip_next_hop_prefix_list_cmd,"nomatchipnext-hopprefix-list",NO_STRM
ATCH_STRIP_STR"Matchnext-hopaddressofroute\n""Matchentriesofprefix-lists\n"){if(
argc==0)returneigrp_route_match_delete(vty,vty->index,"ipnext-hopprefix-list",NU
LL);returneigrp_route_match_delete(vty,vty->index,"ipnext-hopprefix-list",argv[0
]);}ALIAS(no_match_ip_next_hop_prefix_list,no_match_ip_next_hop_prefix_list_val_
cmd,"nomatchipnext-hopprefix-listWORD",NO_STRMATCH_STRIP_STR"Matchnext-hopaddres
sofroute\n""Matchentriesofprefix-lists\n""IPprefix-listname\n")DEFUN(match_ip_ad
dress,match_ip_address_cmd,"matchipaddress(<1-199>|<1300-2699>|WORD)",MATCH_STRI
P_STR"Matchaddressofroute\n""IPaccess-listnumber\n""IPaccess-listnumber(expanded
range)\n""IPAccess-listname\n"){returneigrp_route_match_add(vty,vty->index,"ipad
dress",argv[0]);}DEFUN(no_match_ip_address,no_match_ip_address_cmd,"nomatchipadd
ress",NO_STRMATCH_STRIP_STR"Matchaddressofroute\n"){if(argc==0)returneigrp_route
_match_delete(vty,vty->index,"ipaddress",NULL);returneigrp_route_match_delete(vt
y,vty->index,"ipaddress",argv[0]);}ALIAS(no_match_ip_address,no_match_ip_address
_val_cmd,"nomatchipaddress(<1-199>|<1300-2699>|WORD)",NO_STRMATCH_STRIP_STR"Matc
haddressofroute\n""IPaccess-listnumber\n""IPaccess-listnumber(expandedrange)\n""
IPAccess-listname\n")DEFUN(match_ip_address_prefix_list,match_ip_address_prefix_
list_cmd,"matchipaddressprefix-listWORD",MATCH_STRIP_STR"Matchaddressofroute\n""
Matchentriesofprefix-lists\n""IPprefix-listname\n"){returneigrp_route_match_add(
vty,vty->index,"ipaddressprefix-list",argv[0]);}DEFUN(no_match_ip_address_prefix
_list,no_match_ip_address_prefix_list_cmd,"nomatchipaddressprefix-list",NO_STRMA
TCH_STRIP_STR"Matchaddressofroute\n""Matchentriesofprefix-lists\n"){if(argc==0)r
eturneigrp_route_match_delete(vty,vty->index,"ipaddressprefix-list",NULL);return
eigrp_route_match_delete(vty,vty->index,"ipaddressprefix-list",argv[0]);}ALIAS(n
o_match_ip_address_prefix_list,no_match_ip_address_prefix_list_val_cmd,"nomatchi
paddressprefix-listWORD",NO_STRMATCH_STRIP_STR"Matchaddressofroute\n""Matchentri
esofprefix-lists\n""IPprefix-listname\n")DEFUN(match_tag,match_tag_cmd,"matchtag
<0-65535>",MATCH_STR"Matchtagofroute\n""Metricvalue\n"){returneigrp_route_match_
add(vty,vty->index,"tag",argv[0]);}DEFUN(no_match_tag,no_match_tag_cmd,"nomatcht
ag",NO_STRMATCH_STR"Matchtagofroute\n"){if(argc==0)returneigrp_route_match_delet
e(vty,vty->index,"tag",NULL);returneigrp_route_match_delete(vty,vty->index,"tag"
,argv[0]);}ALIAS(no_match_tag,no_match_tag_val_cmd,"nomatchtag<0-65535>",NO_STRM
ATCH_STR"Matchtagofroute\n""Metricvalue\n")/*setfunctions*/DEFUN(set_metric,set_
metric_cmd,"setmetric<0-4294967295>",SET_STR"Metricvaluefordestinationroutingpro
tocol\n""Metricvalue\n"){returneigrp_route_set_add(vty,vty->index,"metric",argv[
0]);}ALIAS(set_metric,set_metric_addsub_cmd,"setmetric<+/-metric>",SET_STR"Metri
cvaluefordestinationroutingprotocol\n""Addorsubtractmetric\n")DEFUN(no_set_metri
c,no_set_metric_cmd,"nosetmetric",NO_STRSET_STR"Metricvaluefordestinationrouting
protocol\n"){if(argc==0)returneigrp_route_set_delete(vty,vty->index,"metric",NUL
L);returneigrp_route_set_delete(vty,vty->index,"metric",argv[0]);}ALIAS(no_set_m
etric,no_set_metric_val_cmd,"nosetmetric(<0-4294967295>|<+/-metric>)",NO_STRSET_
STR"Metricvaluefordestinationroutingprotocol\n""Metricvalue\n""Addorsubtractmetr
ic\n")DEFUN(set_ip_nexthop,set_ip_nexthop_cmd,"setipnext-hopA.B.C.D",SET_STRIP_S
TR"Nexthopaddress\n""IPaddressofnexthop\n"){unionsockunionsu;intret;ret=str2sock
union(argv[0],&su);if(ret<0){vty_out(vty,"%%Malformednext-hopaddress\n");returnC
MD_WARNING_CONFIG_FAILED;}returneigrp_route_set_add(vty,vty->index,"ipnext-hop",
argv[0]);}DEFUN(no_set_ip_nexthop,no_set_ip_nexthop_cmd,"nosetipnext-hop",NO_STR
SET_STRIP_STR"Nexthopaddress\n"){if(argc==0)returneigrp_route_set_delete(vty,vty
->index,"ipnext-hop",NULL);returneigrp_route_set_delete(vty,vty->index,"ipnext-h
op",argv[0]);}ALIAS(no_set_ip_nexthop,no_set_ip_nexthop_val_cmd,"nosetipnext-hop
A.B.C.D",NO_STRSET_STRIP_STR"Nexthopaddress\n""IPaddressofnexthop\n")DEFUN(set_t
ag,set_tag_cmd,"settag<0-65535>",SET_STR"Tagvalueforroutingprotocol\n""Tagvalue\
n"){returneigrp_route_set_add(vty,vty->index,"tag",argv[0]);}DEFUN(no_set_tag,no
_set_tag_cmd,"nosettag",NO_STRSET_STR"Tagvalueforroutingprotocol\n"){if(argc==0)
returneigrp_route_set_delete(vty,vty->index,"tag",NULL);returneigrp_route_set_de
lete(vty,vty->index,"tag",argv[0]);}ALIAS(no_set_tag,no_set_tag_val_cmd,"nosetta
g<0-65535>",NO_STRSET_STR"Tagvalueforroutingprotocol\n""Tagvalue\n")/*Route-mapi
nit*/voideigrp_route_map_init(){route_map_init();route_map_init_vty();route_map_
add_hook(eigrp_route_map_update);route_map_delete_hook(eigrp_route_map_update);/
*route_map_install_match(&route_match_metric_cmd);route_map_install_match(&route
_match_interface_cmd);*//*route_map_install_match(&route_match_ip_next_hop_cmd);
route_map_install_match(&route_match_ip_next_hop_prefix_list_cmd);route_map_inst
all_match(&route_match_ip_address_cmd);route_map_install_match(&route_match_ip_a
ddress_prefix_list_cmd);*//*route_map_install_match(&route_match_tag_cmd);*//*ro
ute_map_install_set(&route_set_metric_cmd);route_map_install_set(&route_set_ip_n
exthop_cmd);route_map_install_set(&route_set_tag_cmd);*//*install_element(RMAP_N
ODE,&route_match_metric_cmd);install_element(RMAP_NODE,&no_match_metric_cmd);ins
tall_element(RMAP_NODE,&no_match_metric_val_cmd);install_element(RMAP_NODE,&rout
e_match_interface_cmd);install_element(RMAP_NODE,&no_match_interface_cmd);instal
l_element(RMAP_NODE,&no_match_interface_val_cmd);install_element(RMAP_NODE,&rout
e_match_ip_next_hop_cmd);install_element(RMAP_NODE,&no_match_ip_next_hop_cmd);in
stall_element(RMAP_NODE,&no_match_ip_next_hop_val_cmd);install_element(RMAP_NODE
,&route_match_ip_next_hop_prefix_list_cmd);install_element(RMAP_NODE,&no_match_i
p_next_hop_prefix_list_cmd);install_element(RMAP_NODE,&no_match_ip_next_hop_pref
ix_list_val_cmd);*//*install_element(RMAP_NODE,&route_match_ip_address_cmd);inst
all_element(RMAP_NODE,&no_match_ip_address_cmd);install_element(RMAP_NODE,&no_ma
tch_ip_address_val_cmd);install_element(RMAP_NODE,&route_match_ip_address_prefix
_list_cmd);install_element(RMAP_NODE,&no_match_ip_address_prefix_list_cmd);insta
ll_element(RMAP_NODE,&no_match_ip_address_prefix_list_val_cmd);*//*install_eleme
nt(RMAP_NODE,&route_match_tag_cmd);install_element(RMAP_NODE,&no_match_tag_cmd);
install_element(RMAP_NODE,&no_match_tag_val_cmd);*//*install_element(RMAP_NODE,&
set_metric_cmd);install_element(RMAP_NODE,&set_metric_addsub_cmd);install_elemen
t(RMAP_NODE,&no_set_metric_cmd);install_element(RMAP_NODE,&no_set_metric_val_cmd
);install_element(RMAP_NODE,&set_ip_nexthop_cmd);install_element(RMAP_NODE,&no_s
et_ip_nexthop_cmd);install_element(RMAP_NODE,&no_set_ip_nexthop_val_cmd);install
_element(RMAP_NODE,&set_tag_cmd);install_element(RMAP_NODE,&no_set_tag_cmd);inst
all_element(RMAP_NODE,&no_set_tag_val_cmd);*/}