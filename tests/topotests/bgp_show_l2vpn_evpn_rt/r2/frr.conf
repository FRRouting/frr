! debug zebra vxlan
! debug zebra kernel
! debug zebra dplane
! debug zebra rib
! debug bgp neighbor-events
! debug bgp updates
! debug bgp zebra

vrf vrf-101
 vni 101
 exit-vrf
!
vrf vrf-102
 vni 102
 exit-vrf
!
interface loop101 vrf vrf-101
 ip address 10.0.101.2/32
 ipv6 address fd01::2/128
!
interface loop102 vrf vrf-102
 ip address 10.0.102.2/32
 ipv6 address fd02::2/128
!
int lo
 ip address 192.168.0.2/32
!
interface eth-r2
 ip address 192.168.2.2/4
!
ip route 0.0.0.0/0 192.168.2.1
!
router bgp 65000
 bgp router-id 192.168.0.2
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 neighbor 192.168.2.1 peer-group
 neighbor 192.168.2.1 remote-as 65000
 neighbor 192.168.2.1 capability extended-nexthop
 !
 address-family l2vpn evpn
  neighbor 192.168.2.1 activate
  neighbor 192.168.2.1 route-map r2 out
  advertise-all-vni
 exit-address-family
!
router bgp 65000 vrf vrf-101
 bgp router-id 10.0.101.2
 bgp log-neighbor-changes
 no bgp network import-check
 address-family ipv4 unicast
  network 10.0.101.2/32
  network 10.0.101.12/32
 exit-address-family
 address-family ipv6 unicast
  network fd01::2/128
  network fd01::12/128
 exit-address-family
 address-family l2vpn evpn
  rd 65000:2
  route-target both 65000:101
  advertise ipv4 unicast
  advertise ipv6 unicast
 exit-address-family
 !
router bgp 65000 vrf vrf-102
 bgp router-id 10.0.102.2
 bgp log-neighbor-changes
 no bgp network import-check
 address-family ipv4 unicast
  network 10.0.102.2/32
 exit-address-family
 address-family ipv6 unicast
  network fd02::2/128
 exit-address-family
 address-family l2vpn evpn
  rd 65000:4
  route-target both 65000:102
  advertise ipv4 unicast
  advertise ipv6 unicast
 exit-address-family
 !
route-map rmap_r2 permit 1
 match evpn vni 101
exit
!
route-map rmap_r2 permit 2
 match evpn vni 102
exit
