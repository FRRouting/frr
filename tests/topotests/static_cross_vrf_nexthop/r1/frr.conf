!
! Router r1 configuration
!
! This router has two VRFs: vrf_a and vrf_b
!

interface vrf_a
   ip address 192.168.1.1/24

interface vrf_b
   ip address 192.168.2.1/24

! Configure interface for vrf_a with a connected network
interface r1-eth0 vrf vrf_a
 ip address 192.168.1.1/24
exit

! In vrf_a, add a static route that will be used by cross-vrf routes
! This creates the prefix 10.0.0.0/24 reachable via 192.168.1.2
ip route 10.0.0.0/24 192.168.1.2 vrf vrf_a

! Test case 1: Same VRF - should NOT install
! This attempts to resolve 10.0.0.0/24 via 10.0.0.3, where 10.0.0.3
! is within the 10.0.0.0/24 prefix itself (routing loop)
! This should be rejected by zebra
ip route 10.0.0.0/24 10.0.0.3 vrf vrf_a

! Test case 2: Cross VRF - SHOULD install
! In vrf_b, install a route to 10.0.0.0/24 via 10.0.0.3
! but the nexthop is resolved in vrf_a
! Even though the prefix is the same, this should be allowed
! because the nexthop resolution is in a different VRF
ip route 10.0.0.0/24 10.0.0.3 vrf vrf_b nexthop-vrf vrf_a

! Test case 3: Cross VRF with different prefix - SHOULD install
! This is a normal cross-vrf route with different prefixes
ip route 172.16.0.0/16 192.168.1.10 vrf vrf_b nexthop-vrf vrf_a

!

