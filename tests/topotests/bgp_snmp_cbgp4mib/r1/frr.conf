!
hostname r1
!
agentx
!
interface lo
 ip address 192.0.2.1/32
 ipv6 address fd01:1::1/128
!
interface r1-eth0
 ip address 10.10.0.1/24
 ipv6 address fd00:0::1/64
 no shutdown
!
interface r1-eth1
 ip address 10.10.1.1/24
 ipv6 address fd00:1::1/64
 no shutdown
!
interface r1-eth2
 ip address 10.10.2.1/24
 ipv6 address fd00:2::1/64
 no shutdown
!
vrf RED
 exit-vrf
!
interface r1-eth3 vrf RED
 ip address 10.10.3.1/24
 no shutdown
!
interface r1-eth4 vrf RED
 ip address 10.10.4.1/24
 no shutdown
!
interface r1-eth5 vrf RED
 ip address 10.10.5.1/24
 no shutdown
!
! Prefix-list to match routes to be filtered
ip prefix-list FILTER_ROUTES permit 192.168.10.0/24
ip prefix-list FILTER_ROUTES permit 192.168.20.0/24
!
! Route-map to apply inbound filtering
route-map FILTER_IN deny 10
 match ip address prefix-list FILTER_ROUTES
exit
route-map FILTER_IN permit 20
exit
!
! BGP instance for the default VRF
router bgp 65001
 bgp router-id 192.0.2.1
 ! Peer with the loopback addresses for default VRF sessions
 neighbor 10.10.0.2 remote-as 65001
 neighbor fd00:0:0:0::2 remote-as 65001
 neighbor PEER_GROUP_1 peer-group
 neighbor PEER_GROUP_1 remote-as 65001
 neighbor PEER_GROUP_2 peer-group
 neighbor PEER_GROUP_2 remote-as 65001
 neighbor PEER_GROUP_3 peer-group
 neighbor PEER_GROUP_3 remote-as 65001
 neighbor PEER_GROUP_4 peer-group
 neighbor PEER_GROUP_4 remote-as 65001
 neighbor 10.10.1.2 peer-group PEER_GROUP_4
 neighbor 10.10.2.2 peer-group PEER_GROUP_3
 neighbor fd00:1::2 peer-group PEER_GROUP_2
 neighbor fd00:2::2 peer-group PEER_GROUP_1

 address-family ipv4 unicast
  network 192.0.2.1/32
  neighbor 10.10.0.2 soft-reconfiguration inbound
  neighbor 10.10.0.2 route-map FILTER_IN in
  neighbor 10.10.0.2 maximum-prefix 10
  neighbor fd00::2 maximum-prefix 10
  neighbor PEER_GROUP_4 maximum-prefix 10
  neighbor PEER_GROUP_3 maximum-prefix 10
  neighbor PEER_GROUP_2 maximum-prefix 10
  neighbor PEER_GROUP_1 maximum-prefix 10
 exit-address-family

 address-family ipv6 unicast
  neighbor fd00::2 activate
  neighbor fd00::2 maximum-prefix 10
  neighbor PEER_GROUP_1 activate
  neighbor PEER_GROUP_1 maximum-prefix 10
  neighbor PEER_GROUP_2 activate
  neighbor PEER_GROUP_2 maximum-prefix 10
  network fd01:1::1/128
 exit-address-family

 address-family ipv4 vpn
  neighbor 10.10.0.2 activate
  neighbor 10.10.1.2 activate
  neighbor 10.10.2.2 activate
 exit-address-family

 address-family l2vpn evpn
  neighbor 10.10.0.2 activate
  neighbor 10.10.1.2 activate
  neighbor 10.10.2.2 activate
  advertise-all-vni
 exit-address-family

 address-family ipv4 rtfilter
  neighbor 10.10.0.2 activate
  neighbor 10.10.1.2 activate
  neighbor 10.10.2.2 activate
 exit-address-family
!
! BGP instance specifically for the RED VRF
router bgp 65001 vrf RED
 bgp router-id 10.10.3.1
 ! Peer with the neighbor on the dedicated VRF link
 neighbor 10.10.3.2 remote-as 65001
 neighbor VRF_PEER_GROUP_1 peer-group
 neighbor VRF_PEER_GROUP_1 remote-as 65001
 neighbor VRF_PEER_GROUP_2 peer-group
 neighbor VRF_PEER_GROUP_2 remote-as 65001
 neighbor 10.10.5.2 peer-group VRF_PEER_GROUP_1
 neighbor 10.10.4.2 peer-group VRF_PEER_GROUP_2
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
 exit-address-family
!
