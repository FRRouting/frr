mpls label dynamic-block 1000 1048575
!
interface lo
 ip address 192.168.0.2/32
 ipv6 address 3fff::192:168:0:2/128
!
interface eth-rr1
 ip address 10.0.2.2/24
!
interface eth-ce3
 ip address 172.16.3.1/24
 ipv6 address 3fff:3::1/64
!
interface eth-ce4
 ip address 172.16.4.1/24
 ipv6 address 3fff:4::1/64
!
router bgp 65000
  bgp router-id 192.168.0.2
  no bgp ebgp-requires-policy
  bgp bestpath compare-routerid
  no bgp default ipv4-unicast
  neighbor 192.168.0.101 remote-as 65000
  neighbor 192.168.0.101 bfd profile BGP
  neighbor 192.168.0.101 update-source 192.168.0.2
  neighbor 3fff::192:168:0:101 remote-as 65000
  neighbor 3fff::192:168:0:101 bfd profile BGP
  neighbor 3fff::192:168:0:101 update-source 3fff::192:168:0:2
!
 address-family ipv4 unicast
   no neighbor 192.168.0.101 activate
  exit-address-family
!
  address-family ipv4 rt-constraint
   neighbor 192.168.0.101 activate
   neighbor 192.168.0.101 soft-reconfiguration inbound
  exit-address-family
!
  address-family ipv4 vpn
   neighbor 192.168.0.101 activate
   neighbor 192.168.0.101 soft-reconfiguration inbound
  exit-address-family
!
  address-family ipv6 vpn
   neighbor 3fff::192:168:0:101 activate
   neighbor 3fff::192:168:0:101 soft-reconfiguration inbound
  exit-address-family
!
router bgp 65000 vrf RED
 bgp router-id 192.168.0.2
 no bgp ebgp-requires-policy
 bgp bestpath compare-routerid
 neighbor 172.16.3.254 remote-as external
 neighbor 172.16.3.254 bfd profile BGP
 neighbor 3fff:3::ff remote-as external
 neighbor 3fff:3::ff bfd profile BGP
 !
 address-family ipv4 unicast
  label vpn export 100
  rd vpn export 65000:100
  rt vpn both 65000:100
  export vpn
  import vpn
  neighbor 172.16.3.254 next-hop-self
  no neighbor 3fff:3::ff activate
 exit-address-family
!
address-family ipv6 unicast
  label vpn export 200
  rd vpn export 65000:100
  rt vpn both 65000:100
  export vpn
  import vpn
  neighbor 3fff:3::ff activate
  neighbor 3fff:3::ff next-hop-self
 exit-address-family
exit
!
router bgp 65000 vrf GREEN
 bgp router-id 192.168.0.2
 no bgp ebgp-requires-policy
 bgp bestpath compare-routerid
 neighbor 172.16.4.254 remote-as external
 neighbor 172.16.4.254 bfd profile BGP
 neighbor 3fff:4::ff remote-as external
 neighbor 3fff:4::ff bfd profile BGP
 !
 address-family ipv4 unicast
  label vpn export 102
  rd vpn export 65000:102
  rt vpn both 65000:102
  export vpn
  import vpn
  neighbor 172.16.4.254 next-hop-self
  no neighbor 3fff:4::ff activate
 exit-address-family
!
 address-family ipv6 unicast
  label vpn export 202
  rd vpn export 65000:102
  rt vpn both 65000:102
  export vpn
  import vpn
  neighbor 3fff:4::ff activate
  neighbor 3fff:4::ff next-hop-self
 exit-address-family
exit
!
mpls label dynamic-block 1000 1048575
!
interface lo
 ip router isis 1
 isis hello-interval 2
 ipv6 router isis 1
!
interface eth-rr1
 ip router isis 1
 isis hello-interval 2
 ipv6 router isis 1
!
router isis 1
 lsp-gen-interval 2
 net 10.0000.0000.0000.0000.0000.0000.0000.0000.0002.00
 metric-style wide
 exit
!
mpls ldp
 router-id 192.168.0.2
 !
 address-family ipv4
  discovery transport-address 192.168.0.2
  !
  interface eth-rr1
  !
 address-family ipv6
  discovery transport-address 3fff::192:168:0:2
  !
  interface eth-rr1
  !
 !
!
bfd
 profile BGP
  transmit-interval 2000
  receive-interval 2000
 exit
 !
exit
