frr defaults datacenter
service integrated-vtysh-config
hostname tor-22
log syslog
log timestamp precision 6
!
interface lo
 description Loopback
 ip address 10.0.0.31/32
 ipv6 address fd00:0:20::31/128
!
interface swp1
 description swp1 -> leaf-21's swp4
 ipv6 address fd00:10:254::1f:0:2/126
!
interface swp2
 description swp2 -> leaf-22's swp4
 ipv6 address fd00:10:254::23:0:2/126
!
interface vlan111
 description VLAN 111 SVI (L2VNI 1000111)
 ip address 192.168.11.22/24
 ipv6 address fd00:60:1:1::22/64
 vrf vrf2
!
interface vlan112
 description VLAN 112 SVI (L2VNI 1000112)
 ip address 192.168.12.22/24
 ipv6 address fd00:50:1:1::22/64
 vrf vrf1
!
vrf vrf1
 vni 104001
 ip route 203.0.117.0/24 blackhole
 ipv6 route 2001:db8:72:22::/64 blackhole
!
vrf vrf2
 vni 104002
 ip route 203.0.116.0/24 blackhole
 ipv6 route 2001:db8:73:22::/64 blackhole
!
route-map ALLOW_LOBR permit 10
 match interface lo
exit
!
route-map ALLOW_LOBR permit 20
 match interface br1
exit
!
route-map ALLOW_LO permit 10
 match interface lo
exit
!
router bgp 650031
 bgp router-id 10.0.0.31
 bgp bestpath as-path multipath-relax
 bgp bestpath compare-routerid
 neighbor TOR-LEAF-SPINE peer-group
 neighbor TOR-LEAF-SPINE advertisement-interval 0
 neighbor TOR-LEAF-SPINE timers 3 10
 neighbor TOR-LEAF-SPINE timers connect 5
 neighbor TOR-LEAF-SPINE capability extended-nexthop
 neighbor fd00:10:254::1f:0:1 remote-as external
 neighbor fd00:10:254::1f:0:1 peer-group TOR-LEAF-SPINE
 neighbor fd00:10:254::23:0:1 remote-as external
 neighbor fd00:10:254::23:0:1 peer-group TOR-LEAF-SPINE
 !
 address-family ipv4 unicast
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE activate
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor TOR-LEAF-SPINE activate
  advertise-all-vni
 exit-address-family
!
router bgp 650031 vrf vrf1
 bgp router-id 10.0.0.31
 !
 address-family ipv4 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family ipv6 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
!  rd 10.0.0.31:1
!  route-target import 660000:1
!  route-target export 660000:1
 exit-address-family
!
router bgp 650031 vrf vrf2
 bgp router-id 10.0.0.31
 !
 address-family ipv4 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family ipv6 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
!  rd 10.0.0.31:2
!  route-target import 660000:2
!  route-target export 660000:2
 exit-address-family
!
end
