frr version 8.5
frr defaults datacenter
service integrated-vtysh-config
hostname bordertor-12
log syslog informational
!
interface lo
 description Loopback
 ip address 6.0.0.2/32
 ipv6 address 2006:20:20::2/128
!
interface swp1
 description swp1 -> leaf-11's swp4
 ipv6 address 2010:2254::7:0:1/126
!
interface swp2
 description swp2 -> leaf-12's swp4
 ipv6 address 2010:2254::8:0:1/126
!
interface swp3
 description swp3 -> ext-1's swp2
 ipv6 address 2010:2254::9:0:1/126
!
interface swp3.4001
 description VLAN 4001 - VRF1 L3VNI to ext-1
 ip address 144.2.1.2/30
 ipv6 address 2144:2:1:1::2/64
 vrf vrf1
!
interface swp3.4002
 description VLAN 4002 - VRF2 L3VNI to ext-1
 ip address 144.2.1.6/30
 ipv6 address 2144:2:1:2::6/64
 vrf vrf2
!
interface vlan111
 description VLAN 111 SVI (L2VNI 1000111)
 ip address 60.1.1.12/24
 ipv6 address 2060:1:1:1::12/64
 vrf vrf2
!
interface vlan112
 description VLAN 112 SVI (L2VNI 1000112)
 ip address 50.1.1.12/24
 ipv6 address 2050:1:1:1::12/64
 vrf vrf1
!
vrf vrf1
 vni 104001
!
vrf vrf2
 vni 104002
!
ip prefix-list LOCAL_HOST_VRF1 seq 1 permit 50.1.120.0/24
ip prefix-list LOCAL_HOST_VRF1 seq 2 deny any
ip prefix-list LOCAL_HOST_VRF2 seq 1 permit 60.1.120.0/24
ip prefix-list LOCAL_HOST_VRF2 seq 2 deny any
!
ipv6 prefix-list LOCAL_HOST_VRF1_v6 seq 1 permit 2050:1:1:120::/64
ipv6 prefix-list LOCAL_HOST_VRF1_v6 seq 2 deny any
ipv6 prefix-list LOCAL_HOST_VRF2_v6 seq 1 permit 2060:1:1:120::/64
ipv6 prefix-list LOCAL_HOST_VRF2_v6 seq 2 deny any
!
route-map ALLOW_LOBR permit 10
 match interface lo
exit
!
route-map ALLOW_LOBR permit 20
 match interface br1
exit
!
route-map ALLOW_LO permit 10
 match interface lo
exit
!
route-map HOST_ALLOW_1 permit 1
 match ip address prefix-list LOCAL_HOST_VRF1
exit
!
route-map HOST_ALLOW_1_v6 permit 1
 match ipv6 address prefix-list LOCAL_HOST_VRF1_v6
exit
!
route-map HOST_ALLOW_2 permit 1
 match ip address prefix-list LOCAL_HOST_VRF2
exit
!
route-map HOST_ALLOW_2_v6 permit 1
 match ipv6 address prefix-list LOCAL_HOST_VRF2_v6
exit
!
router bgp 660000
 bgp router-id 6.0.0.2
 bgp bestpath as-path multipath-relax
 bgp bestpath compare-routerid
 no bgp default ipv4-unicast
 neighbor TOR-LEAF-SPINE peer-group
 neighbor TOR-LEAF-SPINE advertisement-interval 0
 neighbor TOR-LEAF-SPINE timers 3 10
 neighbor TOR-LEAF-SPINE timers connect 5
 ! neighbor TOR-LEAF-SPINE capability extended-nexthop
 neighbor 2010:2254::7:0:2 remote-as external
 neighbor 2010:2254::7:0:2 peer-group TOR-LEAF-SPINE
 neighbor 2010:2254::8:0:2 remote-as external
 neighbor 2010:2254::8:0:2 peer-group TOR-LEAF-SPINE
 !
 address-family ipv4 unicast
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE activate
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor TOR-LEAF-SPINE activate
  neighbor TOR-LEAF-SPINE allowas-in 1
  advertise-all-vni
 exit-address-family
!
router bgp 660000 vrf vrf1
 bgp router-id 144.2.1.2
 no bgp network import-check
 neighbor 2144:2:1:1::1 remote-as external
 ! neighbor 2144:2:1:1::1 capability extended-nexthop
 !
 address-family ipv4 unicast
  neighbor 2144:2:1:1::1 activate
  network 50.1.1.122/32
  redistribute connected route-map HOST_ALLOW_1
 exit-address-family
 !
 address-family ipv6 unicast
  neighbor 2144:2:1:1::1 activate
  network 2050:1:1:1::122/128
  redistribute connected route-map HOST_ALLOW_1_v6
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
  advertise-default-gw
!  rd 6.0.0.2:1
!  route-target import 660000:1
!  route-target export 660000:1
 exit-address-family
!
router bgp 660000 vrf vrf2
 bgp router-id 144.2.1.6
 no bgp network import-check
 neighbor 2144:2:1:2::5 remote-as external
 ! neighbor 2144:2:1:2::5 capability extended-nexthop
 !
 address-family ipv4 unicast
  neighbor 2144:2:1:2::5 activate
  network 60.1.1.121/32
  redistribute connected route-map HOST_ALLOW_2
 exit-address-family
 !
 address-family ipv6 unicast
  neighbor 2144:2:1:2::5 activate
  network 2060:1:1:1::121/128
  redistribute connected route-map HOST_ALLOW_2_v6
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
  advertise-default-gw
!  rd 6.0.0.2:2
!  route-target import 660000:2
!  route-target export 660000:2
 exit-address-family
!
end
