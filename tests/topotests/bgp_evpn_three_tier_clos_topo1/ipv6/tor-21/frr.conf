frr version 8.5
frr defaults datacenter
service integrated-vtysh-config
hostname tor-21
log syslog informational
!
interface lo
 description Loopback
 ip address 6.0.0.30/32
 ipv6 address 2006:20:20::30/128
!
interface swp1
 description swp1 -> leaf-21's swp3
 ipv6 address 2010:2254::1e:0:2/126
!
interface swp2
 description swp2 -> leaf-22's swp3
 ipv6 address 2010:2254::22:0:2/126
!
interface vlan111
 description VLAN 111 SVI (L2VNI 1000111)
 ip address 60.1.1.21/24
 ipv6 address 2060:1:1:1::21/64
 vrf vrf2
!
interface vlan112
 description VLAN 112 SVI (L2VNI 1000112)
 ip address 50.1.1.21/24
 ipv6 address 2050:1:1:1::21/64
 vrf vrf1
!
vrf vrf1
 vni 104001
 ip route 72.21.1.0/24 blackhole
 ipv6 route 2001:21:1:1::/64 blackhole
!
vrf vrf2
 vni 104002
 ip route 73.21.1.0/24 blackhole
 ipv6 route 2003:21:1:1::/64 blackhole
!
route-map ALLOW_LOBR permit 10
 match interface lo
exit
!
route-map ALLOW_LOBR permit 20
 match interface br1
exit
!
route-map ALLOW_LO permit 10
 match interface lo
exit
!
router bgp 650030
 bgp router-id 6.0.0.30
 bgp bestpath as-path multipath-relax
 bgp bestpath compare-routerid
 neighbor TOR-LEAF-SPINE peer-group
 neighbor TOR-LEAF-SPINE advertisement-interval 0
 neighbor TOR-LEAF-SPINE timers 3 10
 neighbor TOR-LEAF-SPINE timers connect 5
 neighbor TOR-LEAF-SPINE capability extended-nexthop
 neighbor 2010:2254::1e:0:1 remote-as external
 neighbor 2010:2254::1e:0:1 peer-group TOR-LEAF-SPINE
 neighbor 2010:2254::22:0:1 remote-as external
 neighbor 2010:2254::22:0:1 peer-group TOR-LEAF-SPINE
 !
 address-family ipv4 unicast
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE activate
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor TOR-LEAF-SPINE activate
  advertise-all-vni
 exit-address-family
!
router bgp 650030 vrf vrf1
 bgp router-id 6.0.0.30
 !
 address-family ipv4 unicast
  redistribute connected
  redistribute static
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  redistribute static
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
!  rd 6.0.0.30:1
!  route-target import 660000:1
!  route-target export 660000:1
 exit-address-family
!
router bgp 650030 vrf vrf2
 bgp router-id 6.0.0.30
 !
 address-family ipv4 unicast
  redistribute connected
  redistribute static
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  redistribute static
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
!  rd 6.0.0.30:2
!  route-target import 660000:2
!  route-target export 660000:2
 exit-address-family
!
end
