frr defaults datacenter
service integrated-vtysh-config
hostname tor-21
log syslog informational
!
interface lo
 description Loopback
 ip address 10.0.0.30/32
!
interface swp1
 description swp1 -> leaf-21's swp3
 ip address 10.254.0.122/30
!
interface swp2
 description swp2 -> leaf-22's swp3
 ip address 10.254.0.138/30
!
interface vlan111
 description VLAN 111 SVI (L2VNI 1000111)
 ip address 192.168.11.21/24
 ipv6 address fd00:60:1:1::21/64
 vrf vrf2
!
interface vlan112
 description VLAN 112 SVI (L2VNI 1000112)
 ip address 192.168.12.21/24
 ipv6 address fd00:50:1:1::21/64
 vrf vrf1
!
vrf vrf1
 vni 104001
 ip route 203.0.113.0/24 blackhole
 ipv6 route 2001:db8:72:21::/64 blackhole
!
vrf vrf2
 vni 104002
 ip route 203.0.115.0/24 blackhole
 ipv6 route 2001:db8:73:21::/64 blackhole
!
route-map ALLOW_LOBR permit 10
 match interface lo
exit
!
route-map ALLOW_LOBR permit 20
 match interface br1
exit
!
route-map ALLOW_LO permit 10
 match interface lo
exit
!
router bgp 650030
 bgp router-id 10.0.0.30
 no bgp default ipv4-unicast
 neighbor 10.254.0.121 remote-as 651004
 neighbor 10.254.0.137 remote-as 651004
 !
 address-family ipv4 unicast
  neighbor 10.254.0.121 activate
  neighbor 10.254.0.137 activate
  redistribute connected route-map ALLOW_LOBR
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 10.254.0.121 activate
  neighbor 10.254.0.137 activate
  advertise-all-vni
 exit-address-family
!
router bgp 650030 vrf vrf1
 bgp router-id 10.0.0.30
 !
 address-family ipv4 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family ipv6 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
 exit-address-family
!
router bgp 650030 vrf vrf2
 bgp router-id 10.0.0.30
 !
 address-family ipv4 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family ipv6 unicast
  !redistribute connected
  redistribute static
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
 exit-address-family
!
end
