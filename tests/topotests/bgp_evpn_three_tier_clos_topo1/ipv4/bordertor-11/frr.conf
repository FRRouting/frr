frr defaults datacenter
service integrated-vtysh-config
hostname bordertor-11
log syslog informational
!
interface lo
 description Loopback
 ip address 10.0.0.1/32
!
interface swp1
 description swp1 -> leaf-11's swp3
 ip address 10.254.0.1/30
!
interface swp2
 description swp2 -> leaf-12's swp3
 ip address 10.254.0.5/30
!
interface swp3
 description swp3 -> ext-1's swp1
 ip address 10.254.0.9/30
!
interface swp3.4001
 description VLAN 4001 - VRF1 L3VNI to ext-1
 ip address 192.0.2.2/30
 ipv6 address 2001:db8:144:1::2/64
 vrf vrf1
!
interface swp3.4002
 description VLAN 4002 - VRF2 L3VNI to ext-1
 ip address 192.0.2.6/30
 ipv6 address 2001:db8:144:2::6/64
 vrf vrf2
!
interface vlan111
 description VLAN 111 SVI (L2VNI 1000111)
 ip address 192.168.11.11/24
 ipv6 address fd00:60:1:1::11/64
 vrf vrf2
!
interface vlan112
 description VLAN 112 SVI (L2VNI 1000112)
 ip address 192.168.12.11/24
 ipv6 address fd00:50:1:1::11/64
 vrf vrf1
!
vrf vrf1
 vni 104001
!
vrf vrf2
 vni 104002
!
ip prefix-list LOCAL_HOST_VRF1 seq 1 permit 50.1.110.0/24
ip prefix-list LOCAL_HOST_VRF1 seq 2 deny any
ip prefix-list LOCAL_HOST_VRF2 seq 1 permit 60.1.110.0/24
ip prefix-list LOCAL_HOST_VRF2 seq 2 deny any
!
route-map ALLOW_LOBR permit 10
 match interface lo
exit
!
route-map ALLOW_LOBR permit 20
 match interface br1
exit
!
route-map ALLOW_LO permit 10
 match interface lo
exit
!
route-map HOST_ALLOW_1 permit 1
 match ip address prefix-list LOCAL_HOST_VRF1
exit
!
route-map HOST_ALLOW_2 permit 1
 match ip address prefix-list LOCAL_HOST_VRF2
exit
!
router bgp 660000
 bgp router-id 10.0.0.1
 bgp bestpath as-path multipath-relax
 bgp bestpath compare-routerid
 no bgp default ipv4-unicast
 neighbor TOR-LEAF-SPINE peer-group
 neighbor TOR-LEAF-SPINE advertisement-interval 0
 neighbor TOR-LEAF-SPINE timers 3 10
 neighbor TOR-LEAF-SPINE timers connect 5
 neighbor 10.254.0.2 remote-as external
 neighbor 10.254.0.2 peer-group TOR-LEAF-SPINE
 neighbor 10.254.0.6 remote-as external
 neighbor 10.254.0.6 peer-group TOR-LEAF-SPINE
 !
 address-family ipv4 unicast
  neighbor 10.254.0.2 activate
  neighbor 10.254.0.6 activate
  redistribute connected route-map ALLOW_LOBR
  neighbor TOR-LEAF-SPINE allowas-in 1
  maximum-paths 16
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 10.254.0.2 activate
  neighbor 10.254.0.6 activate
  neighbor TOR-LEAF-SPINE allowas-in 1
  advertise-all-vni
 exit-address-family
!
router bgp 660000 vrf vrf1
 bgp router-id 192.0.2.2
 no bgp network import-check
 neighbor 192.0.2.1 remote-as external
 !
 address-family ipv4 unicast
  neighbor 192.0.2.1 activate
  network 192.168.12.112/32
  redistribute connected route-map HOST_ALLOW_1
 exit-address-family
 !
 address-family ipv6 unicast
  neighbor 192.0.2.1 activate
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
  advertise-default-gw
 exit-address-family
!
router bgp 660000 vrf vrf2
 bgp router-id 192.0.2.6
 no bgp network import-check
 neighbor 192.0.2.5 remote-as external
 !
 address-family ipv4 unicast
  neighbor 192.0.2.5 activate
  network 192.168.11.111/32
  redistribute connected route-map HOST_ALLOW_2
 exit-address-family
 !
 address-family ipv6 unicast
  neighbor 192.0.2.5 activate
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
  advertise-default-gw
 exit-address-family
!
end
