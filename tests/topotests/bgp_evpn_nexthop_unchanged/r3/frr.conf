! SPDX-License-Identifier: ISC
!
! R3 - Leaf VTEP (AS 65003)
! Topology: R1 ---- R2 (spine) ---- R3
!                eBGP          eBGP
!
! R3 receives EVPN routes from R1 via R2.
! With the fix for #16209, the next-hop should be 10.0.0.1 (R1's loopback),
! NOT 192.168.23.2 (R2's link IP).
!
vrf vrf-100
 vni 100
 exit-vrf
!
interface lo
 ip address 10.0.0.3/32
!
interface eth0
 ip address 192.168.23.3/24
!
interface loop100 vrf vrf-100
 ip address 10.100.3.3/32
!
router bgp 65003
 bgp router-id 10.0.0.3
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 no bgp ebgp-requires-policy
 neighbor 192.168.23.2 remote-as 65002
 neighbor 192.168.23.2 capability extended-nexthop
 neighbor 192.168.23.2 update-source lo
 !
 address-family ipv4 unicast
  neighbor 192.168.23.2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 192.168.23.2 activate
  advertise-all-vni
 exit-address-family
!
router bgp 65003 vrf vrf-100
 bgp router-id 10.100.3.3
 no bgp network import-check
 address-family ipv4 unicast
  network 10.100.3.3/32
 exit-address-family
 address-family l2vpn evpn
  rd 65003:100
  route-target both 100:100
  advertise ipv4 unicast
 exit-address-family
!
ip route 192.168.12.0/24 192.168.23.2
ip route 10.0.0.1/32 192.168.23.2
