! SPDX-License-Identifier: ISC
!
! R1 - Leaf VTEP (AS 65001)
! Topology: R1 ---- R2 (spine) ---- R3
!                eBGP          eBGP
!
! R1 announces Type-3 EVPN routes with loopback 10.0.0.1 as next-hop
! R3 should receive these routes with next-hop preserved (not rewritten to R2's link IP)
!
vrf vrf-100
 vni 100
 exit-vrf
!
interface lo
 ip address 10.0.0.1/32
!
interface eth0
 ip address 192.168.12.1/24
!
interface loop100 vrf vrf-100
 ip address 10.100.1.1/32
!
router bgp 65001
 bgp router-id 10.0.0.1
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 no bgp ebgp-requires-policy
 neighbor 192.168.12.2 remote-as 65002
 neighbor 192.168.12.2 capability extended-nexthop
 neighbor 192.168.12.2 update-source lo
 !
 address-family ipv4 unicast
  neighbor 192.168.12.2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 192.168.12.2 activate
  advertise-all-vni
 exit-address-family
!
router bgp 65001 vrf vrf-100
 bgp router-id 10.100.1.1
 no bgp network import-check
 address-family ipv4 unicast
  network 10.100.1.1/32
 exit-address-family
 address-family l2vpn evpn
  rd 65001:100
  route-target both 100:100
  advertise ipv4 unicast
 exit-address-family
!
ip route 192.168.23.0/24 192.168.12.2
ip route 10.0.0.3/32 192.168.12.2
