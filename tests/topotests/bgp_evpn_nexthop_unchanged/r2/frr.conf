! SPDX-License-Identifier: ISC
!
! R2 - Spine (AS 65002)
! Topology: R1 ---- R2 (spine) ---- R3
!                eBGP          eBGP
!
! R2 passes EVPN routes between R1 and R3.
! With the fix for #16209, NEXTHOP_UNCHANGED is automatically set for EVPN eBGP peers,
! so R2 should NOT rewrite the next-hop of EVPN routes.
!
interface lo
 ip address 10.0.0.2/32
!
interface eth0
 ip address 192.168.12.2/24
!
interface eth1
 ip address 192.168.23.2/24
!
router bgp 65002
 bgp router-id 10.0.0.2
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 no bgp ebgp-requires-policy
 neighbor 192.168.12.1 remote-as 65001
 neighbor 192.168.12.1 capability extended-nexthop
 neighbor 192.168.12.1 update-source lo
 neighbor 192.168.12.1 ebgp-multihop 2
 neighbor 192.168.23.3 remote-as 65003
 neighbor 192.168.23.3 capability extended-nexthop
 neighbor 192.168.23.3 update-source lo
 neighbor 192.168.23.3 ebgp-multihop 2
 !
 address-family ipv4 unicast
  neighbor 192.168.12.1 activate
  neighbor 192.168.23.3 activate
  network 10.0.0.2/32
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 192.168.12.1 activate
  neighbor 192.168.23.3 activate
 exit-address-family
!
ip route 10.0.0.1/32 192.168.12.1
ip route 10.0.0.3/32 192.168.23.3
