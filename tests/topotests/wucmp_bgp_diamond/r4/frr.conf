!
! r4 configuration - Bottom of the diamond
!
int lo
 ip address 10.10.10.10/32
 ip address 10.1.1.1/32
!
int r4-eth0
 ip address 192.168.24.4/24
!
int r4-eth1
 ip address 192.168.34.4/24
!
router bgp 65004
 no bgp ebgp-requires-policy
 no bgp network import-check
 bgp router-id 4.4.4.4
 bgp bestpath as-path multipath-relax
 neighbor 192.168.24.2 remote-as 65002
 neighbor 192.168.24.2 timers 1 3
 neighbor 192.168.24.2 timers connect 1
 neighbor 192.168.34.3 remote-as 65003
 neighbor 192.168.34.3 timers 1 3
 neighbor 192.168.34.3 timers connect 1
 neighbor 11.11.11.11 remote-as 65001
 neighbor 11.11.11.11 update-source lo
 neighbor 11.11.11.11 ebgp-multihop
 neighbor 11.11.11.11 timers 1 3
 neighbor 11.11.11.11 timers connect 1
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor 192.168.24.2 activate
  neighbor 192.168.24.2 send-community extended
  neighbor 192.168.24.2 route-map TO-R2 out
  neighbor 192.168.34.3 activate
  neighbor 192.168.34.3 send-community extended
  neighbor 192.168.34.3 route-map TO-R3 out
  neighbor 11.11.11.11 activate
  neighbor 11.11.11.11 route-map ONLY-10-1-1-1 out
 exit-address-family
!
ip prefix-list BLOCK-10-1-1-1 deny 10.1.1.1/32
ip prefix-list BLOCK-10-1-1-1 permit 10.10.10.10/32
ip prefix-list BLOCK-10-1-1-1 permit 192.168.24.0/24
ip prefix-list BLOCK-10-1-1-1 permit 192.168.34.0/24
!
ip prefix-list ONLY-10-1-1-1-PREFIX permit 10.1.1.1/32
!
ip prefix-list 10-10-10-10 permit 10.10.10.10/32
!
route-map TO-R2 permit 10
 match ip address prefix-list 10-10-10-10
 set extcommunity bandwidth 1000
exit
!
route-map TO-R2 permit 20
 match ip address prefix-list BLOCK-10-1-1-1
exit
!
route-map TO-R3 permit 10
 match ip address prefix-list 10-10-10-10
 set extcommunity bandwidth 2000
exit
!
route-map TO-R3 permit 20
 match ip address prefix-list BLOCK-10-1-1-1
exit
!
route-map ONLY-10-1-1-1 permit 10
 match ip address prefix-list ONLY-10-1-1-1-PREFIX
exit
!

