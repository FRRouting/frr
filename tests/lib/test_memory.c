/**ThisfileispartofQuagga.**Quaggaisfreesoftware;youcanredistributeitand/ormodif
yit*underthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFounda
tion;eitherversion2,or(atyouroption)any*laterversion.**Quaggaisdistributedintheh
opethatitwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MER
CHANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformore
details.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthispr
ogram;seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinS
t,FifthFloor,Boston,MA02110-1301USA*/#include<zebra.h>#include<memory.h>DEFINE_M
GROUP(TEST_MEMORY,"memorytest")DEFINE_MTYPE_STATIC(TEST_MEMORY,TEST,"generictest
mtype")/*Memorytorturetests**Testsbelowaregenericbutcommentsarefocusedoninteract
ionwith*Paul'sproposedmemory'quick'cache,whichmayneverbeincludedin*CVS*/structth
read_master*master;#if0/*setto1tousesystemallocdirectly*/#undefXMALLOC#undefXCAL
LOC#undefXREALLOC#undefXFREE#defineXMALLOC(T,S)malloc((S))#defineXCALLOC(T,S)cal
loc(1,(S))#defineXREALLOC(T,P,S)realloc((P),(S))#defineXFREE(T,P)free((P))#endif
#defineTIMES10intmain(intargc,char**argv){void*a[10];inti;printf("mallocx,malloc
x,free,mallocx,freefree\n\n");/*simplecase,testcache*/for(i=0;i<TIMES;i++){a[0]=
XMALLOC(MTYPE_TEST,1024);memset(a[0],1,1024);a[1]=XMALLOC(MTYPE_TEST,1024);memse
t(a[1],1,1024);XFREE(MTYPE_TEST,a[0]);/*shouldgotocache*/a[0]=XMALLOC(MTYPE_TEST
,1024);/*shouldbesatisfiedfromcache*/XFREE(MTYPE_TEST,a[0]);XFREE(MTYPE_TEST,a[1
]);}printf("mallocx,mallocy,freex,mallocy,freefree\n\n");/*cacheshouldgoinvalid,
valid,invalid,etc..*/for(i=0;i<TIMES;i++){a[0]=XMALLOC(MTYPE_TEST,512);memset(a[
0],1,512);a[1]=XMALLOC(MTYPE_TEST,1024);/*invalidatecache*/memset(a[1],1,1024);X
FREE(MTYPE_TEST,a[0]);a[0]=XMALLOC(MTYPE_TEST,1024);XFREE(MTYPE_TEST,a[0]);XFREE
(MTYPE_TEST,a[1]);/*cacheshouldbecomevalidagainonnextrequest*/}printf("calloc\n\
n");/*testcalloc*/for(i=0;i<TIMES;i++){a[0]=XCALLOC(MTYPE_TEST,1024);memset(a[0]
,1,1024);a[1]=XCALLOC(MTYPE_TEST,512);/*invalidatecache*/memset(a[1],1,512);XFRE
E(MTYPE_TEST,a[1]);XFREE(MTYPE_TEST,a[0]);/*alloc==0,cachecanbecomevalidagainonn
extrequest*/}printf("callocandrealloc\n\n");/*checkcalloc+realloc*/for(i=0;i<TIM
ES;i++){printf("calloca01024\n");a[0]=XCALLOC(MTYPE_TEST,1024);memset(a[0],1,102
4/2);printf("calloc11024\n");a[1]=XCALLOC(MTYPE_TEST,1024);memset(a[1],1,1024/2)
;printf("realloc01024\n");a[3]=XREALLOC(MTYPE_TEST,a[0],2048);/*invalidatecache*
/if(a[3]!=NULL)a[0]=a[3];memset(a[0],1,1024);printf("calloc2512\n");a[2]=XCALLOC
(MTYPE_TEST,512);memset(a[2],1,512);printf("free102\n");XFREE(MTYPE_TEST,a[1]);X
FREE(MTYPE_TEST,a[0]);XFREE(MTYPE_TEST,a[2]);/*alloc==0,cachevalidnextrequest*/}
return0;}