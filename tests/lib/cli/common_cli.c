/**genericCLItesthelperfunctions**Copyright(C)2015byDavidLamparter,*forOpenSourc
eRouting/NetDEF,Inc.**Quaggaisfreesoftware;youcanredistributeitand/ormodifyit*un
derthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundation;e
itherversion2,or(atyouroption)any*laterversion.**Quaggaisdistributedinthehopetha
titwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERCHANTA
BILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformoredetail
s.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthisprogram;
seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt,Fift
hFloor,Boston,MA02110-1301USA*/#include<zebra.h>#include"thread.h"#include"vty.h
"#include"command.h"#include"memory.h"#include"memory_vty.h"#include"log.h"#incl
ude"common_cli.h"structthread_master*master;intdump_args(structvty*vty,constchar
*descr,intargc,structcmd_token*argv[]){inti;vty_out(vty,"%swith%dargs.\n",descr,
argc);for(i=0;i<argc;i++){vty_out(vty,"[%02d]%s@%s:%s\n",i,argv[i]->text,argv[i]
->varname,argv[i]->arg);}returnCMD_SUCCESS;}staticvoidvty_do_exit(intisexit){pri
ntf("\nend.\n");cmd_terminate();vty_terminate();thread_master_free(master);close
zlog();log_memstats(stderr,"testcli");if(!isexit)exit(0);}/*mainroutine.*/intmai
n(intargc,char**argv){structthreadthread;/*Setumaskbeforeanythingforsecurity*/um
ask(0027);/*masterinit.*/master=thread_master_create(NULL);openzlog("common-cli"
,"NONE",0,LOG_CONS|LOG_NDELAY|LOG_PID,LOG_DAEMON);zlog_set_level(ZLOG_DEST_SYSLO
G,ZLOG_DISABLED);zlog_set_level(ZLOG_DEST_STDOUT,ZLOG_DISABLED);zlog_set_level(Z
LOG_DEST_MONITOR,LOG_DEBUG);/*Libraryinits.*/cmd_init(1);cmd_hostname_set("test"
);vty_init(master);memory_init();test_init(argc,argv);vty_stdio(vty_do_exit);/*F
etchnextactivethread.*/while(thread_fetch(master,&thread))thread_call(&thread);/
*Notreached.*/exit(0);}