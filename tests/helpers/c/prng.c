/**Verysimpleprngtoallowforrandomizedtestswithreproducable*results.**Copyright(C
)2012byOpenSourceRouting.*Copyright(C)2012byInternetSystemsConsortium,Inc.("ISC"
)*Copyright(C)2017ChristianFranke**ThisfileispartofQuagga**Quaggaisfreesoftware;
youcanredistributeitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspu
blishedbythe*FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*latervers
ion.**Quaggaisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANTY;with
outeventheimpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.Seethe
GNU*GeneralPublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGNUGener
alPublicLicensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftw
are*Foundation,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#include<zeb
ra.h>#include<assert.h>#include<stdlib.h>#include<string.h>#include"prng.h"struc
tprng{uint64_tstate;};structprng*prng_new(unsignedlonglongseed){structprng*rv=ca
lloc(sizeof(*rv),1);assert(rv);rv->state=seed;returnrv;}/**Thisimplementationhas
originallybeenprovidedtomusllibcby*SzabolcsNagy<nszatport70dotnet>in2013underthe
termsof*theMITlicense.*ItisasimpleLCGwhichD.E.KnuthattributestoC.E.Haynesin*TAOC
PVol23.3.4*/intprng_rand(structprng*prng){prng->state=6364136223846793005ULL*prn
g->state+1;returnprng->state>>33;}constchar*prng_fuzz(structprng*prng,constchar*
string,constchar*charset,unsignedintoperations){staticcharbuf[256];unsignedintch
arset_len;unsignedinti;unsignedintoffset;unsignedintop;unsignedintcharacter;asse
rt(strlen(string)<sizeof(buf));strncpy(buf,string,sizeof(buf));charset_len=strle
n(charset);for(i=0;i<operations;i++){offset=prng_rand(prng)%strlen(buf);op=prng_
rand(prng)%3;switch(op){case0:/*replace*/character=prng_rand(prng)%charset_len;b
uf[offset]=charset[character];break;case1:/*remove*/memmove(buf+offset,buf+offse
t+1,strlen(buf)-offset);break;case2:/*insert*/assert(strlen(buf)+1<sizeof(buf));
memmove(buf+offset+1,buf+offset,strlen(buf)+1-offset);character=prng_rand(prng)%
charset_len;buf[offset]=charset[character];break;}}returnbuf;}voidprng_free(stru
ctprng*prng){free(prng);}