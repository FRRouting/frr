/*RIPrelatedvaluesandstructures.*Copyright(C)1997,1998,1999KunihiroIshiguro<kuni
hiro@zebra.org>**ThisfileispartofGNUZebra.**GNUZebraisfreesoftware;youcanredistr
ibuteitand/ormodifyit*underthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*
FreeSoftwareFoundation;eitherversion2,or(atyouroption)any*laterversion.**GNUZebr
aisdistributedinthehopethatitwillbeuseful,but*WITHOUTANYWARRANTY;withouteventhei
mpliedwarrantyof*MERCHANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*General
PublicLicenseformoredetails.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLic
ensealong*withthisprogram;seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundat
ion,Inc.,51FranklinSt,FifthFloor,Boston,MA02110-1301USA*/#ifndef_ZEBRA_RIP_H#def
ine_ZEBRA_RIP_H#include"qobj.h"#include"hook.h"#include"nexthop.h"#include"rip_m
emory.h"/*RIPversionnumber.*/#defineRIPv11#defineRIPv22/*N.B.stuffwillbreakif(RI
Pv1!=RI_RIP_VERSION_1)||(RIPv2!=RI_RIP_VERSION_2)*//*RIPcommandlist.*/#defineRIP
_REQUEST1#defineRIP_RESPONSE2#defineRIP_TRACEON3/*Obsolete*/#defineRIP_TRACEOFF4
/*Obsolete*/#defineRIP_POLL5#defineRIP_POLL_ENTRY6#defineRIP_COMMAND_MAX7/*RIPme
tricinfinityvalue.*/#defineRIP_METRIC_INFINITY16/*NormalRIPpacketminandmaxsize.*
/#defineRIP_PACKET_MINSIZ4#defineRIP_PACKET_MAXSIZ512#defineRIP_HEADER_SIZE4#def
ineRIP_RTE_SIZE20/*Maxcountofroutingtableentryinonerippacket.*/#defineRIP_MAX_RT
E((RIP_PACKET_MAXSIZ-RIP_HEADER_SIZE)/RIP_RTE_SIZE)/*RIPversion2multicastaddress
.*/#ifndefINADDR_RIP_GROUP#defineINADDR_RIP_GROUP0xe0000009/*224.0.0.9*/#endif/*
RIPtimers*/#defineRIP_UPDATE_TIMER_DEFAULT30#defineRIP_TIMEOUT_TIMER_DEFAULT180#
defineRIP_GARBAGE_TIMER_DEFAULT120/*RIPpeertimeoutvalue.*/#defineRIP_PEER_TIMER_
DEFAULT180/*RIPportnumber.*/#defineRIP_PORT_DEFAULT520#defineRIP_VTY_PORT2602/*D
efaultconfigurationfilename.*/#defineRIPD_DEFAULT_CONFIG"ripd.conf"/*RIProutetyp
es.*/#defineRIP_ROUTE_RTE0#defineRIP_ROUTE_STATIC1#defineRIP_ROUTE_DEFAULT2#defi
neRIP_ROUTE_REDISTRIBUTE3#defineRIP_ROUTE_INTERFACE4/*RIPv2specialRTEfamilytypes
*/#defineRIP_FAMILY_AUTH0xffff/*RIPv2authenticationtypes,forRIP_FAMILY_AUTHRTE's
*/#defineRIP_NO_AUTH0#defineRIP_AUTH_DATA1#defineRIP_AUTH_SIMPLE_PASSWORD2#defin
eRIP_AUTH_MD53/*RIPv2Simpleauthentication*/#defineRIP_AUTH_SIMPLE_SIZE16/*RIPv2M
D5authentication.*/#defineRIP_AUTH_MD5_SIZE16#defineRIP_AUTH_MD5_COMPAT_SIZERIP_
RTE_SIZE/*RIPstructure.*/structrip{/*RIPsocket.*/intsock;/*Defaultversionofripin
stance.*/intversion_send;/*version1or2(butnotboth)*/intversion_recv;/*version1or
2orboth*//*OutputbufferofRIP.*/structstream*obuf;/*RIProutinginformationbase.*/s
tructroute_table*table;/*RIPonlystaticroutinginformation.*/structroute_table*rou
te;/*RIPneighbor.*/structroute_table*neighbor;/*RIPthreads.*/structthread*t_read
;/*Updateandgarbagetimer.*/structthread*t_update;/*Triggeredupdatehack.*/inttrig
ger;structthread*t_triggered_update;structthread*t_triggered_interval;/*RIPtimer
values.*/unsignedlongupdate_time;unsignedlongtimeout_time;unsignedlonggarbage_ti
me;/*RIPdefaultmetric.*/intdefault_metric;/*RIPdefault-informationoriginate.*/ui
nt8_tdefault_information;char*default_information_route_map;/*RIPdefaultdistance
.*/uint8_tdistance;structroute_table*distance_table;/*RIPECMPflag*/unsignedintec
mp;/*Forredistributeroutemap.*/struct{char*name;structroute_map*map;intmetric_co
nfig;uint32_tmetric;}route_map[ZEBRA_ROUTE_MAX];QOBJ_FIELDS};DECLARE_QOBJ_TYPE(r
ip)/*RIProutingtableentrywhichbelongtorip_packet.*/structrte{uint16_tfamily;/*Ad
dressfamilyofthisroute.*/uint16_ttag;/*RouteTagwhichincludedinRIP2packet.*/struc
tin_addrprefix;/*Prefixofriproute.*/structin_addrmask;/*Netmaskofriproute.*/stru
ctin_addrnexthop;/*Nexthopofriproute.*/uint32_tmetric;/*Metricvalueofriproute.*/
};/*RIPpacketstructure.*/structrip_packet{unsignedcharcommand;/*CommandtypeofRIP
packet.*/unsignedcharversion;/*RIPversionwhichcomingfrompeer.*/unsignedcharpad1;
/*PaddingofRIPpacketheader.*/unsignedcharpad2;/*Sameasabove.*/structrterte[1];/*
Addressstructure.*/};/*BuffertoreadRIPpacket.*/unionrip_buf{structrip_packetrip_
packet;charbuf[RIP_PACKET_MAXSIZ];};/*RIProuteinformation.*/structrip_info{/*Thi
sroute'stype.*/inttype;/*Subtype.*/intsub_type;/*RIPnexthop.*/structnexthopnh;st
ructin_addrfrom;/*Metricofthisroute.*/uint32_tmetric;/*Externalmetricofthisroute
.iflearntfromanexternalmproto*/uint32_texternal_metric;/*Taginformationofthisrou
te.*/uint16_ttag;/*FlagsofRIProute.*/#defineRIP_RTF_FIB1#defineRIP_RTF_CHANGED2u
int8_tflags;/*Garbagecollecttimer.*/structthread*t_timeout;structthread*t_garbag
e_collect;/*Route-mapfutures-thisvariablescanbechanged.*/structin_addrnexthop_ou
t;uint8_tmetric_set;uint32_tmetric_out;uint16_ttag_out;ifindex_tifindex_out;stru
ctroute_node*rp;uint8_tdistance;#ifdefNEW_RIP_TABLEstructrip_info*next;structrip
_info*prev;#endif/*NEW_RIP_TABLE*/};typedefenum{RIP_NO_SPLIT_HORIZON=0,RIP_SPLIT
_HORIZON,RIP_SPLIT_HORIZON_POISONED_REVERSE}split_horizon_policy_t;/*RIPspecific
interfaceconfiguration.*/structrip_interface{/*RIPisenabledonthisinterface.*/int
enable_network;intenable_interface;/*RIPisrunningonthisinterface.*/intrunning;/*
RIPversioncontrol.*/intri_send;intri_receive;/*RIPv2broadcastmode*/intv2_broadca
st;/*RIPv2authenticationtype.*/intauth_type;/*RIPv2authenticationstring.*/char*a
uth_str;/*RIPv2authenticationkeychain.*/char*key_chain;/*valuetouseformd5->auth_
len*/uint8_tmd5_auth_len;/*Splithorizonflag.*/split_horizon_policy_tsplit_horizo
n;split_horizon_policy_tsplit_horizon_default;/*Forfiltertypeslot.*/#defineRIP_F
ILTER_IN0#defineRIP_FILTER_OUT1#defineRIP_FILTER_MAX2/*Access-list.*/structacces
s_list*list[RIP_FILTER_MAX];/*Prefix-list.*/structprefix_list*prefix[RIP_FILTER_
MAX];/*Route-map.*/structroute_map*routemap[RIP_FILTER_MAX];/*Wakeupthread.*/str
uctthread*t_wakeup;/*Interfacestatistics.*/intrecv_badpackets;intrecv_badroutes;
intsent_updates;/*Passiveinterface.*/intpassive;};/*RIPpeerinformation.*/structr
ip_peer{/*Peeraddress.*/structin_addraddr;/*PeerRIPtagvalue.*/intdomain;/*Lastup
datetime.*/time_tuptime;/*PeerRIPversion.*/uint8_tversion;/*Statistics.*/intrecv
_badpackets;intrecv_badroutes;/*Timeoutthread.*/structthread*t_timeout;};structr
ip_md5_info{uint16_tfamily;uint16_ttype;uint16_tpacket_len;uint8_tkeyid;uint8_ta
uth_len;uint32_tsequence;uint32_treserv1;uint32_treserv2;};structrip_md5_data{ui
nt16_tfamily;uint16_ttype;uint8_tdigest[16];};/*RIPaccepet/announcemethods.*/#de
fineRI_RIP_UNSPEC0#defineRI_RIP_VERSION_11#defineRI_RIP_VERSION_22#defineRI_RIP_
VERSION_1_AND_23#defineRI_RIP_VERSION_NONE4/*N.B.stuffwillbreakif(RIPv1!=RI_RIP_
VERSION_1)||(RIPv2!=RI_RIP_VERSION_2)*//*Defaultvaluefor"default-metric"command.
*/#defineRIP_DEFAULT_METRIC_DEFAULT1/*RIPevent.*/enumrip_event{RIP_READ,RIP_UPDA
TE_EVENT,RIP_TRIGGERED_UPDATE,};/*Macrofortimerturnon.*/#defineRIP_TIMER_ON(T,F,
V)thread_add_timer(master,(F),rinfo,(V),&(T))/*Macrofortimerturnoff.*/#defineRIP
_TIMER_OFF(X)THREAD_TIMER_OFF(X)/*Prototypes.*/externvoidrip_init(void);externvo
idrip_reset(void);externvoidrip_clean(void);externvoidrip_clean_network(void);ex
ternvoidrip_interfaces_clean(void);externvoidrip_interfaces_reset(void);externvo
idrip_passive_nondefault_clean(void);externvoidrip_if_init(void);externvoidrip_i
f_down_all(void);externvoidrip_route_map_init(void);externvoidrip_route_map_rese
t(void);externvoidrip_zclient_init(structthread_master*);externvoidrip_zclient_s
top(void);externvoidrip_zclient_reset(void);externvoidrip_offset_init(void);exte
rnintif_check_address(structin_addraddr);externintrip_request_send(structsockadd
r_in*,structinterface*,uint8_t,structconnected*);externintrip_neighbor_lookup(st
ructsockaddr_in*);externintrip_redistribute_check(int);externvoidrip_redistribut
e_add(inttype,intsub_type,structprefix_ipv4*p,structnexthop*nh,unsignedintmetric
,unsignedchardistance,route_tag_ttag);externvoidrip_redistribute_delete(int,int,
structprefix_ipv4*,ifindex_t);externvoidrip_redistribute_withdraw(int);externvoi
drip_zebra_ipv4_add(structroute_node*);externvoidrip_zebra_ipv4_delete(structrou
te_node*);externvoidrip_interface_multicast_set(int,structconnected*);externvoid
rip_distribute_update_interface(structinterface*);externvoidrip_if_rmap_update_i
nterface(structinterface*);externintconfig_write_rip_network(structvty*,int);ext
ernintconfig_write_rip_offset_list(structvty*);externintconfig_write_rip_redistr
ibute(structvty*,int);externvoidrip_peer_init(void);externvoidrip_peer_update(st
ructsockaddr_in*,uint8_t);externvoidrip_peer_bad_route(structsockaddr_in*);exter
nvoidrip_peer_bad_packet(structsockaddr_in*);externvoidrip_peer_display(structvt
y*);externstructrip_peer*rip_peer_lookup(structin_addr*);externstructrip_peer*ri
p_peer_lookup_next(structin_addr*);externintrip_offset_list_apply_in(structprefi
x_ipv4*,structinterface*,uint32_t*);externintrip_offset_list_apply_out(structpre
fix_ipv4*,structinterface*,uint32_t*);externvoidrip_offset_clean(void);externvoi
drip_info_free(structrip_info*);externuint8_trip_distance_apply(structrip_info*)
;externvoidrip_redistribute_clean(void);externstructrip_info*rip_ecmp_add(struct
rip_info*);externstructrip_info*rip_ecmp_replace(structrip_info*);externstructri
p_info*rip_ecmp_delete(structrip_info*);/*Thereisonlyoneripstrucutre.*/externstr
uctrip*rip;externstructzebra_privs_tripd_privs;/*Masterthreadstrucutre.*/externs
tructthread_master*master;/*RIPstatisticsforSNMP.*/externlongrip_global_route_ch
anges;externlongrip_global_queries;DECLARE_HOOK(rip_ifaddr_add,(structconnected*
ifc),(ifc))DECLARE_HOOK(rip_ifaddr_del,(structconnected*ifc),(ifc))#endif/*_ZEBR
A_RIP_H*/