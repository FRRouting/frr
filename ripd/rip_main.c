/*RIPdmainroutine.*Copyright(C)1997,98KunihiroIshiguro<kunihiro@zebra.org>**This
fileispartofGNUZebra.**GNUZebraisfreesoftware;youcanredistributeitand/ormodifyit
*underthetermsoftheGNUGeneralPublicLicenseaspublishedbythe*FreeSoftwareFoundatio
n;eitherversion2,or(atyouroption)any*laterversion.**GNUZebraisdistributedintheho
pethatitwillbeuseful,but*WITHOUTANYWARRANTY;withouteventheimpliedwarrantyof*MERC
HANTABILITYorFITNESSFORAPARTICULARPURPOSE.SeetheGNU*GeneralPublicLicenseformored
etails.**YoushouldhavereceivedacopyoftheGNUGeneralPublicLicensealong*withthispro
gram;seethefileCOPYING;ifnot,writetotheFreeSoftware*Foundation,Inc.,51FranklinSt
,FifthFloor,Boston,MA02110-1301USA*/#include<zebra.h>#include<lib/version.h>#inc
lude"getopt.h"#include"thread.h"#include"command.h"#include"memory.h"#include"me
mory_vty.h"#include"prefix.h"#include"filter.h"#include"keychain.h"#include"log.
h"#include"privs.h"#include"sigevent.h"#include"zclient.h"#include"vrf.h"#includ
e"libfrr.h"#include"ripd/ripd.h"/*ripdoptions.*/staticstructoptionlongopts[]={{"
retain",no_argument,NULL,'r'},{0}};/*ripdprivileges*/zebra_capabilities_t_caps_p
[]={ZCAP_NET_RAW,ZCAP_BIND};structzebra_privs_tripd_privs={#ifdefined(FRR_USER).
user=FRR_USER,#endif#ifdefinedFRR_GROUP.group=FRR_GROUP,#endif#ifdefVTY_GROUP.vt
y_group=VTY_GROUP,#endif.caps_p=_caps_p,.cap_num_p=2,.cap_num_i=0};/*Routeretain
modeflag.*/intretain_mode=0;/*Masterofthreads.*/structthread_master*master;stati
cstructfrr_daemon_inforipd_di;/*SIGHUPhandler.*/staticvoidsighup(void){zlog_info
("SIGHUPreceived");rip_clean();rip_reset();zlog_info("ripdrestarting!");/*Reload
configfile.*/vty_read_config(ripd_di.config_file,config_default);/*Trytoreturnto
normaloperation.*/}/*SIGINThandler.*/staticvoidsigint(void){zlog_notice("Termina
tingonsignal");if(!retain_mode)rip_clean();rip_zclient_stop();frr_fini();exit(0)
;}/*SIGUSR1handler.*/staticvoidsigusr1(void){zlog_rotate();}staticstructquagga_s
ignal_tripd_signals[]={{.signal=SIGHUP,.handler=&sighup,},{.signal=SIGUSR1,.hand
ler=&sigusr1,},{.signal=SIGINT,.handler=&sigint,},{.signal=SIGTERM,.handler=&sig
int,},};FRR_DAEMON_INFO(ripd,RIP,.vty_port=RIP_VTY_PORT,.proghelp="Implementatio
noftheRIProutingprotocol.",.signals=ripd_signals,.n_signals=array_size(ripd_sign
als),.privs=&ripd_privs,)/*Mainroutineofripd.*/intmain(intargc,char**argv){frr_p
reinit(&ripd_di,argc,argv);frr_opt_add("r",longopts,"-r,--retainWhenprogramtermi
nates,retainaddedroutebyripd.\n");/*Commandlineoptionparse.*/while(1){intopt;opt
=frr_getopt(argc,argv,NULL);if(opt==EOF)break;switch(opt){case0:break;case'r':re
tain_mode=1;break;default:frr_help_exit(1);break;}}/*Preparemasterthread.*/maste
r=frr_init();/*Libraryinitialization.*/keychain_init();vrf_init(NULL,NULL,NULL,N
ULL);/*RIPrelatedinitialization.*/rip_init();rip_if_init();rip_zclient_init(mast
er);rip_peer_init();frr_config_fork();frr_run(master);/*Notreached.*/return(0);}
